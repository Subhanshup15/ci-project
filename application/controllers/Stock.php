<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Stock extends CI_Controller {

    public function __construct()
    {
        parent::__construct();

        $this->load->model(array(
            'dashboard_model',
            'setting_model',
            'department_model',
            'patient_model'
        )); 
    }
 
 
    
public function stockUpdate()
    {
                
            error_reporting(0);
            echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
            date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
            echo date('d-m-Y H:i:s');
            echo "<script>
                $(document).ready(function () {
                     setTimeout('location.reload(true);', '60000');
                });
            </script>";
        
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
            ////////////////////////////////////////////////            OPD STOCK CODE          ////////////////////////////////////////////////
            ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                    
            $start_time= date('H:i',strtotime('18:15'));
            $time_date=date('H:i');
            
            $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'opd')->order_by('id','DESC')->limit(1)->get('daily_stock')->row();
            print_r('<br>');
            $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
            print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
            $current_date = date('Y-m-d');
            print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
            $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
            print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');
            
            $res = $this->db->where('create_date', $push_date)->get('patient')->result();
            if($current_date == $push_date)
            {
                $tabletCountArray = array();
                    $tabletCount = 0;
                    $index = 0;
                    $tabletRoundArray = array();
                    $c1 = 0;
                    
                    $startDate2 = date('Y-m-d', strtotime($push_date));
                    print_r('OPD Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                    
                    if($res != '' || $res != null){
                        //print_r($patientList);
                        // $tablets = $this->db->where('status','2')->get('pharma1')->result();
                        $tablets = $this->db->get('pharma1')->result();
                        foreach($tablets as $tab)
                        {
                            // $this->db->where('create_date like', '%'.$startDate2.'%');
                            // $this->db->where('ipd_opd', 'opd');
                            // $patientList =  $this->db->get('patient')->result();
                            
                            $this->db->select('yearly_reg_no');
                            $this->db->from('patient_ipd');
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where('ipd_opd', 'ipd');
                            $subQuery =  $this->db->get_compiled_select();
                            
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                            $this->db->where('ipd_opd', 'opd');
                            $this->db->or_where('old_reg_no !=', '');
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where('ipd_opd', 'opd');
                            $patientList =  $this->db->get('patient')->result();
                            
                            //print_r(count($patientList));echo '<br>';
                            foreach($patientList as $patient)
                            {
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='opd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = '%'.$new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = '%'.$che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                              
                                $ss=date('Y-m-d',strtotime($patient->create_date));
                                
                              
                                if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
    
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else{
                                              
                                           $tretment=$this->db->select("*")
    
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                       }
    
                                if($tretment){
                                    if(stripos($tretment->RX1, $tab->name) !== false){
                                        // echo 'RX1   '.$tretment->RX1;
                                        $str = $tretment->RX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX2, $tab->name) !== false){
                                        // echo 'RX2   '.$tretment->RX2;
                                        $str = $tretment->RX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }

                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX3, $tab->name) !== false)
                                    {
                                        // echo 'RX3   '.$tretment->RX3;
                                        $str = $tretment->RX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX4, $tab->name) !== false){
                                        // echo 'RX4   '.$tretment->RX4;
                                        $str = $tretment->RX4;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX5, $tab->name) !== false){
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->RX5;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        $tabletCount = $tabletCount + 1;
                                    }


                                    if(stripos($tretment->RX_other, $tab->name) !== false){
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->RX_other;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX_other1, $tab->name) !== false){
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->RX_other1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->other_equipment, $tab->name) !== false){
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->other_equipment;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        $tabletCount = $tabletCount + 1;
                                    }
                                }
                                        $total_last_count = 0;
                                        $total_quantity = $c3;
                                        $total_count = $total_quantity * $tab_days;
                                        $total_last_count = $c1 * $tab_days;
                                        
                                    
                                    if(stripos($tretment->RX1, $tab->name) !== false || stripos($tretment->RX2, $tab->name) !== false 
                                        || stripos($tretment->RX3, $tab->name) !== false || stripos($tretment->RX4, $tab->name) !== false 
                                        || stripos($tretment->RX5, $tab->name) !== false || stripos($tretment->RX_other, $tab->name) !== false
                                        || stripos($tretment->RX_other1, $tab->name) !== false || stripos($tretment->other_equipment, $tab->name) !== false)  
                                        {
                                            $patient_array = array(
                                            'patient_auto_id'=>$patient->id,
                                            'yearly_reg_no'=>$patient->yearly_reg_no,
                                            'old_reg_no'=>$patient->old_reg_no,
                                            'age'=>$patient->date_of_birth,
                                            'sex'=>$patient->sex,
                                            'address'=>$patient->address,
                                            'name'=>$patient->firstname,
                                            'dignosis'=>$patient->dignosis,
                                            'RX1'=>$tab->name,
                                            'RX1_despense'=>$total_count,
                                            'tab_name'=>$tab->name,
                                            'tab_count'=>$total_quantity,
                                            'tab_days'=>$tab_days,
                                            'create_date'=>$patient->create_date,
                                            'total_despense'=>$total_last_count
                                            ); 
                                            $a = $this->db->insert('pharma_daily_opd_patient', $patient_array);
                                        }


                                        
                            }
                             //print_r($tabletRoundArray);
                             $tabletCountArray[$index] = ['tab_count' => $tabletCount, 'tab_name'=>$tab->name, 'tab_round'=>$c1, 'tab_days'=>$tab_days];
                             $index = $index + 1; 
                             $tabletCount = $c1 = 0;
                           
                        }
                    }
                    else
                    {
                        foreach($tablets as $tab){
                            $tabletCountArray[$index] = ['tab_count' => 0, 'tab_name'=>$tab->name, 'tab_round'=>0, 'tab_days'=>0];
                            $index = $index + 1;
                        }
                    }
                    //print_r('<br><br>');
                    //print_r($tabletCountArray);
                    for($i=0; $i<count($tabletCountArray);$i++){
                        echo '<br>';
                        // $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%', 'status'=>'2'])->get('pharma1')->row();
                        $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%'])->get('pharma1')->row();
                        print_r($tabletCountArray[$i]['tab_name']);echo '<br>';
                        print_r($res->closing_bal);echo '<br>';
                        //print_r(intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                        print_r($tabletCountArray[$i]['tab_round']*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                        
                        $tab_name = $tabletCountArray[$i]['tab_name'];
                        //$daily_despensing_bal = intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']);
                        echo'<br><br><br><br><br><br>';
                        echo 'TAB_ROUND=====>'.$tabletCountArray[$i]['tab_round'];echo'<br>';
                        echo 'TAB_DAYS======>'.$tabletCountArray[$i]['tab_days'];
                        echo'<br><br><br><br><br><br>';

                        $daily_despensing_bal = 0;

                        $patient_despense =  $this->db->select('DISTINCT(tab_name) as Tab_name,sum(RX1_despense) as despense')
                        ->from('pharma_daily_opd_patient')
                        ->where('tab_name',$tab_name)
                        ->where('create_date',$startDate2)
                        ->get()
                        ->result();
                    $daily_despensing_bal = 0;
                    foreach($patient_despense as $test)
                    {
                      if(stripos($tab_name, $test->Tab_name) !== false)
                      {
                          $daily_despensing_bal = $test->despense;
                      }
                      
                    }
                           echo'<br><br><br><br><br><br>';
                            echo 'Daily_despense_balance=======>'.$daily_despensing_bal = $daily_despensing_bal;
                           echo'<br><br><br><br><br><br>';
                      
                        //$daily_despensing_bal = $tabletCountArray[$i]['tab_round'] * $tabletCountArray[$i]['tab_days'];
                        $daily_opening_bal = $res->closing_bal;
                        $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                        ////print_r($daily_opening_bal);echo '<br>';
                        ////echo '==============';
                        ////print_r($daily_closing_bal);echo '<br>';
                        
                        
                        //////comment for test ////////////////
                        if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                        {
                            $current_stock = $daily_opening_bal;
                            $added_stock = $res->opening_bal;
                            $opening_bal_temp = intval($daily_opening_bal) + intval($res->opening_bal);
                            $total_stock = $opening_bal_temp;
                            $daily_closing_bal = intval($opening_bal_temp)-intval($daily_despensing_bal);
                            
                            ////print_r('c stock => ');print_r($current_stock);print_r('<br>');
                            ////print_r('add stock => ');print_r($added_stock);print_r('<br>');
                            ////print_r('total stock');print_r($total_stock);print_r('<br>');
                            
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_added_bal' => $added_stock,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            (Object)$postData2 = ([
                                'name' => $tab_name,
                                'current_stock' => $current_stock,
                                'added_stock' => $added_stock,
                                'total_stock' => $total_stock,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'status' => $res->status
                            ]);
                            if($this->db->insert('daily_stock', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1)){
                                    //print_r('Stock Updated Successfully');
                                    if($this->db->insert('stock_register', $postData2)){
                                        print_r('OPD Stock Updated Successfully');
                                    }
                                }
                            }
                        }
                        else{
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            if($this->db->insert('daily_stock', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1)){
                                    print_r('OPD Stock Updated Successfully');
                                }
                            }
                        }
                    }
                //echo '<br><br>'.$tabletCount;
            }
            elseif($current_date > $push_date)
            {
                $tabletCountArray = array();
                    $tabletCount = 0;
                    $index = 0;
                    $tabletRoundArray = array();
                    $c1 = 0;
                    
                    $startDate2 = date('Y-m-d', strtotime($push_date));
                    print_r('OPD Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                    
                    if($res != '' || $res != null){
                        //print_r($patientList);
                        // $tablets = $this->db->where('status','2')->get('pharma1')->result();
                        $tablets = $this->db->get('pharma1')->result();
                        foreach($tablets as $tab)
                        {
                            // $this->db->where('create_date like', '%'.$startDate2.'%');
                            // $this->db->where('ipd_opd', 'opd');
                            // $patientList =  $this->db->get('patient')->result();
                            
                            $this->db->select('yearly_reg_no');
                            $this->db->from('patient_ipd');
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where('ipd_opd', 'ipd');
                            $subQuery =  $this->db->get_compiled_select();
                            
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                            $this->db->where('ipd_opd', 'opd');
                            $this->db->or_where('old_reg_no !=', '');
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where('ipd_opd', 'opd');
                            $patientList =  $this->db->get('patient')->result();
                            
                            //print_r(count($patientList));echo '<br>';
                            foreach($patientList as $patient)
                            {
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='opd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = '%'.$new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = '%'.$che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                              
                                $ss=date('Y-m-d',strtotime($patient->create_date));
                                
                              
                                if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
    
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else{
                                              
                                           $tretment=$this->db->select("*")
    
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                       }
    
                                if($tretment){
                                    if(stripos($tretment->RX1, $tab->name) !== false){
                                        // echo 'RX1   '.$tretment->RX1;
                                        $str = $tretment->RX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX2, $tab->name) !== false){
                                        // echo 'RX2   '.$tretment->RX2;
                                        $str = $tretment->RX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }

                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX3, $tab->name) !== false)
                                    {
                                        // echo 'RX3   '.$tretment->RX3;
                                        $str = $tretment->RX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX4, $tab->name) !== false){
                                        // echo 'RX4   '.$tretment->RX4;
                                        $str = $tretment->RX4;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX5, $tab->name) !== false){
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->RX5;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        $tabletCount = $tabletCount + 1;
                                    }

                                    if(stripos($tretment->RX_other, $tab->name) !== false){
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->RX_other;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX_other1, $tab->name) !== false){
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->RX_other1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        $tabletCount = $tabletCount + 1;
                                    }
                                 
                                }
                                        $total_last_count = 0;
                                        $total_quantity = $c3;
                                        $total_count = $total_quantity * $tab_days;
                                        $total_last_count = $c1 * $tab_days;
                                        
                                    
                                    if(stripos($tretment->RX1, $tab->name) !== false || stripos($tretment->RX2, $tab->name) !== false 
                                        || stripos($tretment->RX3, $tab->name) !== false || stripos($tretment->RX4, $tab->name) !== false 
                                        || stripos($tretment->RX5, $tab->name) !== false || stripos($tretment->RX_other, $tab->name) !== false
                                        || stripos($tretment->RX_other1, $tab->name) !== false || stripos($tretment->other_equipment, $tab->name) !== false)  
                                        {
                                            $patient_array = array(
                                            'patient_auto_id'=>$patient->id,
                                            'yearly_reg_no'=>$patient->yearly_reg_no,
                                            'old_reg_no'=>$patient->old_reg_no,
                                            'age'=>$patient->date_of_birth,
                                            'sex'=>$patient->sex,
                                            'address'=>$patient->address,
                                            'name'=>$patient->firstname,
                                            'dignosis'=>$patient->dignosis,
                                            'RX1'=>$tab->name,
                                            'RX1_despense'=>$total_count,
                                            'tab_name'=>$tab->name,
                                            'tab_count'=>$total_quantity,
                                            'tab_days'=>$tab_days,
                                            'create_date'=>$patient->create_date,
                                            'total_despense'=>$total_last_count
                                            ); 
                                            $a = $this->db->insert('pharma_daily_opd_patient', $patient_array);
                                        }


                                        
                            }
                             //print_r($tabletRoundArray);
                             $tabletCountArray[$index] = ['tab_count' => $tabletCount, 'tab_name'=>$tab->name, 'tab_round'=>$c1, 'tab_days'=>$tab_days];
                             $index = $index + 1; 
                             $tabletCount = $c1 = 0;
                           
                        }
                    }
                    else
                    {
                        foreach($tablets as $tab){
                            $tabletCountArray[$index] = ['tab_count' => 0, 'tab_name'=>$tab->name, 'tab_round'=>0, 'tab_days'=>0];
                            $index = $index + 1;
                        }
                    }
                    //print_r('<br><br>');
                    //print_r($tabletCountArray);
                    for($i=0; $i<count($tabletCountArray);$i++){
                        echo '<br>';
                        // $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%', 'status'=>'2'])->get('pharma1')->row();
                        $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%'])->get('pharma1')->row();
                        print_r($tabletCountArray[$i]['tab_name']);echo '<br>';
                        print_r($res->closing_bal);echo '<br>';
                        //print_r(intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                        print_r($tabletCountArray[$i]['tab_round']*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                        
                        $tab_name = $tabletCountArray[$i]['tab_name'];
                        //$daily_despensing_bal = intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']);
                        echo'<br><br><br><br><br><br>';
                        echo 'TAB_ROUND=====>'.$tabletCountArray[$i]['tab_round'];echo'<br>';
                        echo 'TAB_DAYS======>'.$tabletCountArray[$i]['tab_days'];
                        echo'<br><br><br><br><br><br>';

                        $daily_despensing_bal = 0;

                        $patient_despense =  $this->db->select('DISTINCT(tab_name) as Tab_name,sum(RX1_despense) as despense')
                        ->from('pharma_daily_opd_patient')
                        ->where('tab_name',$tab_name)
                        ->where('create_date',$startDate2)
                        ->get()
                        ->result();
                    $daily_despensing_bal = 0;
                    foreach($patient_despense as $test)
                    {
                      if(stripos($tab_name, $test->Tab_name) !== false)
                      {
                          $daily_despensing_bal = $test->despense;
                      }
                      
                    }
                           echo'<br><br><br><br><br><br>';
                            echo 'Daily_despense_balance=======>'.$daily_despensing_bal = $daily_despensing_bal;
                           echo'<br><br><br><br><br><br>';
                      
                        //$daily_despensing_bal = $tabletCountArray[$i]['tab_round'] * $tabletCountArray[$i]['tab_days'];
                        $daily_opening_bal = $res->closing_bal;
                        $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                        ////print_r($daily_opening_bal);echo '<br>';
                        ////echo '==============';
                        ////print_r($daily_closing_bal);echo '<br>';
                        
                        
                        //////comment for test ////////////////
                        if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                        {
                            $current_stock = $daily_opening_bal;
                            $added_stock = $res->opening_bal;
                            $opening_bal_temp = intval($daily_opening_bal) + intval($res->opening_bal);
                            $total_stock = $opening_bal_temp;
                            $daily_closing_bal = intval($opening_bal_temp)-intval($daily_despensing_bal);
                            
                            ////print_r('c stock => ');print_r($current_stock);print_r('<br>');
                            ////print_r('add stock => ');print_r($added_stock);print_r('<br>');
                            ////print_r('total stock');print_r($total_stock);print_r('<br>');
                            
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_added_bal' => $added_stock,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            (Object)$postData2 = ([
                                'name' => $tab_name,
                                'current_stock' => $current_stock,
                                'added_stock' => $added_stock,
                                'total_stock' => $total_stock,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'status' => $res->status
                            ]);
                            if($this->db->insert('daily_stock', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1)){
                                    //print_r('Stock Updated Successfully');
                                    if($this->db->insert('stock_register', $postData2)){
                                        print_r('OPD Stock Updated Successfully');
                                    }
                                }
                            }
                        }
                        else{
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            if($this->db->insert('daily_stock', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1)){
                                    print_r('OPD Stock Updated Successfully');
                                }
                            }
                        }
                    }
                //echo '<br><br>'.$tabletCount;
            }
                
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////            IPD STOCK CODE          ////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    
            $start_time= date('H:i',strtotime('18:15'));
            $time_date=date('H:i');
            
            $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'ipd')->order_by('id','DESC')->limit(1)->get('daily_ipd_stock')->row();
            print_r('<br>');
            $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
            print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
            $current_date = date('Y-m-d');
            print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
            $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
            print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');
            
            $res = $this->db->where('create_date', $push_date)->get('patient_ipd')->result();
            if($current_date == $push_date)
            {
                $startDate2 = date('Y-m-d', strtotime($push_date));
                    print_r('IPD Stock Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                    
                    $tabletCountArray = array();
                    $tabletCount = 0;
                    $index = 0;
                    $tabletRoundArray = array();
                    $c1 = 0;
                    $tabDays = 0;
                    $temp1 = 0;
                    $temp2 = 0;
                        
                    if($res != '' || $res != null)
                    {
                        //print_r($patientList);
                        // $tablets = $this->db->where('status','2')->get('pharma1')->result();
                        $tablets = $this->db->get('pharma1')->result();
                        foreach($tablets as $tab){
                            // $this->db->where('create_date like', '%'.$startDate2.'%');
                            // $this->db->where('ipd_opd', 'ipd');
                            // $patientList =  $this->db->get('patient_ipd')->result();
                            
                            $start_date = date('Y-m-d',strtotime($push_date));
                            $end_date  = date('Y-m-d',strtotime($push_date));
                            $start_date_f= $start_date." 23:59:00";
                            $end_date_f= $end_date."23:59:00";
                            
                        //    $patients1 = $this->db->select("*")
                        //        ->from('patient_ipd')
                        //        ->join('department','department.dprt_id = patient_ipd.department_id')
                        //        ->where('discharge_date >=', $start_date_f)
                        //      	//->or_where('discharge_date <=', $start_date_f)
                        //      	->or_where('discharge_date like', $start_date)
                        //        ->where('create_date <=', $end_date_f)
                        //        ->where('ipd_opd', 'ipd')
                        //        ->get()
                        //        ->result();
                                    
                            //print_r('q1   ');
                            //print_r($this->db->last_query());
                                    
                         //   $patients2 = $this->db->select("*")
                         //       ->from('patient_ipd')
                         //       ->join('department','department.dprt_id = patient_ipd.department_id')
                         //       ->where('create_date <=', $end_date_f)
                         //       ->where('discharge_date LIKE', '%0000-00-00%')
                         //       ->where('ipd_opd', 'ipd')
                         //       ->get()
                         //       ->result();
                            
                          
                          
                          
                          
                          
                            $patients1 = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                            ->where('discharge_date >=', $end_date)
                            ->where('create_date <=', $end_date)
                            ->where('ipd_opd', 'ipd')
                            ->or_where('discharge_date like', '%'.$start_date_f.'%')
                            ->get()
                            ->result();  
                                            
                            $patients2=$this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                            ->where ('ipd_opd', $section)
                            ->where('discharge_date LIKE', '%0000-00-00%')
                            ->where('create_date <=', 'ipd')
                            ->get()

                            ->result();
                                                //print_r('q2   ');                    
                            //print_r($this->db->last_query());
                            
                            $patientList = array_merge($patients1, $patients2);
                            
                            //print_r($patientList);echo '<br>';
                            foreach($patientList as $patient){
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = $new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = $che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                                // $tretment1=$this->db->select("*")
                                //     ->from('treatments1')
                                //     ->where('dignosis LIKE',$p_dignosis)
                                //     ->where('proxy_id',$patient->proxy_id)
                                //     ->where('department_id',$patient->department_id)
                                //     ->where('ipd_opd',$section_tret)
                                //     ->get()
                                //     ->row();
                                
                                
                                // $DISTRIBUTION_IPD=$tretment1->DISTRIBUTION_IPD; 
                                // $ipd_days=$tretment1->ipd_days; 
                                // $last_days=$ipd_days - $DISTRIBUTION_IPD;
                                // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1;
                                
                                //print_r('=>>>>');print_r($DISTRIBUTION_IPD);print_r('<br>');
                                
                                    
                                 if($patient->manual_status==0){
                                      if($patient->proxy_id){
			                          
			                         
                                     $tretment=$this->db->select("*")

			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else{
                                          
                                       $tretment=$this->db->select("*")

			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                     
                            //           if(empty($tretment)){
                            //           $tretment=$this->db->select("*")
                            //           ->from('treatments1')
                            //           ->where('department_id',$patient->department_id)
			                         // ->where('ipd_opd',$patient->department_id)
                            //          ->get()
                            //          ->row();   
                                         
                            //           }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                   }
                                    
                                echo '<br><br><br>';
                              echo   $datefrom_n=date('Y-m-d',strtotime($startDate2));  
			                      echo'<br>';
			                 echo    $admit_date=date('Y-m-d',strtotime($patient->create_date));
                               echo'<br>';
                                 if($patient->discharge_date=='0000-00-00'){
                                     //$discharge_date=date('Y-m-d', strtotime($admit_date. ' + 5 days'));
                                     
                                     $today_date=date('Y-m-d', strtotime($datefrom_n));
                                 } else{
                                 //$discharge_date=date('Y-m-d',strtotime($patient->discharge_date));
                                  $today_date=date('Y-m-d', strtotime($datefrom_n));
                                 }  
                                 
                                $date1=date_create($admit_date);
                                $date2=date_create($today_date);
                                $diff=date_diff($date1,$date2);
                            
                                echo 'Days difference in Create_date and Discharge Date====>'.$n= $diff->format("%a");
                                echo '<br>';
                                echo 'PAtient_name======>'.$patient->firstname;
                                echo '<br>';
                                
                                echo  'Distribution days====>'.$DISTRIBUTION_IPD=$tretment->DISTRIBUTION_IPD; 
                              	echo '<br>';
                                echo 'IPD DAYS====>   '.$ipd_days=$tretment->ipd_days; 
                              	$DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1; 
                                $last_days=$ipd_days - $DISTRIBUTION_IPD;
                             
                              	echo '<br><br><br>';
                              
                              
                              if($DISTRIBUTION_IPD < $n)
                              {
			                         if($patient->manual_status==0)
                                     {
                                      if($patient->proxy_id)
                                      {
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->order_by('id','desc')
                                         ->get()
                                         ->row();
                                         //print_r($this->db->last_query());
                                      }
                                      else
                                      {
                                         $tretment=$this->db->select("*")
                                       ->from('treatments1')
                                       ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                       ->where('ipd_opd ',$section_tret)
                                        ->order_by('id','desc')
                                       ->get()
                                       ->row();  
                                     
                                      }
                                  }else
                                     {
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                   }
			                         
			                      $RX1= $tretment->RX1;
			                      $RX2= $tretment->RX2;
			                      $RX3= $tretment->RX3;
			                      $RX4= $tretment->RX4;
			                      $RX5= $tretment->RX5;
			                      
			                      $RX_other= $tretment->RX_other;
			                      $RX_other1= $tretment->RX_other1;
			                      $other_equipment= $tretment->other_equipment;
			                         
			                         
			                     }
                              
                                if($tretment){
                                    if(stripos($tretment->RX1, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX1   '.$tretment->RX1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        ////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX2, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX2   '.$tretment->RX2;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        /////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX3, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX3   '.$tretment->RX3;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        //////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX4, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX4   '.$tretment->RX4;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX4;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        $c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        //////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX5, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX5   '.$tretment->RX5;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX5;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count-1;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }


                                    if(stripos($tretment->RX_other, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX_other   '.$tretment->RX_other;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX_other;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count-1;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX_other1, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX_other1  '.$tretment->RX_other1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX_other1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count-1;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->other_equipment, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'other_equipment  '.$tretment->other_equipment;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->other_equipment;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count-1;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                }  
                                
                                $total_count = 0;
                            $total_quantity = $temp2;
                           $total_quantity_rx = $temp2;
                            if(stripos($tretment->RX1, $tab->name) !== false || stripos($tretment->RX2, $tab->name) !== false 
                                || stripos($tretment->RX3, $tab->name) !== false || stripos($tretment->RX4, $tab->name) !== false 
                                || stripos($tretment->RX5, $tab->name) !== false || stripos($tretment->RX_other, $tab->name) !== false
                                || stripos($tretment->RX_other1, $tab->name) !== false || stripos($tretment->other_equipment, $tab->name) !== false)  
                                {
                                    $patient_array = array(
                                    'patient_auto_id'=>$patient->id,
                                    'yearly_reg_no'=>$patient->yearly_reg_no,
                                    'old_reg_no'=>$patient->old_reg_no,
                                    'age'=>$patient->date_of_birth,
                                    'sex'=>$patient->sex,
                                    'address'=>$patient->address,
                                    'name'=>$patient->firstname,
                                    'dignosis'=>$patient->dignosis,
                                    'RX1'=>$tab->name,
                                    'RX1_despense'=>$total_count = $total_quantity_rx,
                                    'tab_name'=>$tab->name,
                                    'tab_count'=>$total_quantity_rx,
                                    'tab_days'=>$tab_days1,
                                    'create_date'=>$patient->create_date,
                                     'push_date'=>$push_date,
                                    'discharge_date'=>$patient->discharge_date,
                                    ); 
                                    $a = $this->db->insert('pharma_daily_ipd_patient', $patient_array);
                                
                                }
                                        
                            }
                            
                            
                            $patientList1 = $this->db->select("*")
                                ->from('patient_ipd')
                                ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                                ->where('ipd_opd', 'ipd')
                                ->where('discharge_date >=', $start_date)
                                ->where('discharge_date <=', $end_date)
                                //->where('create_date LIKE', $year)
                                ->get()
                                ->result();
                            
                            foreach($patientList1 as $patient){
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = $new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = $che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                                // $tretment1=$this->db->select("*")
                                //     ->from('treatments1')
                                //     ->where('dignosis LIKE',$p_dignosis)
                                //     ->where('proxy_id',$patient->proxy_id)
                                //     ->where('department_id',$patient->department_id)
                                //     ->where('ipd_opd',$section_tret)
                                //     ->get()
                                //     ->row();
                                
                                
                                // $DISTRIBUTION_IPD=$tretment1->DISTRIBUTION_IPD; 
                                // $ipd_days=$tretment1->ipd_days; 
                                // $last_days=$ipd_days - $DISTRIBUTION_IPD;
                                // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1;
                                
                                //print_r('=>>>>');print_r($DISTRIBUTION_IPD);print_r('<br>');
                                
                                // if($patient->manual_status==0){
                                //     if($patient->proxy_id){
                                //         $tretment=$this->db->select("*")
                                //             ->from('treatments1')
                                //             ->where('dignosis LIKE',$p_dignosis)
                                //             ->where('proxy_id',$patient->proxy_id)
                                //             ->where('department_id',$patient->department_id)
                                //             ->where('ipd_opd ',$section_tret)
                                //             ->get()
                                //             ->row();
                                //     }
                                // }else{
                                //     $tretment=$this->db->select("*")
                                //         ->from('manual_treatments')
                                //         ->where('patient_id_auto',$patient->id)
                                //         ->where('dignosis LIKE',$p_dignosis)
                                //         ->where('ipd_opd ',$section_tret)
                                //         ->get()
                                //         ->row();
                                // }
                                
                                
                                 if($patient->manual_status==0){
                                        $section_tret='ipd';
                                        // $tretarray=$this->db->select("*")
                                        //     ->from('treatments1')
                                        //     ->where('dignosis LIKE',$p_dignosis)
                                        //     ->where('proxy_id',$patient->proxy_id)
                                        //     ->where('department_id',$patient->department_id)
                                        //     ->where('ipd_opd',$section_tret)
                                        //     ->get()->result();
                                        
                                        if($patient->proxy_id){
                                            $tretment=$this->db->select("*")
                                                ->from('treatments1')
                                                ->where('dignosis LIKE',$p_dignosis)
                                                ->where('proxy_id',$patient->proxy_id)
                                                ->where('department_id',$patient->department_id)
                                                //->order_by("id", "desc")
                                                ->where('ipd_opd ',$section_tret)
                                                ->get()
                                                ->row();
                                        }
                                        else{
                                            $tretment=$this->db->select("*")
                                                ->from('treatments1')
                                                ->where('dignosis LIKE',$p_dignosis)
                                                ->where('department_id',$patient->department_id)
                                               // ->order_by("id", "desc")
                                                ->where('ipd_opd ',$section_tret)
                                                ->get()
                                                ->row();  
                                        
                                        //     if(empty($tretment)){
                                        //         $tretment=$this->db->select("*")
                                        //             ->from('treatments1')
                                        //             ->where('department_id',$patient->department_id)
                                        //             ->where('ipd_opd',$patient->department_id)
                                        //             ->get()
                                        //             ->row();   
                                            }
                                        // }
                                    }else{
                                        $tretment=$this->db->select("*")
                                            ->from('manual_treatments')
                                            ->where('patient_id_auto',$patient->id)
                                            ->where('dignosis LIKE',$p_dignosis)
                                            ->where('ipd_opd ',$section_tret)
                                            ->get()
                                            ->row();
                                    }
                              
                             
			                      
			                     
                                
                                
                                if($tretment){
                                    if(stripos($tretment->DRX1, $tab->name) !== false){
                                        echo 'DRX1   '.$tretment->DRX1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                  $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                  $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                  $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                       $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                       $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->DRX2, $tab->name) !== false){
                                        echo 'DRX2   '.$tretment->DRX2;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                //print_r($ar1);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                  $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
    
                                                
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                  $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                      $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->DRX3, $tab->name) !== false){
                                        echo 'DRX3   '.$tretment->DRX3;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                //print_r($ar1);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                   $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                   $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                      $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                }
    
                                $total_count = 0;
                                $total_quantity = $c3;
                                $total_quantity_drx = $c3;
                              
                                if(stripos($tretment->DRX1, $tab->name) !== false 
                                || stripos($tretment->DRX2, $tab->name) !== false || stripos($tretment->DRX3, $tab->name) !== false)  
                                    {
                                        $patient_array = array(
                                        'patient_auto_id'=>$patient->id,
                                        'yearly_reg_no'=>$patient->yearly_reg_no,
                                        'old_reg_no'=>$patient->old_reg_no,
                                        'age'=>$patient->date_of_birth,
                                        'sex'=>$patient->sex,
                                        'address'=>$patient->address,
                                        'name'=>$patient->firstname,
                                        'dignosis'=>$patient->dignosis,
                                        'RX1'=>$tab->name,
                                        'RX1_despense'=>NULL,
                                        'DRX'=>$tab->name,
                                        'DRX_despense'=>$total_count = $total_quantity_drx * $tab_days1,
                                        'tab_name'=>$tab->name,
                                        'tab_count'=>$total_quantity,
                                        'tab_days'=>$tab_days1,
                                        'create_date'=>$patient->create_date,
                                        'push_date'=>$push_date,
                                        'discharge_date'=>$patient->discharge_date,
                                        ); 
                                        $a = $this->db->insert('pharma_daily_ipd_patient', $patient_array);
                                    }
    
                                        
                            }
                            
                          	$tabletCountArray[$index] = ['tab_count' => $tabletCount, 'tab_name'=>$tab->name, 'tab_round'=>$temp1,'tab_round2'=>$c3, 'tab_round1'=>$c4, 'tab_days1'=>$tab_days1];
                            $index = $index + 1; 
                            $tabletCount = $temp1 = $c4 = 0;
                        }
                    }
                    else
                    {
                        foreach($tablets as $tab){
                            $tabletCountArray[$index] = ['tab_count' => 0, 'tab_name'=>$tab->name, 'tab_round'=>0,'tab_round2'=>0, 'tab_round1'=>0, 'tab_days1'=>0];
                            $index = $index + 1; 
                        }
                    }
                    $round = 0;
              		$tabletCountArray['tab_round2'] = 0;
                    for($i=0; $i<=count($tabletCountArray);$i++)
                    {
                        echo '<br>';
                        // $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%', 'status'=>'2'])->get('pharma1')->row();
                        $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%'])->get('pharma1')->row();
                        print_r($tabletCountArray[$i]['tab_name']);echo '<br>';
                        print_r($res->closing_bal);echo '<br>';
                        //print_r(intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                      echo '<br><br><br><br><br><br>';
                     echo '========>tab_round_for_onbed =>'.$tabletCountArray[$i]['tab_round'];echo '<br><br>';
                      echo '========>tab_round_for_discharge =>'.$tabletCountArray[$i]['tab_round1'];echo '<br><br>';
                      echo '========>tab_days_for_discharge =>'.$tabletCountArray[$i]['tab_days1'];
                      echo '<br><br><br><br><br><br>';
                      
                      
                        print_r($tabletCountArray[$i]['tab_round'] + ($tabletCountArray[$i]['tab_round1'] * $tabletCountArray[$i]['tab_days1']));echo '<br>';
                        
                        $tab_name = $tabletCountArray[$i]['tab_name'];

                       
                        $daily_despensing_bal = 0;

                        $patient_despense =  $this->db->select('DISTINCT(tab_name) as Tab_name,sum(RX1_despense) as despense,sum(DRX_despense) as drxdespense')
                        ->from('pharma_daily_ipd_patient')
                        ->where('tab_name',$tab_name)
                        ->where('push_date',$startDate2)
                        ->get()
                        ->result();
                      print_r($this->db->last_query());
                        //$daily_despensing_bal = 0;
                        foreach($patient_despense as $test)
                        {
                        if(stripos($tab_name, $test->Tab_name) !== false)
                        {
                          echo 'RX Despense======>'.$rx = $test->despense;
                           echo 'DRX Despense======>'.$drx = $test->drxdespense;
                          $daily_despensing_bal =  $test->despense + $drx = $test->drxdespense;
                        }
                        
                        }
                           echo'<br><br><br><br><br><br>';
                            echo 'Daily_despense_balance=======>'.$daily_despensing_bal = $daily_despensing_bal;
                           echo'<br><br><br><br><br><br>';
                      
                      
                      //   $daily_despensing_bal = $tabletCountArray[$i]['tab_round'] + ($tabletCountArray[$i]['tab_round1'] * $tabletCountArray[$i]['tab_days1']);
                      
                      
                      	$daily_opening_bal = $res->closing_bal;
                        $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                      
                        /////comment for test /////////
                        if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                        //if($daily_opening_bal < $daily_despensing_bal || $daily_closing_bal < 0)
                        {
                            $current_stock = $daily_opening_bal;
                            $added_stock = $res->opening_bal;
                            ///////$opening_bal_temp = intval($daily_opening_bal) + intval($res->opening_bal);
                            $opening_bal_temp = $daily_opening_bal + $res->opening_bal;
                            $total_stock = $opening_bal_temp;
                            ///////$daily_closing_bal = intval($opening_bal_temp)-intval($daily_despensing_bal);
                            $daily_closing_bal = $opening_bal_temp-$daily_despensing_bal;
                          
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_added_bal' => $added_stock,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            (Object)$postData2 = ([
                                'name' => $tab_name,
                                'current_stock' => $current_stock,
                                'added_stock' => $added_stock,
                                'total_stock' => $total_stock,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'status' => $res->status
                            ]);
                            if($this->db->insert('daily_ipd_stock', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1)){
                                    //print_r('Stock Updated Successfully');
                                    if($this->db->insert('stock_register', $postData2)){
                                        print_r('IPD Stock Updated Successfully');
                                    }
                                }
                            }
                        }
                        else
                        {
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            if($this->db->insert('daily_ipd_stock', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1))
                                {
                                    print_r('IPD Stock Updated Successfully');
                                }
                            }
                        }
                    }
            }
            elseif($current_date > $push_date)
            {
                $startDate2 = date('Y-m-d', strtotime($push_date));
                    print_r('IPD Stock Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                    
                    $tabletCountArray = array();
                    $tabletCount = 0;
                    $index = 0;
                    $tabletRoundArray = array();
                    $c1 = 0;
                    $tabDays = 0;
                    $temp1 = 0;
                    $temp2 = 0;
                        
                    if($res != '' || $res != null)
                    {
                        //print_r($patientList);
                        // $tablets = $this->db->where('status','2')->get('pharma1')->result();
                        $tablets = $this->db->get('pharma1')->result();
                        foreach($tablets as $tab){
                            // $this->db->where('create_date like', '%'.$startDate2.'%');
                            // $this->db->where('ipd_opd', 'ipd');
                            // $patientList =  $this->db->get('patient_ipd')->result();
                            
                            $start_date = date('Y-m-d',strtotime($push_date));
                            $end_date  = date('Y-m-d',strtotime($push_date));
                            $start_date_f= $start_date." 23:59:00";
                            $end_date_f= $end_date."23:59:00";
                            
                        //    $patients1 = $this->db->select("*")
                        //        ->from('patient_ipd')
                        //        ->join('department','department.dprt_id = patient_ipd.department_id')
                        //        ->where('discharge_date >=', $start_date_f)
                        //      	//->or_where('discharge_date <=', $start_date_f)
                        //      	->or_where('discharge_date like', $start_date)
                        //        ->where('create_date <=', $end_date_f)
                        //        ->where('ipd_opd', 'ipd')
                        //        ->get()
                        //        ->result();
                                    
                            //print_r('q1   ');
                            //print_r($this->db->last_query());
                                    
                         //   $patients2 = $this->db->select("*")
                         //       ->from('patient_ipd')
                         //       ->join('department','department.dprt_id = patient_ipd.department_id')
                         //       ->where('create_date <=', $end_date_f)
                         //       ->where('discharge_date LIKE', '%0000-00-00%')
                         //       ->where('ipd_opd', 'ipd')
                         //       ->get()
                         //       ->result();
                            
                          
                          
                          
                          
                          
                            $patients1 = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                            ->where('discharge_date >=', $end_date)
                            ->where('create_date <=', $end_date)
                            ->where('ipd_opd', 'ipd')
                            ->or_where('discharge_date like', '%'.$start_date_f.'%')
                            ->get()
                            ->result();  
                                            
                            $patients2=$this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                            ->where ('ipd_opd', $section)
                            ->where('discharge_date LIKE', '%0000-00-00%')
                            ->where('create_date <=', 'ipd')
                            ->get()

                            ->result();
                                                //print_r('q2   ');                    
                            //print_r($this->db->last_query());
                            
                            $patientList = array_merge($patients1, $patients2);
                            
                            //print_r($patientList);echo '<br>';
                            foreach($patientList as $patient){
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = $new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = $che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                                // $tretment1=$this->db->select("*")
                                //     ->from('treatments1')
                                //     ->where('dignosis LIKE',$p_dignosis)
                                //     ->where('proxy_id',$patient->proxy_id)
                                //     ->where('department_id',$patient->department_id)
                                //     ->where('ipd_opd',$section_tret)
                                //     ->get()
                                //     ->row();
                                
                                
                                // $DISTRIBUTION_IPD=$tretment1->DISTRIBUTION_IPD; 
                                // $ipd_days=$tretment1->ipd_days; 
                                // $last_days=$ipd_days - $DISTRIBUTION_IPD;
                                // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1;
                                
                                //print_r('=>>>>');print_r($DISTRIBUTION_IPD);print_r('<br>');
                                
                                    
                                 if($patient->manual_status==0){
                                      if($patient->proxy_id){
			                          
			                         
                                     $tretment=$this->db->select("*")

			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else{
                                          
                                       $tretment=$this->db->select("*")

			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                     
                            //           if(empty($tretment)){
                            //           $tretment=$this->db->select("*")
                            //           ->from('treatments1')
                            //           ->where('department_id',$patient->department_id)
			                         // ->where('ipd_opd',$patient->department_id)
                            //          ->get()
                            //          ->row();   
                                         
                            //           }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                   }
                                    
                                echo '<br><br><br>';
                              echo   $datefrom_n=date('Y-m-d',strtotime($startDate2));  
			                      echo'<br>';
			                 echo    $admit_date=date('Y-m-d',strtotime($patient->create_date));
                               echo'<br>';
                                 if($patient->discharge_date=='0000-00-00'){
                                     //$discharge_date=date('Y-m-d', strtotime($admit_date. ' + 5 days'));
                                     
                                     $today_date=date('Y-m-d', strtotime($datefrom_n));
                                 } else{
                                 //$discharge_date=date('Y-m-d',strtotime($patient->discharge_date));
                                  $today_date=date('Y-m-d', strtotime($datefrom_n));
                                 }  
                                 
                                $date1=date_create($admit_date);
                                $date2=date_create($today_date);
                                $diff=date_diff($date1,$date2);
                            
                                echo 'Days difference in Create_date and Discharge Date====>'.$n= $diff->format("%a");
                                echo '<br>';
                                echo 'PAtient_name======>'.$patient->firstname;
                                echo '<br>';
                                
                                echo  'Distribution days====>'.$DISTRIBUTION_IPD=$tretment->DISTRIBUTION_IPD; 
                              	echo '<br>';
                                echo 'IPD DAYS====>   '.$ipd_days=$tretment->ipd_days; 
                              	$DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1; 
                                $last_days=$ipd_days - $DISTRIBUTION_IPD;
                             
                              	echo '<br><br><br>';
                              
                              
                              if($DISTRIBUTION_IPD < $n)
                              {
			                         if($patient->manual_status==0)
                                     {
                                      if($patient->proxy_id)
                                      {
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->order_by('id','desc')
                                         ->get()
                                         ->row();
                                         //print_r($this->db->last_query());
                                      }
                                      else
                                      {
                                         $tretment=$this->db->select("*")
                                       ->from('treatments1')
                                       ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                       ->where('ipd_opd ',$section_tret)
                                        ->order_by('id','desc')
                                       ->get()
                                       ->row();  
                                     
                                      }
                                  }else
                                     {
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                   }
			                         
			                      $RX1= $tretment->RX1;
			                      $RX2= $tretment->RX2;
			                      $RX3= $tretment->RX3;
			                      $RX4= $tretment->RX4;
			                      $RX5= $tretment->RX5;
			                      
			                      $RX_other= $tretment->RX_other;
			                      $RX_other1= $tretment->RX_other1;
			                      $other_equipment= $tretment->other_equipment;
			                         
			                         
			                     }
                              
                                if($tretment){
                                    if(stripos($tretment->RX1, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX1   '.$tretment->RX1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }
                                                  else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        ////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX2, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX2   '.$tretment->RX2;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        /////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX3, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX3   '.$tretment->RX3;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        //////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX4, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX4   '.$tretment->RX4;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX4;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        $c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        //////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX5, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX5   '.$tretment->RX5;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX5;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count-1;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }

                                    if(stripos($tretment->RX_other, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX_other   '.$tretment->RX_other;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX_other;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count-1;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX_other1, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX_other1   '.$tretment->RX_other1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX_other1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count-1;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->other_equipment, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'other_equipment   '.$tretment->other_equipment;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->other_equipment;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count-1;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }

                                }  
                                
                                $total_count = 0;
                            $total_quantity = $temp2;
                           $total_quantity_rx = $temp2;
                            if(stripos($tretment->RX1, $tab->name) !== false || stripos($tretment->RX2, $tab->name) !== false 
                                || stripos($tretment->RX3, $tab->name) !== false || stripos($tretment->RX4, $tab->name) !== false 
                                || stripos($tretment->RX5, $tab->name) !== false || stripos($tretment->RX_other, $tab->name) !== false 
                                || stripos($tretment->RX_other1, $tab->name) !== false || stripos($tretment->other_equipment, $tab->name) !== false )  
                                {
                                    $patient_array = array(
                                    'patient_auto_id'=>$patient->id,
                                    'yearly_reg_no'=>$patient->yearly_reg_no,
                                    'old_reg_no'=>$patient->old_reg_no,
                                    'age'=>$patient->date_of_birth,
                                    'sex'=>$patient->sex,
                                    'address'=>$patient->address,
                                    'name'=>$patient->firstname,
                                    'dignosis'=>$patient->dignosis,
                                    'RX1'=>$tab->name,
                                    'RX1_despense'=>$total_count = $total_quantity_rx,
                                    'tab_name'=>$tab->name,
                                    'tab_count'=>$total_quantity_rx,
                                    'tab_days'=>$tab_days1,
                                    'create_date'=>$patient->create_date,
                                     'push_date'=>$push_date,
                                    'discharge_date'=>$patient->discharge_date,
                                    ); 
                                    $a = $this->db->insert('pharma_daily_ipd_patient', $patient_array);
                                
                                }
                                        
                            }
                            
                            
                            $patientList1 = $this->db->select("*")
                                ->from('patient_ipd')
                                ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                                ->where('ipd_opd', 'ipd')
                                ->where('discharge_date >=', $start_date)
                                ->where('discharge_date <=', $end_date)
                                //->where('create_date LIKE', $year)
                                ->get()
                                ->result();
                            
                            foreach($patientList1 as $patient){
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = $new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = $che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                                // $tretment1=$this->db->select("*")
                                //     ->from('treatments1')
                                //     ->where('dignosis LIKE',$p_dignosis)
                                //     ->where('proxy_id',$patient->proxy_id)
                                //     ->where('department_id',$patient->department_id)
                                //     ->where('ipd_opd',$section_tret)
                                //     ->get()
                                //     ->row();
                                
                                
                                // $DISTRIBUTION_IPD=$tretment1->DISTRIBUTION_IPD; 
                                // $ipd_days=$tretment1->ipd_days; 
                                // $last_days=$ipd_days - $DISTRIBUTION_IPD;
                                // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1;
                                
                                //print_r('=>>>>');print_r($DISTRIBUTION_IPD);print_r('<br>');
                                
                                // if($patient->manual_status==0){
                                //     if($patient->proxy_id){
                                //         $tretment=$this->db->select("*")
                                //             ->from('treatments1')
                                //             ->where('dignosis LIKE',$p_dignosis)
                                //             ->where('proxy_id',$patient->proxy_id)
                                //             ->where('department_id',$patient->department_id)
                                //             ->where('ipd_opd ',$section_tret)
                                //             ->get()
                                //             ->row();
                                //     }
                                // }else{
                                //     $tretment=$this->db->select("*")
                                //         ->from('manual_treatments')
                                //         ->where('patient_id_auto',$patient->id)
                                //         ->where('dignosis LIKE',$p_dignosis)
                                //         ->where('ipd_opd ',$section_tret)
                                //         ->get()
                                //         ->row();
                                // }
                                
                                
                                 if($patient->manual_status==0){
                                        $section_tret='ipd';
                                        // $tretarray=$this->db->select("*")
                                        //     ->from('treatments1')
                                        //     ->where('dignosis LIKE',$p_dignosis)
                                        //     ->where('proxy_id',$patient->proxy_id)
                                        //     ->where('department_id',$patient->department_id)
                                        //     ->where('ipd_opd',$section_tret)
                                        //     ->get()->result();
                                        
                                        if($patient->proxy_id){
                                            $tretment=$this->db->select("*")
                                                ->from('treatments1')
                                                ->where('dignosis LIKE',$p_dignosis)
                                                ->where('proxy_id',$patient->proxy_id)
                                                ->where('department_id',$patient->department_id)
                                                //->order_by("id", "desc")
                                                ->where('ipd_opd ',$section_tret)
                                                ->get()
                                                ->row();
                                        }
                                        else{
                                            $tretment=$this->db->select("*")
                                                ->from('treatments1')
                                                ->where('dignosis LIKE',$p_dignosis)
                                                ->where('department_id',$patient->department_id)
                                               // ->order_by("id", "desc")
                                                ->where('ipd_opd ',$section_tret)
                                                ->get()
                                                ->row();  
                                        
                                        //     if(empty($tretment)){
                                        //         $tretment=$this->db->select("*")
                                        //             ->from('treatments1')
                                        //             ->where('department_id',$patient->department_id)
                                        //             ->where('ipd_opd',$patient->department_id)
                                        //             ->get()
                                        //             ->row();   
                                            }
                                        // }
                                    }else{
                                        $tretment=$this->db->select("*")
                                            ->from('manual_treatments')
                                            ->where('patient_id_auto',$patient->id)
                                            ->where('dignosis LIKE',$p_dignosis)
                                            ->where('ipd_opd ',$section_tret)
                                            ->get()
                                            ->row();
                                    }
                              
                             
			                      
			                     
                                
                                
                                if($tretment){
                                    if(stripos($tretment->DRX1, $tab->name) !== false){
                                        echo 'DRX1   '.$tretment->DRX1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                  $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                  $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                  $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                       $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                       $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->DRX2, $tab->name) !== false){
                                        echo 'DRX2   '.$tretment->DRX2;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                //print_r($ar1);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                  $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
    
                                                
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                  $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                      $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->DRX3, $tab->name) !== false){
                                        echo 'DRX3   '.$tretment->DRX3;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                //print_r($ar1);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                   $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                   $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                      $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                }
    
                                $total_count = 0;
                                $total_quantity = $c3;
                                $total_quantity_drx = $c3;
                              
                                if(stripos($tretment->DRX1, $tab->name) !== false 
                                || stripos($tretment->DRX2, $tab->name) !== false || stripos($tretment->DRX3, $tab->name) !== false)  
                                    {
                                        $patient_array = array(
                                        'patient_auto_id'=>$patient->id,
                                        'yearly_reg_no'=>$patient->yearly_reg_no,
                                        'old_reg_no'=>$patient->old_reg_no,
                                        'age'=>$patient->date_of_birth,
                                        'sex'=>$patient->sex,
                                        'address'=>$patient->address,
                                        'name'=>$patient->firstname,
                                        'dignosis'=>$patient->dignosis,
                                        'RX1'=>$tab->name,
                                        'RX1_despense'=>NULL,
                                        'DRX'=>$tab->name,
                                        'DRX_despense'=>$total_count = $total_quantity_drx * $tab_days1,
                                        'tab_name'=>$tab->name,
                                        'tab_count'=>$total_quantity,
                                        'tab_days'=>$tab_days1,
                                        'create_date'=>$patient->create_date,
                                        'push_date'=>$push_date,
                                        'discharge_date'=>$patient->discharge_date,
                                        ); 
                                        $a = $this->db->insert('pharma_daily_ipd_patient', $patient_array);
                                    }
    
                                        
                            }
                            
                          	$tabletCountArray[$index] = ['tab_count' => $tabletCount, 'tab_name'=>$tab->name, 'tab_round'=>$temp1,'tab_round2'=>$c3, 'tab_round1'=>$c4, 'tab_days1'=>$tab_days1];
                            $index = $index + 1; 
                            $tabletCount = $temp1 = $c4 = 0;
                        }
                    }
                    else
                    {
                        foreach($tablets as $tab){
                            $tabletCountArray[$index] = ['tab_count' => 0, 'tab_name'=>$tab->name, 'tab_round'=>0,'tab_round2'=>0, 'tab_round1'=>0, 'tab_days1'=>0];
                            $index = $index + 1; 
                        }
                    }
                    $round = 0;
              		$tabletCountArray['tab_round2'] = 0;
                    for($i=0; $i<=count($tabletCountArray);$i++)
                    {
                        echo '<br>';
                        // $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%', 'status'=>'2'])->get('pharma1')->row();
                        $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%'])->get('pharma1')->row();
                        print_r($tabletCountArray[$i]['tab_name']);echo '<br>';
                        print_r($res->closing_bal);echo '<br>';
                        //print_r(intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                      echo '<br><br><br><br><br><br>';
                     echo '========>tab_round_for_onbed =>'.$tabletCountArray[$i]['tab_round'];echo '<br><br>';
                      echo '========>tab_round_for_discharge =>'.$tabletCountArray[$i]['tab_round1'];echo '<br><br>';
                      echo '========>tab_days_for_discharge =>'.$tabletCountArray[$i]['tab_days1'];
                      echo '<br><br><br><br><br><br>';
                      
                      
                        print_r($tabletCountArray[$i]['tab_round'] + ($tabletCountArray[$i]['tab_round1'] * $tabletCountArray[$i]['tab_days1']));echo '<br>';
                        
                        $tab_name = $tabletCountArray[$i]['tab_name'];

                       
                        $daily_despensing_bal = 0;

                        $patient_despense =  $this->db->select('DISTINCT(tab_name) as Tab_name,sum(RX1_despense) as despense,sum(DRX_despense) as drxdespense')
                        ->from('pharma_daily_ipd_patient')
                        ->where('tab_name',$tab_name)
                        ->where('push_date',$startDate2)
                        ->get()
                        ->result();
                      print_r($this->db->last_query());
                        //$daily_despensing_bal = 0;
                        foreach($patient_despense as $test)
                        {
                        if(stripos($tab_name, $test->Tab_name) !== false)
                        {
                          echo 'RX Despense======>'.$rx = $test->despense;
                           echo 'DRX Despense======>'.$drx = $test->drxdespense;
                          $daily_despensing_bal =  $test->despense + $drx = $test->drxdespense;
                        }
                        
                        }
                           echo'<br><br><br><br><br><br>';
                            echo 'Daily_despense_balance=======>'.$daily_despensing_bal = $daily_despensing_bal;
                           echo'<br><br><br><br><br><br>';
                      
                      
                      //   $daily_despensing_bal = $tabletCountArray[$i]['tab_round'] + ($tabletCountArray[$i]['tab_round1'] * $tabletCountArray[$i]['tab_days1']);
                      
                      
                      	$daily_opening_bal = $res->closing_bal;
                        $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                      
                        /////comment for test /////////
                        if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                        //if($daily_opening_bal < $daily_despensing_bal || $daily_closing_bal < 0)
                        {
                            $current_stock = $daily_opening_bal;
                            $added_stock = $res->opening_bal;
                            ///////$opening_bal_temp = intval($daily_opening_bal) + intval($res->opening_bal);
                            $opening_bal_temp = $daily_opening_bal + $res->opening_bal;
                            $total_stock = $opening_bal_temp;
                            ///////$daily_closing_bal = intval($opening_bal_temp)-intval($daily_despensing_bal);
                            $daily_closing_bal = $opening_bal_temp-$daily_despensing_bal;
                          
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_added_bal' => $added_stock,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            (Object)$postData2 = ([
                                'name' => $tab_name,
                                'current_stock' => $current_stock,
                                'added_stock' => $added_stock,
                                'total_stock' => $total_stock,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'status' => $res->status
                            ]);
                            if($this->db->insert('daily_ipd_stock', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1)){
                                    //print_r('Stock Updated Successfully');
                                    if($this->db->insert('stock_register', $postData2)){
                                        print_r('IPD Stock Updated Successfully');
                                    }
                                }
                            }
                        }
                        else
                        {
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            if($this->db->insert('daily_ipd_stock', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1))
                                {
                                    print_r('IPD Stock Updated Successfully');
                                }
                            }
                        }
                    }
            }
    }

    public function stock_report()
    {
	    $section = $this->input->get('section');
	    if($section){
	        $data['section'] = $section;
	    }else{
	        $data['section'] = '';
	    }
        $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = $this->input->get('start_date');
        }else{
            $sDate = '';
        }
        if($this->input->get('end_date')){
            $eDate = $this->input->get('end_date');
        }else{
            $eDate = '';
        }
        
       
        $data['reportType'] = $reportType = $this->input->get('reportType');
        if($reportType == 'd'){
            $data['datefrom']=$sDate;
            $data['dateto']=$sDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($sDate));
        
            if($section == 'opd'){
                $data['churnaDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                                        ->order_by('id','ASC')
                                        ->get('daily_stock')
                                        ->result();
                $data['tabletDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                                        ->order_by('id','ASC')
                                        ->get('daily_stock')
                                        ->result();
            }
            else if($section == 'ipd'){
                $data['churnaDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                                        ->order_by('id','ASC')
                                        ->get('daily_ipd_stock')
                                        ->result();
                $data['tabletDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                                        ->order_by('id','ASC')
                                        ->get('daily_ipd_stock')
                                        ->result();
            }
        }
        elseif($reportType == 'm'){
            $data['datefrom']=$sDate;
            $data['dateto']=$eDate;
          
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['churnaStockRegister'] = $this->db->where(['status'=>'1'])
                                        ->get('pharma1')
                                        ->result();
            $data['tabletStockRegister'] = $this->db->where(['status'=>'2'])
                                        ->get('pharma1')
                                        ->result();
        }
        elseif($reportType == 'y'){
            $data['datefrom']= $sDate ='01-01-'.$this->session->userdata['acyear'];
            $data['dateto']= $eDate ='31-12-'.$this->session->userdata['acyear'];
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['churnaStockRegister'] = $this->db->where(['status'=>'1'])
                                        ->get('pharma1')
                                        ->result();
            $data['tabletStockRegister'] = $this->db->where(['status'=>'2'])
                                        ->get('pharma1')
                                        ->result();
        }
            
	    
        $data['content'] = $this->load->view('stock_report',$data,true);
        $this->load->view('layout/main_wrapper',$data);  
	}
	
	public function stock_despense_report()
    {
	    $section = $this->input->get('section');
	    if($section){
	        $data['section'] = $section;
	    }else{
	        $data['section'] = '';
	    }
        $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = $this->input->get('start_date');
        }else{
            $sDate = '';
        }
        if($this->input->get('end_date')){
            $eDate = $this->input->get('end_date');
        }else{
            $eDate = '';
        }
        $data['datefrom']=$sDate;
        $data['dateto']=$eDate;
        
        $result = ''; 
        $result1 = ''; 
        
        $data['churnaMedicineName'] = $this->db->where(['status'=>'1'])->get('pharma1')->result();
        
        $data['tabletMedicineName'] = $this->db->where(['status'=>'2'])->get('pharma1')->result();
        
        if($section=='opd'){
            $result = $this->db->where(['create_date>='=>date('Y-m-d',strtotime($sDate)), 'create_date<='=>date('Y-m-d',strtotime($eDate)), 'ipd_opd'=>$section])->get('patient')->result();
        }elseif($section=='ipd'){
            //$result = $this->db->where(['create_date>='=>date('Y-m-d',strtotime($sDate)), 'create_date<='=>date('Y-m-d',strtotime($eDate)), 'ipd_opd'=>$section])->get('patient_ipd')->result();
            
            $start_date = date('Y-m-d',strtotime($sDate));
            $end_date = date('Y-m-d',strtotime($eDate));
            $start_date_f = $start_date." 23:59:00";
            $end_date_f = $end_date." 23:59:00";
            
            // $patients1 = $this->db->select("*")
            //     ->from('patient_ipd')
            //     ->join('department','department.dprt_id = patient_ipd.department_id')
            //     ->where('discharge_date >=', $start_date_f)
            //     ->where('create_date <=', $start_date_f)
            //     ->where('ipd_opd', 'ipd')
            //     ->or_where('discharge_date', $start_date)
            //     ->where('ipd_opd', 'ipd')
            //     ->get()
            //     ->result();
            
            // $patients2 = $this->db->select("*")
            //     ->from('patient_ipd')
            //     ->join('department','department.dprt_id = patient_ipd.department_id')
            //     ->where('create_date <=', $start_date)
            //     ->where('discharge_date LIKE', '%0000-00-00%')
            //     ->where('ipd_opd', 'ipd')
            //     ->get()
            //     ->result();
            
            // $result = array_merge($patients1, $patients2);
            
            $patients1 = $this->db->select("*")
                ->from('patient_ipd')
                ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                ->where('discharge_date >=', $start_date_f)
                ->where('create_date <=', $end_date)
                ->where('ipd_opd', 'ipd')
                ->get()
                ->result();
                    
            //print_r('q1   ');
            //print_r($this->db->last_query());
                    
            $patients2 = $this->db->select("*")
                ->from('patient_ipd')
                ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                ->where('create_date <=', $end_date)
                ->where('discharge_date LIKE', '%0000-00-00%')
                ->where('ipd_opd', 'ipd')
                ->get()
                ->result();
            
            //print_r('q2   ');                    
            //print_r($this->db->last_query());
            
            $result = array_merge($patients1, $patients2);
            
            $result1 = $this->db->select("*")
                ->from('patient_ipd')
                ->join('department_new','department_new.dprt_id = patient_ipd.department_id')
                ->where('ipd_opd', 'ipd')
                ->where('discharge_date >=', $start_date)
                ->where('discharge_date <=', $end_date)
                //->where('create_date LIKE', $year)
                ->get()
                ->result();
            
        }else{
           $result = ''; 
           $result1 = ''; 
        }
        $data['patientData'] = $result;
        $data['disPatientData'] = $result1;
        $data['content'] = $this->load->view('stock_despense_report',$data,true);
        $this->load->view('layout/main_wrapper',$data); 
	}
	
	public function stock_import_report()
    {
	    $currentYear = $this->session->userdata['acyear'];
	    $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = date('Y-m-d', strtotime($this->input->get('start_date')));
        }else{
            $sDate = date('Y-m-d', strtotime($currentYear.'-01-01'));
        }
        if($this->input->get('end_date')){
            $eDate = date('Y-m-d', strtotime($this->input->get('end_date')));
        }else{
            $eDate = date('Y-m-d', strtotime($currentYear.'-12-31'));
        }
        $data['datefrom']=$sDate;
        $data['dateto']=$eDate;
        
        $stockImportData = $this->db->where(['create_date >='=>$sDate, 'create_date <='=>$eDate])->get('stock_register')->result();
        
        $data['stockImportData'] = $stockImportData;
        $data['content'] = $this->load->view('stock_import_register',$data,true);
        $this->load->view('layout/main_wrapper',$data);
	}
	
	
	function despensePatientStock()
    {
        $data['title'] = "Stock Despense Form";
        $data['pageHeading'] = "Stock Despense";
        
          echo  $section = ($this->input->post('section'))?$this->input->post('section'):NULL;
          echo  $opd_reg_no = ($this->input->post('opd_reg_no'))?$this->input->post('opd_reg_no'):NULL;
          echo  $create_date = ($this->input->post('create_date'))?$this->input->post('create_date'):NULL;
        
        //$firstname = ($this->input->post('firstname'))?$this->input->post('firstname'):NULL;
        
        if($section && $opd_reg_no && $create_date )
        {
            $data['section'] = $section;
            $data['opd_reg_no'] = $opd_reg_no;
            $data['create_date'] = $create_date;
            $data['firstname'] = $opd_reg_no;
            
            if($section == 'opd')
            {
                $tableName = 'patient';
                
                $newPatient = $this->db->where(['create_date'=>date('Y-m-d',strtotime($create_date)), 'yearly_reg_no'=>$opd_reg_no, 'ipd_opd'=>$section])
                            ->get($tableName)
                            ->row();
                $oldPatient = $this->db->where(['create_date'=>date('Y-m-d',strtotime($create_date)), 'old_reg_no'=>$opd_reg_no, 'ipd_opd'=>$section])
                            ->get($tableName)
                            ->row();
                            
                 $firstname = $this->db->where(['create_date'=>date('Y-m-d',strtotime($create_date)), 'firstname'=>$opd_reg_no, 'ipd_opd'=>$section])
                            ->get($tableName)
                            ->row();
                            
            }
            else
            {
                $tableName = 'patient_ipd';
                $start_date = date('Y-m-d',strtotime($create_date));
                $end_date   = date('Y-m-d',strtotime($create_date));
                $start_date_f= $start_date." 23:59:00";
                $end_date_f= $end_date." 23:59:00";
                
                $data['firstname'] = $opd_reg_no;
                
                $newPatient = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where('discharge_date >=', $start_date_f)
                            ->where('create_date <=', $end_date_f)
                            ->where('ipd_opd', 'ipd')
                            ->where('yearly_reg_no', $opd_reg_no)
                            ->or_where('create_date <=', $end_date_f)
                            ->where('discharge_date LIKE', '%0000-00-00%')
                            ->where('ipd_opd', 'ipd')
                            ->where('yearly_reg_no', $opd_reg_no)
                            ->or_where('discharge_date >=', $start_date)
                            ->where('discharge_date <=', $end_date)
                            ->where('ipd_opd', 'ipd')
                            ->where('yearly_reg_no', $opd_reg_no)
                            ->get()
                            ->row();
                $oldPatient = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where('discharge_date >=', $start_date_f)
                            ->where('create_date <=', $end_date_f)
                            ->where('ipd_opd', 'ipd')
                            ->where('old_reg_no', $opd_reg_no)
                            ->or_where('create_date <=', $end_date_f)
                            ->where('discharge_date LIKE', '%0000-00-00%')
                            ->where('ipd_opd', 'ipd')
                            ->where('old_reg_no', $opd_reg_no)
                            ->or_where('discharge_date >=', $start_date)
                            ->where('discharge_date <=', $end_date)
                            ->where('ipd_opd', 'ipd')
                            ->where('old_reg_no', $opd_reg_no)
                            ->get()
                            ->row();
                            
                            
                            
                    $firstname = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where('discharge_date >=', $start_date_f)
                            ->where('create_date <=', $end_date_f)
                            ->where('ipd_opd', 'ipd')
                            ->where('firstname', $opd_reg_no)
                            ->or_where('create_date <=', $end_date_f)
                            ->where('discharge_date LIKE', '%0000-00-00%')
                            ->where('ipd_opd', 'ipd')
                            ->where('firstname', $opd_reg_no)
                            ->or_where('discharge_date >=', $start_date)
                            ->where('discharge_date <=', $end_date)
                            ->where('ipd_opd', 'ipd')
                            ->where('firstname', $opd_reg_no)
                            ->get()
                            ->row();
            }
            
            if($newPatient)
            {
                $data['patient'] = $newPatient;
            }
            elseif($oldPatient)
            {
                $data['patient'] = $oldPatient;
            }
            else
            {
               $data['patient'] = $firstname; 
            }
            
            $data['content'] = $this->load->view('stock_despense_form',$data,true);
            $this->load->view('layout/main_wrapper',$data); 
        }
        else
        {
            $data['section'] = $section;
            $data['opd_reg_no'] = $opd_reg_no;
            $data['create_date'] = $create_date;
            //$data['firstname'] = $firstname;
            
            $data['content'] = $this->load->view('stock_despense_form',$data,true);
            $this->load->view('layout/main_wrapper',$data); 
        }
    }
    
     public function get_parma_patient()
    {
        
        $create_date = ($this->input->post('create_date'))?$this->input->post('create_date'):NULL;
        $section = ($this->input->post('section'))?$this->input->post('section'):NULL;
        
            $data['section'] = $section;
            $data['create_date'] = $create_date;
            
            if($section == 'opd')
            {
            $patient1 = $this->db->select("*")
                ->from('patient')
                ->where('create_date', date('Y-m-d', strtotime($create_date)))
                ->where('ipd_opd', $section)
            
                ->get()
                ->result();
            }
            else
            {
               $patient1 = $this->db->select("*")
                ->from('patient_ipd')
                ->where('create_date', date('Y-m-d', strtotime($create_date)))
                ->where('ipd_opd', $section)
            
                ->get()
                ->result(); 
            }
                //print_r($this->db->last_query());
                         
            $data['patient_pharma'] = $patient1;            
            $data['content'] = $this->load->view('stock_despense_form',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        
    }


     
   public function patient_report_datewise()
   {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $section = $this->input->get('section', TRUE);
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['dateto'] = $end_date;
            $data['section'] = $section;
         
           if($section=='opd')
           {
                $data['patient'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id')
               ->from('pharma_daily_opd_patient')
               ->where('create_date >=',$start_date2)
               ->where('create_date <=',$end_date2)
               //->order_by('yearly_reg_no','ASC')
               ->get()
               ->result();
               //print_r($this->db->last_query());
             
             
             //$tab = $this->db->select('*')->from()
             
             
           }
           else
           {
             
   
             $data['patient'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id')
               ->from('pharma_daily_ipd_patient')
              ->where('push_date >=',$start_date2)
               ->where('push_date <=',$end_date2)
               ->get()
               ->result();
             
         //  $data['patients2'] = $this->db->select("DISTINCT(name),yearly_reg_no,patient_auto_id")
           //->from('pharma_daily_ipd_patient')
           //->where('create_date <=', $start_date2)
           //->where('discharge_date LIKE', '%0000-00-00%')
           //->get()
           //->result();
             
             //$data['patient'] = array_merge($data['patients1'],$data['patients2']);
            //   print_r($this->db->last_query());
               
           }
           
              
               $data['content'] = $this->load->view('stock_despense_patient_datewise',$data,true);
               $this->load->view('layout/main_wrapper',$data);
   }
     
     
             public function daily_dispense_report()
               
        {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['dateto'] = $end_date;
               
               
               $data['opd_stock_churn'] = $this->db->select('name as tab_name,daily_opening_bal as opening_stock,daily_despensing_bal as opd_despense')
                 ->from('daily_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','opd')
                 ->where('type','1')
                 ->get()
                 ->result();
               
               
               $data['opd_stock_tab'] = $this->db->select('name as tab_name,daily_opening_bal as opening_stock,daily_despensing_bal as opd_despense')
                 ->from('daily_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','opd')
                 ->where('type','2')
                 ->get()
                 ->result();
               //print_r($this->db->last_query());
               
               
                $data['ipd_stock_churn'] = $this->db->select('name as tab_name,daily_closing_bal as closing_stock,daily_despensing_bal as ipd_despense')
                 ->from('daily_ipd_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','ipd')
                 ->where('type','1')
                 ->get()
                 ->result();
               
               $data['ipd_stock_tab'] = $this->db->select('name as tab_name,daily_closing_bal as closing_stock,daily_despensing_bal as ipd_despense')
                 ->from('daily_ipd_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','ipd')
                 ->where('type','2')
                 ->get()
                 ->result();
               //print_r($this->db->last_query());
               
               $data['daily_despense'] = array_merge($data['opd_stock_churn'],$data['ipd_stock_churn']);
                 
                 
               $data['content'] = $this->load->view('daily_dispense_report',$data,true);
               $this->load->view('layout/main_wrapper',$data);
   }
       
     public function daily_dispense_patient_report()
               
        {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $section   = $this->input->get('section', TRUE);
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['section'] = $start_date;
           $data['dateto'] = $end_date;
           
           if($section =='opd')
           {
             $data['patients'] = $this->db->select('*')
               ->from('pharma_daily_opd_patient')
               ->where('create_date',$start_date2)
               ->get()
               ->result();
             print_r($this->db->last_query());
           }
           else
           {
             $data['patients'] = $this->db->select('*')
               ->from('pharma_daily_ipd_patient')
               ->where('push_date',$start_date2)
               ->get()
               ->result();
           }
               
           $data['content'] = $this->load->view('patient_with_despense',$data,true);
           $this->load->view('layout/main_wrapper',$data);
   }
       
  
  
  
  
   public function stock_despence_churn_tablet()
   {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $section = $this->input->get('section', TRUE);
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['dateto'] = $end_date;
           $data['section'] = $section;
         
           if($section=='opd')
           {
                $data['patient'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id,old_reg_no,create_date')
               ->from('pharma_daily_opd_patient')
               ->where('create_date >=',$start_date2)
               ->where('create_date <=',$end_date2)
               ->order_by('patient_auto_id','ASC')
               ->get()
               ->result();
             //  print_r($this->db->last_query());
             
             	$data['patients'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id,old_reg_no,create_date')
               ->from('pharma_daily_opd_patient')
               ->where('create_date >=',$start_date2)
               ->where('create_date <=',$end_date2)
               ->order_by('patient_auto_id','ASC')
               ->get()
               ->result();
               //print_r($this->db->last_query());
             
           }
           else
           {
             
             	$data['patient'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id,old_reg_no,create_date')
               ->from('pharma_daily_ipd_patient')
              
              ->where('push_date >=',$start_date2)
               ->where('push_date <=',$end_date2)
                   ->order_by('patient_auto_id','ASC')
               ->get()
               ->result();
             
               $data['patients'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id,old_reg_no,create_date')
               ->from('pharma_daily_ipd_patient')
              ->where('push_date >=',$start_date2)
               ->where('push_date <=',$end_date2)
                  ->order_by('patient_auto_id','ASC')
               ->get()
               ->result();
             
              // print_r($this->db->last_query());
               
           }
               $data['content'] = $this->load->view('stock_despence_churn_tablet',$data,true);
               $this->load->view('layout/main_wrapper',$data);
   }
  
  
  
  
    ////////////////////////////////////////  Oil Stock  ////////////////////////////////////////
    
    public function oilStockUpdate()
    {
            
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
        date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
        echo date('d-m-Y H:i:s');
        echo "<script>
            $(document).ready(function () {
                 setTimeout('location.reload(true);', '60000');
            });
        </script>";
    
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////            OPD STOCK CODE          ////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
        
        print_r('<center><h3>OPD OIL STOCK DEDUCTION</h3></center>');
        print_r('<br>');
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        
        $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'opd')->order_by('id','DESC')->limit(1)->get('daily_opd_oil_stock')->row();
        print_r('<br>');
        $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
        print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
        $current_date = date('Y-m-d');
        print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
        $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
        print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');
        
        $res = $this->db->where('create_date', $push_date)->get('patient')->result();
        if($current_date == $push_date){
            if($time_date == $start_time){
            
            $oilCountArray = array();
            $oilCount = 0;
            $index = 0;
            $c1 = 0;
            
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('OPD Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                
                
                if($res != '' || $res != null){
                    
                    //print_r($patientList);
                    $oils = $this->db->get('pharma1_oil')->result();
                    foreach($oils as $oil){
                        
                        $start_date = date('Y-m-d', strtotime($startDate2));
                        $year = '%'.date('Y',strtotime($start_date)).'%';
                        if($start_date>'2022-07-29'){
                            $this->db->select('yearly_reg_no');
                            $this->db->from('patient_ipd');
                            $this->db->where('create_date like', '%'.$start_date.'%');
                            $this->db->where('ipd_opd', 'ipd');
                            $subQuery =  $this->db->get_compiled_select();
                            
                            $this->db->where('create_date like', '%'.$start_date.'%');
                            $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                            $this->db->where('ipd_opd', 'opd');
                            $patientList =  $this->db->get('patient')->result();
                        }else{
                            $patientList = $this->db->select("*")
                                ->from('patient')
                                ->join('department','department.dprt_id = patient.department_id')
                                ->where ('ipd_opd', 'opd')
                                ->where('create_date like ',  '%'.$start_date.'%')
                                ->get()
                                ->result();
                        }
                        
                        //print_r($this->db->last_query());
                        
                        //print_r(count($patientList));echo '<br>';
                        foreach($patientList as $patient){
                            
                            if(date('Y-m-d',strtotime($patient->create_date))<='2022-07-29'){
                                $p_dignosis = '%'.$patient->dignosis.'%';
                                $section_tret='opd';
                                $dd= substr($patient->dignosis,$len - 1);
                                if($dd=='I'){
                                    //echo $dd;
                                    $dd1=substr($patient->dignosis, 0, -1);
                                    $p_dignosis = '%'.$dd1.'%';
                                    $p_dignosis_name=$dd1;
                                }else{
                                    $p_dignosis = '%'.$patient->dignosis.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
    
                                $tretment=$this->db->select("*")
                                    ->from('treatments1')
                                    ->where('dignosis LIKE',$p_dignosis)
                                    ->where('ipd_opd ',$section_tret)
                                    ->get()
                                    ->row();
                                // print_r($this->db->last_query());
                                // print_r($tretment);
                                // die();
                            }else{
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                $section_tret='opd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = '%'.$new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = '%'.$che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                            
                                if($patient->manual_status==0){
                                    if($patient->proxy_id){
                                        $tretment=$this->db->select("*")
                                            ->from('treatments1')
                                            ->where('dignosis LIKE',$p_dignosis)
                                            ->where('proxy_id',$patient->proxy_id)
                                            ->where('department_id',$patient->department_id)
                                            ->where('ipd_opd ',$section_tret)
                                            ->get()
                                            ->row();
                                    }
                                    else{
                                        $tretment=$this->db->select("*")
                                            ->from('treatments1')
                                            ->where('dignosis LIKE',$p_dignosis)
                                            ->where('department_id',$patient->department_id)
                                            ->where('ipd_opd ',$section_tret)
                                            ->get()
                                            ->row();  
                                    }
                                }else{
                                    $tretment=$this->db->select("*")
                                        ->from('manual_treatments')
                                        ->where('patient_id_auto',$patient->id)
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                }
                            }
    
                    
                            
                            if($tretment){
                                if($tretment->SNEHAN){
                                    //echo 'SNEHAN   '.$tretment->SNEHAN;;print_r('<br>');
                                    $temp_str = $tretment->SNEHAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SNEHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SNEHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->SWEDAN){
                                    //echo 'SWEDAN   '.$tretment->SWEDAN;;print_r('<br>');
                                    $temp_str = $tretment->SWEDAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SWEDAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SWEDAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->VAMAN){
                                    //echo 'VAMAN   '.$tretment->VAMAN;;print_r('<br>');
                                    $temp_str = $tretment->VAMAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->VIRECHAN){
                                    //echo 'VIRECHAN   '.$tretment->VIRECHAN;;print_r('<br>');
                                    $temp_str = $tretment->VIRECHAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->BASTI){
                                    //echo 'BASTI   '.$tretment->BASTI;;print_r('<br>');
                                    $temp_str = $tretment->BASTI;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'BASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'BASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->NASYA){
                                    //echo 'NASYA   '.$tretment->NASYA;;print_r('<br>');
                                    $temp_str = $tretment->NASYA;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'NASYA   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'NASYA   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->RAKTAMOKSHAN){
                                    //echo 'RAKTAMOKSHAN   '.$tretment->RAKTAMOKSHAN;;print_r('<br>');
                                    $temp_str = $tretment->RAKTAMOKSHAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'RAKTAMOKSHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'RAKTAMOKSHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->SHIRODHARA_SHIROBASTI){
                                    //echo 'SHIRODHARA_SHIROBASTI   '.$tretment->SHIRODHARA_SHIROBASTI;;print_r('<br>');
                                    $temp_str = $tretment->SHIRODHARA_SHIROBASTI;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SHIRODHARA   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SHRODHARA   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->SHIROBASTI){
                                    //echo 'SHIROBASTI   '.$tretment->SHIROBASTI;;print_r('<br>');
                                    $temp_str = $tretment->SHIROBASTI;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SHIROBASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SHIROBASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->YONIDHAVAN){
                                    //echo 'YONIDHAVAN   '.$tretment->YONIDHAVAN;;print_r('<br>');
                                    $temp_str = $tretment->YONIDHAVAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'YONIDHAVAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'YONIDHAVAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->YONIPICHU){
                                    //echo 'YONIPICHU   '.$tretment->YONIPICHU;;print_r('<br>');
                                    $temp_str = $tretment->YONIPICHU;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'YONIPICHU   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'YONIPICHU   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->UTTARBASTI){
                                    //echo 'UTTARBASTI   '.$tretment->UTTARBASTI;;print_r('<br>');
                                    $temp_str = $tretment->UTTARBASTI;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'UTTARBASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'UTTARBASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->OTHER){
                                    //echo 'OTHER   '.$tretment->OTHER;;print_r('<br>');
                                    $temp_str = $tretment->OTHER;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'OTHER   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'OTHER   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                            }
                        }
                        //print_r($c1);print_r('=======');print_r('<br>');
                        $oilCountArray[$index] = ['oil_id' => $oil->id, 'oil_churna_name'=>$oil->name, 'oil_count'=>$c1];
                        $index = $index + 1; 
                        $c1 = 0;
                        //print_r($oilCountArray);
                    }
                }
                else{
                    foreach($oils as $oil){
                        $oilCountArray[$index] = ['oil_id' => $oil->id, 'oil_churna_name'=>$oil->name, 'oil_count'=>0];
                        $index = $index + 1;
                    }
                }
                print_r('<br><br>');
                print_r($oilCountArray);
                
                for($i=0; $i<count($oilCountArray);$i++){
                    echo '<br>';
                    $res = $this->db->where(['id'=> $oilCountArray[$i]['oil_id'], 'name like '=>'%'.$oilCountArray[$i]['oil_churna_name'].'%'])->get('pharma1_oil')->row();
                    print_r($res->id);echo '<br>';
                    print_r($oilCountArray[$i]['oil_churna_name']);echo '<br>';
                    print_r($res->closing_bal);echo '<br>';
    
                    $oil_churna_name = $oilCountArray[$i]['oil_churna_name'];
                    $daily_despensing_bal = $oilCountArray[$i]['oil_count'];
                    $daily_opening_bal = $res->closing_bal;
                    $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                    ////print_r($daily_opening_bal);echo '<br>';
                    ////echo '==============';
                    ////print_r($daily_closing_bal);echo '<br>';
                    
                    
                    ///////////Comment for test ///////////////
                    
                    //if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                    if($daily_opening_bal < $daily_despensing_bal || $daily_closing_bal < 0)
                    {
                        $current_stock = $daily_opening_bal;
                        $added_stock = $res->opening_bal;
                        $opening_bal_temp = $daily_opening_bal + $res->opening_bal;
                        
                        $total_stock = $opening_bal_temp;
                        $daily_closing_bal = $opening_bal_temp-$daily_despensing_bal;
                        
                        ////print_r('c stock => ');print_r($current_stock);print_r('<br>');
                        ////print_r('add stock => ');print_r($added_stock);print_r('<br>');
                        ////print_r('total stock');print_r($total_stock);print_r('<br>');
                        
                        (Object)$postData = ([
                            'medicine_id'=>$res->id,
                            'name' => $oil_churna_name,
                            'daily_added_bal' => $added_stock,
                            'daily_opening_bal' => $daily_opening_bal,
                            'daily_despensing_bal' => $daily_despensing_bal,
                            'daily_closing_bal' => $daily_closing_bal,
                            'create_date' => $startDate2,
                            'ipd_opd' => 'opd',
                            'type'=>$res->type,
                            'status' => $res->status
                        ]);
                        (Object)$postData1 = ([
                            'closing_bal' => $daily_closing_bal
                        ]);
                        (Object)$postData2 = ([
                            'medicine_id'=>$res->id,
                            'name' => $oil_churna_name,
                            'current_stock' => $current_stock,
                            'added_stock' => $added_stock,
                            'total_stock' => $total_stock,
                            'create_date' => $startDate2,
                            'ipd_opd' => 'opd',
                            'type'=>$res->type,
                            'status' => $res->status
                        ]);
                        if($this->db->insert('daily_opd_oil_stock', $postData))
                        {
                            if($this->db->where('id',$res->id)->update('pharma1_oil', $postData1)){
                                //print_r('Stock Updated Successfully');
                                if($this->db->insert('oil_stock_register', $postData2)){
                                    print_r('OPD Oil Stock Updated Successfully');
                                }
                            }
                        }
                    }
                    else{
                        (Object)$postData = ([
                            'medicine_id'=>$res->id,
                            'name' => $oil_churna_name,
                            'daily_opening_bal' => $daily_opening_bal,
                            'daily_despensing_bal' => $daily_despensing_bal,
                            'daily_closing_bal' => $daily_closing_bal,
                            'create_date' => $startDate2,
                            'ipd_opd' => 'opd',
                            'type'=>$res->type,
                            'status' => $res->status
                        ]);
                        (Object)$postData1 = ([
                            'closing_bal' => $daily_closing_bal
                        ]);
                        if($this->db->insert('daily_opd_oil_stock', $postData))
                        {
                            if($this->db->where('id',$res->id)->update('pharma1_oil', $postData1)){
                                print_r('OPD Oil Stock Updated Successfully');
                            }
                        }
                    }
                }
                
                //echo '<br><br>'.$tabletCount;
            
            }
        }
        elseif($current_date > $push_date){
            
            $oilCountArray = array();
            $oilCount = 0;
            $index = 0;
            $c1 = 0;
            
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('OPD Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                
                
            if($res != '' || $res != null){
                
                //print_r($patientList);
                $oils = $this->db->get('pharma1_oil')->result();
                foreach($oils as $oil){
                    // $this->db->where('create_date like', '%'.$startDate2.'%');
                    // $this->db->where('ipd_opd', 'opd');
                    // $patientList =  $this->db->get('patient')->result();
                    
                    
                    // $this->db->select('yearly_reg_no');
                    // $this->db->from('patient_ipd');
                    // $this->db->where('create_date like', '%'.$startDate2.'%');
                    // $this->db->where('ipd_opd', 'ipd');
                    // $subQuery =  $this->db->get_compiled_select();
                    
                    // $this->db->where('create_date like', '%'.$startDate2.'%');
                    // $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                    // $this->db->where('ipd_opd', 'opd');
                    // $this->db->or_where('old_reg_no !=', '');
                    // $this->db->where('create_date like', '%'.$startDate2.'%');
                    // $this->db->where('ipd_opd', 'opd');
                    // $patientList =  $this->db->get('patient')->result();
                    
                    $start_date = date('Y-m-d', strtotime($startDate2));
                    $year = '%'.date('Y',strtotime($start_date)).'%';
                    if($start_date>'2022-07-29'){
                        $this->db->select('yearly_reg_no');
                        $this->db->from('patient_ipd');
                        $this->db->where('create_date like', '%'.$start_date.'%');
                        $this->db->where('ipd_opd', 'ipd');
                        $subQuery =  $this->db->get_compiled_select();
                        
                        $this->db->where('create_date like', '%'.$start_date.'%');
                        $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                        $this->db->where('ipd_opd', 'opd');
                        $patientList =  $this->db->get('patient')->result();
                    }else{
                        $patientList = $this->db->select("*")
                            ->from('patient')
                            ->join('department','department.dprt_id = patient.department_id')
                            ->where ('ipd_opd', 'opd')
                            ->where('create_date like ',  '%'.$start_date.'%')
                            ->get()
                            ->result();
                    }
                    
                    //print_r($this->db->last_query());
                    
                    //print_r(count($patientList));echo '<br>';
                    foreach($patientList as $patient){
                        
                        if(date('Y-m-d',strtotime($patient->create_date))<='2022-07-29'){
                            $p_dignosis = '%'.$patient->dignosis.'%';
                            $section_tret='opd';
                            $dd= substr($patient->dignosis,$len - 1);
                            if($dd=='I'){
                                //echo $dd;
                                $dd1=substr($patient->dignosis, 0, -1);
                                $p_dignosis = '%'.$dd1.'%';
                                $p_dignosis_name=$dd1;
                            }else{
                                $p_dignosis = '%'.$patient->dignosis.'%';
                                $p_dignosis_name=$patient->dignosis;
                            }

                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();
                            // print_r($this->db->last_query());
                            // print_r($tretment);
                            // die();
                        }else{
                            $che=trim($patient->dignosis);
                            //print_r($che);
                            $section_tret='opd';
                            $len=strlen($che);
                            $dd= substr($che,$len - 1);
                            $str = $patient->dignosis;
                            $arry=explode("-",$str);
                            $t_c=count($arry);
                            if($t_c=='2'){
                                $dd1=substr($che, 0, -1);
                                $new_str = trim($arry[0]);
                                $p_dignosis = '%'.$new_str.'%';
                                $p_dignosis_name=$patient->dignosis;
                            }else{
                                $p_dignosis = '%'.$che.'%';
                                $p_dignosis_name=$patient->dignosis;
                            }
                        
                            if($patient->manual_status==0){
                                if($patient->proxy_id){
                                    $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('proxy_id',$patient->proxy_id)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                }
                                else{
                                    $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();  
                                }
                            }else{
                                $tretment=$this->db->select("*")
                                    ->from('manual_treatments')
                                    ->where('patient_id_auto',$patient->id)
                                    ->where('dignosis LIKE',$p_dignosis)
                                    ->where('ipd_opd ',$section_tret)
                                    ->get()
                                    ->row();
                            }
                        }

                        // print_r($this->db->last_query());
                        // print_r($tretment);echo '<br>';
                    
                        // print_r('<br>');
                        // print_r(stripos($tretment->SNEHAN, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->SWEDAN, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->VAMAN, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->VIRECHAN, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->BASTI, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->NASYA, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->RAKTAMOKSHAN, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->SHIRODHARA_SHIROBASTI, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->YONIDHAVAN, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->YONIPICHU, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->UTTARBASTI, $oil->name));print_r('   ');print_r($oil->name);
                        // print_r(stripos($tretment->OTHER, $oil->name));print_r('   ');print_r($oil->name);
                        
                        if($tretment){
                            if($tretment->SNEHAN){
                                //echo 'SNEHAN   '.$tretment->SNEHAN;;print_r('<br>');
                                $temp_str = $tretment->SNEHAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SNEHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'SNEHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->SWEDAN){
                                //echo 'SWEDAN   '.$tretment->SWEDAN;;print_r('<br>');
                                $temp_str = $tretment->SWEDAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SWEDAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'SWEDAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->VAMAN){
                                //echo 'VAMAN   '.$tretment->VAMAN;;print_r('<br>');
                                $temp_str = $tretment->VAMAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->VIRECHAN){
                                //echo 'VIRECHAN   '.$tretment->VIRECHAN;;print_r('<br>');
                                $temp_str = $tretment->VIRECHAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->BASTI){
                                //echo 'BASTI   '.$tretment->BASTI;;print_r('<br>');
                                $temp_str = $tretment->BASTI;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'BASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'BASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->NASYA){
                                //echo 'NASYA   '.$tretment->NASYA;;print_r('<br>');
                                $temp_str = $tretment->NASYA;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'NASYA   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'NASYA   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->RAKTAMOKSHAN){
                                //echo 'RAKTAMOKSHAN   '.$tretment->RAKTAMOKSHAN;;print_r('<br>');
                                $temp_str = $tretment->RAKTAMOKSHAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'RAKTAMOKSHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'RAKTAMOKSHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->SHIRODHARA_SHIROBASTI){
                                //echo 'SHIRODHARA_SHIROBASTI   '.$tretment->SHIRODHARA_SHIROBASTI;;print_r('<br>');
                                $temp_str = $tretment->SHIRODHARA_SHIROBASTI;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SHIRODHARA   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'SHRODHARA   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->SHIROBASTI){
                                //echo 'SHIROBASTI   '.$tretment->SHIROBASTI;;print_r('<br>');
                                $temp_str = $tretment->SHIROBASTI;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SHIROBASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'SHIROBASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->YONIDHAVAN){
                                //echo 'YONIDHAVAN   '.$tretment->YONIDHAVAN;;print_r('<br>');
                                $temp_str = $tretment->YONIDHAVAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'YONIDHAVAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'YONIDHAVAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->YONIPICHU){
                                //echo 'YONIPICHU   '.$tretment->YONIPICHU;;print_r('<br>');
                                $temp_str = $tretment->YONIPICHU;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'YONIPICHU   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'YONIPICHU   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->UTTARBASTI){
                                //echo 'UTTARBASTI   '.$tretment->UTTARBASTI;;print_r('<br>');
                                $temp_str = $tretment->UTTARBASTI;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'UTTARBASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'UTTARBASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->OTHER){
                                //echo 'OTHER   '.$tretment->OTHER;;print_r('<br>');
                                $temp_str = $tretment->OTHER;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'OTHER   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'OTHER   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                        }
                    }
                    //print_r($c1);print_r('=======');print_r('<br>');
                    $oilCountArray[$index] = ['oil_id' => $oil->id, 'oil_churna_name'=>$oil->name, 'oil_count'=>$c1];
                    $index = $index + 1; 
                    $c1 = 0;
                    //print_r($oilCountArray);
                }
            }
            else{
                foreach($oils as $oil){
                    $oilCountArray[$index] = ['oil_id' => $oil->id, 'oil_churna_name'=>$oil->name, 'oil_count'=>0];
                    $index = $index + 1;
                }
            }
            print_r('<br><br>');
            print_r($oilCountArray);
            
            for($i=0; $i<count($oilCountArray);$i++){
                echo '<br>';
                $res = $this->db->where(['id'=> $oilCountArray[$i]['oil_id'], 'name like '=>'%'.$oilCountArray[$i]['oil_churna_name'].'%'])->get('pharma1_oil')->row();
                print_r($res->id);echo '<br>';
                print_r($oilCountArray[$i]['oil_churna_name']);echo '<br>';
                print_r($res->closing_bal);echo '<br>';

                $oil_churna_name = $oilCountArray[$i]['oil_churna_name'];
                $daily_despensing_bal = $oilCountArray[$i]['oil_count'];
                $daily_opening_bal = $res->closing_bal;
                $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                ////print_r($daily_opening_bal);echo '<br>';
                ////echo '==============';
                ////print_r($daily_closing_bal);echo '<br>';
                
                
                ///////////Comment for test ///////////////
                
                //if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                if($daily_opening_bal < $daily_despensing_bal || $daily_closing_bal < 0)
                {
                    $current_stock = $daily_opening_bal;
                    $added_stock = $res->opening_bal;
                    $opening_bal_temp = $daily_opening_bal + $res->opening_bal;
                    
                    $total_stock = $opening_bal_temp;
                    $daily_closing_bal = $opening_bal_temp-$daily_despensing_bal;
                    
                    ////print_r('c stock => ');print_r($current_stock);print_r('<br>');
                    ////print_r('add stock => ');print_r($added_stock);print_r('<br>');
                    ////print_r('total stock');print_r($total_stock);print_r('<br>');
                    
                    (Object)$postData = ([
                        'medicine_id'=>$res->id,
                        'name' => $oil_churna_name,
                        'daily_added_bal' => $added_stock,
                        'daily_opening_bal' => $daily_opening_bal,
                        'daily_despensing_bal' => $daily_despensing_bal,
                        'daily_closing_bal' => $daily_closing_bal,
                        'create_date' => $startDate2,
                        'ipd_opd' => 'opd',
                        'type'=>$res->type,
                        'status' => $res->status
                    ]);
                    (Object)$postData1 = ([
                        'closing_bal' => $daily_closing_bal
                    ]);
                    (Object)$postData2 = ([
                        'medicine_id'=>$res->id,
                        'name' => $oil_churna_name,
                        'current_stock' => $current_stock,
                        'added_stock' => $added_stock,
                        'total_stock' => $total_stock,
                        'create_date' => $startDate2,
                        'ipd_opd' => 'opd',
                        'type'=>$res->type,
                        'status' => $res->status
                    ]);
                    if($this->db->insert('daily_opd_oil_stock', $postData))
                    {
                        if($this->db->where('id',$res->id)->update('pharma1_oil', $postData1)){
                            //print_r('Stock Updated Successfully');
                            if($this->db->insert('oil_stock_register', $postData2)){
                                print_r('OPD Oil Stock Updated Successfully');
                            }
                        }
                    }
                }
                else{
                    (Object)$postData = ([
                        'medicine_id'=>$res->id,
                        'name' => $oil_churna_name,
                        'daily_opening_bal' => $daily_opening_bal,
                        'daily_despensing_bal' => $daily_despensing_bal,
                        'daily_closing_bal' => $daily_closing_bal,
                        'create_date' => $startDate2,
                        'ipd_opd' => 'opd',
                        'type'=>$res->type,
                        'status' => $res->status
                    ]);
                    (Object)$postData1 = ([
                        'closing_bal' => $daily_closing_bal
                    ]);
                    if($this->db->insert('daily_opd_oil_stock', $postData))
                    {
                        if($this->db->where('id',$res->id)->update('pharma1_oil', $postData1)){
                            print_r('OPD Oil Stock Updated Successfully');
                        }
                    }
                }
            }
            
            //echo '<br><br>'.$tabletCount;
        }
        
        
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////            IPD STOCK CODE          ////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        print_r('<br><br><br>');
        print_r('<center><h3>IPD OIL STOCK DEDUCTION</h3></center>');
        print_r('<br>');
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        
        $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'ipd')->order_by('id','DESC')->limit(1)->get('daily_ipd_oil_stock')->row();
        print_r('<br>');
        $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
        print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
        $current_date = date('Y-m-d');
        print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
        $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
        print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');
        
        $res = $this->db->where('create_date', $push_date)->get('patient_ipd')->result();
        if($current_date == $push_date){
            if($time_date == $start_time){
                $startDate2 = date('Y-m-d', strtotime($push_date));
                print_r('IPD Stock Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                
                $oilCountArray = array();
                $oilCount = 0;
                $index = 0;
                $c1 = 0;
                
                if($res != '' || $res != null){
                    //print_r($patientList);
                    $oils = $this->db->get('pharma1_oil')->result();
                    foreach($oils as $oil){
                        
                        $start_date = date('Y-m-d',strtotime($push_date));
                        $end_date   = date('Y-m-d',strtotime($push_date));
                        $start_date_f= $start_date." 23:59:00";
                        $end_date_f= $end_date." 23:59:00";
                        
                        $patients1 = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where('discharge_date >=', $start_date_f)
                            ->where('create_date <=', $end_date_f)
                            ->where('ipd_opd', 'ipd')
                            ->get()
                            ->result();
                                
                        //print_r('q1   ');
                        //print_r($this->db->last_query());
                                
                        $patients2 = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where('create_date <=', $end_date_f)
                            ->where('discharge_date LIKE', '%0000-00-00%')
                            ->where('ipd_opd', 'ipd')
                            ->get()
                            ->result();
                            
                        //print_r('q2   ');                    
                        //print_r($this->db->last_query());
                        $patientList = array_merge($patients1, $patients2);
                        
                        //print_r($patientList);echo '<br>';
                        foreach($patientList as $patient){
                            
                            if(date('Y-m-d',strtotime($patient->create_date))<='2022-07-29'){
                                $section_tret='ipd';
                                $len=strlen($patient->dignosis);
                                $dd= substr($patient->dignosis,$len - 1);
                                if($dd=='I'){
                                    $p_dignosis = '%'.$patient->dignosis.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = '%'.$patient->dignosis.'I%';
                                    $p_dignosis_name=$patient->dignosis.'I';
                                }
                                if($patient->manual_status==0){
                                    $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                }else{
                                    $tretment=$this->db->select("*")
                                        ->from('manual_treatments')
                                        ->where('patient_id_auto',$patient->id)
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                }
                            }else{
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = '%'.$new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = '%'.$che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                if($patient->manual_status==0){
                                    if($patient->proxy_id){
                                        $tretment=$this->db->select("*")
                                            ->from('treatments1')
                                            ->where('dignosis LIKE',$p_dignosis)
                                            ->where('proxy_id',$patient->proxy_id)
                                            ->where('department_id',$patient->department_id)
                                            ->where('ipd_opd ',$section_tret)
                                            ->get()
                                            ->row();
                                    }
                                    else{
                                        $tretment=$this->db->select("*")
                                            ->from('treatments1')
                                            ->where('dignosis LIKE',$p_dignosis)
                                            ->where('department_id',$patient->department_id)
                                            ->where('ipd_opd ',$section_tret)
                                            ->get()
                                            ->row();  
                                    }
                                }else{
                                    $tretment=$this->db->select("*")
                                        ->from('manual_treatments')
                                        ->where('patient_id_auto',$patient->id)
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                }
                            }
                                
                            //print_r(count($tretarray));print_r('<br>');
                            
                            $admit_date=date('Y-m-d',strtotime($patient->create_date));
                            $vaman_virachan_date=date('Y-m-d',strtotime("+7 days", strtotime($admit_date)));
                            $date1=date_create($admit_date);
                            $date2=date_create($startDate2);
                            $diff=date_diff($date1,$date2);
                            $diffDay = $diff->format("%a");
                            $shirobastiCheck = ($diffDay % 2);
                            if($tretment){
                                if($tretment->SNEHAN){
                                    //echo 'SNEHAN   '.$tretment->SNEHAN;;print_r('<br>');
                                    $temp_str = $tretment->SNEHAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SNEHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SNEHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->SWEDAN){
                                    //echo 'SWEDAN   '.$tretment->SWEDAN;;print_r('<br>');
                                    $temp_str = $tretment->SWEDAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SWEDAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SWEDAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->VAMAN){
                                    //echo 'VAMAN   '.$tretment->VAMAN;;print_r('<br>');
                                    $temp_str = $tretment->VAMAN;
                                    if($admit_date <= '2022-07-29' && $admit_date == $startDate2){
                                        $str=explode(",",$temp_str);
                                        $count_str = count($str);
                                        
                                        if($count_str > 1){
                                            for($i=0;$i<$count_str;$i++){
                                                $arry_str1=explode("(",$str[$i]);
                                                $count_str1 = count($arry_str1);
                                                // print_r($arry_str1[$count_str1-1]);
                                                // print_r("<br>");
                                                $temp_str2 = $arry_str1[$count_str1-1];
                                                $arry_str2=explode(")",$temp_str2);
                                                $count_str2 = count($arry_str2);
                                                // print_r($arry_str2[0]);
                                                // print_r("<br>");
                                                $temp_str3 = $arry_str2[0];
                                                $arry_str3=explode("-",$temp_str3);
                                                $count_str3 = count($arry_str3);
                                                // print_r($arry_str3[0]);
                                                // print_r("<br>");
                                                if(trim($arry_str3[0]) == $oil->name){
                                                    echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                    
                                                    $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                    $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                    $gCheck = preg_match("/g/", $arry_str3[1]);
                                                    $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                    $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                    $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                    $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                    $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1 || $MGCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1 || $GMCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1){
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                        $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $ltrVal[0] * 1000;
                                                        print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }
                                            }
                                        }
                                        else{
                                            $arry_str1=explode("(",$temp_str);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }else{
                                        if($vaman_virachan_date == $startDate2){
                                            $str=explode(",",$temp_str);
                                            $count_str = count($str);
                                            
                                            if($count_str > 1){
                                                for($i=0;$i<$count_str;$i++){
                                                    $arry_str1=explode("(",$str[$i]);
                                                    $count_str1 = count($arry_str1);
                                                    // print_r($arry_str1[$count_str1-1]);
                                                    // print_r("<br>");
                                                    $temp_str2 = $arry_str1[$count_str1-1];
                                                    $arry_str2=explode(")",$temp_str2);
                                                    $count_str2 = count($arry_str2);
                                                    // print_r($arry_str2[0]);
                                                    // print_r("<br>");
                                                    $temp_str3 = $arry_str2[0];
                                                    $arry_str3=explode("-",$temp_str3);
                                                    $count_str3 = count($arry_str3);
                                                    // print_r($arry_str3[0]);
                                                    // print_r("<br>");
                                                    if(trim($arry_str3[0]) == $oil->name){
                                                        echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1 || $MGCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1 || $GMCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        $c1 = $c1 + $tempChurnaVal;
                                                    }
                                                }
                                            }
                                            else{
                                                $arry_str1=explode("(",$temp_str);
                                                $count_str1 = count($arry_str1);
                                                // print_r($arry_str1[$count_str1-1]);
                                                // print_r("<br>");
                                                $temp_str2 = $arry_str1[$count_str1-1];
                                                $arry_str2=explode(")",$temp_str2);
                                                $count_str2 = count($arry_str2);
                                                // print_r($arry_str2[0]);
                                                // print_r("<br>");
                                                $temp_str3 = $arry_str2[0];
                                                $arry_str3=explode("-",$temp_str3);
                                                $count_str3 = count($arry_str3);
                                                // print_r($arry_str3[0]);
                                                // print_r("<br>");
                                                if(trim($arry_str3[0]) == $oil->name){
                                                    echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                    
                                                    $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                    $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                    $gCheck = preg_match("/g/", $arry_str3[1]);
                                                    $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                    $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                    $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                    $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                    $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1 || $MGCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1 || $GMCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1){
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                        $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $ltrVal[0] * 1000;
                                                        print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }
                                            }
                                        }
                                    }
                                }
                                if($tretment->VIRECHAN){
                                    //echo 'VIRECHAN   '.$tretment->VIRECHAN;;print_r('<br>');
                                    $temp_str = $tretment->VIRECHAN;
                                    if($admit_date <= '2022-07-29'){
                                        $str=explode(",",$temp_str);
                                        $count_str = count($str);
                                        
                                        if($count_str > 1){
                                            for($i=0;$i<$count_str;$i++){
                                                $arry_str1=explode("(",$str[$i]);
                                                $count_str1 = count($arry_str1);
                                                // print_r($arry_str1[$count_str1-1]);
                                                // print_r("<br>");
                                                $temp_str2 = $arry_str1[$count_str1-1];
                                                $arry_str2=explode(")",$temp_str2);
                                                $count_str2 = count($arry_str2);
                                                // print_r($arry_str2[0]);
                                                // print_r("<br>");
                                                $temp_str3 = $arry_str2[0];
                                                $arry_str3=explode("-",$temp_str3);
                                                $count_str3 = count($arry_str3);
                                                // print_r($arry_str3[0]);
                                                // print_r("<br>");
                                                if(trim($arry_str3[0]) == $oil->name){
                                                    echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                    
                                                    $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                    $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                    $gCheck = preg_match("/g/", $arry_str3[1]);
                                                    $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                    $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                    $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                    $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                    $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1 || $MGCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1 || $GMCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1){
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                        $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $ltrVal[0] * 1000;
                                                        print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }
                                            }
                                        }
                                        else{
                                            $arry_str1=explode("(",$temp_str);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }else{
                                        if($vaman_virachan_date == $startDate2){
                                            $str=explode(",",$temp_str);
                                            $count_str = count($str);
                                            
                                            if($count_str > 1){
                                                for($i=0;$i<$count_str;$i++){
                                                    $arry_str1=explode("(",$str[$i]);
                                                    $count_str1 = count($arry_str1);
                                                    // print_r($arry_str1[$count_str1-1]);
                                                    // print_r("<br>");
                                                    $temp_str2 = $arry_str1[$count_str1-1];
                                                    $arry_str2=explode(")",$temp_str2);
                                                    $count_str2 = count($arry_str2);
                                                    // print_r($arry_str2[0]);
                                                    // print_r("<br>");
                                                    $temp_str3 = $arry_str2[0];
                                                    $arry_str3=explode("-",$temp_str3);
                                                    $count_str3 = count($arry_str3);
                                                    // print_r($arry_str3[0]);
                                                    // print_r("<br>");
                                                    if(trim($arry_str3[0]) == $oil->name){
                                                        echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1 || $MGCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1 || $GMCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        $c1 = $c1 + $tempChurnaVal;
                                                    }
                                                }
                                            }
                                            else{
                                                $arry_str1=explode("(",$temp_str);
                                                $count_str1 = count($arry_str1);
                                                // print_r($arry_str1[$count_str1-1]);
                                                // print_r("<br>");
                                                $temp_str2 = $arry_str1[$count_str1-1];
                                                $arry_str2=explode(")",$temp_str2);
                                                $count_str2 = count($arry_str2);
                                                // print_r($arry_str2[0]);
                                                // print_r("<br>");
                                                $temp_str3 = $arry_str2[0];
                                                $arry_str3=explode("-",$temp_str3);
                                                $count_str3 = count($arry_str3);
                                                // print_r($arry_str3[0]);
                                                // print_r("<br>");
                                                if(trim($arry_str3[0]) == $oil->name){
                                                    echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                    
                                                    $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                    $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                    $gCheck = preg_match("/g/", $arry_str3[1]);
                                                    $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                    $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                    $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                    $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                    $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1 || $MGCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1 || $GMCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1){
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                        $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $ltrVal[0] * 1000;
                                                        print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }
                                            }
                                        }
                                    }
                                }
                                if($tretment->BASTI){
                                    //echo 'BASTI   '.$tretment->BASTI;;print_r('<br>');
                                    $temp_str = $tretment->BASTI;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'BASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'BASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->NASYA){
                                    //echo 'NASYA   '.$tretment->NASYA;;print_r('<br>');
                                    $temp_str = $tretment->NASYA;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'NASYA   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'NASYA   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->RAKTAMOKSHAN){
                                    //echo 'RAKTAMOKSHAN   '.$tretment->RAKTAMOKSHAN;;print_r('<br>');
                                    $temp_str = $tretment->RAKTAMOKSHAN;
                                    
                                    if($admit_date == $startDate2){
                                        $str=explode(",",$temp_str);
                                        $count_str = count($str);
                                        
                                        if($count_str > 1){
                                            for($i=0;$i<$count_str;$i++){
                                                $arry_str1=explode("(",$str[$i]);
                                                $count_str1 = count($arry_str1);
                                                // print_r($arry_str1[$count_str1-1]);
                                                // print_r("<br>");
                                                $temp_str2 = $arry_str1[$count_str1-1];
                                                $arry_str2=explode(")",$temp_str2);
                                                $count_str2 = count($arry_str2);
                                                // print_r($arry_str2[0]);
                                                // print_r("<br>");
                                                $temp_str3 = $arry_str2[0];
                                                $arry_str3=explode("-",$temp_str3);
                                                $count_str3 = count($arry_str3);
                                                // print_r($arry_str3[0]);
                                                // print_r("<br>");
                                                if(trim($arry_str3[0]) == $oil->name){
                                                    echo 'RAKTAMOKSHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                    
                                                    $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                    $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                    $gCheck = preg_match("/g/", $arry_str3[1]);
                                                    $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                    $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                    $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                    $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                    $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1 || $MGCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1 || $GMCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1){
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                        $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $ltrVal[0] * 1000;
                                                        print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }
                                            }
                                        }
                                        else{
                                            $arry_str1=explode("(",$temp_str);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'RAKTAMOKASHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                }
                                if($tretment->SHIRODHARA_SHIROBASTI){
                                    //echo 'SHIRODHARA_SHIROBASTI   '.$tretment->SHIRODHARA_SHIROBASTI;;print_r('<br>');
                                    $temp_str = $tretment->SHIRODHARA_SHIROBASTI;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SHIRODHARA   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SHIRODHARA   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->SHIROBASTI){
                                    //echo 'SHIROBASTI   '.$tretment->SHIROBASTI;;print_r('<br>');
                                    $temp_str = $tretment->SHIROBASTI;
                                    
                                    if($shirobastiCheck == 0){
                                        $str=explode(",",$temp_str);
                                        $count_str = count($str);
                                        
                                        if($count_str > 1){
                                            for($i=0;$i<$count_str;$i++){
                                                $arry_str1=explode("(",$str[$i]);
                                                $count_str1 = count($arry_str1);
                                                // print_r($arry_str1[$count_str1-1]);
                                                // print_r("<br>");
                                                $temp_str2 = $arry_str1[$count_str1-1];
                                                $arry_str2=explode(")",$temp_str2);
                                                $count_str2 = count($arry_str2);
                                                // print_r($arry_str2[0]);
                                                // print_r("<br>");
                                                $temp_str3 = $arry_str2[0];
                                                $arry_str3=explode("-",$temp_str3);
                                                $count_str3 = count($arry_str3);
                                                // print_r($arry_str3[0]);
                                                // print_r("<br>");
                                                if(trim($arry_str3[0]) == $oil->name){
                                                    echo 'SHIROBASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                    
                                                    $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                    $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                    $gCheck = preg_match("/g/", $arry_str3[1]);
                                                    $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                    $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                    $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                    $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                    $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1 || $MGCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1 || $GMCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1){
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                        $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $ltrVal[0] * 1000;
                                                        print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }
                                            }
                                        }
                                        else{
                                            $arry_str1=explode("(",$temp_str);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SHIROBASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                }
                                if($tretment->YONIDHAVAN){
                                    //echo 'YONIDHAVAN   '.$tretment->YONIDHAVAN;;print_r('<br>');
                                    $temp_str = $tretment->YONIDHAVAN;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'YONIDHAVAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'YONIDHAVAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->YONIPICHU){
                                    //echo 'YONIPICHU   '.$tretment->YONIPICHU;;print_r('<br>');
                                    $temp_str = $tretment->YONIPICHU;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'YONIPICHU   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'YONIPICHU   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->UTTARBASTI){
                                    //echo 'UTTARBASTI   '.$tretment->UTTARBASTI;;print_r('<br>');
                                    $temp_str = $tretment->UTTARBASTI;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'UTTARBASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'UTTARBASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                if($tretment->OTHER){
                                    //echo 'OTHER   '.$tretment->OTHER;;print_r('<br>');
                                    $temp_str = $tretment->OTHER;
                                    
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'OTHER   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'OTHER   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                            }
                                
                        }
                        
                        //print_r($c1);print_r('=======');print_r('<br>');
                        $oilCountArray[$index] = ['oil_id' => $oil->id, 'oil_churna_name'=>$oil->name, 'oil_count'=>$c1];
                        $index = $index + 1; 
                        $c1 = 0;
                        //print_r($oilCountArray);
                    }
                }
                else{
                    foreach($oils as $oil){
                        $oilCountArray[$index] = ['oil_id' => $oil->id, 'oil_churna_name'=>$oil->name, 'oil_count'=>0];
                        $index = $index + 1;
                    }
                }
                
                print_r('<br><br>');
                print_r($oilCountArray);
                
                for($i=0; $i<count($oilCountArray);$i++){
                    echo '<br>';
                    $res = $this->db->where(['id'=> $oilCountArray[$i]['oil_id'], 'name like '=>'%'.$oilCountArray[$i]['oil_churna_name'].'%'])->get('pharma1_oil')->row();
                    print_r($res->id);echo '<br>';
                    print_r($oilCountArray[$i]['oil_churna_name']);echo '<br>';
                    print_r($res->closing_bal);echo '<br>';
    
                    $oil_churna_name = $oilCountArray[$i]['oil_churna_name'];
                    $daily_despensing_bal = $oilCountArray[$i]['oil_count'];
                    $daily_opening_bal = $res->closing_bal;
                    $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                    ////print_r($daily_opening_bal);echo '<br>';
                    ////echo '==============';
                    ////print_r($daily_closing_bal);echo '<br>';
                    
                    
                    ///////////Comment for test ///////////////
                    
                    if($daily_opening_bal < $daily_despensing_bal || $daily_closing_bal < 0)
                    {
                        $current_stock = $daily_opening_bal;
                        $added_stock = $res->opening_bal;
                        $opening_bal_temp = $daily_opening_bal + $res->opening_bal;
                        
                        $total_stock = $opening_bal_temp;
                        $daily_closing_bal = $opening_bal_temp-$daily_despensing_bal;
                        
                        ////print_r('c stock => ');print_r($current_stock);print_r('<br>');
                        ////print_r('add stock => ');print_r($added_stock);print_r('<br>');
                        ////print_r('total stock');print_r($total_stock);print_r('<br>');
                        
                        (Object)$postData = ([
                            'medicine_id'=>$res->id,
                            'name' => $oil_churna_name,
                            'daily_added_bal' => $added_stock,
                            'daily_opening_bal' => $daily_opening_bal,
                            'daily_despensing_bal' => $daily_despensing_bal,
                            'daily_closing_bal' => $daily_closing_bal,
                            'create_date' => $startDate2,
                            'ipd_opd' => 'ipd',
                            'type'=>$res->type,
                            'status' => $res->status
                        ]);
                        (Object)$postData1 = ([
                            'closing_bal' => $daily_closing_bal
                        ]);
                        (Object)$postData2 = ([
                            'medicine_id'=>$res->id,
                            'name' => $oil_churna_name,
                            'current_stock' => $current_stock,
                            'added_stock' => $added_stock,
                            'total_stock' => $total_stock,
                            'create_date' => $startDate2,
                            'ipd_opd' => 'ipd',
                            'type'=>$res->type,
                            'status' => $res->status
                        ]);
                        if($this->db->insert('daily_ipd_oil_stock', $postData))
                        {
                            if($this->db->where('id',$res->id)->update('pharma1_oil', $postData1)){
                                //print_r('Stock Updated Successfully');
                                if($this->db->insert('oil_stock_register', $postData2)){
                                    print_r('IPD Oil Stock Updated Successfully');
                                }
                            }
                        }
                    }
                    else{
                        (Object)$postData = ([
                            'medicine_id'=>$res->id,
                            'name' => $oil_churna_name,
                            'daily_opening_bal' => $daily_opening_bal,
                            'daily_despensing_bal' => $daily_despensing_bal,
                            'daily_closing_bal' => $daily_closing_bal,
                            'create_date' => $startDate2,
                            'ipd_opd' => 'ipd',
                            'type'=>$res->type,
                            'status' => $res->status
                        ]);
                        (Object)$postData1 = ([
                            'closing_bal' => $daily_closing_bal
                        ]);
                        if($this->db->insert('daily_ipd_oil_stock', $postData))
                        {
                            if($this->db->where('id',$res->id)->update('pharma1_oil', $postData1)){
                                print_r('IPD Oil Stock Updated Successfully');
                            }
                        }
                    }
                }
            }
        }
        elseif($current_date > $push_date){
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('IPD Stock Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
            
            $oilCountArray = array();
            $oilCount = 0;
            $index = 0;
            $c1 = 0;
            
            if($res != '' || $res != null){
                //print_r($patientList);
                $oils = $this->db->get('pharma1_oil')->result();
                foreach($oils as $oil){
                    
                    $start_date = date('Y-m-d',strtotime($push_date));
                    $end_date   = date('Y-m-d',strtotime($push_date));
                    $start_date_f= $start_date." 23:59:00";
                    $end_date_f= $end_date." 23:59:00";
                    
                    $patients1 = $this->db->select("*")
                        ->from('patient_ipd')
                        ->join('department','department.dprt_id = patient_ipd.department_id')
                        ->where('discharge_date >=', $start_date_f)
                        ->where('create_date <=', $end_date_f)
                        ->where('ipd_opd', 'ipd')
                        ->get()
                        ->result();
                            
                    //print_r('q1   ');
                    //print_r($this->db->last_query());
                            
                    $patients2 = $this->db->select("*")
                        ->from('patient_ipd')
                        ->join('department','department.dprt_id = patient_ipd.department_id')
                        ->where('create_date <=', $end_date_f)
                        ->where('discharge_date LIKE', '%0000-00-00%')
                        ->where('ipd_opd', 'ipd')
                        ->get()
                        ->result();
                        
                    //print_r('q2   ');                    
                    //print_r($this->db->last_query());
                    $patientList = array_merge($patients1, $patients2);
                    
                    //print_r($patientList);echo '<br>';
                    foreach($patientList as $patient){
                        
                        if(date('Y-m-d',strtotime($patient->create_date))<='2022-07-29'){
                            $section_tret='ipd';
                            $len=strlen($patient->dignosis);
                            $dd= substr($patient->dignosis,$len - 1);
                            if($dd=='I'){
                                $p_dignosis = '%'.$patient->dignosis.'%';
                                $p_dignosis_name=$patient->dignosis;
                            }else{
                                $p_dignosis = '%'.$patient->dignosis.'I%';
                                $p_dignosis_name=$patient->dignosis.'I';
                            }
                            if($patient->manual_status==0){
                                $tretment=$this->db->select("*")
                                    ->from('treatments1')
                                    ->where('dignosis LIKE',$p_dignosis)
                                    ->where('ipd_opd ',$section_tret)
                                    ->get()
                                    ->row();
                            }else{
                                $tretment=$this->db->select("*")
                                    ->from('manual_treatments')
                                    ->where('patient_id_auto',$patient->id)
                                    ->where('dignosis LIKE',$p_dignosis)
                                    ->where('ipd_opd ',$section_tret)
                                    ->get()
                                    ->row();
                            }
                        }else{
                            $che=trim($patient->dignosis);
                            //print_r($che);
                            
                            $section_tret='ipd';
                            $len=strlen($che);
                            $dd= substr($che,$len - 1);
                            
                            $str = $patient->dignosis;
                            $arry=explode("-",$str);
                            $t_c=count($arry);
                            if($t_c=='2'){
                                $dd1=substr($che, 0, -1);
                                $new_str = trim($arry[0]);
                                $p_dignosis = '%'.$new_str.'%';
                                $p_dignosis_name=$patient->dignosis;
                            }else{
                                $p_dignosis = '%'.$che.'%';
                                $p_dignosis_name=$patient->dignosis;
                            }
                            if($patient->manual_status==0){
                                if($patient->proxy_id){
                                    $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('proxy_id',$patient->proxy_id)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                }
                                else{
                                    $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();  
                                }
                            }else{
                                $tretment=$this->db->select("*")
                                    ->from('manual_treatments')
                                    ->where('patient_id_auto',$patient->id)
                                    ->where('dignosis LIKE',$p_dignosis)
                                    ->where('ipd_opd ',$section_tret)
                                    ->get()
                                    ->row();
                            }
                        }
                            
                        //print_r(count($tretarray));print_r('<br>');
                        
                        $admit_date=date('Y-m-d',strtotime($patient->create_date));
                        $vaman_virachan_date=date('Y-m-d',strtotime("+7 days", strtotime($admit_date)));
                        $date1=date_create($admit_date);
                        $date2=date_create($startDate2);
                        $diff=date_diff($date1,$date2);
                        $diffDay = $diff->format("%a");
                        $shirobastiCheck = ($diffDay % 2);
                        if($tretment){
                            if($tretment->SNEHAN){
                                //echo 'SNEHAN   '.$tretment->SNEHAN;;print_r('<br>');
                                $temp_str = $tretment->SNEHAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SNEHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'SNEHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->SWEDAN){
                                //echo 'SWEDAN   '.$tretment->SWEDAN;;print_r('<br>');
                                $temp_str = $tretment->SWEDAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SWEDAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'SWEDAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->VAMAN){
                                //echo 'VAMAN   '.$tretment->VAMAN;;print_r('<br>');
                                $temp_str = $tretment->VAMAN;
                                if($admit_date <= '2022-07-29' && $admit_date == $startDate2){
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }else{
                                    if($vaman_virachan_date == $startDate2){
                                        $str=explode(",",$temp_str);
                                        $count_str = count($str);
                                        
                                        if($count_str > 1){
                                            for($i=0;$i<$count_str;$i++){
                                                $arry_str1=explode("(",$str[$i]);
                                                $count_str1 = count($arry_str1);
                                                // print_r($arry_str1[$count_str1-1]);
                                                // print_r("<br>");
                                                $temp_str2 = $arry_str1[$count_str1-1];
                                                $arry_str2=explode(")",$temp_str2);
                                                $count_str2 = count($arry_str2);
                                                // print_r($arry_str2[0]);
                                                // print_r("<br>");
                                                $temp_str3 = $arry_str2[0];
                                                $arry_str3=explode("-",$temp_str3);
                                                $count_str3 = count($arry_str3);
                                                // print_r($arry_str3[0]);
                                                // print_r("<br>");
                                                if(trim($arry_str3[0]) == $oil->name){
                                                    echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                    
                                                    $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                    $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                    $gCheck = preg_match("/g/", $arry_str3[1]);
                                                    $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                    $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                    $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                    $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                    $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1 || $MGCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1 || $GMCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1){
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                        $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $ltrVal[0] * 1000;
                                                        print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }
                                            }
                                        }
                                        else{
                                            $arry_str1=explode("(",$temp_str);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'VAMAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                }
                            }
                            if($tretment->VIRECHAN){
                                //echo 'VIRECHAN   '.$tretment->VIRECHAN;;print_r('<br>');
                                $temp_str = $tretment->VIRECHAN;
                                if($admit_date <= '2022-07-29'){
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }else{
                                    if($vaman_virachan_date == $startDate2){
                                        $str=explode(",",$temp_str);
                                        $count_str = count($str);
                                        
                                        if($count_str > 1){
                                            for($i=0;$i<$count_str;$i++){
                                                $arry_str1=explode("(",$str[$i]);
                                                $count_str1 = count($arry_str1);
                                                // print_r($arry_str1[$count_str1-1]);
                                                // print_r("<br>");
                                                $temp_str2 = $arry_str1[$count_str1-1];
                                                $arry_str2=explode(")",$temp_str2);
                                                $count_str2 = count($arry_str2);
                                                // print_r($arry_str2[0]);
                                                // print_r("<br>");
                                                $temp_str3 = $arry_str2[0];
                                                $arry_str3=explode("-",$temp_str3);
                                                $count_str3 = count($arry_str3);
                                                // print_r($arry_str3[0]);
                                                // print_r("<br>");
                                                if(trim($arry_str3[0]) == $oil->name){
                                                    echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                    
                                                    $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                    $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                    $gCheck = preg_match("/g/", $arry_str3[1]);
                                                    $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                    $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                    $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                    $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                    $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1 || $MGCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1 || $GMCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1){
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                        $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                        $tempChurnaVal = $ltrVal[0] * 1000;
                                                        print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c1 = $c1 + $tempChurnaVal;
                                                }
                                            }
                                        }
                                        else{
                                            $arry_str1=explode("(",$temp_str);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'VIRECHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                }
                            }
                            if($tretment->BASTI){
                                //echo 'BASTI   '.$tretment->BASTI;;print_r('<br>');
                                $temp_str = $tretment->BASTI;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'BASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'BASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->NASYA){
                                //echo 'NASYA   '.$tretment->NASYA;;print_r('<br>');
                                $temp_str = $tretment->NASYA;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'NASYA   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'NASYA   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->RAKTAMOKSHAN){
                                //echo 'RAKTAMOKSHAN   '.$tretment->RAKTAMOKSHAN;;print_r('<br>');
                                $temp_str = $tretment->RAKTAMOKSHAN;
                                
                                if($admit_date == $startDate2){
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'RAKTAMOKSHAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'RAKTAMOKASHAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                            }
                            if($tretment->SHIRODHARA_SHIROBASTI){
                                //echo 'SHIRODHARA_SHIROBASTI   '.$tretment->SHIRODHARA_SHIROBASTI;;print_r('<br>');
                                $temp_str = $tretment->SHIRODHARA_SHIROBASTI;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SHIRODHARA   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'SHIRODHARA   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->SHIROBASTI){
                                //echo 'SHIROBASTI   '.$tretment->SHIROBASTI;;print_r('<br>');
                                $temp_str = $tretment->SHIROBASTI;
                                
                                if($shirobastiCheck == 0){
                                    $str=explode(",",$temp_str);
                                    $count_str = count($str);
                                    
                                    if($count_str > 1){
                                        for($i=0;$i<$count_str;$i++){
                                            $arry_str1=explode("(",$str[$i]);
                                            $count_str1 = count($arry_str1);
                                            // print_r($arry_str1[$count_str1-1]);
                                            // print_r("<br>");
                                            $temp_str2 = $arry_str1[$count_str1-1];
                                            $arry_str2=explode(")",$temp_str2);
                                            $count_str2 = count($arry_str2);
                                            // print_r($arry_str2[0]);
                                            // print_r("<br>");
                                            $temp_str3 = $arry_str2[0];
                                            $arry_str3=explode("-",$temp_str3);
                                            $count_str3 = count($arry_str3);
                                            // print_r($arry_str3[0]);
                                            // print_r("<br>");
                                            if(trim($arry_str3[0]) == $oil->name){
                                                echo 'SHIROBASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                                
                                                $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                                $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                                $gCheck = preg_match("/g/", $arry_str3[1]);
                                                $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                                $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                                $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                                $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                                $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                                $tempChurnaVal = 0;
                                                if($mgCheck == 1 || $MGCheck == 1){
                                                    $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                    print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($gCheck == 1 || $GMCheck == 1){
                                                    $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $gVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($mlCheck == 1 || $MLCheck == 1){
                                                    $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $mlVal[0];
                                                    print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                    $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                    $tempChurnaVal = $ltrVal[0] * 1000;
                                                    print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                }
                                                $c1 = $c1 + $tempChurnaVal;
                                            }
                                        }
                                    }
                                    else{
                                        $arry_str1=explode("(",$temp_str);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'SHIROBASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                            }
                            if($tretment->YONIDHAVAN){
                                //echo 'YONIDHAVAN   '.$tretment->YONIDHAVAN;;print_r('<br>');
                                $temp_str = $tretment->YONIDHAVAN;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'YONIDHAVAN   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'YONIDHAVAN   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->YONIPICHU){
                                //echo 'YONIPICHU   '.$tretment->YONIPICHU;;print_r('<br>');
                                $temp_str = $tretment->YONIPICHU;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'YONIPICHU   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'YONIPICHU   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->UTTARBASTI){
                                //echo 'UTTARBASTI   '.$tretment->UTTARBASTI;;print_r('<br>');
                                $temp_str = $tretment->UTTARBASTI;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'UTTARBASTI   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'UTTARBASTI   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                            if($tretment->OTHER){
                                //echo 'OTHER   '.$tretment->OTHER;;print_r('<br>');
                                $temp_str = $tretment->OTHER;
                                
                                $str=explode(",",$temp_str);
                                $count_str = count($str);
                                
                                if($count_str > 1){
                                    for($i=0;$i<$count_str;$i++){
                                        $arry_str1=explode("(",$str[$i]);
                                        $count_str1 = count($arry_str1);
                                        // print_r($arry_str1[$count_str1-1]);
                                        // print_r("<br>");
                                        $temp_str2 = $arry_str1[$count_str1-1];
                                        $arry_str2=explode(")",$temp_str2);
                                        $count_str2 = count($arry_str2);
                                        // print_r($arry_str2[0]);
                                        // print_r("<br>");
                                        $temp_str3 = $arry_str2[0];
                                        $arry_str3=explode("-",$temp_str3);
                                        $count_str3 = count($arry_str3);
                                        // print_r($arry_str3[0]);
                                        // print_r("<br>");
                                        if(trim($arry_str3[0]) == $oil->name){
                                            echo 'OTHER   '.$temp_str;print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            
                                            $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                            $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                            $gCheck = preg_match("/g/", $arry_str3[1]);
                                            $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                            $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                            $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                            $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                            $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                            $tempChurnaVal = 0;
                                            if($mgCheck == 1 || $MGCheck == 1){
                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($gCheck == 1 || $GMCheck == 1){
                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $gVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($mlCheck == 1 || $MLCheck == 1){
                                                $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $mlVal[0];
                                                print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            elseif($ltrCheck == 1 || $LTRCheck == 1){
                                                $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                                $tempChurnaVal = $ltrVal[0] * 1000;
                                                print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                            }
                                            $c1 = $c1 + $tempChurnaVal;
                                        }
                                    }
                                }
                                else{
                                    $arry_str1=explode("(",$temp_str);
                                    $count_str1 = count($arry_str1);
                                    // print_r($arry_str1[$count_str1-1]);
                                    // print_r("<br>");
                                    $temp_str2 = $arry_str1[$count_str1-1];
                                    $arry_str2=explode(")",$temp_str2);
                                    $count_str2 = count($arry_str2);
                                    // print_r($arry_str2[0]);
                                    // print_r("<br>");
                                    $temp_str3 = $arry_str2[0];
                                    $arry_str3=explode("-",$temp_str3);
                                    $count_str3 = count($arry_str3);
                                    // print_r($arry_str3[0]);
                                    // print_r("<br>");
                                    if(trim($arry_str3[0]) == $oil->name){
                                        echo 'OTHER   '.$temp_str;print_r("=====>");print_r($arry_str3[1]);print_r("=====>");print_r($oil->name);print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        
                                        $mgCheck = preg_match("/mg/", $arry_str3[1]);
                                        $MGCheck = preg_match("/MG/", $arry_str3[1]);
                                        $gCheck = preg_match("/g/", $arry_str3[1]);
                                        $GMCheck = preg_match("/GM/", $arry_str3[1]);
                                        $mlCheck = preg_match("/ml/", $arry_str3[1]);
                                        $MLCheck = preg_match("/ML/", $arry_str3[1]);
                                        $ltrCheck = preg_match("/ltr/", $arry_str3[1]);
                                        $LTRCheck = preg_match("/LTR/", $arry_str3[1]);
                                        $tempChurnaVal = 0;
                                        if($mgCheck == 1 || $MGCheck == 1){
                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($gCheck == 1 || $GMCheck == 1){
                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $gVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($mlCheck == 1 || $MLCheck == 1){
                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $mlVal[0];
                                            print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        elseif($ltrCheck == 1 || $LTRCheck == 1){
                                            $ltrVal = preg_split("/[(A-Z)(a-z)]/", $arry_str3[1]);
                                            $tempChurnaVal = $ltrVal[0] * 1000;
                                            print_r($ltrVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                        }
                                        $c1 = $c1 + $tempChurnaVal;
                                    }
                                }
                            }
                        }
                            
                    }
                    
                    //print_r($c1);print_r('=======');print_r('<br>');
                    $oilCountArray[$index] = ['oil_id' => $oil->id, 'oil_churna_name'=>$oil->name, 'oil_count'=>$c1];
                    $index = $index + 1; 
                    $c1 = 0;
                    //print_r($oilCountArray);
                }
            }
            else{
                foreach($oils as $oil){
                    $oilCountArray[$index] = ['oil_id' => $oil->id, 'oil_churna_name'=>$oil->name, 'oil_count'=>0];
                    $index = $index + 1;
                }
            }
            
            print_r('<br><br>');
            print_r($oilCountArray);
            
            for($i=0; $i<count($oilCountArray);$i++){
                echo '<br>';
                $res = $this->db->where(['id'=> $oilCountArray[$i]['oil_id'], 'name like '=>'%'.$oilCountArray[$i]['oil_churna_name'].'%'])->get('pharma1_oil')->row();
                print_r($res->id);echo '<br>';
                print_r($oilCountArray[$i]['oil_churna_name']);echo '<br>';
                print_r($res->closing_bal);echo '<br>';

                $oil_churna_name = $oilCountArray[$i]['oil_churna_name'];
                $daily_despensing_bal = $oilCountArray[$i]['oil_count'];
                $daily_opening_bal = $res->closing_bal;
                $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                ////print_r($daily_opening_bal);echo '<br>';
                ////echo '==============';
                ////print_r($daily_closing_bal);echo '<br>';
                
                
                ///////////Comment for test ///////////////
                
                if($daily_opening_bal < $daily_despensing_bal || $daily_closing_bal < 0)
                {
                    $current_stock = $daily_opening_bal;
                    $added_stock = $res->opening_bal;
                    $opening_bal_temp = $daily_opening_bal + $res->opening_bal;
                    
                    $total_stock = $opening_bal_temp;
                    $daily_closing_bal = $opening_bal_temp-$daily_despensing_bal;
                    
                    ////print_r('c stock => ');print_r($current_stock);print_r('<br>');
                    ////print_r('add stock => ');print_r($added_stock);print_r('<br>');
                    ////print_r('total stock');print_r($total_stock);print_r('<br>');
                    
                    (Object)$postData = ([
                        'medicine_id'=>$res->id,
                        'name' => $oil_churna_name,
                        'daily_added_bal' => $added_stock,
                        'daily_opening_bal' => $daily_opening_bal,
                        'daily_despensing_bal' => $daily_despensing_bal,
                        'daily_closing_bal' => $daily_closing_bal,
                        'create_date' => $startDate2,
                        'ipd_opd' => 'ipd',
                        'type'=>$res->type,
                        'status' => $res->status
                    ]);
                    (Object)$postData1 = ([
                        'closing_bal' => $daily_closing_bal
                    ]);
                    (Object)$postData2 = ([
                        'medicine_id'=>$res->id,
                        'name' => $oil_churna_name,
                        'current_stock' => $current_stock,
                        'added_stock' => $added_stock,
                        'total_stock' => $total_stock,
                        'create_date' => $startDate2,
                        'ipd_opd' => 'ipd',
                        'type'=>$res->type,
                        'status' => $res->status
                    ]);
                    if($this->db->insert('daily_ipd_oil_stock', $postData))
                    {
                        if($this->db->where('id',$res->id)->update('pharma1_oil', $postData1)){
                            //print_r('Stock Updated Successfully');
                            if($this->db->insert('oil_stock_register', $postData2)){
                                print_r('IPD Oil Stock Updated Successfully');
                            }
                        }
                    }
                }
                else{
                    (Object)$postData = ([
                        'medicine_id'=>$res->id,
                        'name' => $oil_churna_name,
                        'daily_opening_bal' => $daily_opening_bal,
                        'daily_despensing_bal' => $daily_despensing_bal,
                        'daily_closing_bal' => $daily_closing_bal,
                        'create_date' => $startDate2,
                        'ipd_opd' => 'ipd',
                        'type'=>$res->type,
                        'status' => $res->status
                    ]);
                    (Object)$postData1 = ([
                        'closing_bal' => $daily_closing_bal
                    ]);
                    if($this->db->insert('daily_ipd_oil_stock', $postData))
                    {
                        if($this->db->where('id',$res->id)->update('pharma1_oil', $postData1)){
                            print_r('IPD Oil Stock Updated Successfully');
                        }
                    }
                }
            }
            
        }
        
    }
    
    public function oil_stock_report()
    {
        $section = $this->input->get('section');
        if($section){
            $data['section'] = $section;
        }else{
            $data['section'] = '';
        }
        $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = $this->input->get('start_date');
        }else{
            $sDate = '';
        }
        if($this->input->get('end_date')){
            $eDate = $this->input->get('end_date');
        }else{
            $eDate = '';
        }
        
      
        
        $data['reportType'] = $reportType = $this->input->get('reportType');
        if($reportType == 'd'){
            $data['datefrom']=$sDate;
            $data['dateto']=$sDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($sDate));
            
            if($section == 'opd'){
                $data['oilDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                    ->order_by('id','ASC')
                    ->get('daily_opd_oil_stock')
                    ->result();
                //print_r($this->db->last_query());
                $data['churnDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                    ->order_by('id','ASC')
                    ->get('daily_opd_oil_stock')
                    ->result();
            }
            else if($section == 'ipd'){
                $data['oilDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                    ->order_by('id','ASC')
                    ->get('daily_ipd_oil_stock')
                    ->result();
                $data['churnDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                    ->order_by('id','ASC')
                    ->get('daily_ipd_oil_stock')
                    ->result();
            }
        }
        elseif($reportType == 'm'){
            $data['datefrom']=$sDate;
            $data['dateto']=$eDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['oilStockRegister'] = $this->db->where(['type'=>'1'])
                ->get('pharma1_oil')
                ->result();
            $data['churnStockRegister'] = $this->db->where(['type'=>'2'])
                ->get('pharma1_oil')
                ->result();
            //print_r($this->db->last_query());
        }
        elseif($reportType == 'y'){
            $data['datefrom']= $sDate ='01-01-'.$this->session->userdata['acyear'];
            $data['dateto']= $eDate ='31-12-'.$this->session->userdata['acyear'];
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['oilStockRegister'] = $this->db->where(['type'=>'1'])
                ->get('pharma1_oil')
                ->result();
            $data['churnStockRegister'] = $this->db->where(['type'=>'2'])
                ->get('pharma1_oil')
                ->result();
        }
        
        
        $data['content'] = $this->load->view('oil_stock_report',$data,true);
        $this->load->view('layout/main_wrapper',$data);  
    }


    public function oil_stock_import_report(){
        $currentYear = $this->session->userdata['acyear'];
        $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = date('Y-m-d', strtotime($this->input->get('start_date')));
        }else{
            $sDate = date('Y-m-d', strtotime($currentYear.'-01-01'));
        }
        if($this->input->get('end_date')){
            $eDate = date('Y-m-d', strtotime($this->input->get('end_date')));
        }else{
            $eDate = date('Y-m-d', strtotime($currentYear.'-12-31'));
        }
        $data['datefrom']=$sDate;
        $data['dateto']=$eDate;
        
        $oilstockImportData = $this->db->where(['create_date >='=>$sDate, 'create_date <='=>$eDate])->get('oil_stock_register')->result();
        //print_r($oilstockImportData);
        $data['oilstockImportData'] = $oilstockImportData;
        $data['content'] = $this->load->view('oil_stock_import_register',$data,true);
        $this->load->view('layout/main_wrapper',$data);
    }

    ////////////////////////////////////////  Oil Stock  ////////////////////////////////////////
    
  
  
  
    public function kadhaStock()
    {
                
            error_reporting(0);
            echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
            date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
            echo date('d-m-Y H:i:s');
            echo "<script>
                $(document).ready(function () {
                     setTimeout('location.reload(true);', '60000');
                });
            </script>";
        
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////            OPD STOCK CODE          ////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                    
            $start_time= date('H:i',strtotime('18:15'));
            $time_date=date('H:i');
            
            $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'opd')->order_by('id','DESC')->limit(1)->get('daily_stock_kadha')->row();
            print_r('<br>');
            $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
            print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
            $current_date = date('Y-m-d');
            print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
            $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
            print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');
            
            $res = $this->db->where('create_date', $push_date)->get('patient')->result();
            if($current_date == $push_date)
            {
                $tabletCountArray = array();
                    $tabletCount = 0;
                    $index = 0;
                    $tabletRoundArray = array();
                    $c1 = 0;
                    
                    $startDate2 = date('Y-m-d', strtotime($push_date));
                    print_r('OPD Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                    
                    if($res != '' || $res != null){
                        //print_r($patientList);
                        // $tablets = $this->db->where('status','2')->get('pharma1')->result();
                        $tablets = $this->db->get('pharma1')->result();
                        foreach($tablets as $tab)
                        {
                            // $this->db->where('create_date like', '%'.$startDate2.'%');
                            // $this->db->where('ipd_opd', 'opd');
                            // $patientList =  $this->db->get('patient')->result();
                            
                            $this->db->select('yearly_reg_no');
                            $this->db->from('patient_ipd');
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where('ipd_opd', 'ipd');
                            $subQuery =  $this->db->get_compiled_select();
                            
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                            $this->db->where('ipd_opd', 'opd');
                            $this->db->or_where('old_reg_no !=', '');
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where('ipd_opd', 'opd');
                            $patientList =  $this->db->get('patient')->result();
                            
                            //print_r(count($patientList));echo '<br>';
                            foreach($patientList as $patient)
                            {
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='opd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = '%'.$new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = '%'.$che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                              
                                $ss=date('Y-m-d',strtotime($patient->create_date));
                                
                              
                                if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
    
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else{
                                              
                                           $tretment=$this->db->select("*")
    
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                       }
    
                                if($tretment){
                                    if(stripos($tretment->RX1, $tab->name) !== false){
                                        // echo 'RX1   '.$tretment->RX1;
                                        $str = $tretment->RX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX2, $tab->name) !== false){
                                        // echo 'RX2   '.$tretment->RX2;
                                        $str = $tretment->RX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX3, $tab->name) !== false)
                                    {
                                        // echo 'RX3   '.$tretment->RX3;
                                        $str = $tretment->RX3;
                                       $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX4, $tab->name) !== false){
                                        // echo 'RX4   '.$tretment->RX4;
                                        $str = $tretment->RX4;
                                       $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX5, $tab->name) !== false)
                                    {
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->RX5;
                                      $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                }
                                        $total_last_count = 0;
                                        $total_quantity = $c3;
                                        $total_count = $total_quantity * $tab_days;
                                        $total_last_count = $c1 * $tab_days;
                                        
                                    
                                    if(stripos($tretment->RX1, $tab->name) !== false || stripos($tretment->RX2, $tab->name) !== false 
                                        || stripos($tretment->RX3, $tab->name) !== false || stripos($tretment->RX4, $tab->name) !== false 
                                        || stripos($tretment->RX5, $tab->name) !== false)  
                                        {
                                            $patient_array = array(
                                            'patient_auto_id'=>$patient->id,
                                            'yearly_reg_no'=>$patient->yearly_reg_no,
                                            'old_reg_no'=>$patient->old_reg_no,
                                            'age'=>$patient->date_of_birth,
                                            'sex'=>$patient->sex,
                                            'address'=>$patient->address,
                                            'name'=>$patient->firstname,
                                            'dignosis'=>$patient->dignosis,
                                            'RX1'=>$tab->name,
                                            'RX1_despense'=>$total_count,
                                            'tab_name'=>$tab->name,
                                            'tab_count'=>$total_quantity,
                                            'tab_days'=>$tab_days,
                                            'create_date'=>$patient->create_date,
                                            'total_despense'=>$total_last_count
                                            ); 
                                            $a = $this->db->insert('kadha_daily_opd_patient', $patient_array);
                                        }


                                        
                            }
                             //print_r($tabletRoundArray);
                             $tabletCountArray[$index] = ['tab_count' => $tabletCount, 'tab_name'=>$tab->name, 'tab_round'=>$c1, 'tab_days'=>$tab_days];
                             $index = $index + 1; 
                             $tabletCount = $c1 = 0;
                           
                        }
                    }
                    else
                    {
                        foreach($tablets as $tab){
                            $tabletCountArray[$index] = ['tab_count' => 0, 'tab_name'=>$tab->name, 'tab_round'=>0, 'tab_days'=>0];
                            $index = $index + 1;
                        }
                    }
                    //print_r('<br><br>');
                    //print_r($tabletCountArray);
                    for($i=0; $i<count($tabletCountArray);$i++){
                        echo '<br>';
                        // $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%', 'status'=>'2'])->get('pharma1')->row();
                        $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%'])->get('pharma1')->row();
                        print_r($tabletCountArray[$i]['tab_name']);echo '<br>';
                        print_r($res->closing_bal);echo '<br>';
                        //print_r(intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                        print_r($tabletCountArray[$i]['tab_round']*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                        
                        $tab_name = $tabletCountArray[$i]['tab_name'];
                        //$daily_despensing_bal = intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']);
                     //   echo'<br><br><br><br><br><br>';
                        echo 'TAB_ROUND=====>'.$tabletCountArray[$i]['tab_round'];echo'<br>';
                        echo 'TAB_DAYS======>'.$tabletCountArray[$i]['tab_days'];
                    //    echo'<br><br><br><br><br><br>';

                        $daily_despensing_bal = 0;

                        $patient_despense =  $this->db->select('DISTINCT(tab_name) as Tab_name,sum(RX1_despense) as despense')
                        ->from('kadha_daily_opd_patient')
                        ->where('tab_name',$tab_name)
                        ->where('create_date',$startDate2)
                        ->get()
                        ->result();
                    $daily_despensing_bal = 0;
                    foreach($patient_despense as $test)
                    {
                      if(stripos($tab_name, $test->Tab_name) !== false)
                      {
                          $daily_despensing_bal = $test->despense;
                      }
                      
                    }
                          // echo'<br><br><br><br><br><br>';
                            echo 'Daily_despense_balance=======>'.$daily_despensing_bal = $daily_despensing_bal;
                        //   echo'<br><br><br><br><br><br>';
                      
                        //$daily_despensing_bal = $tabletCountArray[$i]['tab_round'] * $tabletCountArray[$i]['tab_days'];
                        $daily_opening_bal = $res->closing_bal;
                        $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                        ////print_r($daily_opening_bal);echo '<br>';
                        ////echo '==============';
                        ////print_r($daily_closing_bal);echo '<br>';
                        
                        
                        //////comment for test ////////////////
                        if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                        {
                            $current_stock = $daily_opening_bal;
                            $added_stock = $res->opening_bal;
                            $opening_bal_temp = intval($daily_opening_bal) + intval($res->opening_bal);
                            $total_stock = $opening_bal_temp;
                            $daily_closing_bal = intval($opening_bal_temp)-intval($daily_despensing_bal);
                            
                            ////print_r('c stock => ');print_r($current_stock);print_r('<br>');
                            ////print_r('add stock => ');print_r($added_stock);print_r('<br>');
                            ////print_r('total stock');print_r($total_stock);print_r('<br>');
                            
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_added_bal' => $added_stock,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            (Object)$postData2 = ([
                                'name' => $tab_name,
                                'current_stock' => $current_stock,
                                'added_stock' => $added_stock,
                                'total_stock' => $total_stock,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'status' => $res->status
                            ]);
                            if($this->db->insert('daily_stock_kadha', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1)){
                                    //print_r('Stock Updated Successfully');
                                    if($this->db->insert('stock_register', $postData2)){
                                        print_r('OPD Stock Updated Successfully');
                                    }
                                }
                            }
                        }
                        else{
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            if($this->db->insert('daily_stock_kadha', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1', $postData1)){
                                    print_r('OPD Stock Updated Successfully');
                                }
                            }
                        }
                    }
                //echo '<br><br>'.$tabletCount;
            }
            elseif($current_date > $push_date)
            {
                $tabletCountArray = array();
                    $tabletCount = 0;
                    $index = 0;
                    $tabletRoundArray = array();
                    $c1 = 0;
                    
                    $startDate2 = date('Y-m-d', strtotime($push_date));
                    print_r('OPD Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                    
                    if($res != '' || $res != null){
                        //print_r($patientList);
                        // $tablets = $this->db->where('status','2')->get('pharma1')->result();
                        $tablets = $this->db->get('pharma1_kadha_oil')->result();
                        foreach($tablets as $tab)
                        {
                            // $this->db->where('create_date like', '%'.$startDate2.'%');
                            // $this->db->where('ipd_opd', 'opd');
                            // $patientList =  $this->db->get('patient')->result();
                            
                            $this->db->select('yearly_reg_no');
                            $this->db->from('patient_ipd');
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where('ipd_opd', 'ipd');
                            $subQuery =  $this->db->get_compiled_select();
                            
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                            $this->db->where('ipd_opd', 'opd');
                            $this->db->or_where('old_reg_no !=', '');
                            $this->db->where('create_date like', '%'.$startDate2.'%');
                            $this->db->where('ipd_opd', 'opd');
                            $patientList =  $this->db->get('patient')->result();
                            
                            //print_r(count($patientList));echo '<br>';
                            foreach($patientList as $patient)
                            {
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='opd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = '%'.$new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = '%'.$che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                              
                                $ss=date('Y-m-d',strtotime($patient->create_date));
                                
                              
                                if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
    
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else{
                                              
                                           $tretment=$this->db->select("*")
    
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                       }
    
                                if($tretment){
                                    if(stripos($tretment->RX1, $tab->name) !== false){
                                        // echo 'RX1   '.$tretment->RX1;
                                        $str = $tretment->RX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX2, $tab->name) !== false){
                                        // echo 'RX2   '.$tretment->RX2;
                                        $str = $tretment->RX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX3, $tab->name) !== false)
                                    {
                                        // echo 'RX3   '.$tretment->RX3;
                                        $str = $tretment->RX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX4, $tab->name) !== false)
                                    {
                                        // echo 'RX4   '.$tretment->RX4;
                                        $str = $tretment->RX4;
                                      $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->RX5, $tab->name) !== false)
                                    {
                                        // echo 'RX5   '.$tretment->RX5;
                                        $str = $tretment->RX5;
                                      $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++){
                                            if($i==0)
                                            {
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                if($tab->status == 1)
                                                {
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                  	$mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                         elseif($mlCheck == 1 || $MLCheck == 1){
                                                      $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                      $tempChurnaVal = $mlVal[0];
                                                      print_r($tempChurnaVal);print_r('<br>');
                                                  }
                                                  
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                    $c3 += $ar1[$ar1_count - 1];
                                                }
                                                for($j=$ar1_count;$j>0;$j--)
                                                {
                                                    if($ar1[$j]!=''){
                                                        $ex = explode('D',$ar1[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            elseif($i==($count-1))
                                            {
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1)
                                                {
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1)
                                                    {
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1)
                                                    {
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                   elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    $c3 += $tempChurnaVal;
                                                }
                                                else
                                                {
                                                    $c1 = $c1 + $ar2[0];
                                                    $c3 += $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--)
                                                {
                                                    if($ar2[$j]!='')
                                                    {
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                      $mlCheck = preg_match("/ml/", $arry[$i]);
                                            			$MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                      elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        $c3 += $tempChurnaVal;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                        $c3 += $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                }
                                        $total_last_count = 0;
                                        $total_quantity = $c3;
                                        $total_count = $total_quantity * $tab_days;
                                        $total_last_count = $c1 * $tab_days;
                                        
                                    
                                    if(stripos($tretment->RX1, $tab->name) !== false || stripos($tretment->RX2, $tab->name) !== false 
                                        || stripos($tretment->RX3, $tab->name) !== false || stripos($tretment->RX4, $tab->name) !== false 
                                        || stripos($tretment->RX5, $tab->name) !== false)  
                                        {
                                            $patient_array = array(
                                            'patient_auto_id'=>$patient->id,
                                            'yearly_reg_no'=>$patient->yearly_reg_no,
                                            'old_reg_no'=>$patient->old_reg_no,
                                            'age'=>$patient->date_of_birth,
                                            'sex'=>$patient->sex,
                                            'address'=>$patient->address,
                                            'name'=>$patient->firstname,
                                            'dignosis'=>$patient->dignosis,
                                            'RX1'=>$tab->name,
                                            'RX1_despense'=>$total_count,
                                            'tab_name'=>$tab->name,
                                            'tab_count'=>$total_quantity,
                                            'tab_days'=>$tab_days,
                                            'create_date'=>$patient->create_date,
                                            'total_despense'=>$total_last_count
                                            ); 
                                            $a = $this->db->insert('kadha_daily_opd_patient', $patient_array);
                                        }


                                        
                            }
                             //print_r($tabletRoundArray);
                             $tabletCountArray[$index] = ['tab_count' => $tabletCount, 'tab_name'=>$tab->name, 'tab_round'=>$c1, 'tab_days'=>$tab_days];
                             $index = $index + 1; 
                             $tabletCount = $c1 = 0;
                           
                        }
                    }
                    else
                    {
                        foreach($tablets as $tab){
                            $tabletCountArray[$index] = ['tab_count' => 0, 'tab_name'=>$tab->name, 'tab_round'=>0, 'tab_days'=>0];
                            $index = $index + 1;
                        }
                    }
                    //print_r('<br><br>');
                    //print_r($tabletCountArray);
                    for($i=0; $i<count($tabletCountArray);$i++){
                        echo '<br>';
                        // $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%', 'status'=>'2'])->get('pharma1_kadha_oil')->row();
                        $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%'])->get('pharma1_kadha_oil')->row();
                        print_r($tabletCountArray[$i]['tab_name']);echo '<br>';
                        print_r($res->closing_bal);echo '<br>';
                        //print_r(intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                        print_r($tabletCountArray[$i]['tab_round']*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                        
                        $tab_name = $tabletCountArray[$i]['tab_name'];
                        //$daily_despensing_bal = intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']);
                    //    echo'<br><br><br><br><br><br>';
                        echo 'TAB_ROUND=====>'.$tabletCountArray[$i]['tab_round'];echo'<br>';
                        echo 'TAB_DAYS======>'.$tabletCountArray[$i]['tab_days'];
                    //  echo'<br><br><br><br><br><br>';

                        $daily_despensing_bal = 0;

                        $patient_despense =  $this->db->select('DISTINCT(tab_name) as Tab_name,sum(RX1_despense) as despense')
                        ->from('kadha_daily_opd_patient')
                        ->where('tab_name',$tab_name)
                        ->where('create_date',$startDate2)
                        ->get()
                        ->result();
                    $daily_despensing_bal = 0;
                    foreach($patient_despense as $test)
                    {
                      if(stripos($tab_name, $test->Tab_name) !== false)
                      {
                          $daily_despensing_bal = $test->despense;
                      }
                      
                    }
                          // echo'<br><br><br><br><br><br>';
                            echo 'Daily_despense_balance=======>'.$daily_despensing_bal = $daily_despensing_bal;
                           //echo'<br><br><br><br><br><br>';
                      
                        //$daily_despensing_bal = $tabletCountArray[$i]['tab_round'] * $tabletCountArray[$i]['tab_days'];
                        $daily_opening_bal = $res->closing_bal;
                        $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                        ////print_r($daily_opening_bal);echo '<br>';
                        ////echo '==============';
                        ////print_r($daily_closing_bal);echo '<br>';
                        
                        
                        //////comment for test ////////////////
                        if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                        {
                            $current_stock = $daily_opening_bal;
                            $added_stock = $res->opening_bal;
                            $opening_bal_temp = intval($daily_opening_bal) + intval($res->opening_bal);
                            $total_stock = $opening_bal_temp;
                            $daily_closing_bal = intval($opening_bal_temp)-intval($daily_despensing_bal);
                            
                            ////print_r('c stock => ');print_r($current_stock);print_r('<br>');
                            ////print_r('add stock => ');print_r($added_stock);print_r('<br>');
                            ////print_r('total stock');print_r($total_stock);print_r('<br>');
                            
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_added_bal' => $added_stock,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            (Object)$postData2 = ([
                                'name' => $tab_name,
                                'current_stock' => $current_stock,
                                'added_stock' => $added_stock,
                                'total_stock' => $total_stock,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'status' => $res->status
                            ]);
                            if($this->db->insert('daily_stock_kadha', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1_kadha_oil', $postData1)){
                                    //print_r('Stock Updated Successfully');
                                    if($this->db->insert('stock_register', $postData2)){
                                        print_r('OPD Stock Updated Successfully');
                                    }
                                }
                            }
                        }
                        else{
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'opd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            if($this->db->insert('daily_stock_kadha', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1_kadha_oil', $postData1)){
                                    print_r('OPD Stock Updated Successfully');
                                }
                            }
                        }
                    }
                //echo '<br><br>'.$tabletCount;
            }
                
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////            IPD STOCK CODE          ////////////////////////////////////////////////
        ////////////////////////////////////////////////                                    ////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    
            $start_time= date('H:i',strtotime('18:15'));
            $time_date=date('H:i');
            
            $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'ipd')->order_by('id','DESC')->limit(1)->get('daily_ipd_stock_kadha')->row();
            print_r('<br>');
            $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
            print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
            $current_date = date('Y-m-d');
            print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
            $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
            print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');
            
            $res = $this->db->where('create_date', $push_date)->get('patient_ipd')->result();
            if($current_date == $push_date)
            {
                $startDate2 = date('Y-m-d', strtotime($push_date));
                    print_r('IPD Stock Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                    
                    $tabletCountArray = array();
                    $tabletCount = 0;
                    $index = 0;
                    $tabletRoundArray = array();
                    $c1 = 0;
                    $tabDays = 0;
                    $temp1 = 0;
                    $temp2 = 0;
                        
                    if($res != '' || $res != null)
                    {
                        //print_r($patientList);
                        // $tablets = $this->db->where('status','2')->get('pharma1_kadha_oil')->result();
                        $tablets = $this->db->get('pharma1_kadha_oil')->result();
                        foreach($tablets as $tab){
                            // $this->db->where('create_date like', '%'.$startDate2.'%');
                            // $this->db->where('ipd_opd', 'ipd');
                            // $patientList =  $this->db->get('patient_ipd')->result();
                            
                            $start_date = date('Y-m-d',strtotime($push_date));
                            $end_date  = date('Y-m-d',strtotime($push_date));
                            $start_date_f= $start_date." 23:59:00";
                            $end_date_f= $end_date."23:59:00";
                            
                        //    $patients1 = $this->db->select("*")
                        //        ->from('patient_ipd')
                        //        ->join('department','department.dprt_id = patient_ipd.department_id')
                        //        ->where('discharge_date >=', $start_date_f)
                        //      	//->or_where('discharge_date <=', $start_date_f)
                        //      	->or_where('discharge_date like', $start_date)
                        //        ->where('create_date <=', $end_date_f)
                        //        ->where('ipd_opd', 'ipd')
                        //        ->get()
                        //        ->result();
                                    
                            //print_r('q1   ');
                            //print_r($this->db->last_query());
                                    
                         //   $patients2 = $this->db->select("*")
                         //       ->from('patient_ipd')
                         //       ->join('department','department.dprt_id = patient_ipd.department_id')
                         //       ->where('create_date <=', $end_date_f)
                         //       ->where('discharge_date LIKE', '%0000-00-00%')
                         //       ->where('ipd_opd', 'ipd')
                         //       ->get()
                         //       ->result();
                            
                          
                          
                          
                          
                          
                            $patients1 = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where('discharge_date >=', $end_date)
                            ->where('create_date <=', $end_date)
                            ->where('ipd_opd', 'ipd')
                            ->or_where('discharge_date like', '%'.$start_date_f.'%')
                            ->get()
                            ->result();  
                                            
                            $patients2=$this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where ('ipd_opd', $section)
                            ->where('discharge_date LIKE', '%0000-00-00%')
                            ->where('create_date <=', 'ipd')
                            ->get()

                            ->result();
                                                //print_r('q2   ');                    
                            //print_r($this->db->last_query());
                            
                            $patientList = array_merge($patients1, $patients2);
                            
                            //print_r($patientList);echo '<br>';
                            foreach($patientList as $patient){
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = $new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = $che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                                // $tretment1=$this->db->select("*")
                                //     ->from('treatments1')
                                //     ->where('dignosis LIKE',$p_dignosis)
                                //     ->where('proxy_id',$patient->proxy_id)
                                //     ->where('department_id',$patient->department_id)
                                //     ->where('ipd_opd',$section_tret)
                                //     ->get()
                                //     ->row();
                                
                                
                                // $DISTRIBUTION_IPD=$tretment1->DISTRIBUTION_IPD; 
                                // $ipd_days=$tretment1->ipd_days; 
                                // $last_days=$ipd_days - $DISTRIBUTION_IPD;
                                // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1;
                                
                                //print_r('=>>>>');print_r($DISTRIBUTION_IPD);print_r('<br>');
                                
                                    
                                 if($patient->manual_status==0){
                                      if($patient->proxy_id){
			                          
			                         
                                     $tretment=$this->db->select("*")

			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else{
                                          
                                       $tretment=$this->db->select("*")

			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                     
                            //           if(empty($tretment)){
                            //           $tretment=$this->db->select("*")
                            //           ->from('treatments1')
                            //           ->where('department_id',$patient->department_id)
			                         // ->where('ipd_opd',$patient->department_id)
                            //          ->get()
                            //          ->row();   
                                         
                            //           }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                   }
                                    
                                echo '<br><br><br>';
                              echo   $datefrom_n=date('Y-m-d',strtotime($startDate2));  
			                      echo'<br>';
			                 echo    $admit_date=date('Y-m-d',strtotime($patient->create_date));
                               echo'<br>';
                                 if($patient->discharge_date=='0000-00-00'){
                                     //$discharge_date=date('Y-m-d', strtotime($admit_date. ' + 5 days'));
                                     
                                     $today_date=date('Y-m-d', strtotime($datefrom_n));
                                 } else{
                                 //$discharge_date=date('Y-m-d',strtotime($patient->discharge_date));
                                  $today_date=date('Y-m-d', strtotime($datefrom_n));
                                 }  
                                 
                                $date1=date_create($admit_date);
                                $date2=date_create($today_date);
                                $diff=date_diff($date1,$date2);
                            
                                echo 'Days difference in Create_date and Discharge Date====>'.$n= $diff->format("%a");
                                echo '<br>';
                                echo 'PAtient_name======>'.$patient->firstname;
                                echo '<br>';
                                
                                echo  'Distribution days====>'.$DISTRIBUTION_IPD=$tretment->DISTRIBUTION_IPD; 
                              	echo '<br>';
                                echo 'IPD DAYS====>   '.$ipd_days=$tretment->ipd_days; 
                              	$DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1; 
                                $last_days=$ipd_days - $DISTRIBUTION_IPD;
                             
                              	echo '<br><br><br>';
                              
                              
                              if($DISTRIBUTION_IPD < $n)
                              {
			                         if($patient->manual_status==0)
                                     {
                                      if($patient->proxy_id)
                                      {
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->order_by('id','desc')
                                         ->get()
                                         ->row();
                                         //print_r($this->db->last_query());
                                      }
                                      else
                                      {
                                         $tretment=$this->db->select("*")
                                       ->from('treatments1')
                                       ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                       ->where('ipd_opd ',$section_tret)
                                        ->order_by('id','desc')
                                       ->get()
                                       ->row();  
                                     
                                      }
                                  }else
                                     {
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                   }
			                         
			                      $RX1= $tretment->RX1;
			                      $RX2= $tretment->RX2;
			                      $RX3= $tretment->RX3;
			                      $RX4= $tretment->RX4;
			                      $RX5= $tretment->RX5;
			                      
			                      $RX_other= $tretment->RX_other;
			                      $RX_other1= $tretment->RX_other1;
			                      $other_equipment= $tretment->other_equipment;
			                         
			                         
			                     }
                              
                                if($tretment){
                                    if(stripos($tretment->RX1, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX1   '.$tretment->RX1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        ////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX2, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX2   '.$tretment->RX2;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        /////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX3, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX3   '.$tretment->RX3;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        //////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX4, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX4   '.$tretment->RX4;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX4;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        //////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX5, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX5   '.$tretment->RX5;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX5;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                }  
                                
                                $total_count = 0;
                            $total_quantity = $temp2;
                           $total_quantity_rx = $temp2;
                            if(stripos($tretment->RX1, $tab->name) !== false || stripos($tretment->RX2, $tab->name) !== false 
                                || stripos($tretment->RX3, $tab->name) !== false || stripos($tretment->RX4, $tab->name) !== false 
                                || stripos($tretment->RX5, $tab->name) !== false )  
                                {
                                    $patient_array = array(
                                    'patient_auto_id'=>$patient->id,
                                    'yearly_reg_no'=>$patient->yearly_reg_no,
                                    'old_reg_no'=>$patient->old_reg_no,
                                    'age'=>$patient->date_of_birth,
                                    'sex'=>$patient->sex,
                                    'address'=>$patient->address,
                                    'name'=>$patient->firstname,
                                    'dignosis'=>$patient->dignosis,
                                    'RX1'=>$tab->name,
                                    'RX1_despense'=>$total_count = $total_quantity_rx,
                                    'tab_name'=>$tab->name,
                                    'tab_count'=>$total_quantity_rx,
                                    'tab_days'=>$tab_days1,
                                    'create_date'=>$patient->create_date,
                                     'push_date'=>$push_date,
                                    'discharge_date'=>$patient->discharge_date,
                                    ); 
                                    $a = $this->db->insert('kadha_daily_ipd_patient', $patient_array);
                                
                                }
                                        
                            }
                            
                            
                            $patientList1 = $this->db->select("*")
                                ->from('patient_ipd')
                                ->join('department','department.dprt_id = patient_ipd.department_id')
                                ->where('ipd_opd', 'ipd')
                                ->where('discharge_date >=', $start_date)
                                ->where('discharge_date <=', $end_date)
                                //->where('create_date LIKE', $year)
                                ->get()
                                ->result();
                            
                            foreach($patientList1 as $patient){
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = $new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = $che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                                // $tretment1=$this->db->select("*")
                                //     ->from('treatments1')
                                //     ->where('dignosis LIKE',$p_dignosis)
                                //     ->where('proxy_id',$patient->proxy_id)
                                //     ->where('department_id',$patient->department_id)
                                //     ->where('ipd_opd',$section_tret)
                                //     ->get()
                                //     ->row();
                                
                                
                                // $DISTRIBUTION_IPD=$tretment1->DISTRIBUTION_IPD; 
                                // $ipd_days=$tretment1->ipd_days; 
                                // $last_days=$ipd_days - $DISTRIBUTION_IPD;
                                // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1;
                                
                                //print_r('=>>>>');print_r($DISTRIBUTION_IPD);print_r('<br>');
                                
                                // if($patient->manual_status==0){
                                //     if($patient->proxy_id){
                                //         $tretment=$this->db->select("*")
                                //             ->from('treatments1')
                                //             ->where('dignosis LIKE',$p_dignosis)
                                //             ->where('proxy_id',$patient->proxy_id)
                                //             ->where('department_id',$patient->department_id)
                                //             ->where('ipd_opd ',$section_tret)
                                //             ->get()
                                //             ->row();
                                //     }
                                // }else{
                                //     $tretment=$this->db->select("*")
                                //         ->from('manual_treatments')
                                //         ->where('patient_id_auto',$patient->id)
                                //         ->where('dignosis LIKE',$p_dignosis)
                                //         ->where('ipd_opd ',$section_tret)
                                //         ->get()
                                //         ->row();
                                // }
                                
                                
                                 if($patient->manual_status==0){
                                        $section_tret='ipd';
                                        // $tretarray=$this->db->select("*")
                                        //     ->from('treatments1')
                                        //     ->where('dignosis LIKE',$p_dignosis)
                                        //     ->where('proxy_id',$patient->proxy_id)
                                        //     ->where('department_id',$patient->department_id)
                                        //     ->where('ipd_opd',$section_tret)
                                        //     ->get()->result();
                                        
                                        if($patient->proxy_id){
                                            $tretment=$this->db->select("*")
                                                ->from('treatments1')
                                                ->where('dignosis LIKE',$p_dignosis)
                                                ->where('proxy_id',$patient->proxy_id)
                                                ->where('department_id',$patient->department_id)
                                                //->order_by("id", "desc")
                                                ->where('ipd_opd ',$section_tret)
                                                ->get()
                                                ->row();
                                        }
                                        else{
                                            $tretment=$this->db->select("*")
                                                ->from('treatments1')
                                                ->where('dignosis LIKE',$p_dignosis)
                                                ->where('department_id',$patient->department_id)
                                               // ->order_by("id", "desc")
                                                ->where('ipd_opd ',$section_tret)
                                                ->get()
                                                ->row();  
                                        
                                        //     if(empty($tretment)){
                                        //         $tretment=$this->db->select("*")
                                        //             ->from('treatments1')
                                        //             ->where('department_id',$patient->department_id)
                                        //             ->where('ipd_opd',$patient->department_id)
                                        //             ->get()
                                        //             ->row();   
                                            }
                                        // }
                                    }else{
                                        $tretment=$this->db->select("*")
                                            ->from('manual_treatments')
                                            ->where('patient_id_auto',$patient->id)
                                            ->where('dignosis LIKE',$p_dignosis)
                                            ->where('ipd_opd ',$section_tret)
                                            ->get()
                                            ->row();
                                    }
                              
                             
			                      
			                     
                                
                                
                                if($tretment){
                                    if(stripos($tretment->DRX1, $tab->name) !== false){
                                        echo 'DRX1   '.$tretment->DRX1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                  $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                  $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                  $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		    $MLCheck = preg_match("/ML/", $ar2[0]);

                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                       $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                       $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->DRX2, $tab->name) !== false){
                                        echo 'DRX2   '.$tretment->DRX2;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                  $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                  $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                  $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		    $MLCheck = preg_match("/ML/", $ar2[0]);

                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                       $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                       $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                    if(stripos($tretment->DRX3, $tab->name) !== false){
                                        echo 'DRX3   '.$tretment->DRX3;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->DRX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        //print_r("<br>");
                                        $c3 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                //print_r($ar1[$ar1_count - 1]);
                                                //print_r("<br>");
                                                if($tab->status == 1){
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                    $c2 = $c2 + $ar1[$ar1_count - 1];
                                                    $c3 = $c3 + $ar1[$ar1_count - 1];
                                                  $c4 = $c4 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);
                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    
                                                    $c2 = $c2 + $tempChurnaVal;
                                                    $c3 = $c3 + $tempChurnaVal;
                                                  $c4 = $c4 + $tempChurnaVal;
                                                }else{
                                                  $c2 = $c2 + $ar2[0];
                                                    $c3 = $c3 + $ar2[0];
                                                  $c4 = $c4 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days1 = $ex[0];
                                                        //print_r($tab_days1);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		    $MLCheck = preg_match("/ML/", $ar2[0]);

                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                    {
                                                        $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                        $tempChurnaVal = $mlVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                       $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $arry[$i];
                                                        $c3 = $c3 + $arry[$i];
                                                       $c4 = $c4 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        
                                        $tabletCount = $tabletCount + 1;
                                    }
                                }
    
                                $total_count = 0;
                                $total_quantity = $c3;
                                $total_quantity_drx = $c3;
                              
                                if(stripos($tretment->DRX1, $tab->name) !== false 
                                || stripos($tretment->DRX2, $tab->name) !== false || stripos($tretment->DRX3, $tab->name) !== false)  
                                    {
                                        $patient_array = array(
                                        'patient_auto_id'=>$patient->id,
                                        'yearly_reg_no'=>$patient->yearly_reg_no,
                                        'old_reg_no'=>$patient->old_reg_no,
                                        'age'=>$patient->date_of_birth,
                                        'sex'=>$patient->sex,
                                        'address'=>$patient->address,
                                        'name'=>$patient->firstname,
                                        'dignosis'=>$patient->dignosis,
                                        'RX1'=>$tab->name,
                                        'RX1_despense'=>NULL,
                                        'DRX'=>$tab->name,
                                        'DRX_despense'=>$total_count = $total_quantity_drx * $tab_days1,
                                        'tab_name'=>$tab->name,
                                        'tab_count'=>$total_quantity,
                                        'tab_days'=>$tab_days1,
                                        'create_date'=>$patient->create_date,
                                        'push_date'=>$push_date,
                                        'discharge_date'=>$patient->discharge_date,
                                        ); 
                                        $a = $this->db->insert('kadha_daily_ipd_patient', $patient_array);
                                    }
    
                                        
                            }
                            
                          	$tabletCountArray[$index] = ['tab_count' => $tabletCount, 'tab_name'=>$tab->name, 'tab_round'=>$temp1,'tab_round2'=>$c3, 'tab_round1'=>$c4, 'tab_days1'=>$tab_days1];
                            $index = $index + 1; 
                            $tabletCount = $temp1 = $c4 = 0;
                        }
                    }
                    else
                    {
                        foreach($tablets as $tab){
                            $tabletCountArray[$index] = ['tab_count' => 0, 'tab_name'=>$tab->name, 'tab_round'=>0,'tab_round2'=>0, 'tab_round1'=>0, 'tab_days1'=>0];
                            $index = $index + 1; 
                        }
                    }
                    $round = 0;
              		$tabletCountArray['tab_round2'] = 0;
                    for($i=0; $i<=count($tabletCountArray);$i++)
                    {
                        echo '<br>';
                        // $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%', 'status'=>'2'])->get('pharma1_kadha_oil')->row();
                        $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%'])->get('pharma1_kadha_oil')->row();
                        print_r($tabletCountArray[$i]['tab_name']);echo '<br>';
                        print_r($res->closing_bal);echo '<br>';
                        //print_r(intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                  //    echo '<br><br><br><br><br><br>';
                     echo '========>tab_round_for_onbed =>'.$tabletCountArray[$i]['tab_round'];echo '<br><br>';
                      echo '========>tab_round_for_discharge =>'.$tabletCountArray[$i]['tab_round1'];echo '<br><br>';
                      echo '========>tab_days_for_discharge =>'.$tabletCountArray[$i]['tab_days1'];
                  //    echo '<br><br><br><br><br><br>';
                      
                      
                        print_r($tabletCountArray[$i]['tab_round'] + ($tabletCountArray[$i]['tab_round1'] * $tabletCountArray[$i]['tab_days1']));echo '<br>';
                        
                        $tab_name = $tabletCountArray[$i]['tab_name'];

                       
                        $daily_despensing_bal = 0;

                        $patient_despense =  $this->db->select('DISTINCT(tab_name) as Tab_name,sum(RX1_despense) as despense,sum(DRX_despense) as drxdespense')
                        ->from('kadha_daily_ipd_patient')
                        ->where('tab_name',$tab_name)
                        ->where('push_date',$startDate2)
                        ->get()
                        ->result();
                      print_r($this->db->last_query());
                        //$daily_despensing_bal = 0;
                        foreach($patient_despense as $test)
                        {
                        if(stripos($tab_name, $test->Tab_name) !== false)
                        {
                          echo 'RX Despense======>'.$rx = $test->despense;
                           echo 'DRX Despense======>'.$drx = $test->drxdespense;
                          $daily_despensing_bal =  $test->despense + $drx = $test->drxdespense;
                        }
                        
                        }
                        ///   echo'<br><br><br><br><br><br>';
                            echo 'Daily_despense_balance=======>'.$daily_despensing_bal = $daily_despensing_bal;
                         //  echo'<br><br><br><br><br><br>';
                      //
                      
                      //   $daily_despensing_bal = $tabletCountArray[$i]['tab_round'] + ($tabletCountArray[$i]['tab_round1'] * $tabletCountArray[$i]['tab_days1']);
                      
                      
                      	$daily_opening_bal = $res->closing_bal;
                        $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                      
                        /////comment for test /////////
                        if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                        //if($daily_opening_bal < $daily_despensing_bal || $daily_closing_bal < 0)
                        {
                            $current_stock = $daily_opening_bal;
                            $added_stock = $res->opening_bal;
                            ///////$opening_bal_temp = intval($daily_opening_bal) + intval($res->opening_bal);
                            $opening_bal_temp = $daily_opening_bal + $res->opening_bal;
                            $total_stock = $opening_bal_temp;
                            ///////$daily_closing_bal = intval($opening_bal_temp)-intval($daily_despensing_bal);
                            $daily_closing_bal = $opening_bal_temp-$daily_despensing_bal;
                          
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_added_bal' => $added_stock,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            (Object)$postData2 = ([
                                'name' => $tab_name,
                                'current_stock' => $current_stock,
                                'added_stock' => $added_stock,
                                'total_stock' => $total_stock,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'status' => $res->status
                            ]);
                            if($this->db->insert('daily_ipd_stock_kadha', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1_kadha_oil', $postData1)){
                                    //print_r('Stock Updated Successfully');
                                    if($this->db->insert('stock_register', $postData2)){
                                        print_r('IPD Stock Updated Successfully');
                                    }
                                }
                            }
                        }
                        else
                        {
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            if($this->db->insert('daily_ipd_stock_kadha', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1_kadha_oil', $postData1))
                                {
                                    print_r('IPD Stock Updated Successfully');
                                }
                            }
                        }
                    }
            }
            elseif($current_date > $push_date)
            {
                $startDate2 = date('Y-m-d', strtotime($push_date));
                    print_r('IPD Stock Data Push Date');print_r('==>==>');print_r($startDate2);print_r('<br>');
                    
                    $tabletCountArray = array();
                    $tabletCount = 0;
                    $index = 0;
                    $tabletRoundArray = array();
                    $c1 = 0;
                    $tabDays = 0;
                    $temp1 = 0;
                    $temp2 = 0;
                        
                    if($res != '' || $res != null)
                    {
                        //print_r($patientList);
                        // $tablets = $this->db->where('status','2')->get('pharma1_kadha_oil')->result();
                        $tablets = $this->db->get('pharma1_kadha_oil')->result();
                        foreach($tablets as $tab){
                            // $this->db->where('create_date like', '%'.$startDate2.'%');
                            // $this->db->where('ipd_opd', 'ipd');
                            // $patientList =  $this->db->get('patient_ipd')->result();
                            
                            $start_date = date('Y-m-d',strtotime($push_date));
                            $end_date  = date('Y-m-d',strtotime($push_date));
                            $start_date_f= $start_date." 23:59:00";
                            $end_date_f= $end_date."23:59:00";
                            
                        //    $patients1 = $this->db->select("*")
                        //        ->from('patient_ipd')
                        //        ->join('department','department.dprt_id = patient_ipd.department_id')
                        //        ->where('discharge_date >=', $start_date_f)
                        //      	//->or_where('discharge_date <=', $start_date_f)
                        //      	->or_where('discharge_date like', $start_date)
                        //        ->where('create_date <=', $end_date_f)
                        //        ->where('ipd_opd', 'ipd')
                        //        ->get()
                        //        ->result();
                                    
                            //print_r('q1   ');
                            //print_r($this->db->last_query());
                                    
                         //   $patients2 = $this->db->select("*")
                         //       ->from('patient_ipd')
                         //       ->join('department','department.dprt_id = patient_ipd.department_id')
                         //       ->where('create_date <=', $end_date_f)
                         //       ->where('discharge_date LIKE', '%0000-00-00%')
                         //       ->where('ipd_opd', 'ipd')
                         //       ->get()
                         //       ->result();
                            
                          
                          
                          
                          
                          
                            $patients1 = $this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where('discharge_date >=', $end_date)
                            ->where('create_date <=', $end_date)
                            ->where('ipd_opd', 'ipd')
                            ->or_where('discharge_date like', '%'.$start_date_f.'%')
                            ->get()
                            ->result();  
                                            
                            $patients2=$this->db->select("*")
                            ->from('patient_ipd')
                            ->join('department','department.dprt_id = patient_ipd.department_id')
                            ->where ('ipd_opd', $section)
                            ->where('discharge_date LIKE', '%0000-00-00%')
                            ->where('create_date <=', 'ipd')
                            ->get()

                            ->result();
                                                //print_r('q2   ');                    
                            //print_r($this->db->last_query());
                            
                            $patientList = array_merge($patients1, $patients2);
                            
                            //print_r($patientList);echo '<br>';
                            foreach($patientList as $patient){
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = $new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = $che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                                // $tretment1=$this->db->select("*")
                                //     ->from('treatments1')
                                //     ->where('dignosis LIKE',$p_dignosis)
                                //     ->where('proxy_id',$patient->proxy_id)
                                //     ->where('department_id',$patient->department_id)
                                //     ->where('ipd_opd',$section_tret)
                                //     ->get()
                                //     ->row();
                                
                                
                                // $DISTRIBUTION_IPD=$tretment1->DISTRIBUTION_IPD; 
                                // $ipd_days=$tretment1->ipd_days; 
                                // $last_days=$ipd_days - $DISTRIBUTION_IPD;
                                // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1;
                                
                                //print_r('=>>>>');print_r($DISTRIBUTION_IPD);print_r('<br>');
                                
                                    
                                 if($patient->manual_status==0){
                                      if($patient->proxy_id){
			                          
			                         
                                     $tretment=$this->db->select("*")

			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else{
                                          
                                       $tretment=$this->db->select("*")

			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                     
                            //           if(empty($tretment)){
                            //           $tretment=$this->db->select("*")
                            //           ->from('treatments1')
                            //           ->where('department_id',$patient->department_id)
			                         // ->where('ipd_opd',$patient->department_id)
                            //          ->get()
                            //          ->row();   
                                         
                            //           }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                   }
                                    
                                echo '<br><br><br>';
                              echo   $datefrom_n=date('Y-m-d',strtotime($startDate2));  
			                      echo'<br>';
			                 echo    $admit_date=date('Y-m-d',strtotime($patient->create_date));
                               echo'<br>';
                                 if($patient->discharge_date=='0000-00-00'){
                                     //$discharge_date=date('Y-m-d', strtotime($admit_date. ' + 5 days'));
                                     
                                     $today_date=date('Y-m-d', strtotime($datefrom_n));
                                 } else{
                                 //$discharge_date=date('Y-m-d',strtotime($patient->discharge_date));
                                  $today_date=date('Y-m-d', strtotime($datefrom_n));
                                 }  
                                 
                                $date1=date_create($admit_date);
                                $date2=date_create($today_date);
                                $diff=date_diff($date1,$date2);
                            
                                echo 'Days difference in Create_date and Discharge Date====>'.$n= $diff->format("%a");
                                echo '<br>';
                                echo 'PAtient_name======>'.$patient->firstname;
                                echo '<br>';
                                
                                echo  'Distribution days====>'.$DISTRIBUTION_IPD=$tretment->DISTRIBUTION_IPD; 
                              	echo '<br>';
                                echo 'IPD DAYS====>   '.$ipd_days=$tretment->ipd_days; 
                              	$DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1; 
                                $last_days=$ipd_days - $DISTRIBUTION_IPD;
                             
                              	echo '<br><br><br>';
                              
                              
                              if($DISTRIBUTION_IPD < $n)
                              {
			                         if($patient->manual_status==0)
                                     {
                                      if($patient->proxy_id)
                                      {
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->order_by('id','desc')
                                         ->get()
                                         ->row();
                                         //print_r($this->db->last_query());
                                      }
                                      else
                                      {
                                         $tretment=$this->db->select("*")
                                       ->from('treatments1')
                                       ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                       ->where('ipd_opd ',$section_tret)
                                        ->order_by('id','desc')
                                       ->get()
                                       ->row();  
                                     
                                      }
                                  }else
                                     {
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                   }
			                         
			                      $RX1= $tretment->RX1;
			                      $RX2= $tretment->RX2;
			                      $RX3= $tretment->RX3;
			                      $RX4= $tretment->RX4;
			                      $RX5= $tretment->RX5;
			                      
			                      $RX_other= $tretment->RX_other;
			                      $RX_other1= $tretment->RX_other1;
			                      $other_equipment= $tretment->other_equipment;
			                         
			                         
			                     }
                              
                                if($tretment)
                                {
                                    if(stripos($tretment->RX1, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX1   '.$tretment->RX1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX1;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        ////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX2, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX2   '.$tretment->RX2;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX2;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        /////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX3, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX3   '.$tretment->RX3;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX3;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        //////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX4, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX4   '.$tretment->RX4;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX4;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        
                                        //////////////$temp1 = (int)$temp1 + (int)$c1;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                    if(stripos($tretment->RX5, $tab->name) !== false){
                                        ////print_r($tretment->DISTRIBUTION_IPD);print_r('<br>');
                                        echo 'RX5   '.$tretment->RX5;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                        $str = $tretment->RX5;
                                        $arry=explode(" ",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        // print_r($arry);
                                        $arry=explode("-",$str);
                                        $count = count($arry);
                                        //print_r($arry[$count-1]);
                                        //print_r($arry);
                                        $temp2 = 0;
                                        for($i=0;$i<$count;$i++)
                                        {
                                            if($i==0){
                                                $ar1 = explode(' ',$arry[$i]);
                                                $ar1_count = count($ar1);
                                                // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                    $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                    $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                            		$MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                    $c1 = $c1 + $tempChurnaVal;
                                                }else{
                                                    $c1 = $c1 + $ar1[$ar1_count - 1];
                                                }
                                            }
                                            elseif($i==($count-1)){
                                                $ar2 = explode(' ',$arry[$count-1]);
                                                $ar2_count = count($ar2);
                                                // array_push($tabletRoundArray, $ar2[0]);
                                                if($tab->status == 1){
                                                    
                                                    $mgCheck = preg_match("/mg/", $ar2[0]);
                                                    $gCheck = preg_match("/g/", $ar2[0]);
                                                    $mlCheck = preg_match("/ml/", $ar2[0]);
                                            		$MLCheck = preg_match("/ML/", $ar2[0]);

                                                    $tempChurnaVal = 0;
                                                    if($mgCheck == 1){
                                                        $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                        //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($gCheck == 1){
                                                        $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                        $tempChurnaVal = $gVal[0];
                                                        //print_r($tempChurnaVal);print_r('<br>');
                                                    }
                                                    elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                
                                                    $c1 = $c1 + $tempChurnaVal;
                                                    
                                                    //$c1 = intval($c1) + 1;
                                                }else{
                                                    $c1 = $c1 + $ar2[0];
                                                }
                                                
                                                //print_r($ar2);
                                                
                                                for($j=$ar2_count;$j>0;$j--){
                                                    if($ar2[$j]!=''){
                                                        $ex = explode('D',$ar2[$j]);
                                                        $tab_days = $ex[0];
                                                        //print_r($tab_days);
                                                        break;
                                                    }
                                                }
                                            }
                                            else{
                                                if($arry[$i] != ''){
                                                    // array_push($tabletRoundArray, $arry[$i]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $arry[$i]);
                                                        $gCheck = preg_match("/g/", $arry[$i]);
                                                        $mlCheck = preg_match("/ml/", $arry[$i]);
                                            		    $MLCheck = preg_match("/ML/", $arry[$i]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            //print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $gVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }

                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/",$arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c1 = $c1 + $tempChurnaVal;
                                                        
                                                        //$c1 = intval($c1) + 1;
                                                    }else{
                                                        $c1 = $c1 + $arry[$i];
                                                    }
                                                }
                                            }
                                        }
                                        //$temp1 = (int)$temp1 + (int)$c1 * (int)$tretment->DISTRIBUTION_IPD;
                                        $temp1 = $temp1 + $c1;
                                        $temp2 = $temp2 + $c1;
                                        ////print_r($temp1);print_r('====rrrrrrrr======');print_r('<br>');
                                        $tabletCount = $tabletCount + 1;
                                        $c1 = 0;
                                    }
                                }  
                                
                                $total_count = 0;
                            $total_quantity = $temp2;
                           $total_quantity_rx = $temp2;
                            if(stripos($tretment->RX1, $tab->name) !== false || stripos($tretment->RX2, $tab->name) !== false 
                                || stripos($tretment->RX3, $tab->name) !== false || stripos($tretment->RX4, $tab->name) !== false 
                                || stripos($tretment->RX5, $tab->name) !== false )  
                                {
                                    $patient_array = array(
                                    'patient_auto_id'=>$patient->id,
                                    'yearly_reg_no'=>$patient->yearly_reg_no,
                                    'old_reg_no'=>$patient->old_reg_no,
                                    'age'=>$patient->date_of_birth,
                                    'sex'=>$patient->sex,
                                    'address'=>$patient->address,
                                    'name'=>$patient->firstname,
                                    'dignosis'=>$patient->dignosis,
                                    'RX1'=>$tab->name,
                                    'RX1_despense'=>$total_count = $total_quantity_rx,
                                    'tab_name'=>$tab->name,
                                    'tab_count'=>$total_quantity_rx,
                                    'tab_days'=>$tab_days1,
                                    'create_date'=>$patient->create_date,
                                     'push_date'=>$push_date,
                                    'discharge_date'=>$patient->discharge_date,
                                    ); 
                                    $a = $this->db->insert('kadha_daily_ipd_patient', $patient_array);
                                
                                }
                                        
                            }
                            
                            
                            $patientList1 = $this->db->select("*")
                                ->from('patient_ipd')
                                ->join('department','department.dprt_id = patient_ipd.department_id')
                                ->where('ipd_opd', 'ipd')
                                ->where('discharge_date >=', $start_date)
                                ->where('discharge_date <=', $end_date)
                                //->where('create_date LIKE', $year)
                                ->get()
                                ->result();
                            
                            foreach($patientList1 as $patient){
                                $che=trim($patient->dignosis);
                                //print_r($che);
                                
                                $section_tret='ipd';
                                $len=strlen($che);
                                $dd= substr($che,$len - 1);
                                
                                $str = $patient->dignosis;
                                $arry=explode("-",$str);
                                $t_c=count($arry);
                                if($t_c=='2'){
                                    $dd1=substr($che, 0, -1);
                                    $new_str = trim($arry[0]);
                                    $p_dignosis = $new_str.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }else{
                                    $p_dignosis = $che.'%';
                                    $p_dignosis_name=$patient->dignosis;
                                }
                                
                                // $tretment1=$this->db->select("*")
                                //     ->from('treatments1')
                                //     ->where('dignosis LIKE',$p_dignosis)
                                //     ->where('proxy_id',$patient->proxy_id)
                                //     ->where('department_id',$patient->department_id)
                                //     ->where('ipd_opd',$section_tret)
                                //     ->get()
                                //     ->row();
                                
                                
                                // $DISTRIBUTION_IPD=$tretment1->DISTRIBUTION_IPD; 
                                // $ipd_days=$tretment1->ipd_days; 
                                // $last_days=$ipd_days - $DISTRIBUTION_IPD;
                                // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1;
                                
                                //print_r('=>>>>');print_r($DISTRIBUTION_IPD);print_r('<br>');
                                
                                // if($patient->manual_status==0){
                                //     if($patient->proxy_id){
                                //         $tretment=$this->db->select("*")
                                //             ->from('treatments1')
                                //             ->where('dignosis LIKE',$p_dignosis)
                                //             ->where('proxy_id',$patient->proxy_id)
                                //             ->where('department_id',$patient->department_id)
                                //             ->where('ipd_opd ',$section_tret)
                                //             ->get()
                                //             ->row();
                                //     }
                                // }else{
                                //     $tretment=$this->db->select("*")
                                //         ->from('manual_treatments')
                                //         ->where('patient_id_auto',$patient->id)
                                //         ->where('dignosis LIKE',$p_dignosis)
                                //         ->where('ipd_opd ',$section_tret)
                                //         ->get()
                                //         ->row();
                                // }
                                
                                
                                 if($patient->manual_status==0){
                                        $section_tret='ipd';
                                        // $tretarray=$this->db->select("*")
                                        //     ->from('treatments1')
                                        //     ->where('dignosis LIKE',$p_dignosis)
                                        //     ->where('proxy_id',$patient->proxy_id)
                                        //     ->where('department_id',$patient->department_id)
                                        //     ->where('ipd_opd',$section_tret)
                                        //     ->get()->result();
                                        
                                        if($patient->proxy_id){
                                            $tretment=$this->db->select("*")
                                                ->from('treatments1')
                                                ->where('dignosis LIKE',$p_dignosis)
                                                ->where('proxy_id',$patient->proxy_id)
                                                ->where('department_id',$patient->department_id)
                                                //->order_by("id", "desc")
                                                ->where('ipd_opd ',$section_tret)
                                                ->get()
                                                ->row();
                                        }
                                        else{
                                            $tretment=$this->db->select("*")
                                                ->from('treatments1')
                                                ->where('dignosis LIKE',$p_dignosis)
                                                ->where('department_id',$patient->department_id)
                                               // ->order_by("id", "desc")
                                                ->where('ipd_opd ',$section_tret)
                                                ->get()
                                                ->row();  
                                        
                                        //     if(empty($tretment)){
                                        //         $tretment=$this->db->select("*")
                                        //             ->from('treatments1')
                                        //             ->where('department_id',$patient->department_id)
                                        //             ->where('ipd_opd',$patient->department_id)
                                        //             ->get()
                                        //             ->row();   
                                            }
                                        // }
                                    }else{
                                        $tretment=$this->db->select("*")
                                            ->from('manual_treatments')
                                            ->where('patient_id_auto',$patient->id)
                                            ->where('dignosis LIKE',$p_dignosis)
                                            ->where('ipd_opd ',$section_tret)
                                            ->get()
                                            ->row();
                                    }
                              
                             
			                      
			                     
                                
                                
                                    if($tretment){
                                        if(stripos($tretment->DRX1, $tab->name) !== false){
                                            echo 'DRX1   '.$tretment->DRX1;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            $str = $tretment->DRX1;
                                            $arry=explode(" ",$str);
                                            $count = count($arry);
                                            //print_r($arry[$count-1]);
                                            // print_r($arry);
                                            $arry=explode("-",$str);
                                            $count = count($arry);
                                            //print_r($arry[$count-1]);
                                            //print_r($arry);
                                            //print_r("<br>");
                                            $c3 = 0;
                                            for($i=0;$i<$count;$i++)
                                            {
                                                if($i==0){
                                                    $ar1 = explode(' ',$arry[$i]);
                                                    
                                                    $ar1_count = count($ar1);
                                                    // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                    //print_r($ar1[$ar1_count - 1]);
                                                    //print_r("<br>");
                                                    if($tab->status == 1){
                                                        $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                        $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                        $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                                        $MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $ar1[$ar1_count - 1];
                                                        $c3 = $c3 + $ar1[$ar1_count - 1];
                                                      $c4 = $c4 + $ar1[$ar1_count - 1];
                                                    }
                                                }
                                                elseif($i==($count-1)){
                                                    $ar2 = explode(' ',$arry[$count-1]);
                                                    $ar2_count = count($ar2);
                                                    // array_push($tabletRoundArray, $ar2[0]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $ar2[0]);
                                                        $gCheck = preg_match("/g/", $ar2[0]);
                                                        $mlCheck = preg_match("/ml/", $ar2[0]);
                                                        $MLCheck = preg_match("/ML/", $ar2[0]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                      $c2 = $c2 + $ar2[0];
                                                        $c3 = $c3 + $ar2[0];
                                                      $c4 = $c4 + $ar2[0];
                                                    }
                                                    
                                                    //print_r($ar2);
                                                    
                                                    for($j=$ar2_count;$j>0;$j--){
                                                        if($ar2[$j]!=''){
                                                            $ex = explode('D',$ar2[$j]);
                                                            $tab_days1 = $ex[0];
                                                            //print_r($tab_days1);
                                                            break;
                                                        }
                                                    }
                                                }
                                                else{
                                                    if($arry[$i] != ''){
                                                        // array_push($tabletRoundArray, $arry[$i]);
                                                        if($tab->status == 1){
                                                            
                                                            $mgCheck = preg_match("/mg/", $arry[$i]);
                                                            $gCheck = preg_match("/g/", $arry[$i]);
                                                            $mlCheck = preg_match("/ml/", $ar2[0]);
                                                            $MLCheck = preg_match("/ML/", $ar2[0]);
    
                                                            $tempChurnaVal = 0;
                                                            if($mgCheck == 1){
                                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                            }
                                                            elseif($gCheck == 1){
                                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                                $tempChurnaVal = $gVal[0];
                                                                print_r($tempChurnaVal);print_r('<br>');
                                                            }
                                                            elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                            
                                                            $c2 = $c2 + $tempChurnaVal;
                                                            $c3 = $c3 + $tempChurnaVal;
                                                           $c4 = $c4 + $tempChurnaVal;
                                                        }else{
                                                            $c2 = $c2 + $arry[$i];
                                                            $c3 = $c3 + $arry[$i];
                                                           $c4 = $c4 + $arry[$i];
                                                        }
                                                    }
                                                }
                                            }
                                            
                                            $tabletCount = $tabletCount + 1;
                                        }
                                        if(stripos($tretment->DRX2, $tab->name) !== false){
                                            echo 'DRX2   '.$tretment->DRX2;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            $str = $tretment->DRX2;
                                            $arry=explode(" ",$str);
                                            $count = count($arry);
                                            //print_r($arry[$count-1]);
                                            // print_r($arry);
                                            $arry=explode("-",$str);
                                            $count = count($arry);
                                            //print_r($arry[$count-1]);
                                            //print_r($arry);
                                            //print_r("<br>");
                                            $c3 = 0;
                                            for($i=0;$i<$count;$i++)
                                            {
                                                if($i==0){
                                                    $ar1 = explode(' ',$arry[$i]);
                                                    
                                                    $ar1_count = count($ar1);
                                                    // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                    //print_r($ar1[$ar1_count - 1]);
                                                    //print_r("<br>");
                                                    if($tab->status == 1){
                                                        $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                        $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                        $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                                        $MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $ar1[$ar1_count - 1];
                                                        $c3 = $c3 + $ar1[$ar1_count - 1];
                                                      $c4 = $c4 + $ar1[$ar1_count - 1];
                                                    }
                                                }
                                                elseif($i==($count-1)){
                                                    $ar2 = explode(' ',$arry[$count-1]);
                                                    $ar2_count = count($ar2);
                                                    // array_push($tabletRoundArray, $ar2[0]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $ar2[0]);
                                                        $gCheck = preg_match("/g/", $ar2[0]);
                                                        $mlCheck = preg_match("/ml/", $ar2[0]);
                                                        $MLCheck = preg_match("/ML/", $ar2[0]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                      $c2 = $c2 + $ar2[0];
                                                        $c3 = $c3 + $ar2[0];
                                                      $c4 = $c4 + $ar2[0];
                                                    }
                                                    
                                                    //print_r($ar2);
                                                    
                                                    for($j=$ar2_count;$j>0;$j--){
                                                        if($ar2[$j]!=''){
                                                            $ex = explode('D',$ar2[$j]);
                                                            $tab_days1 = $ex[0];
                                                            //print_r($tab_days1);
                                                            break;
                                                        }
                                                    }
                                                }
                                                else{
                                                    if($arry[$i] != ''){
                                                        // array_push($tabletRoundArray, $arry[$i]);
                                                        if($tab->status == 1){
                                                            
                                                            $mgCheck = preg_match("/mg/", $arry[$i]);
                                                            $gCheck = preg_match("/g/", $arry[$i]);
                                                            $mlCheck = preg_match("/ml/", $ar2[0]);
                                                            $MLCheck = preg_match("/ML/", $ar2[0]);
    
                                                            $tempChurnaVal = 0;
                                                            if($mgCheck == 1){
                                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                            }
                                                            elseif($gCheck == 1){
                                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                                $tempChurnaVal = $gVal[0];
                                                                print_r($tempChurnaVal);print_r('<br>');
                                                            }
                                                            elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                            
                                                            $c2 = $c2 + $tempChurnaVal;
                                                            $c3 = $c3 + $tempChurnaVal;
                                                           $c4 = $c4 + $tempChurnaVal;
                                                        }else{
                                                            $c2 = $c2 + $arry[$i];
                                                            $c3 = $c3 + $arry[$i];
                                                           $c4 = $c4 + $arry[$i];
                                                        }
                                                    }
                                                }
                                            }
                                            
                                            $tabletCount = $tabletCount + 1;
                                        }
                                        if(stripos($tretment->DRX3, $tab->name) !== false){
                                            echo 'DRX3   '.$tretment->DRX3;print_r("=====>");print_r($patient->firstname);print_r('<br>');
                                            $str = $tretment->DRX3;
                                            $arry=explode(" ",$str);
                                            $count = count($arry);
                                            //print_r($arry[$count-1]);
                                            // print_r($arry);
                                            $arry=explode("-",$str);
                                            $count = count($arry);
                                            //print_r($arry[$count-1]);
                                            //print_r($arry);
                                            //print_r("<br>");
                                            $c3 = 0;
                                            for($i=0;$i<$count;$i++)
                                            {
                                                if($i==0){
                                                    $ar1 = explode(' ',$arry[$i]);
                                                    
                                                    $ar1_count = count($ar1);
                                                    // array_push($tabletRoundArray, $ar1[$ar1_count - 1]);
                                                    //print_r($ar1[$ar1_count - 1]);
                                                    //print_r("<br>");
                                                    if($tab->status == 1){
                                                        $mgCheck = preg_match("/mg/", $ar1[$ar1_count - 1]);
                                                        $gCheck = preg_match("/g/", $ar1[$ar1_count - 1]);
                                                        $mlCheck = preg_match("/ml/", $ar1[$ar1_count - 1]);
                                                        $MLCheck = preg_match("/ML/", $ar1[$ar1_count - 1]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar1[$ar1_count - 1]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                        $c2 = $c2 + $ar1[$ar1_count - 1];
                                                        $c3 = $c3 + $ar1[$ar1_count - 1];
                                                      $c4 = $c4 + $ar1[$ar1_count - 1];
                                                    }
                                                }
                                                elseif($i==($count-1)){
                                                    $ar2 = explode(' ',$arry[$count-1]);
                                                    $ar2_count = count($ar2);
                                                    // array_push($tabletRoundArray, $ar2[0]);
                                                    if($tab->status == 1){
                                                        
                                                        $mgCheck = preg_match("/mg/", $ar2[0]);
                                                        $gCheck = preg_match("/g/", $ar2[0]);
                                                        $mlCheck = preg_match("/ml/", $ar2[0]);
                                                        $MLCheck = preg_match("/ML/", $ar2[0]);
                                                        $tempChurnaVal = 0;
                                                        if($mgCheck == 1){
                                                            $mgVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                            print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($gCheck == 1){
                                                            $gVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = $gVal[0];
                                                            print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $ar2[0]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                        
                                                        $c2 = $c2 + $tempChurnaVal;
                                                        $c3 = $c3 + $tempChurnaVal;
                                                      $c4 = $c4 + $tempChurnaVal;
                                                    }else{
                                                      $c2 = $c2 + $ar2[0];
                                                        $c3 = $c3 + $ar2[0];
                                                      $c4 = $c4 + $ar2[0];
                                                    }
                                                    
                                                    //print_r($ar2);
                                                    
                                                    for($j=$ar2_count;$j>0;$j--){
                                                        if($ar2[$j]!=''){
                                                            $ex = explode('D',$ar2[$j]);
                                                            $tab_days1 = $ex[0];
                                                            //print_r($tab_days1);
                                                            break;
                                                        }
                                                    }
                                                }
                                                else{
                                                    if($arry[$i] != ''){
                                                        // array_push($tabletRoundArray, $arry[$i]);
                                                        if($tab->status == 1){
                                                            
                                                            $mgCheck = preg_match("/mg/", $arry[$i]);
                                                            $gCheck = preg_match("/g/", $arry[$i]);
                                                            $mlCheck = preg_match("/ml/", $ar2[0]);
                                                            $MLCheck = preg_match("/ML/", $ar2[0]);
    
                                                            $tempChurnaVal = 0;
                                                            if($mgCheck == 1){
                                                                $mgVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                                $tempChurnaVal = (int)$mgVal[0] / 1000;
                                                                print_r($mgVal[0]);print_r('=======');print_r($tempChurnaVal);print_r('<br>');
                                                            }
                                                            elseif($gCheck == 1){
                                                                $gVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                                $tempChurnaVal = $gVal[0];
                                                                print_r($tempChurnaVal);print_r('<br>');
                                                            }
                                                            elseif($mlCheck == 1 || $MLCheck == 1)
                                                        {
                                                            $mlVal = preg_split("/[(A-Z)(a-z)]/", $arry[$i]);
                                                            $tempChurnaVal = $mlVal[0];
                                                            //print_r($tempChurnaVal);print_r('<br>');
                                                        }
                                                            
                                                            $c2 = $c2 + $tempChurnaVal;
                                                            $c3 = $c3 + $tempChurnaVal;
                                                           $c4 = $c4 + $tempChurnaVal;
                                                        }else{
                                                            $c2 = $c2 + $arry[$i];
                                                            $c3 = $c3 + $arry[$i];
                                                           $c4 = $c4 + $arry[$i];
                                                        }
                                                    }
                                                }
                                            }
                                            
                                            $tabletCount = $tabletCount + 1;
                                        }
                                    }
    
                                $total_count = 0;
                                $total_quantity = $c3;
                                $total_quantity_drx = $c3;
                              
                                if(stripos($tretment->DRX1, $tab->name) !== false 
                                || stripos($tretment->DRX2, $tab->name) !== false || stripos($tretment->DRX3, $tab->name) !== false)  
                                    {
                                        $patient_array = array(
                                        'patient_auto_id'=>$patient->id,
                                        'yearly_reg_no'=>$patient->yearly_reg_no,
                                        'old_reg_no'=>$patient->old_reg_no,
                                        'age'=>$patient->date_of_birth,
                                        'sex'=>$patient->sex,
                                        'address'=>$patient->address,
                                        'name'=>$patient->firstname,
                                        'dignosis'=>$patient->dignosis,
                                        'RX1'=>$tab->name,
                                        'RX1_despense'=>NULL,
                                        'DRX'=>$tab->name,
                                        'DRX_despense'=>$total_count = $total_quantity_drx * $tab_days1,
                                        'tab_name'=>$tab->name,
                                        'tab_count'=>$total_quantity,
                                        'tab_days'=>$tab_days1,
                                        'create_date'=>$patient->create_date,
                                        'push_date'=>$push_date,
                                        'discharge_date'=>$patient->discharge_date,
                                        ); 
                                        $a = $this->db->insert('kadha_daily_ipd_patient', $patient_array);
                                    }
    
                                        
                            }
                            
                          	$tabletCountArray[$index] = ['tab_count' => $tabletCount, 'tab_name'=>$tab->name, 'tab_round'=>$temp1,'tab_round2'=>$c3, 'tab_round1'=>$c4, 'tab_days1'=>$tab_days1];
                            $index = $index + 1; 
                            $tabletCount = $temp1 = $c4 = 0;
                        }
                    }
                    else
                    {
                        foreach($tablets as $tab){
                            $tabletCountArray[$index] = ['tab_count' => 0, 'tab_name'=>$tab->name, 'tab_round'=>0,'tab_round2'=>0, 'tab_round1'=>0, 'tab_days1'=>0];
                            $index = $index + 1; 
                        }
                    }
                    $round = 0;
              		$tabletCountArray['tab_round2'] = 0;
                    for($i=0; $i<=count($tabletCountArray);$i++)
                    {
                        echo '<br>';
                        // $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%', 'status'=>'2'])->get('pharma1_kadha_oil')->row();
                        $res = $this->db->where(['name like '=>'%'.$tabletCountArray[$i]['tab_name'].'%'])->get('pharma1_kadha_oil')->row();
                        print_r($tabletCountArray[$i]['tab_name']);echo '<br>';
                        print_r($res->closing_bal);echo '<br>';
                        //print_r(intval($tabletCountArray[$i]['tab_round'])*intval($tabletCountArray[$i]['tab_days']));echo '<br>';
                     // echo '<br><br><br><br><br><br>';
                     echo '========>tab_round_for_onbed =>'.$tabletCountArray[$i]['tab_round'];echo '<br><br>';
                      echo '========>tab_round_for_discharge =>'.$tabletCountArray[$i]['tab_round1'];echo '<br><br>';
                      echo '========>tab_days_for_discharge =>'.$tabletCountArray[$i]['tab_days1'];
                    //  echo '<br><br><br><br><br><br>';
                      
                      
                        print_r($tabletCountArray[$i]['tab_round'] + ($tabletCountArray[$i]['tab_round1'] * $tabletCountArray[$i]['tab_days1']));echo '<br>';
                        
                        $tab_name = $tabletCountArray[$i]['tab_name'];

                       
                        $daily_despensing_bal = 0;

                        $patient_despense =  $this->db->select('DISTINCT(tab_name) as Tab_name,sum(RX1_despense) as despense,sum(DRX_despense) as drxdespense')
                        ->from('kadha_daily_ipd_patient')
                        ->where('tab_name',$tab_name)
                        ->where('push_date',$startDate2)
                        ->get()
                        ->result();
                      print_r($this->db->last_query());
                        //$daily_despensing_bal = 0;
                        foreach($patient_despense as $test)
                        {
                        if(stripos($tab_name, $test->Tab_name) !== false)
                        {
                          echo 'RX Despense======>'.$rx = $test->despense;
                           echo 'DRX Despense======>'.$drx = $test->drxdespense;
                          $daily_despensing_bal =  $test->despense + $drx = $test->drxdespense;
                        }
                        
                        }
                         //  echo'<br><br><br><br><br><br>';
                            echo 'Daily_despense_balance=======>'.$daily_despensing_bal = $daily_despensing_bal;
                         //  echo'<br><br><br><br><br><br>';
                      
                      
                      //   $daily_despensing_bal = $tabletCountArray[$i]['tab_round'] + ($tabletCountArray[$i]['tab_round1'] * $tabletCountArray[$i]['tab_days1']);
                      
                      
                      	$daily_opening_bal = $res->closing_bal;
                        $daily_closing_bal = $daily_opening_bal-$daily_despensing_bal;
                      
                        /////comment for test /////////
                        if($daily_opening_bal < $daily_closing_bal || $daily_closing_bal < 0)
                        //if($daily_opening_bal < $daily_despensing_bal || $daily_closing_bal < 0)
                        {
                            $current_stock = $daily_opening_bal;
                            $added_stock = $res->opening_bal;
                            ///////$opening_bal_temp = intval($daily_opening_bal) + intval($res->opening_bal);
                            $opening_bal_temp = $daily_opening_bal + $res->opening_bal;
                            $total_stock = $opening_bal_temp;
                            ///////$daily_closing_bal = intval($opening_bal_temp)-intval($daily_despensing_bal);
                            $daily_closing_bal = $opening_bal_temp-$daily_despensing_bal;
                          
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_added_bal' => $added_stock,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            (Object)$postData2 = ([
                                'name' => $tab_name,
                                'current_stock' => $current_stock,
                                'added_stock' => $added_stock,
                                'total_stock' => $total_stock,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'status' => $res->status
                            ]);
                            if($this->db->insert('daily_ipd_stock_kadha', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1_kadha_oil', $postData1)){
                                    //print_r('Stock Updated Successfully');
                                    if($this->db->insert('stock_register', $postData2)){
                                        print_r('IPD Stock Updated Successfully');
                                    }
                                }
                            }
                        }
                        else
                        {
                            (Object)$postData = ([
                                'medicine_id'=>$res->id,
                                'name' => $tab_name,
                                'daily_opening_bal' => $daily_opening_bal,
                                'daily_despensing_bal' => $daily_despensing_bal,
                                'daily_closing_bal' => $daily_closing_bal,
                                'create_date' => $startDate2,
                                'ipd_opd' => 'ipd',
                                'type'=>$res->status
                            ]);
                            (Object)$postData1 = ([
                                'closing_bal' => $daily_closing_bal
                            ]);
                            if($this->db->insert('daily_ipd_stock_kadha', $postData))
                            {
                                if($this->db->where('id',$res->id)->update('pharma1_kadha_oil', $postData1))
                                {
                                    print_r('IPD Stock Updated Successfully');
                                }
                            }
                        }
                    }
            }
    }
  
  
  
  
  
   public function patient_report_datewise_kadha()
   {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $section = $this->input->get('section', TRUE);
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['dateto'] = $end_date;
            $data['section'] = $section;
         
           if($section=='opd')
           {
                $data['patient'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id')
               ->from('kadha_daily_opd_patient')
               ->where('create_date >=',$start_date2)
               ->where('create_date <=',$end_date2)
               //->order_by('yearly_reg_no','ASC')
               ->get()
               ->result();
               //print_r($this->db->last_query());
             
             
             //$tab = $this->db->select('*')->from()
             
             
           }
           else
           {
             
   
             $data['patient'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id')
               ->from('kadha_daily_ipd_patient')
              ->where('push_date >=',$start_date2)
               ->where('push_date <=',$end_date2)
               ->get()
               ->result();
             
         //  $data['patients2'] = $this->db->select("DISTINCT(name),yearly_reg_no,patient_auto_id")
           //->from('pharma_daily_ipd_patient')
           //->where('create_date <=', $start_date2)
           //->where('discharge_date LIKE', '%0000-00-00%')
           //->get()
           //->result();
             
             //$data['patient'] = array_merge($data['patients1'],$data['patients2']);
            //   print_r($this->db->last_query());
               
           }
           
              
               $data['content'] = $this->load->view('stock_despense_patient_datewise_kadha',$data,true);
               $this->load->view('layout/main_wrapper',$data);
   }
     
     
             public function daily_dispense_report_kadha()
               
        {
                $year = '%'.$this->session->userdata['acyear'].'%';
                $start_date1 = $this->input->get('start_date', TRUE);
                $end_date1   = $this->input->get('start_date', TRUE);
                $start_date2 = date('Y-m-d',strtotime($start_date1));
                $end_date2   = date('Y-m-d',strtotime($end_date1));
                $start_date= $start_date2;
                $start_date_f= $start_date2." 23:59:00";
                $end_date= $end_date2." 23:59:00";

                $data['datefrom'] = $start_date;
                $data['dateto'] = $end_date;

                $data['opd_stock_churn'] = $this->db->select('name as tab_name,daily_opening_bal as opening_stock,daily_despensing_bal as opd_despense')
                ->from('daily_opd_oil_stock')
                ->where('create_date',$start_date2)
                ->where('ipd_opd','opd')
                ->where('type','1')
                ->get()
                ->result();

                $data['opd_stock_tab'] = $this->db->select('name as tab_name,daily_opening_bal as opening_stock,daily_despensing_bal as opd_despense')
                ->from('daily_opd_oil_stock')
                ->where('create_date',$start_date2)
                ->where('ipd_opd','opd')
                ->where('type','2')
                ->get()
                ->result();
                //print_r($this->db->last_query());

                $data['ipd_stock_churn'] = $this->db->select('name as tab_name,daily_closing_bal as closing_stock,daily_despensing_bal as ipd_despense')
                ->from('daily_ipd_oil_stock')
                ->where('create_date',$start_date2)
                ->where('ipd_opd','ipd')
                ->where('type','1')
                ->get()
                ->result();

                $data['ipd_stock_tab_kadha'] = $this->db->select('name as tab_name,daily_closing_bal as closing_stock,daily_despensing_bal as ipd_despense')
                ->from('daily_ipd_oil_stock')
                ->where('create_date',$start_date2)
                ->where('ipd_opd','ipd')
                ->where('type','2')
                ->get()
                ->result();
                //print_r($this->db->last_query());

                $data['daily_despense'] = array_merge($data['opd_stock_churn'],$data['ipd_stock_churn']);
                $data['content'] = $this->load->view('daily_dispense_report_kadha',$data,true);
                $this->load->view('layout/main_wrapper',$data);
 
 
   }
       
     public function daily_dispense_patient_report_kadha()
               
        {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $section   = $this->input->get('section', TRUE);
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['section'] = $start_date;
           $data['dateto'] = $end_date;
           
           if($section =='opd')
           {
             $data['patients'] = $this->db->select('*')
               ->from('kadha_daily_opd_patient')
               ->where('create_date',$start_date2)
               ->get()
               ->result();
             print_r($this->db->last_query());
           }
           else
           {
             $data['patients'] = $this->db->select('*')
               ->from('kadha_daily_ipd_patient')
               ->where('push_date',$start_date2)
               ->get()
               ->result();
           }
               
           $data['content'] = $this->load->view('patient_with_despense_kadha',$data,true);
           $this->load->view('layout/main_wrapper',$data);
   }
       
  
  
  
  
   public function stock_despence_churn_tablet_kadha()
   {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $section = $this->input->get('section', TRUE);
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['dateto'] = $end_date;
           $data['section'] = $section;
         
           if($section=='opd')
           {
                $data['patient'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id,old_reg_no,create_date')
               ->from('kadha_daily_opd_patient')
               ->where('create_date >=',$start_date2)
               ->where('create_date <=',$end_date2)
               ->order_by('patient_auto_id','ASC')
               ->get()
               ->result();
             //  print_r($this->db->last_query());
             
             	$data['patients'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id,old_reg_no,create_date')
               ->from('kadha_daily_opd_patient')
               ->where('create_date >=',$start_date2)
               ->where('create_date <=',$end_date2)
               ->order_by('patient_auto_id','ASC')
               ->get()
               ->result();
               //print_r($this->db->last_query());
             
           }
           else
           {
             
             	$data['patient'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id,old_reg_no,create_date')
               ->from('kadha_daily_ipd_patient')
              
              ->where('push_date >=',$start_date2)
               ->where('push_date <=',$end_date2)
                   ->order_by('patient_auto_id','ASC')
               ->get()
               ->result();
             
               $data['patients'] = $this->db->select('DISTINCT(name),yearly_reg_no,patient_auto_id,old_reg_no,create_date')
               ->from('kadha_daily_ipd_patient')
              ->where('push_date >=',$start_date2)
               ->where('push_date <=',$end_date2)
                  ->order_by('patient_auto_id','ASC')
               ->get()
               ->result();
             
              // print_r($this->db->last_query());
               
           }
               $data['content'] = $this->load->view('stock_despence_churn_tablet_kadha',$data,true);
               $this->load->view('layout/main_wrapper',$data);
   }




 public function new_despense_report_patientwise()
    {
        $year = '%'.$this->session->userdata['acyear'].'%';
        $start_date1 = $this->input->get('start_date', TRUE);
        $end_date1   = $this->input->get('start_date', TRUE);
        $section   = $this->input->get('section', TRUE);
        $start_date2 = date('Y-m-d',strtotime($start_date1));
        $end_date2   = date('Y-m-d',strtotime($end_date1));
        $start_date= $start_date2;
        $start_date_f= $start_date2." 23:59:00";
        $end_date= $end_date2." 23:59:00";
        
        $data['datefrom'] = $start_date;
        $data['dateto'] = $end_date;
        $data['section'] = $section;

        if($section == 'opd')
        {
            $table = 'pharma_daily_opd_patient';
            $patient_table = 'patient';
        }
        else{
            $table = 'pharma_daily_ipd_patient';
            $patient_table = 'patient_ipd';
        }

        $data['table'] = $patient_table;
        $data['drug_table'] = $table;
            if($section == 'opd')
        {
        $data['patient'] = $this->db->select('DISTINCT(name) as PatientName,patient_auto_id')
                 ->from($table)
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd',$section)
                 ->order_by('patient_auto_id','ASC')
                 ->get()
                 ->result();
                # print_r($this->db->last_query());
        }
        else
        {
                    $data['patient'] = $this->db->select('DISTINCT(name) as PatientName,patient_auto_id')
                 ->from($table)
                 ->where('push_date',$start_date2)
                 ->where('ipd_opd',$section)
                 ->order_by('patient_auto_id','ASC')
                 ->get()
                 ->result();
                # print_r($this->db->last_query());
        }
                 


        $data['content'] = $this->load->view('new_despense_report_patientwise',$data,true);
        $this->load->view('layout/main_wrapper',$data);
    }






          public function daily_dispense_report_churn()
               
        {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['dateto'] = $end_date;
               
               
               $data['opd_stock_churn'] = $this->db->select('name as tab_name,daily_opening_bal as opening_stock,daily_despensing_bal as opd_despense')
                 ->from('daily_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','opd')
                 ->where('type','1')
                 ->get()
                 ->result();
               
               
               $data['opd_stock_tab'] = $this->db->select('name as tab_name,daily_opening_bal as opening_stock,daily_despensing_bal as opd_despense')
                 ->from('daily_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','opd')
                 ->where('type','2')
                 ->get()
                 ->result();
               //print_r($this->db->last_query());
               
               
                $data['ipd_stock_churn'] = $this->db->select('name as tab_name,daily_closing_bal as closing_stock,daily_despensing_bal as ipd_despense')
                 ->from('daily_ipd_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','ipd')
                 ->where('type','1')
                 ->get()
                 ->result();
               
               $data['ipd_stock_tab'] = $this->db->select('name as tab_name,daily_closing_bal as closing_stock,daily_despensing_bal as ipd_despense')
                 ->from('daily_ipd_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','ipd')
                 ->where('type','2')
                 ->get()
                 ->result();
               //print_r($this->db->last_query());
               
               $data['daily_despense'] = array_merge($data['opd_stock_churn'],$data['ipd_stock_churn']);
                 
                 
               $data['content'] = $this->load->view('daily_dispense_report_churn',$data,true);
               $this->load->view('layout/main_wrapper',$data);
   }

     public function stock_report_churn()
    {
	    $section = $this->input->get('section');
	    if($section){
	        $data['section'] = $section;
	    }else{
	        $data['section'] = '';
	    }
        $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = $this->input->get('start_date');
        }else{
            $sDate = '';
        }
        if($this->input->get('end_date')){
            $eDate = $this->input->get('end_date');
        }else{
            $eDate = '';
        }
        
       
        $data['reportType'] = $reportType = $this->input->get('reportType');
        if($reportType == 'd'){
            $data['datefrom']=$sDate;
            $data['dateto']=$sDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($sDate));
        
            if($section == 'opd'){
                $data['churnaDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                                        ->order_by('id','ASC')
                                        ->get('daily_stock')
                                        ->result();
                $data['tabletDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                                        ->order_by('id','ASC')
                                        ->get('daily_stock')
                                        ->result();
            }
            else if($section == 'ipd'){
                $data['churnaDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                                        ->order_by('id','ASC')
                                        ->get('daily_ipd_stock')
                                        ->result();
                $data['tabletDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                                        ->order_by('id','ASC')
                                        ->get('daily_ipd_stock')
                                        ->result();
            }
        }
        elseif($reportType == 'm'){
            $data['datefrom']=$sDate;
            $data['dateto']=$eDate;
          
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['churnaStockRegister'] = $this->db->where(['status'=>'1'])
                                        ->get('pharma1')
                                        ->result();
            $data['tabletStockRegister'] = $this->db->where(['status'=>'2'])
                                        ->get('pharma1')
                                        ->result();
        }
        elseif($reportType == 'y'){
            $data['datefrom']= $sDate ='01-01-'.$this->session->userdata['acyear'];
            $data['dateto']= $eDate ='31-12-'.$this->session->userdata['acyear'];
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['churnaStockRegister'] = $this->db->where(['status'=>'1'])
                                        ->get('pharma1')
                                        ->result();
            $data['tabletStockRegister'] = $this->db->where(['status'=>'2'])
                                        ->get('pharma1')
                                        ->result();
        }
            
	    
        $data['content'] = $this->load->view('stock_report_churn',$data,true);
        $this->load->view('layout/main_wrapper',$data);  
	}


   public function daily_dispense_report_tab()
               
        {
           $year = '%'.$this->session->userdata['acyear'].'%';
           $start_date1 = $this->input->get('start_date', TRUE);
           $end_date1   = $this->input->get('start_date', TRUE);
           $start_date2 = date('Y-m-d',strtotime($start_date1));
           $end_date2   = date('Y-m-d',strtotime($end_date1));
           $start_date= $start_date2;
           $start_date_f= $start_date2." 23:59:00";
           $end_date= $end_date2." 23:59:00";
         
           $data['datefrom'] = $start_date;
           $data['dateto'] = $end_date;
               
               
               $data['opd_stock_churn'] = $this->db->select('name as tab_name,daily_opening_bal as opening_stock,daily_despensing_bal as opd_despense')
                 ->from('daily_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','opd')
                 ->where('type','1')
                 ->get()
                 ->result();
               
               
               $data['opd_stock_tab'] = $this->db->select('name as tab_name,daily_opening_bal as opening_stock,daily_despensing_bal as opd_despense')
                 ->from('daily_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','opd')
                 ->where('type','2')
                 ->get()
                 ->result();
               //print_r($this->db->last_query());
               
               
                $data['ipd_stock_churn'] = $this->db->select('name as tab_name,daily_closing_bal as closing_stock,daily_despensing_bal as ipd_despense')
                 ->from('daily_ipd_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','ipd')
                 ->where('type','1')
                 ->get()
                 ->result();
               
               $data['ipd_stock_tab'] = $this->db->select('name as tab_name,daily_closing_bal as closing_stock,daily_despensing_bal as ipd_despense')
                 ->from('daily_ipd_stock')
                 ->where('create_date',$start_date2)
                 ->where('ipd_opd','ipd')
                 ->where('type','2')
                 ->get()
                 ->result();
               //print_r($this->db->last_query());
               
               $data['daily_despense'] = array_merge($data['opd_stock_churn'],$data['ipd_stock_churn']);
                 
                 
               $data['content'] = $this->load->view('daily_dispense_report_tab',$data,true);
               $this->load->view('layout/main_wrapper',$data);
   }


      public function stock_report_tab()
    {
	    $section = $this->input->get('section');
	    if($section){
	        $data['section'] = $section;
	    }else{
	        $data['section'] = '';
	    }
        $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = $this->input->get('start_date');
        }else{
            $sDate = '';
        }
        if($this->input->get('end_date')){
            $eDate = $this->input->get('end_date');
        }else{
            $eDate = '';
        }
        
       
        $data['reportType'] = $reportType = $this->input->get('reportType');
        if($reportType == 'd'){
            $data['datefrom']=$sDate;
            $data['dateto']=$sDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($sDate));
        
            if($section == 'opd'){
                $data['churnaDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                                        ->order_by('id','ASC')
                                        ->get('daily_stock')
                                        ->result();
                $data['tabletDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                                        ->order_by('id','ASC')
                                        ->get('daily_stock')
                                        ->result();
            }
            else if($section == 'ipd'){
                $data['churnaDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                                        ->order_by('id','ASC')
                                        ->get('daily_ipd_stock')
                                        ->result();
                $data['tabletDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                                        ->order_by('id','ASC')
                                        ->get('daily_ipd_stock')
                                        ->result();
            }
        }
        elseif($reportType == 'm'){
            $data['datefrom']=$sDate;
            $data['dateto']=$eDate;
          
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['churnaStockRegister'] = $this->db->where(['status'=>'1'])
                                        ->get('pharma1')
                                        ->result();
            $data['tabletStockRegister'] = $this->db->where(['status'=>'2'])
                                        ->get('pharma1')
                                        ->result();
        }
        elseif($reportType == 'y'){
            $data['datefrom']= $sDate ='01-01-'.$this->session->userdata['acyear'];
            $data['dateto']= $eDate ='31-12-'.$this->session->userdata['acyear'];
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['churnaStockRegister'] = $this->db->where(['status'=>'1'])
                                        ->get('pharma1')
                                        ->result();
            $data['tabletStockRegister'] = $this->db->where(['status'=>'2'])
                                        ->get('pharma1')
                                        ->result();
        }
            
	    
        $data['content'] = $this->load->view('stock_report_tab',$data,true);
        $this->load->view('layout/main_wrapper',$data);  
	}


     public function oil_stock_report_month()
    {
        $section = $this->input->get('section');
        if($section){
            $data['section'] = $section;
        }else{
            $data['section'] = '';
        }
        $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = $this->input->get('start_date');
        }else{
            $sDate = '';
        }
        if($this->input->get('end_date')){
            $eDate = $this->input->get('end_date');
        }else{
            $eDate = '';
        }
        
      
        
        $data['reportType'] = $reportType = $this->input->get('reportType');
        if($reportType == 'd'){
            $data['datefrom']=$sDate;
            $data['dateto']=$sDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($sDate));
            
            if($section == 'opd'){
                $data['oilDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                    ->order_by('id','ASC')
                    ->get('daily_opd_oil_stock')
                    ->result();
                //print_r($this->db->last_query());
                $data['churnDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                    ->order_by('id','ASC')
                    ->get('daily_opd_oil_stock')
                    ->result();
            }
            else if($section == 'ipd'){
                $data['oilDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                    ->order_by('id','ASC')
                    ->get('daily_ipd_oil_stock')
                    ->result();
                $data['churnDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                    ->order_by('id','ASC')
                    ->get('daily_ipd_oil_stock')
                    ->result();
            }
        }
        elseif($reportType == 'm'){
            $data['datefrom']=$sDate;
            $data['dateto']=$eDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['oilStockRegister'] = $this->db->where(['type'=>'1'])
                ->get('pharma1_oil')
                ->result();
            $data['churnStockRegister'] = $this->db->where(['type'=>'2'])
                ->get('pharma1_oil')
                ->result();
            //print_r($this->db->last_query());
        }
        elseif($reportType == 'y'){
            $data['datefrom']= $sDate ='01-01-'.$this->session->userdata['acyear'];
            $data['dateto']= $eDate ='31-12-'.$this->session->userdata['acyear'];
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['oilStockRegister'] = $this->db->where(['type'=>'1'])
                ->get('pharma1_oil')
                ->result();
            $data['churnStockRegister'] = $this->db->where(['type'=>'2'])
                ->get('pharma1_oil')
                ->result();
        }
        
        
        $data['content'] = $this->load->view('oil_stock_report_month',$data,true);
        $this->load->view('layout/main_wrapper',$data);  
    }


      public function oil_stock_report_month_churn()
    {
        $section = $this->input->get('section');
        if($section){
            $data['section'] = $section;
        }else{
            $data['section'] = '';
        }
        $year = '%'.$this->session->userdata['acyear'].'%';
        
        if($this->input->get('start_date')){
            $sDate = $this->input->get('start_date');
        }else{
            $sDate = '';
        }
        if($this->input->get('end_date')){
            $eDate = $this->input->get('end_date');
        }else{
            $eDate = '';
        }
        
      
        
        $data['reportType'] = $reportType = $this->input->get('reportType');
        if($reportType == 'd'){
            $data['datefrom']=$sDate;
            $data['dateto']=$sDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($sDate));
            
            if($section == 'opd'){
                $data['oilDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                    ->order_by('id','ASC')
                    ->get('daily_opd_oil_stock')
                    ->result();
                //print_r($this->db->last_query());
                $data['churnDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                    ->order_by('id','ASC')
                    ->get('daily_opd_oil_stock')
                    ->result();
            }
            else if($section == 'ipd'){
                $data['oilDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'1'])
                    ->order_by('id','ASC')
                    ->get('daily_ipd_oil_stock')
                    ->result();
                $data['churnDailyStockRegister'] = $this->db->where(['ipd_opd' => $section, 'create_date' => $fDate, 'type'=>'2'])
                    ->order_by('id','ASC')
                    ->get('daily_ipd_oil_stock')
                    ->result();
            }
        }
        elseif($reportType == 'm'){
            $data['datefrom']=$sDate;
            $data['dateto']=$eDate;
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['oilStockRegister'] = $this->db->where(['type'=>'1'])
                ->get('pharma1_oil')
                ->result();
            $data['churnStockRegister'] = $this->db->where(['type'=>'2'])
                ->get('pharma1_oil')
                ->result();
            //print_r($this->db->last_query());
        }
        elseif($reportType == 'y'){
            $data['datefrom']= $sDate ='01-01-'.$this->session->userdata['acyear'];
            $data['dateto']= $eDate ='31-12-'.$this->session->userdata['acyear'];
            $fDate = date('Y-m-d',strtotime($sDate));
            $tDate = date('Y-m-d',strtotime($eDate));
            
            $data['oilStockRegister'] = $this->db->where(['type'=>'1'])
                ->get('pharma1_oil')
                ->result();
            $data['churnStockRegister'] = $this->db->where(['type'=>'2'])
                ->get('pharma1_oil')
                ->result();
        }
        
        
        $data['content'] = $this->load->view('oil_stock_report_month_churn',$data,true);
        $this->load->view('layout/main_wrapper',$data);  
    }
}