<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Dashboard extends CI_Controller {

    public function __construct()
    {
        parent::__construct();

        $this->load->model(array(
            'dashboard_model',
            'setting_model',
            'department_model',
            'patient_model'
        )); 
    }
    
   



 public function data_push_2019()
    {
      
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
          date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
          echo date('d-m-Y H:i:s');
          echo "<script>
           $(document).ready(function () 
           {
             setTimeout('location.reload(true);', '5000');
           });
        </script>";
        
        $dbHost = "localhost";
        // $dbDatabase = "m0labn2g_anjaneyaamc";
        // $dbPasswrod = "anjaneyacollege@1234";
        // $dbUser = "m0labn2g_anjaneyacollege";
        $dbDatabase = "srpayurved_db";
        $dbPasswrod = "gJXdRod3AOlyp4c9";
        $dbUser = "srpayurved_db";
        $mysqli = new mysqli($dbHost, $dbUser, $dbPasswrod, $dbDatabase);
        $mysqli -> character_set_name();
        // Change character set to utf8
        $mysqli -> set_charset("utf8");

        
        //CJOB Auto push comment start -----------------------------
        //set time limit of opd ipd 
        //   $opd_ipd_time = "SELECT * FROM `opd_ipd_time`";
	    //$opd_ipd_time1 = $mysqli->query($opd_ipd_time);
	    //$k=1;
	    // while($row = mysqli_fetch_array($opd_ipd_time1))
        //   {
        //      if($k==1){
        //          $name1=  $row['name'];
        //          $start_time_m= $row['start_time'];
        //          $end_time_m= $row['end_time'];
        //   }
        //     else if($k==2){
        //          $name2=  $row['name'];
        //          $start_time_e= $row['start_time'];
        //          $end_time_e= $row['end_time'];
        //   }
        //   $k++; 
     
        //  }
        //CJOB Auto push comment End ----------------------------------
     
        //end time limit of opd ipd 
        
        
       //Prints the day
        date_default_timezone_set('Asia/kolkata');
	  
        $last_date_insert="SELECT * FROM  patient ORDER BY id DESC LIMIT 1;";
        $last_date_insert_r = $mysqli->query($last_date_insert);
        $last_date_insert_row1=$last_date_insert_r->fetch_assoc();
        echo "last_date_insert".$late_date=$last_date_insert_row1['create_date'];
        
        $holidayList = "Select holiday_date from holiday";
        $result= $mysqli->query($holidayList);
        //$resHoliday=$result->fetch_array();
        while($row = mysqli_fetch_array($result))
        {
            $data[] = $row; 
        }
	    //print_r($data);
	    //die();
	    for($i=0; $i<count($data); $i++)
	    {
	       if(date('Y-m-d',strtotime($data[$i]['holiday_date'])) == date('Y-m-d',strtotime($late_date)))
	       {
	            $late_date = date('Y-m-d', strtotime("+1 days", strtotime($late_date)));
                $w_day= date('D',strtotime($late_date));
                if($w_day !='Sun')
                {
                    $late_date=$late_date;
                }
                else
                {
                    $late_date=date('Y-m-d', strtotime("+1 days", strtotime($late_date)));
                }
	       }
	   }
	   echo "last_date_insert_11 =====> ".$late_date;

        //CJOB Auto push comment start -------------------------------------------------
        // 	  $time_date=date('H:i');
        // 	  $late_date_convert=date('Y-m-d',strtotime($late_date));
        //       //$ADV_DAY=date('Y-m-d H:i');
        // 	  $ADV_DAY=$late_date_convert." ".$time_date;
        //       $ADV_DAY1=$late_date_convert;

        //CJOB Auto push comment End -----------------------------------------------------
        
        //CJOB Auto Push Code Start -------------------------------------------------------
        $time_date=date('H:i:s');
	    $tempDate = date('Y-m-d');
        $tempDate1 = date('Y-m-d', strtotime("-1 days", strtotime($tempDate)));

        $dt1=$tempDate1;
        $dt2='%'.$dt1.'%';
        $sqlQuery1 = "SELECT * FROM patient WHERE create_date LIKE '$dt2'";
        $sqlQueryRes1 = $mysqli->query($sqlQuery1);
        $sqlQueryRowCount1=mysqli_num_rows($sqlQueryRes1);
        
        $sqlQuery2 = "SELECT * FROM patient_ipd WHERE create_date LIKE '$dt2'";
        $sqlQueryRes2 = $mysqli->query($sqlQuery2);
        $sqlQueryRowCount2=mysqli_num_rows($sqlQueryRes2);
        $finalSqlQueryRowCount=$sqlQueryRowCount1 + $sqlQueryRowCount2;
	   
        // Today's patient master limit 
        $dlp = "SELECT * FROM data_limit";
        $dlp1 = $mysqli->query($dlp);
        $dlp11=$dlp1->fetch_assoc();
        $dlt=$dlp11['data_limit'];
        $dlt1=$dlt - 15;

        if($tempDate1 == date('Y-m-d',strtotime($late_date)) && $finalSqlQueryRowCount > $dlt1 )
        {
            $late_date_convert=date('Y-m-d',strtotime($tempDate));
            $ADV_DAY=$late_date_convert." ".$time_date; //Working Code
            $ADV_DAY1=$late_date_convert; //Working Code
            echo "<br>";
            echo "CR======>";
            echo $ADV_DAY;
            echo "======>";
            echo $ADV_DAY1;
            echo "===>";
            echo "Current Data1";
            echo "<br>";
            
            $opd_ipd_time = "SELECT * FROM `opd_ipd_time`";
            $opd_ipd_time1 = $mysqli->query($opd_ipd_time);
            $k=1;
            while($row = mysqli_fetch_array($opd_ipd_time1))
            {
                if($k==1)
                {
                    $name1=  $row['name'];
                    $start_time_m= $row['start_time'];
                    $end_time_m= $row['end_time'];
                }
                else if($k==2)
                {
                    $name2=  $row['name'];
                    $start_time_e= $row['start_time'];
                    $end_time_e= $row['end_time'];
                }
                $k++; 
            }
        }
        else if($tempDate == date('Y-m-d',strtotime($late_date)))
        {
            $late_date_convert=date('Y-m-d',strtotime($tempDate));
            $ADV_DAY=$late_date_convert." ".$time_date; //Working Code
            $ADV_DAY1=$late_date_convert; //Working Code
            echo "<br>";
            echo "CR======>";
            echo $ADV_DAY;
            echo "======>";
            echo $ADV_DAY1;
            echo "===>";
            echo "Current Data";
            echo "<br>";
            
            $opd_ipd_time = "SELECT * FROM `opd_ipd_time`";
            $opd_ipd_time1 = $mysqli->query($opd_ipd_time);
            $k=1;
            while($row = mysqli_fetch_array($opd_ipd_time1))
            {
                if($k==1)
                {
                    $name1=  $row['name'];
                    $start_time_m= $row['start_time'];
                    $end_time_m= $row['end_time'];
                }
                else if($k==2)
                {
                    $name2=  $row['name'];
                    $start_time_e= $row['start_time'];
                    $end_time_e= $row['end_time'];
                }
                $k++; 
            }
        }
        else{
            $late_date_convert=date('Y-m-d',strtotime($late_date));
            
            $ldt1=$late_date_convert;
            $ldt2='%'.$ldt1.'%';
            $lSqlQuery1 = "SELECT * FROM patient WHERE create_date LIKE '$ldt2'";
            $lSqlQueryRes1 = $mysqli->query($lSqlQuery1);
            $lSqlQueryRowCount1=mysqli_num_rows($lSqlQueryRes1);
            
            $lSqlQuery2 = "SELECT * FROM patient_ipd WHERE create_date LIKE '$ldt2'";
            $lSqlQueryRes2 = $mysqli->query($lSqlQuery2);
            $lSqlQueryRowCount2=mysqli_num_rows($lSqlQueryRes2);
            $lFinalSqlQueryRowCount=$lSqlQueryRowCount1 + $lSqlQueryRowCount2;
           
            // Today's patient master limit 
            $ldlp = "SELECT * FROM data_limit";
            $ldlp1 = $mysqli->query($ldlp);
            $ldlp11=$ldlp1->fetch_assoc();
            $ldlt=$ldlp11['data_limit'];
            $ldlt1=$ldlt - 15;
            
            if($lFinalSqlQueryRowCount > $ldlt1)
            {
                
                //set holiday
                $opd_ipd_time = "SELECT * FROM `holiday`";
                $opd_ipd_time1 = $mysqli->query($opd_ipd_time);
                
                while($row = mysqli_fetch_array($opd_ipd_time1))
                {
                    $data[] = $row; 
                }
                
                for($i=0;$i<count($data);$i++)
                {
                    $data[$i]['holiday_date'];
                    $holiday_date=date('Y-m-d', strtotime("+1 days", strtotime($late_date_convert)));
                    if(date('Y-m-d',strtotime($holiday_date)) == date('Y-m-d',strtotime($data[$i]['holiday_date'])))
                    {
                        $holiday="holiday";
                    }
                }
                    
                if(!empty($holiday))
                {
                    $next_date=date('Y-m-d', strtotime("+1 days", strtotime($late_date_convert)));
                    $w_day= date('D',strtotime($next_date));
                    if($w_day !='Sun')
                    {
                        $late_date_convert= $next_date;
                    } 
                    else
                    {
                        $next_date=date('Y-m-d', strtotime("+2 days", strtotime($late_date_convert)));
                        $w_day= date('D',strtotime($next_date));
                        if($w_day !='Sun')
                        {
                            $late_date_convert= $next_date;
                        }
                    }
                } 
                else
                {
                    
                    $next_date=date('Y-m-d', strtotime("+1 days", strtotime($late_date_convert)));
                    $w_day= date('D',strtotime($next_date));
                    if($w_day !='Sun')
                    {
                        $late_date_convert=$next_date;
                    } 
                    else
                    {
                        $next_date=date('Y-m-d', strtotime("+2 days", strtotime($late_date_convert)));
                        $w_day= date('D',strtotime($next_date));
                        if($w_day !='Sun'){
                            $late_date_convert=$next_date;
                        }
                    }
                }
                
                for($i=0; $i<count($data); $i++)
                {
        	       if(date('Y-m-d',strtotime($data[$i]['holiday_date'])) == date('Y-m-d',strtotime($late_date_convert)))
        	       {
        	            $late_date_convert = date('Y-m-d', strtotime("+1 days", strtotime($late_date_convert)));
                        $w_day= date('D',strtotime($late_date_convert));
                        if($w_day !='Sun')
                        {
                            $late_date_convert=$late_date_convert;
                        }
                        else
                        {
                            $late_date_convert=date('Y-m-d', strtotime("+1 days", strtotime($late_date_convert)));
                        }
        	       }
        	   }
                
                //$late_date_convert=date('Y-m-d', strtotime("+1 days", strtotime($late_date_convert)));
            }
            
            $ADV_DAY=$late_date_convert." ".$time_date; //Working Code
            $ADV_DAY1=$late_date_convert; //Working Code
            echo "<br>";
            echo "CR======>";
            echo $ADV_DAY;
            echo "======>";
            echo $ADV_DAY1;
            echo "===>";
            echo "Back Dated Data";
            echo "<br>";
            
            $start_time_m= date('H:i:s',strtotime('01:00:00'));
            $end_time_m= date('H:i:s',strtotime('23:55:45'));
            $start_time_e= date('H:i:s',strtotime('03:00:00'));
            $end_time_e= date('H:i:s',strtotime('23:30:00'));
      }
      // CJOB Auto push code End -----------------------------------------------------------------
    
	  if($ADV_DAY1 >='2025-12-31')
	  {
	      exit;
	  }
      echo  "current date ".$date = $ADV_DAY;
      echo "<br>";
      echo "strat date morning ".$date1=$ADV_DAY1." ".$start_time_m;
     
      echo "<br>";
      echo "end date morning".$date2 = $ADV_DAY1." ".$end_time_m;
      echo "<br>";
      
      echo "strat date evening ".$date33=$ADV_DAY1." ".$start_time_e;
      echo "<br>";
      echo "end date evening".$date44 = $ADV_DAY1." ".$end_time_e;
      echo "<br>";
      echo "Today is ".$w_day1 = date('D',strtotime($ADV_DAY1))."<br>";
      
      $w_day= date('D',strtotime($ADV_DAY1));
      
      //set holiday
       $opd_ipd_time = "SELECT * FROM `holiday`";
	   $opd_ipd_time1 = $mysqli->query($opd_ipd_time);
	  
	   while($row = mysqli_fetch_array($opd_ipd_time1))
        {
         $data[] = $row; 
        }
   
   
      for($i=0;$i<count($data);$i++)
      {
       
          $data[$i]['holiday_date'];
       
         if(date('Y-m-d',strtotime($date)) == date('Y-m-d',strtotime($data[$i]['holiday_date'])))
         {
           $holiday="holiday";
         }
      }
   
     if(empty($holiday))
     {
      echo "no holiday";   
     } 
     else
     {
         echo "today is holiday";
     }
  
    //end set holiday
    
  
     
    if(($date1 <= $date) && ($date2 >= $date)){ echo "Yes";}
	         $auto_on_off = "SELECT * FROM auto_on_off";
	         $auto_on_off1 = $mysqli->query($auto_on_off);
	         $auto_on_off2=$auto_on_off1->fetch_assoc();
             $auto_on_off3=$auto_on_off2['status'];
      
       $date3=$ADV_DAY1;
       $date22='%'.$date3.'%';
       $sql2 = "SELECT * FROM patient WHERE create_date LIKE '$date22'";
	   $result2 = $mysqli->query($sql2);
       $rowcount=mysqli_num_rows($result2);
       
       $sql22 = "SELECT * FROM patient_ipd WHERE create_date LIKE '$date22'";
	   $result22 = $mysqli->query($sql22);
       $rowcount1=mysqli_num_rows($result22);
       $rowcount_two=$rowcount + $rowcount1;
       //$rowcount_two=$rowcount;
       echo "<br>";
	   echo "today's count ".$rowcount_two."<br>";
	   
	     // Today's patient master limit 
             $data_limit_patient = "SELECT * FROM data_limit";
	         $data_limit_patient1 = $mysqli->query($data_limit_patient);
	         $data_limit_patient11=$data_limit_patient1->fetch_assoc();
             $data_limit=$data_limit_patient11['data_limit'];
             $data_limit1=$data_limit - 15;
             $rand_data_limit=rand($data_limit1,$data_limit);
             
             echo "<br>data_limit ".$data_limit."<br>";
             echo "<br>data_limit1 ".$data_limit1."<br>";
             echo "<br>rand_data_limit ".$rand_data_limit."<br>";
        // end Today's patient master limit
	
		if($rowcount_two<=$rand_data_limit)
		{
			$ADV_DAY=$late_date_convert." ".$time_date;
           echo $ADV_DAY1=$late_date_convert;
		} 
		else 
		{
		    
		  if($ADV_DAY1=='2025-12-31')
		  {
		     echo "still date-".$ADV_DAY1;exit;
		  }
		  for($i=0;$i<count($data);$i++)
		  {
       
           $data[$i]['holiday_date'];
           $holiday_date=date('Y-m-d', strtotime("+1 days", strtotime($ADV_DAY1)));
          if(date('Y-m-d',strtotime($holiday_date)) == date('Y-m-d',strtotime($data[$i]['holiday_date'])))
          {
            $holiday="holiday";
         
           }
          }
   
           if(!empty($holiday))
           {
              
                $ADV_DAY=$holiday_date." ".$time_date;
             $ADV_DAY1=$holiday_date;
			 $next_date=date('Y-m-d', strtotime("+1 days", strtotime($ADV_DAY1)));
			 $w_day= date('D',strtotime($next_date));
			 if($w_day !='Sun')
			 {
				 $ADV_DAY=$next_date." ".$time_date;
                echo $ADV_DAY1=$next_date; 
			 } 
			 else 
			 {
				 
				 $next_date=date('Y-m-d', strtotime("+2 days", strtotime($ADV_DAY1)));
				 $w_day= date('D',strtotime($next_date));
			  if($w_day !='Sun')
			  {
				 $ADV_DAY=$next_date." ".$time_date;
                 echo $ADV_DAY1=$next_date; 
			 }
			 }
             } 
		    
		    else
		    {
		    
			
			 $ADV_DAY=$late_date_convert." ".$time_date;
             $ADV_DAY1=$late_date_convert;
			 $next_date=date('Y-m-d', strtotime("+1 days", strtotime($ADV_DAY1)));
			 $w_day= date('D',strtotime($next_date));
			 if($w_day !='Sun'){
				 $ADV_DAY=$next_date." ".$time_date;
                echo $ADV_DAY1=$next_date; 
			 } 
			 else
			 {
				 
				 $next_date=date('Y-m-d', strtotime("+2 days", strtotime($ADV_DAY1)));
				 $w_day= date('D',strtotime($next_date));
			  if($w_day !='Sun'){
				 $ADV_DAY=$next_date." ".$time_date;
                 echo $ADV_DAY1=$next_date; 
			 }
			 }
		}
        
        }    
      
        
        $today_limit_day='%'.$ADV_DAY1.'%';
	   // today's opd(new/old) limit
             $today_old = "SELECT * FROM patient WHERE flag='1' AND create_date LIKE  '$today_limit_day'";
             $today_old1 = $mysqli->query($today_old);
	         $result_t_old = $today_old1->num_rows;
	         echo "today old count". $result_t_old;
	         
	         $today_new = "SELECT * FROM patient WHERE flag='0' AND create_date LIKE  '$today_limit_day'";
             $today_new1 = $mysqli->query($today_new);
	         $result_t_new = $today_new1->num_rows;
	         echo "today new count". $result_t_new;
      // end today's opd(new/old) limit
      
       // today's opd(new/old) percentage
             $today_old_percentage=round($data_limit * (40/100));
             $today_new_percentage=round($data_limit * (60/100));
             /*$today_new_percentage_M=round($today_new_percentage*(60/100));
             $today_old_percentage_M=round($today_old_percentage*(60/100));*/
             $today_new_percentage_M=round($today_new_percentage*(100/100));
             $today_old_percentage_M=round($today_old_percentage*(100/100));
             echo "<br>today new percentge limit ".$today_new_percentage."<br>";
             echo "<br>today old percentge limit ".$today_old_percentage."<br>";
             echo "<br>today new percentge limit Morning ".$today_new_percentage_M."<br>";
             echo "<br>today old percentge limit Morning ".$today_old_percentage_M."<br>";
              
	       
	     // end today's opd(new/old) percentage
	     
	        
            
      if($auto_on_off3=='0')
      {
      
       /*if(($date1 <= $date) && ($date2 >= $date) && ($w_day !='Sun') &&($rowcount_two<=$rand_data_limit) && (empty($holiday))){*/
	  /*if(($date1 <= $date) && ($date2 >= $date) && ($w_day !='Sun') &&($ADV_DAY1) &&($rowcount_two<=$rand_data_limit))*/
	  /*if(($date1 <= $date) && ($date2 >= $date) && ($w_day !='Sun') &&($ADV_DAY1))*/
	  if(($date1 <= $date) && ($date2 >= $date) && ($w_day !='Sun') &&($ADV_DAY1) && ($rowcount_two<=$rand_data_limit))
	  { 
	     
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            
            
            //$rand=rand(75,85);
            if($rowcount_two>=75){
                $ancCheckDate = date('Y-m-d', strtotime($ADV_DAY1));
                $tempANCItemQuery = "SELECT * FROM  items_anc WHERE  create_date like '$ancCheckDate' and flag=0 LIMIT 1";
                $tempANCItemQueryResult = $mysqli->query($tempANCItemQuery);
                $ANCResultRow=$tempANCItemQueryResult->fetch_assoc();
                // print_r('====>');
                // print_r($ANCResultRow['name']);
                // die();
                if($ANCResultRow)
                {
                    if($ANCResultRow['fol_up_status'] == 'N')
                    {
                        $tempQuery = "SELECT * FROM  patient WHERE  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                        $tempQueryResult = $mysqli->query($tempQuery);
                        $tempQueryRow=$tempQueryResult->fetch_assoc();
                        $CopddD_New=$tempQueryRow['yearly_reg_no']+1;
                        
                        $query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,discharge_date,create_date,wieght,occupation,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,proxy_id,flag,lmp,edd,fhs,ag) values('".$CopddD_New."','".$CopddD_New."','".$CopddD_New."','".$ANCResultRow["name"]."','F','".$ANCResultRow['age']."','".$ANCResultRow["address"]."','29','".$ANCResultRow['dignosis']."','opd','0000-00-00','".$ANCResultRow["create_date"]."','".$ANCResultRow["weight"]."','".$ANCResultRow["occupation"]."','".$ANCResultRow["pulse"]."','".$ANCResultRow["bp"]."','".$ANCResultRow["nadi"]."','".$ANCResultRow["ur"]."','".$ANCResultRow["cvs"]."','".$ANCResultRow["udar"]."','".$ANCResultRow["netra"]."','".$ANCResultRow["jivha"]."','".$ANCResultRow["kusudha"]."','".$ANCResultRow["ahar"]."','".$ANCResultRow["mal"]."','".$ANCResultRow["proxy_id"]."','1','".$ANCResultRow["lmp_date"]."','".$ANCResultRow["edd_date"]."','".$ANCResultRow["fhs"]."','".$ANCResultRow["ag"]."')";
                        $yes= $this->db->query($query1);
                        //print_r($yes);
                        //die();
                        if($yes)
                        {
                            $query2 = "update items_anc set patient_id='".$CopddD_New."', yearly_reg_no='".$CopddD_New."' where name like '".$ANCResultRow["name"]."'";
                            $mysqli->query($query2);
                            $query3 = "update items_anc set flag=1 where id='".$ANCResultRow["id"]."'";
                            $mysqli->query($query3);
                        }
                        echo "New ANC Patient Inserted In OPD => Name => ".$ANCResultRow["name"]." ===> New OPD No => ".$CopddD_New;
                    }
                    else
                    {
                        if($ANCResultRow['yearly_reg_no'] != '' || $ANCResultRow['yearly_reg_no'] != NULL)
                        {
                            $query1 = "insert into patient(patient_id,yearly_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,discharge_date,create_date,wieght,occupation,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,proxy_id,flag,lmp,edd,fhs,ag) values('".$ANCResultRow['yearly_reg_no']."','".$ANCResultRow['yearly_reg_no']."','".$ANCResultRow['yearly_reg_no']."','".$ANCResultRow["name"]."','F','".$ANCResultRow['age']."','".$ANCResultRow["address"]."','29','".$ANCResultRow['dignosis']."','opd','0000-00-00','".$ANCResultRow["create_date"]."','".$ANCResultRow["weight"]."','".$ANCResultRow["occupation"]."','".$ANCResultRow["pulse"]."','".$ANCResultRow["bp"]."','".$ANCResultRow["nadi"]."','".$ANCResultRow["ur"]."','".$ANCResultRow["cvs"]."','".$ANCResultRow["udar"]."','".$ANCResultRow["netra"]."','".$ANCResultRow["jivha"]."','".$ANCResultRow["kusudha"]."','".$ANCResultRow["ahar"]."','".$ANCResultRow["mal"]."','".$ANCResultRow["proxy_id"]."','1','".$ANCResultRow["lmp_date"]."','".$ANCResultRow["edd_date"]."','".$ANCResultRow["fhs"]."','".$ANCResultRow["ag"]."')";
                            $yes= $this->db->query($query1);
                            if($yes)
                            {
                                $query3 = "update items_anc set flag=1 where id='".$ANCResultRow["id"]."'";
                                $mysqli->query($query3);
                            }
                            echo "Follow up ANC Patient Inserted In OPD => Name => ".$ANCResultRow["name"]." ===> Old OPD No => ".$ANCResultRow['yearly_reg_no'];
                        }
                    }
                }
            }
            
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	     
       $sql1="SELECT * FROM  patient WHERE  yearly_reg_no !='' ORDER BY id DESC LIMIT 1;";
       $result1 = $mysqli->query($sql1);
	   $row1=$result1->fetch_assoc();
	   echo "Sr no is ".$srno=$row1['yearly_reg_no'];
	   if(empty($srno))
	   {
		  $srno=0; 
	   }
	   else
	   {
		   $srno=$row1['yearly_reg_no'];
	   }
	    echo "Sr no is real ".$srno;



          

        ///KSHARSUTRA IPD PATIENT FOLLOW UP START ///

                    $follow_up_date_ks = date('Y-m-d', strtotime($ADV_DAY1));

                    $old_date_ks = date('Y-m-d', strtotime("-5 days", strtotime($ADV_DAY1)));

                    $kshar_sutra = "SELECT patient.*, patient_ipd.discharge_date as dd 
                    FROM patient 
                    JOIN patient_ipd ON patient_ipd.yearly_reg_no = patient.yearly_reg_no
                    WHERE patient_ipd.discharge_date = '$old_date_ks' 
                    AND patient.dignosis LIKE '%BHAGANDAR%' 
                    AND patient.ipd_patient_flag = '1' 
                    AND patient.ks_follow_up_flag = '0'";

                    $kshar_sutra_result = $this->db->query($kshar_sutra);

                    if ($kshar_sutra_result) 
                    {
                        foreach ($kshar_sutra_result->result_array() as $row111) 
                        {
                            $query12 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,
                            date_of_birth,address,department_id,dignosis,ipd_no,
                            discharge_date,create_date,ipd_opd,flag,ipd_patient_flag,ks_follow_up_flag,fol_up_date,
                            wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,
                            netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id,sym_reduce_per,kstatus) 
                            values('".$row111["patient_id"]."','".$row111["yearly_no"]."','".$row111['daily_reg_no']."',
                            '".$row111['monthly_reg_no']."','".$row111['yearly_reg_no']."','".$row111["firstname"]."',
                            '".$row111['sex']."','".$row111['date_of_birth']."','".$row111['address']."',
                            '".$row111['department_id']."','".$row111['dignosis']."',
                            '".$row111['ipd_no']."','".$row111['discharge_date']."',
                            '".$follow_up_date_ks."','opd','1','1','1','".$fol_up_date."','".$row111['wieght']."',
                            '".$row111['occupation']."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."',
                            '".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."',
                            '".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."',
                            '".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."',
                            '".$nidra[$nidra1]."','".$row111['proxy_id']."','".$ruduce[$ruduce1]."','1')";

                            $this->db->query($query12);

                            $query22 = "UPDATE patient SET ks_follow_up_flag = 1 WHERE id = " . $row111["id"];
                            $this->db->query($query22);
                        }
                    } 
                    else 
                    {
                    echo "Error executing query: " . $this->db->error();
                    }

                    // SECOND FOLLOW UP
                    echo $kshar_sutra_next_follow_up = "SELECT * FROM patient WHERE ipd_patient_flag = '1' AND ks_follow_up_flag = '1'
                    AND dignosis LIKE '%BHAGANDAR%' AND old_reg_no !=''";
                    $kshar_sutra_next_follow_up_new = $this->db->query($kshar_sutra_next_follow_up);
                    if($kshar_sutra_next_follow_up_new)
                    {
                        foreach ($kshar_sutra_next_follow_up_new->result_array() as $row11) 
                        {
                            echo '<br>==>follow up date'.$ks_old_follow_up_date = date("Y-m-d",strtotime($row11["create_date"]));
                            echo '<br>==>New follow up date'.$old_date_ks_n = date('Y-m-d', strtotime("+5 days", strtotime($ks_old_follow_up_date)));
                            echo '<br>==>Push Date'.$follow_up_date_ks_n = date('Y-m-d', strtotime($ADV_DAY1));


                                $last_count_new = "SELECT COUNT(id) AS total FROM patient WHERE create_date = '$follow_up_date_ks_n'";
                                $total_old_ks = $this->db->query($last_count_new);
                                $result = $total_old_ks->row(); // Assuming you are using CodeIgniter's query result object
                                $count_new_ks = $result->total;
                                echo '<br>' . $count_new_ks;


                            if($old_date_ks_n == $follow_up_date_ks_n && $count_new_ks >='45')
                            {
                                $query12 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,
                                date_of_birth,address,department_id,dignosis,ipd_no,
                                discharge_date,create_date,ipd_opd,flag,ipd_patient_flag,ks_follow_up_flag,fol_up_date,
                                wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,
                                netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id,sym_reduce_per,kstatus) 
                                values('".$row11["patient_id"]."','".$row11["yearly_no"]."','".$row11['daily_reg_no']."',
                                '".$row11['monthly_reg_no']."','".$row11['old_reg_no']."','".$row11["firstname"]."',
                                '".$row11['sex']."','".$row11['date_of_birth']."','".$row11['address']."',
                                '".$row11['department_id']."','".$row11['dignosis']."',
                                '".$row11['ipd_no']."','".$row11['discharge_date']."',
                                '".$follow_up_date_ks_n."','opd','1','1','3','".$fol_up_date."','".$row11['wieght']."',
                                '".$row11['occupation']."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."',
                                '".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."',
                                '".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."',
                                '".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."',
                                '".$nidra[$nidra1]."','".$row11['proxy_id']."','".$ruduce[$ruduce1]."','1')";

                                $this->db->query($query12);
                                $query22 = "UPDATE patient SET ks_follow_up_flag = 2 WHERE id = " . $row11["id"];
                                $this->db->query($query22);
                            }
                        }
                    }
                    else 
                    {
                        echo "Error executing query: " . $this->db->error();
                    }



        ///KSHARSUTRA IPD PATIENT FOLLOW UP END ///



	   $rand=rand(6,9);
       echo "<br>";
       echo "old ipd rand day ".$rand."<br>";
       $old_date=date('Y-m-d', strtotime("-$rand days", strtotime($ADV_DAY1)));
      // date('Y-m-d', strtotime("-$rand days", strtotime($ADV_DAY1)));
      
       $old_date1='%'.$old_date.'%';
	   $old_rand=rand(1,2);
	  // $old_date1 = "SELECT * FROM patient WHERE flag= 0 AND department_id!='35' AND create_date LIKE  '$old_date1' AND yearly_reg_no !='' ORDER BY rand(id)  LIMIT  $old_rand";
	   $old_date1 = "SELECT * FROM patient WHERE flag = 0 AND department_id!='35' AND manual_status='0' AND create_date LIKE  '$old_date1' AND yearly_reg_no !='' OR created_by = ''  ORDER BY rand(id)  LIMIT  $old_rand";
	   $result11 = $mysqli->query($old_date1);
	   // $row1=$result11->fetch_assoc();
	   //$old_date111=$row1['created_date'];
	   
	   echo "old_record is ".$result11->num_rows;
	   
	  
	   if ($result11->num_rows > 0) 
	   {
	    $flag='1';
	    $ipd_opd1='opd';
	    $ipd_opd2='ipd';
	    $n=1;
	    
	       
	    
	    if($result_t_old <= $today_old_percentage_M)
	    {
	    while($row1 = $result11->fetch_assoc()) 
	    {
	         
	         if($n == 1)
	         {
               $date_opd_old = date('Y-m-d H:i:s',strtotime('-10 minutes'))."<br>";
              }
              else if($n == 2)
              {
               $date_opd_old = date('Y-m-d H:i:s',strtotime('-5 minutes'))."<br>";
              }
              else if($n == 3)
              {
               $date_opd_old = date('Y-m-d H:i:s',strtotime('-2 minutes'))."<br>";
              }
            
              else 
              {
                $date_opd_old = date('Y-m-d H:i:s')."<br>";
              }
              $date_opd_old1=$ADV_DAY1;
              //echo $date_opd_old;
             
                    $yearly_reg_no=NULL;
                    $old_reg_no = $row1['yearly_reg_no'];
                    
                   echo "<br> id old: " . $row1["id"]. " - Name: " . $row1["firstname"]." - yearly reg id: " . $row1["yearly_reg_no"]."<br>";
                   
                   
                   
             
                //$bp=array('130/80','124/86','138/88','116/90','110/70','136/84','132/72','128/60','142/90');
                $bp = array('122/82','128/78','120/80','118/78','110/70','116/76','130/82','112/72','114/74','124/84','126/86');
                if($row['VIBHAG'] !=32)
                {
                    $Pulse =array('78','84','86','80','76','74','70','88','90','72','82');
                }
                else
                {
                    $Pulse =array('92','104','108','106','96','98','94','90','100','102','110');
                }
                
                $nadi=array('मंडूकगति', 'सर्पगती ' , 'हंसगति','अविशेष');
                
                //$Pulse =array(76,78,88,90,68,72,82,66,74,92,64);
                
                
                $netra=array('आविल','अच्छ','ईषत्पित्त') ;
                $givwa=array('साम','निराम');
                 $sudha=array('तीक्ष्णाग्नि', 'समाग्नि', 'विषमाग्नि');   
                
                $ahar=array('प्रभुत ','अल्प ','मध्यम');
                $mal=array('साम ','निराम ','कठीण ','दुर्गंधीयुक्त ','अविशेष');
                $mutra=array('पीत','आविल','दुर्गंधीयुक्त','अविशेष');
                $nidra=array('अविशेष','प्रभुत','अल्प');
                
                
                $c_o=$row1['dignosis'];
                $h_o='NAD';
                $f_o='NAD';
                $Pulse1=array_rand($Pulse);
                $Pulse[$Pulse1];
                $bp1=array_rand($bp);
                $bp[$bp1];
                
                $nadi1=array_rand($nadi);
                $nadi[$nadi1];
                $ur= 'अविशेष';
                $cvs ='S1S2 N';
                $udar='soft';
                
                $netra1=array_rand($netra);
                $netra[$netra1];
                
                $givwa1=array_rand($givwa);
                $givwa[$givwa1];
                
                
                $sudha1=array_rand($sudha);
                $sudha[$sudha1];
                
                $ahar1=array_rand($ahar);
                $ahar[$ahar1];
                
                $mal1=array_rand($mal);
                $mal[$mal1];
                
                $mutra1=array_rand($mutra);
                $mutra[$mutra1];
                
                $nidra1=array_rand($nidra);
                $nidra[$nidra1];
                
                $ruduce =array(10,25,50,75);
                $ruduce1=array_rand($ruduce);
                $ruduce[$ruduce1];
	           
                   //FOLLOW UP OLD GARBHINI 
                    if($row1['dignosis']=='GARBHINI-SRIIIII')
                    {
                        $follow_up=$row1['follow_up'] + 1;
                        $master_g_id=$row1['master_g_id'];
                        $date202= date('Y-m-d',strtotime($row1['create_date']));
                        $today202=$ADV_DAY1;
                        $datetime1 = date_create($date202); 
                        $datetime2 = date_create($today202); 
  
                        $inter = date_diff($datetime1, $datetime2); 
                        $inter1=$inter->format('%a'); 
                        if($inter1 <=30)
                        {
                             
                        }
                        else
                        {
                        $date_opd_old1=$ADV_DAY1; 
                        if($row1["firstname"]){
                        $query12 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,flag,'master_g_id','follow_up','wieght') values('".$row1["patient_id"]."','".$row1["yearly_no"]."','".$row1['daily_reg_no']."','".$row1['monthly_reg_no']."','".$row1['yearly_reg_no']."','".$row1["firstname"]."','".$row1['sex']."','".$row1['date_of_birth']."','".$row1['address']."','".$row1['department_id']."','".$row1['dignosis']."','".$ipd_opd1."','".$row1['ipd_no']."','".$row1['discharge_date']."','".$date_opd_old1."','".$flag."','".$master_g_id."','".$follow_up."','".$row1['wieght']."')";
                        $mysqli->query($query12);
                        }
                        if($follow_up==9)
                        {
                          $master_gar_nav = "SELECT * FROM garbhini_navjat where id='$master_g_id'";
                          $master_gar_nav1 = $mysqli->query($master_gar_nav);
	                      $master_gar_nav12=$master_gar_nav1->fetch_assoc();
                          $master_nav=$master_gar_nav12['id'];
                          
                         $last_id1 = "SELECT * total FROM patient_ipd where create_date LIKE '$year' ORDER BY id DESC LIMIT 1";
                         $last_id11 = $mysqli->query($last_id1);
	                     $last_id22=$last_id11->fetch_assoc();
	                     $patient_id1=$last_id22['patient_id'] + 1;
	                     if($last_id22['yearly_reg_no']){
                         $yearly_reg_no1=$last_id22['yearly_reg_no'] + 1;
	                     }
	                     else
	                     {
	                       $yearly_reg_no1=$last_id22['old_reg_no'] + 1;  
	                     }
                         $year_no1 = $last_id22['yearly_no'] + 1;
                         $daily_reg_no1 = $last_id22['daily_reg_no'] + 1;
                          
                          //Garbhini and navjat entry
                          $query13 = "insert into patient_ipd(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,'master_g_id','follow_up',wieght) values('".$patient_id1."','".$year_no1."','".$daily_reg_no1."','','".$yearly_reg_no1."','".$row1["firstname"]."','".$row1['sex']."','".$row1['date_of_birth']."','".$row1['address']."','".$row1['department_id']."','".$row1['dignosis']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row1['discharge_date']."','".$date_opd_old1."','".$master_g_id."','".$follow_up."','".$row1['wieght']."')";
                          $mysqli->query($query13); 
                           
                          $query13 = "insert into patient_ipd(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,'master_g_id','follow_up',wieght) values('".$patient_id1."','".$year_no1."','".$daily_reg_no1."','','".$yearly_reg_no1."','".$master_gar_nav12["b_name"]."','".$master_gar_nav12['b_sex']."','','".$master_gar_nav12['address']."','".$master_gar_nav12['department_id']."','".$master_gar_nav12['b_dignosis']."','".$ipd_opd2."','','','".$date_opd_old1."','".$master_g_id."','''".$row1['wieght']."')";
                          $mysqli->query($query13); 
                          $query22 = "update patient set flag = 1 where id=".$row1["id"];
                         }
                        }
               
                       }
                       else
                       {
                       $fol_up_date=date('Y-m-d',strtotime($row1["create_date"]));
                       if($row1["firstname"]){
	                   $query12 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,flag,fol_up_date,wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id,sym_reduce_per) values('".$row1["patient_id"]."','".$row1["yearly_no"]."','".$row1['daily_reg_no']."','".$row1['monthly_reg_no']."','".$row1['yearly_reg_no']."','".$row1["firstname"]."','".$row1['sex']."','".$row1['date_of_birth']."','".$row1['address']."','".$row1['department_id']."','".$row1['dignosis']."','".$ipd_opd1."','".$row1['ipd_no']."','".$row1['discharge_date']."','".$date_opd_old1."','".$flag."','".$fol_up_date."','".$row1['wieght']."','".$row1['occupation']."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row1['proxy_id']."','".$ruduce[$ruduce1]."')";
                       //$mysqli->query($query12);
                       $this->db->query($query12);
                       $query22 = "update patient set flag = 1 where id=".$row1["id"];
                       $mysqli->query($query22);
                       }
                       }
                       echo $i."<br>";
                       $n++;
               
			 
         }
	    }
	    
	     if($result_t_new<= $today_new_percentage_M){
        //if($result_t_new){
        $rand=(rand(1,3));
        
        // CJOB Auto Push Code Start -------------------------------------------------------------------
        
        //$sql = "SELECT * FROM items WHERE flag= 0 AND Sno > $srno ORDER by id ASC LIMIT  $rand";
            $sql = "SELECT * FROM items WHERE flag= 0  ORDER by id ASC  LIMIT  $rand";
        
        // CJOB Auto Push Code End -------------------------------------------------------------------
        
        $result = $mysqli->query($sql);
            //echo $result->num_rows;
            if ($result->num_rows > 0) 
        {
            // output data of each row
        
        
           //admit patient
           echo  "<br>current date for admit ".$date_admit = $ADV_DAY;
           echo "<br>";
           echo "strat date for admit ".$date_admit1=$ADV_DAY1." 01:00";
           echo "<br>";
           
           echo "end date for admit ".$date_admit2 = $ADV_DAY1." 23:45";
           $sql_admit = "SELECT * FROM patient WHERE flag = 1 AND ipd_opd ='opd' AND ipd_flag = 0 LIMIT  1";
           $result_admit = $mysqli->query($sql_admit);
	       $row_admit=$result_admit->fetch_assoc();
	      
	       $single_record=$result_admit->num_rows;
	       //$old_date111=$row1['created_date'];
	       // end admit patient
	       
	       //admit_todays  
	        $admit_todays1='%'.$ADV_DAY1.'%';
	        $admit_todays = "SELECT * FROM patient_ipd WHERE  create_date LIKE  '$admit_todays1' AND ipd_opd ='ipd' AND ipd_flag = 1";
	         $admit_todayss = $mysqli->query($admit_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_admit_todays=$admit_todayss->num_rows;
            echo "<br>today_total_admit ".$total_admit_todays."<br>";
            // end admit_todays
            
           
            
             //master limit admit patient
             $admit_todays_limit = "SELECT * FROM admit_patient_limit";
	         $admit_todayss1 = $mysqli->query($admit_todays_limit);
	         $admit_todayss11=$admit_todayss1->fetch_assoc();
             $admit_limit=$admit_todayss11['data_limit'];
            // end master limit admit patient
            
            
            
              $value=date('d',strtotime($ADV_DAY1)); 
	           if ($value % 2) {
                 //$admit_limit=$admit_todayss11['data_limit'] + 2;
                 $admit_limit=$admit_todayss11['data_limit'];
                } 
                else 
                {
                   $admit_limit=$admit_todayss11['data_limit'] + 1;
                }
            
               /* $value=date('d',strtotime($ADV_DAY1)); 
	           if ($value % 2) {
                 $admit_limit=$admit_todayss11['data_limit'];
                } else {
                   $admit_limit=$admit_todayss11['data_limit'] - 1;
                }*/
            
            
             //master limit occupancy patient
             $occupancy_todays_limit = "SELECT * FROM occupancy_limit";
	         $occupancy_todayss1 = $mysqli->query($occupancy_todays_limit);
	         $occupancy_todayss11=$occupancy_todayss1->fetch_assoc();
             $occupancy_limit=$occupancy_todayss11['data_limit'];
            // end master limit occupancy patient
            
            
            //occupancy_todays  
	        $occupancy_todays = "SELECT * FROM patient_ipd WHERE  discharge_date ='0000-00-00' AND ipd_opd ='ipd'";
	        $occupancy_todayss = $mysqli->query($occupancy_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_occupancy_todays=$occupancy_todayss->num_rows;
            echo "<br>today_total_occupancy ".$total_occupancy_todays."<br>";
            // end occupancy_todays
            
            //master limit discharge patient
             $discharge_todays_limit = "SELECT * FROM discharge_patient_limit";
	         $discharge_todayss1 = $mysqli->query($discharge_todays_limit);
	         $discharge_todayss11=$discharge_todayss1->fetch_assoc();
             $discharge_limit=$discharge_todayss11['data_limit'];
            // end master limit discharge patient
            
            ////// if($total_occupancy_todays < 80)
            ////// { 
            //////      $admit_limit=$admit_todayss11['data_limit'] + 3;
            ////// }elseif($total_occupancy_todays > 90)
            ////// {
            //////      $discharge_limit=$discharge_todayss11['data_limit'] + 5;
            ////// }
          /*  if($total_occupancy_todays < 40)
            { 
                 $admit_limit = rand(6,9);
            }elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            {
                 $admit_limit = -1;
            }
            elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            {
                $admit_limit = 9;
            }
            else{
                $admit_limit = $admit_todayss11['data_limit'];
            }
            
            */
            
             if(date('Y',strtotime($ADV_DAY1)) == '2019'){
                if($total_occupancy_todays <= 30)
                { 
                     $admit_limit = rand(4,7);
                }
                elseif($total_occupancy_todays >= 35)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 30 && $total_occupancy_todays < 35)
                {
                    $admit_limit = 3;
                }
                else
                {
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2020')
            {
                if($total_occupancy_todays <= 45)
                { 
                     $admit_limit = rand(9,10);
                }
                elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 45 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 5;
                }
                else
                {
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2021')
            {
                if($total_occupancy_todays <= 55)
                { 
                     $admit_limit = rand(6,8);
                }
                elseif($total_occupancy_todays >= 60)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 55 && $total_occupancy_todays < 60)
                {
                    $admit_limit = 8;
                }
                else
                {
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2022')
            {
                if($total_occupancy_todays <= 40)
                { 
                     $admit_limit = rand(8,10);
                }
                elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 8;
                }
                else
                {
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
         elseif(date('Y',strtotime($ADV_DAY1)) == '2023'){
                if($total_occupancy_todays <= 45)
                { 
                     $admit_limit = rand(8,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 45 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }



              elseif(date('Y',strtotime($ADV_DAY1)) == '2024')
              {
                 if($admit_todayss11['data_limit'] !='-1'){
                if($total_occupancy_todays <= 65)
                { 
                     $admit_limit = rand(15,20);
                }elseif($total_occupancy_todays >= 75)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 65 && $total_occupancy_todays < 75)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
               }
            }

              elseif(date('Y',strtotime($ADV_DAY1)) == '2025')
              {
                 if($admit_todayss11['data_limit'] !='-1'){
                if($total_occupancy_todays <= 60)
                { 
                     $admit_limit = rand(15,20);
                }elseif($total_occupancy_todays >= 65)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 60 && $total_occupancy_todays < 65)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
               }
            }
            
           
            // random discharge limit end
            
            
            echo "<br>today_total_admit_limit ".$admit_limit."<br>";
            
            //discharge_todays  
	        $discharge_todays1='%'.$ADV_DAY1.'%';
	        $discharge_todays = "SELECT * FROM patient_ipd WHERE  discharge_date LIKE  '$discharge_todays1' AND ipd_opd ='ipd'";
	        $discharge_todayss = $mysqli->query($discharge_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_discharge_todays=$discharge_todayss->num_rows;
            echo "<br>today_total_discharge ".$total_discharge_todays."<br>";
            echo "<br>today_total_discharge_limit ".$discharge_limit."<br>";
            // end discharge_todays
            
            // discharge patient 
            echo  "<br>current date for discharge ".$date_discharge = $ADV_DAY;
            echo "<br>";
            echo "strat date for discharge ".$date_discharge1=$ADV_DAY1." 01:00";
            echo "<br>";
            echo "end date for discharge ".$date_discharge2 = $ADV_DAY1." 23:45";
            
            //if($total_discharge_todays < $discharge_limit){
            
                // $rand_dis=rand(6,10);
                // $old_date_dis=date('Y-m-d', strtotime("-$rand_dis days", strtotime($ADV_DAY1)));
                // $old_date_dis1='%'.$old_date_dis.'%';
                // //echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd'  LIMIT 1";
                // /////echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd' or DATEDIFF('$ADV_DAY1', create_date) > '$rand_dis' AND discharge_date ='0000-00-00' AND ipd_opd ='ipd' LIMIT 1";
                // echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd' or DATEDIFF('$ADV_DAY1', '$old_date_dis') > '$rand_dis' AND discharge_date ='0000-00-00' AND ipd_opd ='ipd' LIMIT 1";
                // $discharge_patient1 = $mysqli->query($discharge_patient);
                // $discharge_patient2 = $discharge_patient1->fetch_assoc();
                // $dis_id = $discharge_patient2['id'];
                // $master_id_dis = $discharge_patient2['master_g_id'];
                // $bed_remove=$discharge_patient2['bedNo'];
                if($discharge_todayss11['data_limit']!='-1'){
                echo '<br>';
                echo $Check_discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date < '$ADV_DAY1' AND ipd_opd ='ipd' order by rand() LIMIT 1";
                //////echo $Check_discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date < '$ADV_DAY1' AND ipd_opd ='ipd' LIMIT 1";
                $Check_discharge_patient1 = $mysqli->query($Check_discharge_patient);
                $Check_discharge_patient2 = $Check_discharge_patient1->fetch_assoc();
                
                $che=trim($Check_discharge_patient2['dignosis']);
                $len=strlen($che);
                $dd= substr($che,$len - 1);
                $str = $Check_discharge_patient2['dignosis'];
                $arry=explode("-",$str);
                $t_c=count($arry);
                if($t_c=='2')
                {
                    $dd1=substr($che, 0, -1);
                    $new_str = trim($arry[0]);
                    $dis_dia = '%'.$new_str.'%';
                    $dis_p_dignosis_name=$Check_discharge_patient2['dignosis'];
                }
                else
                {
                    $dis_dia = '%'.$che.'%';
                    $dis_p_dignosis_name=$Check_discharge_patient2['dignosis'];
                }
                $dis_proxy_id = $Check_discharge_patient2['proxy_id'];
                $dis_department_id = $Check_discharge_patient2['department_id'];
                $dis_p_id = $Check_discharge_patient2['id'];
                $dis_p_create_date = date('Y-m-d', strtotime($Check_discharge_patient2['create_date']));
                
                $tretment=$this->db->select("*")
                    ->from('treatments1')
                    ->where('dignosis LIKE',$dis_dia)
                    ->where('proxy_id',$dis_proxy_id)
                    ->where('department_id', $dis_department_id)
                    ->where('ipd_opd','ipd')
                    ->get()
                    ->row();
                $ipd_days= $tretment->ipd_days;      
                
                echo '<br>';
                echo $ipd_days;
                echo '<br>';
                
                $date1=date_create(date("Y-m-d", strtotime($dis_p_create_date)));
                $date2=date_create(date("Y-m-d", strtotime($ADV_DAY1)));
                $diff=date_diff($date1,$date2);
                $Days = $diff->d;
                echo '<br>';
                echo 'Discharge Diff. Days ==> '.$Days;
                echo '<br>';
                if($Days >= $ipd_days)
                {
                    echo '<br>';
                    echo 'Patient On Bed Days :- '.$Days.'<br>';
                    echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE id = '$dis_p_id' AND ipd_opd ='ipd'";
                    $discharge_patient1 = $mysqli->query($discharge_patient);
                    $discharge_patient2 = $discharge_patient1->fetch_assoc();
                    $dis_id = $discharge_patient2['id'];
                    $master_id_dis = $discharge_patient2['master_g_id'];
                    $bed_remove=$discharge_patient2['bedNo'];
                    ///////////}
                    //}
            
            
                    //   ////Treatment Wise Discharge
                    //   // disharge with numbers
                    //     $dis_create_date=$discharge_patient2['create_date'];
                    //     $dis_dia='%'.$discharge_patient2['dignosis'].'%';
                    //     $dis_proxy_id=$discharge_patient2['proxy_id'];
                    //     $tretment=$this->db->select("*")

			        //                    ->from('treatments1')

    			     //                    ->where('dignosis LIKE',$dis_dia)
    			     //                    ->where('proxy_id',$dis_proxy_id)
    			     //                    ->where('ipd_opd','ipd')
                    //                              ->get()
                    //                              ->row();
                    //         $ipd_days= $tretment->ipd_days;      
                
                    //         if($ipd_days <= 6){
                    //             $ipd_days=$ipd_days + 1;
                    //         }else{
                    //             $ipd_days=$ipd_days;
                                
                    //         }
                            
                    //         $date=date_create($dis_create_date);
                            
                    //         date_add($date,date_interval_create_from_date_string($ipd_days." days"));
                    //         if($ipd_days){
                    //          $date_of_dis=date_format($date,"Y-m-d");
                    //         }
                    //         else {
                    //           $date_of_dis=$ADV_DAY1;
                    //         }                            
            
                    echo "<br>dis id before".$dis_id;
              
              /////if(($date_discharge1 <= $date_discharge) && ($date_discharge2 >= $date_discharge) && ($total_discharge_todays <= $discharge_limit)){
            
            if(($date_discharge1 <= $date_discharge) && ($date_discharge2 >= $date_discharge))
            {
                //////////////if((date('Y-m-d',strtotime($date_discharge1)) <= date('Y-m-d',strtotime($date_discharge))) && (date('Y-m-d',strtotime($date_discharge2)) >= date('Y-m-d',strtotime($date_discharge)))){
                   echo "<br>discharge_id :".$dis_id."<br>";
                // $date_of_dis=$ADV_DAY;
            
                 $date_of_dis=$ADV_DAY1;
                 $query3 = "update patient_ipd set discharge_date = '$date_of_dis' where id = ".$dis_id;
                 $mysqli->query($query3);
                 if($master_id_dis){
                 $discharge_patient_nav = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND master_g_id ='$master_id_dis' AND ipd_opd ='ipd'";
                 $discharge_patient_nav1 = $mysqli->query($discharge_patient_nav);
                 $discharge_patient_nav2 = $discharge_patient_nav1->fetch_assoc();
                 $dis_id_nav = $discharge_patient_nav2['id']; 
                 
                 $query33 = "update patient_ipd set discharge_date = '$date_of_dis' where id = ".$dis_id_nav;
                 $mysqli->query($query33);
             }
             if($bed_remove)
             {
                 $query2222 = "update beds set status = 0 where id=".$bed_remove;
                      $mysqli->query($query2222);
                      
                       $query22222 = "update patient_ipd set bed_status = 0 where id = ".$dis_id;
                      $mysqli->query($query22222);
             }
             else
             {
                 
                 
             }
              }
                }

                }
            //end discharge patient
            
             
            
        
        
              $m=0;
              $j=1;
              $ipd_opd2='opd';
              $ipd_opd='ipd';
              
             $adress_def=array();
             $address = "SELECT * FROM address";
             $address1 = $mysqli->query($address);
	         while($address2=$address1->fetch_assoc()){
	        // $auto_on_off2['description']."<br>";
	           array_push($adress_def,$address2['name']);
	         }
	         
	         

        while($row = $result->fetch_assoc()) {
              $m++;
              if(($row['SEX']=='M') && ($row['VIBHAG'] !=32)){
                  
	              $occupation= array('Farmer','Office','Business','Job','Labor','Jobless','Teacher','other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
              	
	         }
	         else if(($row['SEX']=='F') && ($row['VIBHAG'] !=32)){
	              $occupation= array('Farmer','Office','Business','Job','Labor','Jobless','Teacher','other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
	         }
	         else{
	              $occupation= array('Student','other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
                  $key = array_rand($a);
	         }
	          
	          
	          $c_o=$row['NIDAN'];
	         $h_o='NAD';
	         $f_o='NAD';
	         $bp=array('130/80','124/86','128/88','116/90','110/70','126/84','132/72','120/60','122/90');
	         $nadi=array('मंडूकगति', 'सर्पगती ' , 'हंसगति','अविशेष');
             $Pulse =array(76,78,88,90,68,72,82,66,74,92,64);
             $ur= 'अविशेष';
             $cvs ='S1S2 N';
             $udar='soft';
             $netra=array('आविल','अच्छ','इषतपीत') ;
             $givwa=array('साम','निराम');
            $$sudha=array('तीक्ष्णाग्नि', 'समाग्नि', 'विषमाग्नि');     
            
             $ahar=array('प्रभुत ','अल्प ','मध्यम');
             $mal=array('साम ','निराम ','कठीण ','दुर्गंधीयुक्त ','अविशेष');
             $mutra=array('पीत','आविल','दुर्गंधीयुक्त','अविशेष');
             $nidra=array('अविशेष','प्रभुत','अल्प');

              $key = array_rand($a); 
	          $a[$key];
	          $key1 =array_rand($occupation);
	          $occupation[$key1];
	          $key2=array_rand($adress_def);
	          $adress_def[$key2];
	          
	          
	          $c_o1=array_rand($c_o);
	          $c_o[$c_o1];
	          
	          $bp1=array_rand($bp);
	          $bp[$bp1];
	          
	          $nadi1=array_rand($nadi);
	          $nadi[$nadi1];
	          
	          $Pulse1=array_rand($Pulse);
	          $Pulse[$Pulse1];
	          
	          $netra1=array_rand($netra);
	          $netra[$netra1];
	          
	           $givwa1=array_rand($givwa);
	           $givwa[$givwa1];
	           
	           
	           $sudha1=array_rand($sudha);
	           $sudha[$sudha1];
	           
	           $ahar1=array_rand($ahar);
	           $ahar[$ahar1];
	           
	           $mal1=array_rand($mal);
	           $mal[$mal1];
	           
	           $mutra1=array_rand($mutra);
	           $mutra[$mutra1];
	           
	           $nidra1=array_rand($nidra);
	           $nidra[$nidra1];
	           
	           $ruduce =array(10,25,50,75);
               $ruduce1=array_rand($ruduce);
	           $ruduce[$ruduce1];
	           
	          
              if($j == 1){
               $date_new = date('Y-m-d H:i',strtotime('- 10 minutes'))."<br>";
              }
              else if($j == 2){
               $date_new = date('Y-m-d H:i',strtotime('- 7 minutes'))."<br>";
              }
               else if($j == 3){
               $date_new = date('Y-m-d H:i',strtotime('- 4 minutes'))."<br>";
              }
               else if($j == 4){
               $date_new = date('Y-m-d H:i',strtotime('- 2 minutes'))."<br>";
              }
               
              else {
              $date_new =$ADV_DAY."<br>";
              }
             $date_new1=$ADV_DAY1;
              $j++;
                if(empty($row['CopddD_New'])){
                    $CopddD_New=NULL;
                    $Copdd_Old=$row['Copdd_Old'];
                      echo "<br>Sno: " . $row["Sno"]. " - Name: " . $row["NAME"]."<br>";
                      
                      if($row["NAME"]){
	                  $query1 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,sym_reduce_per) values('".$row["Sno"]."','".$row["yealry_number"]."','".$row['Daily']."','".$row['Monthly']."','".$Copdd_Old."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_new1."','".$a[$key]."','".$occupation[$key1]."' ,'".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$ruduce[$ruduce1]."')";
                      $yes=$mysqli->query($query1); 
                       if($yes){
			          $query2 = "update items set flag=1 where Sno=".$row["Sno"];
                      $mysqli->query($query2);
                      }
                      }
            //MASTER GARBHINI INSERT INTO PATIENT
            $month=date('m');
           
            $year = '%'.$this->session->userdata['acyear'].'%';
            $year1=$this->session->userdata['acyear'];
            $d=cal_days_in_month(CAL_GREGORIAN,$month,$year1);
            $dd='%GARBHINI-SR%';
            $start_date=$year1.'-'.$month.'-01 00:00:00';
            //echo "<br>";
            $end_date=$year1.'-'.$month.'-'.$d.' 23:59:00'; 
           
             $auto_on_off = "SELECT count(*) as total FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date'";
          
	         $auto_on_off1 = $mysqli->query($auto_on_off);
	         $auto_on_off2=$auto_on_off1->fetch_assoc();
             $auto_on_off3=$auto_on_off2['total'];
            
            $rand =rand(4,5);
           
            if($auto_on_off3 <= $rand){
              
                
               $G= "SELECT * FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date' ORDER BY id DESC LIMIT 1";
               $G1 = $mysqli->query($G);
	           $G2=$G1->fetch_assoc();
               $G3= date('Y-m-d',strtotime($G2['create_date']));
               $today=date('Y-m-d');
               $datetime1 = date_create($G3); 
               $datetime2 = date_create($today); 
  
               $interval = date_diff($datetime1, $datetime2); 
               $interval1=$interval->format('%a'); 
               $rand1=rand(4,6);
               if($interval1 <= $rand1){
                  // echo "no";
                   
                         
               }else{
                   // echo "yes";
                    $last_id = "SELECT * FROM patient where create_date LIKE '$year' and  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $last_id1 = $mysqli->query($last_id);
	                $last_id2=$last_id1->fetch_assoc();
	                     $patient_id=$last_id2['patient_id'] + 1;
                         $yearly_reg_no=$last_id2['yearly_reg_no'] + 1;
                         $year_no = $last_id2['yearly_no'] + 1;
                         $daily_reg_no = $last_id2['daily_reg_no'] + 1;
                        // $old_reg_no = $last_id2['old_reg_no'] + 1;
                        
                        $master_gar = "SELECT * FROM garbhini_navjat where status ='0'  ORDER BY id DESC LIMIT 1";
                        $master_gar1 = $mysqli->query($master_gar);
	                    $master_gar2=$master_gar1->fetch_assoc();
                        $master_id=$master_gar2['id'];
                         
                      if($m == 1){  
                    if($master_gar2['m_name']){
                      $date_new1=$ADV_DAY1;
                      if($master_gar2['m_name']){
                      $query1 = "insert into patient(patient_id,yearly_reg_no,yearly_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,master_g_id,follow_up,wieght,occupation) values('".$patient_id."','".$yearly_reg_no."','".$year_no."','".$daily_reg_no."','','".$master_gar2['m_name']."','".$master_gar2['sex']."','".$master_gar2['age']."','".$adress_def[$key2]."','".$master_gar2['department_id']."','".$master_gar2['dignosis']."','".$master_gar2['ipd_opd']."','','','".$date_new1."','".$master_gar2['id']."','".$master_gar2['follow_up']."','".$a[$key]."','".$occupation[$key1]."')";
                      $mysqli->query($query1);
			          $query2 = "update garbhini_navjat set status=1 where id=".$master_id;
                      $mysqli->query($query2);
                      }
                          
                      }
                          
                      }     
                   }

                   } else {
                   echo "No garbhini limit over";
                  }
                      //END GARBHINI
                      
                      
              
                     if(($single_record == $m ) && ($total_admit_todays <= $admit_limit)){
                  
                   
                      //if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit) && ($total_discharge_todays <= $discharge_limit)) {
                      if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit)) {
                          if(($row['VIBHAG'] == '35') || ($row['VIBHAG'] == '28')){
                          }
                          else{
                          
                          $gender1=$row['SEX'];
                          $depart_id1= $row['VIBHAG'];
                          
                        if($depart_id1 == '28'){
                            $depart_id='34';
                        }else{
                             $depart_id= $row['VIBHAG'];
                        }
                        
                        $dep_bed_limit = "SELECT * FROM data_lmit_dept_ipd where dept_id=".$depart_id;
            	         $dep_bed_limit1 = $mysqli->query($dep_bed_limit);
            	         $dep_bed_limit11=$dep_bed_limit1->fetch_assoc();
            	         
            	         if($SEX_Check=='M'){
                         $data_limit=$dep_bed_limit11['data_limit_m'];
            	         }else{
            			 $data_limit=$dep_bed_limit11['data_limit_f'];
            	         }
            	         
            	         $dep_bed_limit_total=$data_limit;
                        // end master data_lmit_dept_ipd
            			
            			 //patient check in bed with gender
            	          $check_bed = "SELECT * FROM patient_ipd where discharge_date LIKE '%0000-00-00%' and  sex='$SEX_Check' and department_id=".$depart_id;
            	          $bed_status1 = $mysqli->query($check_bed);
            	          echo "//////////////////";  echo "<br>";
            	          echo "depart_id:".$depart_id;
            	          echo "//////////////////";  echo "<br>";
            	         echo  '$dep_bed_limit_total :'.$dep_bed_limit_total;
            	         echo "<br>";
            	         echo "//////////////////";
            	         echo  'bed_status_total :'.$bed_status_total=$bed_status1->num_rows;
            	         echo "//////////////////";
            	        // end patient check in bed with gender
                        
                         $bed = "SELECT * FROM beds WHERE gender ='$gender1' AND department_id ='$depart_id' AND status ='0' LIMIT  1";
                         $bed_no = $mysqli->query($bed);
	                     $bed_no1=$bed_no->fetch_assoc(); 
	                       if ($bed_no1) {
                            $admit_bed=$bed_no1['id'];
                            }else{
	                          $admit_bed ='';
	                        }
	                        //Admit only available diagnosis in ipd
	                    //$nivan=$row['NIDAN']."I";
	                    //$nivan1='%'.$nivan.'%';
	                    
                        $che=trim($row['NIDAN']);
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $row['NIDAN'];
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $nivan = '%'.$new_str.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }else{
                            $nivan = '%'.$che.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }
	                    echo $nivan1 = $nivan;
	                    
	                    $proxy_id = $row['proxy_id'];
	                    //$department_id = $row['VIBHAG'];
	                    $department_id = $depart_id;
	                    
	                    $admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND proxy_id = '$proxy_id' AND department_id = '$department_id' AND ipd_opd ='ipd'";
                        $admit_avai_diagnosis1 = $mysqli->query($admit_avai_diagnosis);
	                    $admit_avai_diagnosis2=$admit_avai_diagnosis1->fetch_assoc(); 
	                    
	                    echo "<br>=====> 1 ";
	                    print_r($admit_avai_diagnosis2);
	                    echo "<br><br><br>"; 
	                    
	                    if($bed_status_total < $dep_bed_limit_total){ 
	                   // if($admit_avai_diagnosis2){ 
	                   if($admit_avai_diagnosis2 && $admit_bed != ''){ 
	                        
	                        $bed_status='1';
                      $query12 = "insert into patient_ipd(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,bedNo,bed_status,discharge_date,create_date) values('".$row["Sno"]."','".$row["yealry_number"]."','".$row['Daily']."','".$row['Monthly']."','".$row['Copdd_Old']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$row['Address']."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd."','".$row1['ipd_no']."','".$admit_bed."','".$bed_status."','".$row['Dischargedate']."','".$date_new."')";
                      $mysqli->query($query12); 
                      $query22 = "update patient_ipd set ipd_flag = 1 where patient_id=".$row["Sno"];
                      $mysqli->query($query22);
                      
                      $query222 = "update beds set status = 1 where id=".$admit_bed;
                      $mysqli->query($query222);
	                    }
                       }
                        }
                      }
                      else {
                         echo "<br>no admit<br>";
                       
                     }
                   }
                }
                else {
                    //$CopddD_New=$row['CopddD_New'];
                    
                    // CJOB Auto Push Code Start ------------------------------------------------------------
                    
                    //$CopddD_New=$row['CopddD_New'];
                    $tempQuery1 = "SELECT * FROM  patient ORDER BY id DESC LIMIT 1";
                    $tempQueryResult1 = $mysqli->query($tempQuery1);
	                $tempQueryRow1=$tempQueryResult1->fetch_assoc();
	                /*print_r($tempQueryRow1);
	                die();*/
	               
                    $tempQuery = "SELECT * FROM  patient WHERE  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $tempQueryResult = $mysqli->query($tempQuery);
	                $tempQueryRow=$tempQueryResult->fetch_assoc();
	                /*print_r($tempQueryRow);
	                die();*/
                    //$CopddD_New=$row['CopddD_New'];
                    $CopddD_New=$tempQueryRow['yearly_reg_no']+1;
                    
                    // CJOB Auto Push Code End ----------------------------------------------------------------
                    
                    
                    //check dublicate New Yearly Number
                     $d_number=date('Y',strtotime($ADV_DAY1));
                     $d_number_like='%'.$d_number.'%';
	                 $check_number = "SELECT * FROM patient WHERE  create_date LIKE  '$d_number_like' AND ipd_opd ='opd' AND yearly_reg_no ='$CopddD_New'";
	                 $check_number_q = $mysqli->query($check_number);
	                 $check_number_result=$check_number_q->num_rows;
                     //check dublicate New Yearly Number end 
                    
                    

                     $Copdd_Old=NULL;
                     $date_new1=$ADV_DAY1;
                     echo "<br>Sno: " . $row["Sno"]. " - Name: " . $row["NAME"]."<br>";
                     if($check_number_result==0){
                     if($row["NAME"]){
                          $year_new = date('Y',strtotime($date_new1));
                        $check_last_record = "select * from patient where year(create_date)  = '$year_new' AND yearly_reg_no = '$CopddD_New'";
                        $check_last_record1 = $mysqli->query($check_last_record);
                        $check_last_record2=$check_last_record1->num_rows;
                        if($check_last_record2 >= 1)
                        {

                        }
                        else
                        {
	                  //$query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id) values('".$row["Sno"]."','".$row["yealry_number"]."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row['proxy_id']."')";
	                  $query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id) values('".$CopddD_New."','".$CopddD_New."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row['proxy_id']."')";
                      //$mysqli->query($query1);
                     $yes= $this->db->query($query1);
                     // echo $query1;
                     if($yes){
			          $query2 = "update items set flag=1 where Sno=".$row["Sno"];
                      $mysqli->query($query2);
                     }
                        }
                     }
                     }
                      
                      //MASTER GARBHINI INSERT INTO PATIENT
            $month=date('m');
           
            $year = '%'.$this->session->userdata['acyear'].'%';
            $year1=$this->session->userdata['acyear'];
            $d=cal_days_in_month(CAL_GREGORIAN,$month,$year1);
            $dd='%GARBHINI-SRiiii%';
            $start_date=$year1.'-'.$month.'-01 00:00:00';
            //echo "<br>";
            $end_date=$year1.'-'.$month.'-'.$d.' 23:59:00'; 
           
             $auto_on_off = "SELECT count(*) as total FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date'";
          
	         $auto_on_off1 = $mysqli->query($auto_on_off);
	         $auto_on_off2=$auto_on_off1->fetch_assoc();
             $auto_on_off3=$auto_on_off2['total'];
            
            $rand =rand(4,5);
           
            if($auto_on_off3 <= $rand){
              
                
               $G= "SELECT * FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date' ORDER BY id DESC LIMIT 1";
               $G1 = $mysqli->query($G);
	           $G2=$G1->fetch_assoc();
               $G3= date('Y-m-d',strtotime($G2['create_date']));
               $today=date('Y-m-d');
               $datetime1 = date_create($G3); 
               $datetime2 = date_create($today); 
  
               $interval = date_diff($datetime1, $datetime2); 
               $interval1=$interval->format('%a'); 
               $rand1=rand(4,6);
               if($interval1 <= $rand1){
                  // echo "no";
                   
                         
               }else{
                   //echo "yes";
                    $last_id = "SELECT * FROM patient where create_date LIKE '$year' and  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $last_id1 = $mysqli->query($last_id);
	                $last_id2=$last_id1->fetch_assoc();
	                     $patient_id=$last_id2['patient_id'] + 1;
                         $yearly_reg_no=$last_id2['yearly_reg_no'] + 1;
                         $year_no = $last_id2['yearly_no'] + 1;
                         $daily_reg_no = $last_id2['daily_reg_no'] + 1;
                        // $old_reg_no = $last_id2['old_reg_no'] + 1;
                        
                        $master_gar = "SELECT * FROM garbhini_navjat where status ='0'  ORDER BY id DESC LIMIT 1";
                        $master_gar1 = $mysqli->query($master_gar);
	                    $master_gar2=$master_gar1->fetch_assoc();
                        $master_id=$master_gar2['id'];
                         
                        $date_new1=$ADV_DAY1;
                         if($m == 1){ 
                             if($master_gar2['m_name']){
                      $query1 = "insert into patient(patient_id,yearly_reg_no,yearly_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,master_g_id,follow_up,wieght,occupation) values('".$patient_id."','".$yearly_reg_no."','".$year_no."','".$daily_reg_no."','','".$master_gar2['m_name']."','".$master_gar2['sex']."','".$master_gar2['age']."','".$adress_def[$key2]."','".$master_gar2['department_id']."','".$master_gar2['dignosis']."','".$master_gar2['ipd_opd']."','','','".$date_new1."','".$master_gar2['id']."','".$master_gar2['follow_up']."','".$a[$key]."','".$occupation[$key1]."')";
                      $mysqli->query($query1);
			          $query2 = "update garbhini_navjat set status=1 where id=".$master_id;
                      $mysqli->query($query2);
                             }
                         }          
               }

            } else {
                echo "No garghan limit over";
            }
                      //END GARBHINI
              
                     if(($single_record == $m  ) && ($total_admit_todays <= $admit_limit)){
                  
                  
                      if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit)) {
                            if(($row['VIBHAG'] == '35') || ($row['VIBHAG'] == '28')){
                          }
                          else{
                               echo "ADMITTTTTTTTA";
                          $gender1=$row['SEX'];
                          $depart_id1= $row['VIBHAG'];
                           if($depart_id1 == '28'){
                            $depart_id='34';
                        }else{
                             $depart_id= $row['VIBHAG'];
                        }
                        
                        
                        /////////////////////////////######## IPF CASE PAPER############//////////////////
                         $hb =array(11.5,12.0,12.5,13.0,13.5,14.0,14.5);
	                     $hb1=array_rand($hb);
	                     $hb[$hb1];
	                     
	                     $TLC =array(4000,4500,5000,5500,6000,6500,7000,7500,8000,8500,9000,9500,10000,11000);
	                     $TLC1=array_rand($TLC);
	                     $TLC[$TLC1];
	                     
	                     
	                     $DLC_Neutro =array(50,55,60,65,70);
	                     $DLC_Neutro1=array_rand($DLC_Neutro);
	                     $DLC_Neutro[$DLC_Neutro1];
	                     
	                     $Lymphocytes =array(20,25,30,35,40);
	                     $Lymphocytes1=array_rand($Lymphocytes);
	                     $Lymphocytes[$Lymphocytes1];
	                     
	                     
	                     $Monocytes =array(1,2,3,4);
	                     $Monocytes1=array_rand($Monocytes);
	                     $Monocytes[$Monocytes1];
	                     
	                     $Eosinophils =array(0.1,0.2,0.3,0.4);
	                     $Eosinophils1=array_rand($Eosinophils);
	                     $Eosinophils[$Eosinophils1];
	                     
	                     
	                     $ESR =array(10,14,16,18,20);
	                     $ESR1=array_rand($ESR);
	                     $ESR[$ESR1];
	                     
	                    
	                     
	                     $Platelet_Count=array(1.5,2.0,2.5,3.0,3.5,4.0,4.5);
	                     $Platelet_Count1=array_rand($Platelet_Count);
	                     $Platelet_Count[$Platelet_Count1];
                        
                         $B_Sugar=array(70,80,90,100,110);
	                     $B_Sugar1=array_rand($B_Sugar);
	                     $B_Sugar[$B_Sugar1];
	                     
	                     $Blood_Sugar=array(110,120,130,140,150);
	                     $Blood_Sugar1=array_rand($Blood_Sugar);
	                     $Blood_Sugar[$Blood_Sugar1];
	                     
	                     $Blood_Urea=array(20,25,30,35,40);
	                     $Blood_Urea1=array_rand($Blood_Urea);
	                     $Blood_Urea[$Blood_Urea1];
	                     
	                     $S_Creatinine=array(0.4,0.5,0.7,0.9,1.2,1.4);
	                     $S_Creatinine1=array_rand($S_Creatinine);
	                     $S_Creatinine[$S_Creatinine1];
                        
                         $S_Uric_Acid=array(2,3,4,5,6);
	                     $S_Uric_Acid1=array_rand($S_Uric_Acid);
	                     $S_Uric_Acid[$S_Uric_Acid1];
	                     
	                     $SNat	=array(135,140,145,150,155);
	                     $SNat1=array_rand($SNat);
	                     $SNat[$SNat1];
	                     
	                     
	                     
	                     
	                     $SK=array(3.5,4.0,4.5,5.0,5.5);
	                     $SK1=array_rand($SK);
	                     $SK[$SK1];
	                     
	                     $Total_Cholestrol=array(150,160,170,180,190,200);
	                     $Total_Cholestrol1=array_rand($Total_Cholestrol);
	                     $Total_Cholestrol[$Total_Cholestrol1];
	                     
	                     $STg=array(60,80,90,100,120,140,150,160,170);
	                     $STg1=array_rand($STg);
	                     $STg[$STg1];
	                     
	                     
	                     $HDL=array(30,40,50,60,70);
	                     $HDL1=array_rand($HDL);
	                     $HDL[$HDL1];
	                     
	                     $LDL=array(110,120,130,140,150);
	                     $LDL1=array_rand($LDL);
	                     $LDL[$LDL1];
	                     
	                     $VLDL=array(14,15,18,20,25,28,34,36,38,42,44,45);
	                     $VLDL1=array_rand($VLDL);
	                     $VLDL[$VLDL1];
	                     
	                     
	                     $atime=array('9:00','9:05','9:10','09:15','09:20','09:30');
	                     $atime1=array_rand($atime);
	                     $atime[$atime1];
	                     
	                     $dtime=array('9:15','9:30','9:45','10:00','10:30','10:45');
	                     $dtime1=array_rand($dtime);
	                     $dtime[$dtime1];
	                     
	                     $phone=array(98,97,96,94);
	                     $phone1=array_rand($phone);
	                     $phone[$phone1];
	                     
	                     $digits = 8;
                         $digi8=rand(pow(10, $digits1),pow(10,$digits)-1);
                         $phonedigit10=$phone[$phone1].$digi8;
                         
                         
                         //##
                         $BillirubinT=array(0.1,0.2,0.4,0.8,0.5);
	                     $BillirubinT1=array_rand($BillirubinT);
	                     $BillirubinT[$BillirubinT1];
	                     
	                     $BillirubinI=array(0.3,0.7,0.4,0.8,0.5);
	                     $BillirubinI1=array_rand($BillirubinI);
	                     $BillirubinI[$BillirubinI1];
                        
                         $Color=array('Yellow','Brown','Dark Brown','Black');
	                     $Color1=array_rand($Color);
	                     $Color[$Color1];
	                     
	                     $MUCOUS=array('+++','++++');
	                     $MUCOUS1=array_rand($MUCOUS);
	                     $MUCOUS[$MUCOUS1];
	                     
	                     $Comsistency=array('Liguid','Semi Solid','Solid','Hard');
	                     $Comsistency1=array_rand($Comsistency);
	                     $Comsistency[$Comsistency1];
	                     
	                     $raj=array('सामान्य ','अप्रवृत्ती ','अतिप्रवृत्ती ','अल्प प्रवृत्ती – काल');
	                     $raj1=array_rand($raj);
	                     $raj[$raj1];
	                     
	                     
	                     $samajik=array('Medium','Average', 'Above Poverty Line','Below Poverty Line','Poor','Modirate');
	                     $samajik1=array_rand($samajik);
	                     $samajik[$samajik1];
	                     
	                     $aharfood=array('Non vegetarian','Vegetarian', 'Non vegetarian +  Vegetarian');
	                     $aharfood1=array_rand($aharfood);
	                     $aharfood[$aharfood1];
	                     
	                     
	                     $aharghatak=array('Medium','Average', 'Above average','Below average','Poor');
	                     $aharghatak1=array_rand($aharghatak);
	                     $aharghatak[$aharghatak1];
	                     
	                     
	                     $nidtra=array('Normal');
	                     $nidtra1=array_rand($nidtra);
	                     $nidtra[$nidtra1];
	                     
	                     
	                     $vyasan=array('Tea','Coffee','Tobacco','Smoking');
	                     $vyasan1=array_rand($vyasan);
	                     $vyasan[$vyasan1];
	                     
	                     $mutrapra=array('4-Yellow','5-Faint yellow','6-Dark yellow','7-Pale Yellow','8-Yellow');
	                     $mutrapra1=array_rand($mutrapra);
	                     $mutrapra[$mutrapra1];
	                     
	                     
	                     $urine=array('NAD','NILL');
	                     $urine1=array_rand($urine);
	                     $urine[$urine1];
	                     
	                     $purushpra=array('1-Yellow','2-Dark yellow','1-Brown','2-Dark yellow','1-Dark Brown','2-blackest');
	                     $purushpra1=array_rand($purushpra);
	                     $purushpra[$purushpra1];
	                     
	                     $apanwayu=array('NAD','Normal','Excessive');
	                     $apanwayu1=array_rand($apanwayu);
	                     $apanwayu[$apanwayu1];
                        
                        
                         $koshth=array('क्रूर','मध्यम ','मृदू');
	                     $koshth1=array_rand($koshth);
	                     $koshth[$koshth1];
	                     
	                     
	                     $samanyaatur=array('Pitta','Vata','Pittakapha','Vatapitta','VataKaPha','Sam');
	                     $samanyaatur1=array_rand($samanyaatur);
	                     $samanyaatur[$samanyaatur1];
	                     
	                     
	                     $tap=array('96.5','96','97.5','97');
	                     $tap1=array_rand($tap);
	                     $tap[$tap1];
	                     
	                     
	                     $sharir=array('Medium','Modrate','Well built','Thin','Central Obesity');
	                     $sharir1=array_rand($sharir);
	                     $sharir[$sharir1];
	                     
	                     $aharshakti=array('Medium','Strong');
	                     $aharshakti1=array_rand($aharshakti);
	                     $aharshakti[$aharshakti1];
	                     
	                     
	                     $vyamshakti=array('Medium','Strong');
	                     $vyamshakti1=array_rand($vyamshakti);
	                     $vyamshakti[$vyamshakti1];
	                     
	                     $rand_no=rand(1,5);
	                     if($rand_no=='1'){
	                         $second='अल्पोपशय';$three='अल्पोपशय';$four='25';$five='50';$six='75';$seven='उपशय';$eight='उपशय';$nine='उपशय';
	                         
	                         $SPO2='88,90,92,91,93,94,96,97,98';
	                         $Input='2000,2020,2010,2060,2100,2080,2160,2140,2120';
	                         $Output='1600,1640,1680,1670,1720,1750,1800,1940,1960';
	                         
	                     }else if($rand_no=='2'){
	                         $second='25';$three='50';$four='75';$five='अल्पोपशय';$six='अल्पोपशय';$seven='अल्पोपशय';$eight='उपशय';$nine='उपशय';
	                        
	                         $SPO2='90,91,92,94,93,94,98,97,98';
	                         $Input='2010,2020,2040,2160,2100,2080,2160,2140,2120';
	                         $Output='1640,1650,1670,1670,1750,1780,1800,1940,1960';
	                     }
	                     else if($rand_no=='3'){
	                          $second='Same complaint';$three='10';$four='25';$five='50';$six='75';$seven='उपशय';$eight='उपशय';$nine='उपशय';
	                          
	                          $SPO2='92,91,92,88,93,94,98,96,98';
	                          $Input='2040,2020,2010,2060,2100,2090,2140,2140,2120';
	                          $Output='1750,1700,1680,1800,1850,1670,1680,1840,1940';
	                     }
	                     else if($rand_no=='4'){
	                         $second='10';$three='25';$four='50';$five='75';$six='उपशय';$seven='उपशय';$eight='अल्पोपशय';$nine='अल्पोपशय'; 
	                     
	                         $SPO2='89,90,91,93,94,94,97,96,98';
	                         $Input='2020,2020,2010,2080,2080,2180,2160,2140,2120';
	                         $Output='1680,1670,1700,1750,1840,1850,1900,1950,1950';
	                     }
	                     
	                     else if($rand_no=='5'){
	                          
	                         $second='Same complaint';$three='Same complaint';$four='10';$five='25';$six='50';$seven='75';$eight='अल्पोपशय';$nine='अल्पोपशय';
	                         
	                         $SPO2='89,88,90,94,94,94,96,97,98';
	                         $Input='2000,2010,2040,2030,2120,2080,2160,2140,2140';
	                         $Output='1600,1620,1690,1670,1740,1750,1800,1940,1960';
	                         
	                     }
	                     else{
	                           $second='';$three='';$four='';$five='';$six='';$seven='';$eight='';$nine='';
	                           
	                           $SPO2='88,91,90,88,93,95,97,96,98'; 
	                           $Input='2030,2020,2080,2060,2120,2080,2140,2150,2120';
	                           $Output='1640,1640,1690,1670,1720,1750,1840,1940,1980';
	                     }
	                     
	                     $gcondition=array('Fair','Moderate');
	                     $gcondition1=array_rand($gcondition);
	                     $gcondition[$gcondition1];
	                     
	                     $Scl=array('95','96','98','99','100','102','103','105');
	                     $Scl1=array_rand($Scl);
	                     $Scl[$Scl1];
	                     
	                     
	                     
	                    
	                     
	                     
                        
                       // ,'".$SPO2."','".$Input."','".$Output."','". $five."','".$six."','".$seven."','".$eight."'
                        
                      //  ,gcondition,Scl,Color,MUCOUS,Comsistency,raj,samajik,aharfood,aharghatak,nidtra,vyasan,mutrapra,urine,purushpra,apanwayu,koshth,samanyaatur,tap,sharir,aharshakti,vyamshakti
                        
                     //  ,'".$gcondition[$gcondition1]."','".$Scl[$Scl1]."','".$four[$four1]."','". $five[$five1]."','".$six[$six1]."','".$seven[$seven1]."','".$eight[$eight1]."','".$nine[$nine1]."','".$aharghatak[$aharghatak1]."','".$nidtra[$nidtra1]."','".$vyasan[$vyasan1]."','".$mutrapra[$mutrapra1]."','".$urine[$urine1]."','".$purushpra[$purushpra1]."','".$apanwayu[$apanwayu1]."','".$koshth[$koshth1]."','".$samanyaatur[$samanyaatur1]."','".$tap[$tap1]."','".$sharir[$sharir1]."','".$aharshakti[$aharshakti1]."','".$vyamshakti[$vyamshakti1]."'
                        
                        /////////////////////////////######## IPF CASE PAPER############//////////////////
                        
                        
                        $SEX_Check=$row['SEX'];
                        
                          //master data_lmit_dept_ipd
                         $dep_bed_limit = "SELECT * FROM data_lmit_dept_ipd where dept_id=".$depart_id;
            	         $dep_bed_limit1 = $mysqli->query($dep_bed_limit);
            	         $dep_bed_limit11=$dep_bed_limit1->fetch_assoc();
            	         
            	         if($SEX_Check=='M'){
                         $data_limit=$dep_bed_limit11['data_limit_m'];
            	         }else{
            			 $data_limit=$dep_bed_limit11['data_limit_f'];
            	         }
            	         
            	         $dep_bed_limit_total=$data_limit;
                        // end master data_lmit_dept_ipd
            			
            			 //patient check in bed with gender
            	          $check_bed = "SELECT * FROM patient_ipd where discharge_date LIKE '%0000-00-00%' and  sex='$SEX_Check' and department_id=".$depart_id;
            	          $bed_status1 = $mysqli->query($check_bed);
            	          echo "//////////////////";  echo "<br>";
            	          echo "depart_id:".$depart_id;
            	          echo "//////////////////";  echo "<br>";
            	         echo  '$dep_bed_limit_total :'.$dep_bed_limit_total;
            	         echo "<br>";
            	         echo "//////////////////";
            	         echo  'bed_status_total :'.$bed_status_total=$bed_status1->num_rows;
            	         echo "//////////////////";
            	        // end patient check in bed with gender
                        
                        
                         $bed = "SELECT * FROM beds WHERE gender ='$SEX_Check' AND department_id ='$depart_id' AND status ='0' LIMIT  1";
                         $bed_no = $mysqli->query($bed);
	                     $bed_no1=$bed_no->fetch_assoc(); 
	                       if ($bed_no1) {
                            $admit_bed=$bed_no1['id'];
                            }
                            else{
	                          $admit_bed ='';
	                        }
	                    
	                    
	                    //Admit only available diagnosis in ipd
	                   // $nivan=$row['NIDAN'];
	                   // $nivan1='%'.$nivan.'%';
	                    
	                    $che=trim($row['NIDAN']);
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $row['NIDAN'];
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $nivan = '%'.$new_str.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }else{
                            $nivan = '%'.$che.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }
	                    echo $nivan1 = $nivan;
	                    
	                    $proxy_id = $row['proxy_id'];
	                    $department_id = $depart_id;
	                    
	                    $admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND proxy_id = '$proxy_id' AND department_id = '$department_id' AND ipd_opd ='ipd'";
	                    
	                    //$admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND ipd_opd ='ipd'";
                        $admit_avai_diagnosis1 = $mysqli->query($admit_avai_diagnosis);
	                    $admit_avai_diagnosis2=$admit_avai_diagnosis1->fetch_assoc(); 
	                    
	                    echo "<br>=====> 2 ";
	                    print_r($admit_avai_diagnosis2);
	                    echo "<br><br><br>"; 
	                 
	                 if($bed_status_total < $dep_bed_limit_total){ 
	                 //if($admit_avai_diagnosis2){ 
	                 if($admit_avai_diagnosis2 && $admit_bed != ''){ 
	                  $bed_status='1';
                      $query12 = "insert into patient_ipd(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,bedNo,bed_status,discharge_date,create_date,Hb,TLC,DLC_Neutro,Lymphocytes,Monocytes,Eosinophils,ESR,Platelet_Count,B_Sugar,Blood_Sugar,Blood_Urea,S_Creatinine,S_Uric_Acid,SNat,SK,Total_Cholestrol,STg,HDL,LDL,VLDL,atime,dtime,phone,BillirubinT,BillirubinI,Color,MUCOUS,Comsistency,raj,samajik,aharfood,aharghatak,nidtra,vyasan,mutrapra,urine,purushpra,apanwayu,koshth,samanyaatur,tap,sharir,aharshakti,vyamshakti,second,three,four,five,six,seven,eight,nine,SPO2,Input,Output,proxy_id,gcondition,Scl) values('".$row["Sno"]."','".$row["yealry_number"]."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd."','".$row1['ipd_no']."','".$admit_bed."','".$bed_status."','".$row['Dischargedate']."','".$date_new1."','".$hb[$hb1]."','".$TLC[$TLC1]."','".$DLC_Neutro[$DLC_Neutro1]."','".$Lymphocytes[$Lymphocytes1]."','".$Monocytes[$Monocytes1]."','".$Eosinophils[$Eosinophils1]."','".$ESR[$ESR1]."','".$Platelet_Count[$Platelet_Count1]."','".$B_Sugar[$B_Sugar1]."','".$Blood_Sugar[$Blood_Sugar1]."','".$Blood_Urea[$Blood_Urea1]."','".$S_Creatinine[$S_Creatinine1]."','".$S_Uric_Acid[$S_Uric_Acid1]."','".$SNat[$SNat1]."','".$SK[$SK1]."','".$Total_Cholestrol[$Total_Cholestrol1]."','". $STg[$STg1]."','".$HDL[$HDL1]."','".$LDL[$LDL1]."','".$VLDL[$VLDL1]."','".$atime[$atime1]."','".$dtime[$dtime1]."','".$phonedigit10."','".$BillirubinT[$BillirubinT1]."','".$BillirubinI[$BillirubinI1]."','".$Color[$Color1]."','".$MUCOUS[$MUCOUS1]."','".$Comsistency[$Comsistency1]."','".$raj[$raj1]."','".$samajik[$samajik1]."','".$aharfood[$aharfood1]."','".$aharghatak[$aharghatak1]."','".$nidtra[$nidtra1]."','".$vyasan[$vyasan1]."','".$mutrapra[$mutrapra1]."','".$urine[$urine1]."','".$purushpra[$purushpra1]."','".$apanwayu[$apanwayu1]."','".$koshth[$koshth1]."','".$samanyaatur[$samanyaatur1]."','".$tap[$tap1]."','".$sharir[$sharir1]."','".$aharshakti[$aharshakti1]."','".$vyamshakti[$vyamshakti1]."','".$second."','".$three."','".$four."','". $five."','".$six."','".$seven."','".$eight."','".$nine."','".$SPO2."','".$Input."','".$Output."','".$row['proxy_id']."','".$gcondition[$gcondition1]."','".$Scl[$Scl1]."')";
                      //$mysqli->query($query12); 
                      $this->db->query($query12);
                      echo $query12;
                      $query22 = "update patient_ipd set ipd_flag = 1 where patient_id=".$row["Sno"];
                      $mysqli->query($query22);
                      
                      $query2222 = "update patient set flag = 1,ipd_patient_flag = 1 where yearly_reg_no='$CopddD_New' ORDER BY id DESC LIMIT 1";
                      $mysqli->query($query2222);
                      
                      $query222 = "update beds set status = 1 where id=".$admit_bed;
                      $mysqli->query($query222);
	                       }
                          }
                        }
                      }
                      else {
                         echo "<br>no admit<br>";
                       
                     }
                   }
                }
             
			     
       }
	 
	   
       echo "insert data succesfully using crone job(old-new...)" ;
       } 
      }
      else {
       echo "master data no available/Today's limit complete ";
      }  
		   

	}
	   
	else{
	   
	     
	   $rand=(rand(1,3));
       
   	   // CJOB Auto Push Code Start -------------------------------------------------------------
   
       //$sql = "SELECT * FROM items WHERE flag=0 AND Sno > $srno ORDER by id ASC LIMIT  $rand";
       $sql = "SELECT * FROM items WHERE flag=0  ORDER by id ASC  LIMIT  $rand";
    
        // CJOB Auto Push Code End ---------------------------------------------------------------
   
       $result = $mysqli->query($sql);
      
         if ($result->num_rows > 0) 
	   {
        
        
         //admit patient
           echo  "<br>current date for admit ".$date_admit = $ADV_DAY;
           echo "<br>";
           echo "strat date for admit ".$date_admit1=$ADV_DAY1." 01:45";
           echo "<br>";
           
           echo "end date for admit ".$date_admit2 = $ADV_DAY1." 23:45";
           echo "<br>";
           $sql_admit = "SELECT * FROM patient WHERE flag = 1 AND ipd_opd ='opd' AND ipd_flag = 0 LIMIT  1";
           $result_admit = $mysqli->query($sql_admit);
	       $row_admit=$result_admit->fetch_assoc();
	      
	       echo "$single_record".$single_record=$result_admit->num_rows;
	       //$old_date111=$row1['created_date'];
	       // end admit patient
	       
	       //admit_todays  
	        $admit_todays1='%'.$ADV_DAY1.'%';
	        $admit_todays = "SELECT * FROM patient_ipd WHERE  create_date LIKE  '$admit_todays1' AND ipd_opd ='ipd' AND ipd_flag = 1";
	         $admit_todayss = $mysqli->query($admit_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_admit_todays=$admit_todayss->num_rows;
            echo "<br>today_total_admit".$total_admit_todays."<br>";
            // end admit_todays
            
            
            
             //master limit admit patient
             $admit_todays_limit = "SELECT * FROM admit_patient_limit";
	         $admit_todayss1 = $mysqli->query($admit_todays_limit);
	         $admit_todayss11=$admit_todayss1->fetch_assoc();
             $admit_limit=$admit_todayss11['data_limit'];
            // end master limit admit patient
            
              $value=date('d',strtotime($ADV_DAY1)); 
	           if ($value % 2) {
                 //$admit_limit=$admit_todayss11['data_limit'] + 2;
                 $admit_limit=$admit_todayss11['data_limit'];
                } else {
                   $admit_limit=$admit_todayss11['data_limit'] + 1;
                }
            
            
            
            
             //master limit discharge patient
             $discharge_todays_limit = "SELECT * FROM discharge_patient_limit";
	         $discharge_todayss1 = $mysqli->query($discharge_todays_limit);
	         $discharge_todayss11=$discharge_todayss1->fetch_assoc();
             $discharge_limit=$discharge_todayss11['data_limit'];
             
            //////  if($total_occupancy_todays < 80)
            ////// { 
            //////      $admit_limit=$admit_todayss11['data_limit'] + 3;
            ////// }else if($total_occupancy_todays > 90)
            ////// {
            //////      $discharge_limit=$discharge_todayss11['data_limit'] + 5;
            ////// }
          /*  if($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            { 
                 $admit_limit = rand(6,9);
            }elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            {
                 $admit_limit = -1;
            }
            elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            {
                $admit_limit = 9;
            }
            else{
                $admit_limit = $admit_todayss11['data_limit'];
            }*/
             if(date('Y',strtotime($ADV_DAY1)) == '2019'){
                if($total_occupancy_todays <= 30)
                { 
                     $admit_limit = rand(4,7);
                }elseif($total_occupancy_todays >= 35)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 30 && $total_occupancy_todays < 35)
                {
                    $admit_limit = 3;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2020'){
                if($total_occupancy_todays <= 45)
                { 
                     $admit_limit = rand(9,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 45 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 5;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2021'){
                if($total_occupancy_todays <= 55)
                { 
                     $admit_limit = rand(6,8);
                }elseif($total_occupancy_todays >= 60)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 55 && $total_occupancy_todays < 60)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2022'){
                if($total_occupancy_todays <= 40)
                { 
                     $admit_limit = rand(8,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
              elseif(date('Y',strtotime($ADV_DAY1)) == '2023'){
                if($total_occupancy_todays <= 45)
                { 
                     $admit_limit = rand(8,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 45 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }


           elseif(date('Y',strtotime($ADV_DAY1)) == '2024')
           {
                 if($admit_todayss11['data_limit'] !='-1'){
                if($total_occupancy_todays <= 65)
                { 
                     $admit_limit = rand(15,20);
                }elseif($total_occupancy_todays >= 75)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 90 && $total_occupancy_todays < 100)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
               }
            }
            
               elseif(date('Y',strtotime($ADV_DAY1)) == '2025')
           {
                 if($admit_todayss11['data_limit'] !='-1'){
                if($total_occupancy_todays <= 60)
                { 
                     $admit_limit = rand(15,20);
                }elseif($total_occupancy_todays >= 65)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 60 && $total_occupancy_todays < 65)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
               }
            }
            
            
            // end master limit discharge patient
            
            
            // random discharge limit
            //  $value=date('d',strtotime($ADV_DAY1)); 
	           //if ($value % 2) {
            //      $discharge_limit=$discharge_todayss11['data_limit'] - 1;
            //     } else {
            //       $discharge_limit=$discharge_todayss11['data_limit'];
            //     }
            
            // random discharge limit end
            
             echo "<br>today_total_admit_limit ".$admit_limit."<br>";
            
            //discharge_todays  
	        $discharge_todays1='%'.$ADV_DAY1.'%';
	        $discharge_todays = "SELECT * FROM patient_ipd WHERE  discharge_date LIKE  '$discharge_todays1' AND discharge_date !='' AND ipd_opd ='ipd'";
	        $discharge_todayss = $mysqli->query($discharge_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_discharge_todays=$discharge_todayss->num_rows;
            echo "<br>today_total_discharge ".$total_discharge_todays."<br>";
            echo "<br>today_total_discharge_limit ".$discharge_limit."<br>";
            // end discharge_todays
            
            // discharge patient 
            echo  "<br>current date for discharge ".$date_discharge = $ADV_DAY;
            echo "<br>";
            echo "strat date for discharge ".$date_discharge1=$ADV_DAY1." 01:00";
            echo "<br>";
            echo "end date for discharge ".$date_discharge2 = $ADV_DAY1."  23:45";
            
            //if($total_discharge_todays < $discharge_limit){
                // $rand_dis=rand(6,10);
                // $old_date_dis=date('Y-m-d', strtotime("-$rand_dis days", strtotime($ADV_DAY1)));
                // $old_date_dis1='%'.$old_date_dis.'%';
                
                // //echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date like '%0000-00-00%' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd'  LIMIT 1";
                // /////echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd' or DATEDIFF('$ADV_DAY1', create_date) > '$rand_dis' AND discharge_date ='0000-00-00' AND ipd_opd ='ipd' LIMIT 1";
                // echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd' or DATEDIFF('$ADV_DAY1', '$old_date_dis') > '$rand_dis' AND discharge_date ='0000-00-00' AND ipd_opd ='ipd' LIMIT 1";
                
                // $discharge_patient1 = $mysqli->query($discharge_patient);
                // $discharge_patient2 = $discharge_patient1->fetch_assoc();
                // $dis_id = $discharge_patient2['id'];
                // $bed_remove=$discharge_patient2['bedNo'];
                // $master_id_dis = $discharge_patient2['master_g_id'];
                if($discharge_todayss11['data_limit']!='-1'){
                echo '<br>';
                echo $Check_discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date < '$ADV_DAY1' AND ipd_opd ='ipd' order by rand() LIMIT 1";
                //////echo $Check_discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date < '$ADV_DAY1' AND ipd_opd ='ipd' LIMIT 1";
                $Check_discharge_patient1 = $mysqli->query($Check_discharge_patient);
                $Check_discharge_patient2 = $Check_discharge_patient1->fetch_assoc();
                
                $che=trim($Check_discharge_patient2['dignosis']);
                $len=strlen($che);
                $dd= substr($che,$len - 1);
                $str = $Check_discharge_patient2['dignosis'];
                $arry=explode("-",$str);
                $t_c=count($arry);
                if($t_c=='2'){
                    $dd1=substr($che, 0, -1);
                    $new_str = trim($arry[0]);
                    $dis_dia = '%'.$new_str.'%';
                    $dis_p_dignosis_name=$Check_discharge_patient2['dignosis'];
                }else{
                    $dis_dia = '%'.$che.'%';
                    $dis_p_dignosis_name=$Check_discharge_patient2['dignosis'];
                }
                $dis_proxy_id = $Check_discharge_patient2['proxy_id'];
                $dis_department_id = $Check_discharge_patient2['department_id'];
                $dis_p_id = $Check_discharge_patient2['id'];
                $dis_p_create_date = date('Y-m-d', strtotime($Check_discharge_patient2['create_date']));
                
                $tretment=$this->db->select("*")
                    ->from('treatments1')
                    ->where('dignosis LIKE',$dis_dia)
                    ->where('proxy_id',$dis_proxy_id)
                    ->where('department_id', $dis_department_id)
                    ->where('ipd_opd','ipd')
                    ->get()
                    ->row();
                $ipd_days= $tretment->ipd_days;      
                
                echo '<br>';
                echo $ipd_days;
                echo '<br>';
                
                $date1=date_create(date("Y-m-d", strtotime($dis_p_create_date)));
                $date2=date_create(date("Y-m-d", strtotime($ADV_DAY1)));
                $diff=date_diff($date1,$date2);
                $Days = $diff->d;
                
                echo '<br>';
                echo 'Discharge Diff. Days ==> '.$Days;
                echo '<br>';
                
                if($Days >= $ipd_days){
                    echo '<br>';
                    echo 'Patient On Bed Days :- '.$Days.'<br>';
                    echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE id = '$dis_p_id' AND ipd_opd ='ipd'";
                    $discharge_patient1 = $mysqli->query($discharge_patient);
                    $discharge_patient2 = $discharge_patient1->fetch_assoc();
                    $dis_id = $discharge_patient2['id'];
                    $master_id_dis = $discharge_patient2['master_g_id'];
                    $bed_remove=$discharge_patient2['bedNo'];
                /////////////////}
            
             //}
            // ////Treatment Wise Discharge
            // // disharge with numbers
            // $dis_create_date=$discharge_patient2['create_date'];
            // $dis_dia='%'.$discharge_patient2['dignosis'].'%';
            // $dis_proxy_id=$discharge_patient2['proxy_id'];
            // $tretment=$this->db->select("*")

			         //                ->from('treatments1')

			         //                ->where('dignosis LIKE',$dis_dia)
			         //                ->where('proxy_id',$dis_proxy_id)
			         //                ->where('ipd_opd','ipd')
            //                          ->get()
            //                          ->row();
            //     $ipd_days= $tretment->ipd_days;                        
                
            //     $date=date_create($dis_create_date);
                
            //     date_add($date,date_interval_create_from_date_string($ipd_days." days"));
            //     if($ipd_days){
            //      $date_of_dis=date_format($date,"Y-m-d");
            //     }
            //     else {
            //       $date_of_dis=$ADV_DAY1;
            //     }               
            
              ////if(($date_discharge1 <= $date_discharge) && ($date_discharge2 >= $date_discharge) && ($total_discharge_todays <= $discharge_limit)){
              if(($date_discharge1 <= $date_discharge) && ($date_discharge2 >= $date_discharge)){
              //////////////if((date('Y-m-d',strtotime($date_discharge1)) <= date('Y-m-d',strtotime($date_discharge))) && (date('Y-m-d',strtotime($date_discharge2)) >= date('Y-m-d',strtotime($date_discharge)))){
                   echo "<br>discharge_id :".$dis_id."<br>";
             //$date_of_dis=$ADV_DAY;
             $date_of_dis=$ADV_DAY1;
             $query3 = "update patient_ipd set discharge_date = '$date_of_dis' where id = ".$dis_id;
             $mysqli->query($query3);
             
              if($master_id_dis){
             $discharge_patient_nav = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND master_g_id ='$master_id_dis' AND ipd_opd ='ipd'";
             $discharge_patient_nav1 = $mysqli->query($discharge_patient_nav);
             $discharge_patient_nav2 = $discharge_patient_nav1->fetch_assoc();
             $dis_id_nav = $discharge_patient_nav2['id']; 
             
             $query33 = "update patient_ipd set discharge_date = '$date_of_dis' where id = ".$dis_id_nav;
             $mysqli->query($query33);
             
              if($bed_remove){
                 $query2222 = "update beds set status = 0 where id=".$bed_remove;
                      $mysqli->query($query2222);
                      
                       $query22222 = "update patient_ipd set bed_status = 0 where id = ".$dis_id;
                      $mysqli->query($query22222);
             }
             
             
             }
              }
                }
                
                }
            //end discharge patient
            
            
              $m=0;
              $k=1;
              $ipd_opd2='opd';
              $ipd_opd='ipd';
              $ipd_flag = 1;
             
             $adress_def=array();
             $address = "SELECT * FROM address";
             $address1 = $mysqli->query($address);
	         while($address2=$address1->fetch_assoc()){
	        // $auto_on_off2['description']."<br>";
	           array_push($adress_def,$address2['name']);
	         }
	         
	         
	         
             while($row = $result->fetch_assoc()) {
             $m++;
               if(($row['SEX']=='M') && ($row['VIBHAG'] !=32)){
                  
	              $occupation= array('Farmer','Office','Business','Job','Labor','Jobless','Teacher','other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
              	
	         }
	         else if(($row['SEX']=='F') && ($row['VIBHAG'] !=32)){
	              $occupation= array('Farmer','Office','Business','Job','Labor','Jobless','Teacher','other');
	               if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
	         }
	         else{
	              $occupation= array('Student','Other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
                  $key = array_rand($a);
	         }
	         
	         $c_o=$row['NIDAN'];
			 $h_o='NAD';
	         $f_o='NAD';
	         //$bp=array('130/80','124/86','138/88','116/90','110/70','136/84','132/72','128/60','140/90');
	         $bp = array('122/82','128/78','120/80','118/78','110/70','116/76','130/82','112/72','114/74','124/84','126/86');
	         $nadi=array('मंडूकगति', 'सर्पगती' , 'हंसगति','अविशेष');
	         
	         //$Pulse =array(76,78,88,90,68,72,82,66,74,92,64);
	         if($row['VIBHAG'] !=32){
              $Pulse =array('78','84','86','80','76','74','70','88','90','72','82');
	         }else{
	             $Pulse =array('92','104','108','106','96','98','94','90','100','102','110');
	         }
             $ur= 'अविशेष';
             $cvs ='S1S2 N';
             $udar='soft';
             $netra=array('आविल','अच्छ','ईषत्पित्त')  ;
             $givwa=array('साम','निराम');
               $sudha=array('तीक्ष्णाग्नि', 'समाग्नि', 'विषमाग्नि');   
            
             $ahar=array('प्रभुत ','अल्प ','मध्यम');
             $mal=array('साम ','निराम ','कठीण ','दुर्गंधीयुक्त ','अविशेष');
             $mutra=array('पीत','आविल','दुर्गंधीयुक्त','अविशेष');
             $nidra=array('अविशेष','प्रभुत','अल्प');   
             
              $key = array_rand($a); 
	          $a[$key];
	          $key1 =array_rand($occupation);
	          $occupation[$key1];
	          $key2=array_rand($adress_def);
	          $adress_def[$key2];
	          
	          $c_o1=array_rand($c_o);
	          $c_o[$c_o1];
	          
	          $bp1=array_rand($bp);
	          $bp[$bp1];
	          
	          $nadi1=array_rand($nadi);
	          $nadi[$nadi1];
	          
	          $Pulse1=array_rand($Pulse);
	          $Pulse[$Pulse1];
	          
	          $netra1=array_rand($netra);
	          $netra[$netra1];
	          
	           $givwa1=array_rand($givwa);
	           $givwa[$givwa1];
	           
	           
	           $sudha1=array_rand($sudha);
	           $sudha[$sudha1];
	           
	           $ahar1=array_rand($ahar);
	           $ahar[$ahar1];
	           
	           $mal1=array_rand($mal);
	           $mal[$mal1];
	           
	           $mutra1=array_rand($mutra);
	           $mutra[$mutra1];
	           
	           $nidra1=array_rand($nidra);
	           $nidra[$nidra1];
	           
	           $ruduce =array(10,25,50,75);
               $ruduce1=array_rand($ruduce);
	           $ruduce[$ruduce1];
	          
	          
              if($k == 1){
               $date_only_new = date('Y-m-d H:i',strtotime('-15 minutes'))."<br>";
              }
              else if($k == 2){
               $date_only_new = date('Y-m-d H:i',strtotime('- 14 minutes'))."<br>";
              }
              else if($k == 3){
               $date_only_new = date('Y-m-d H:i',strtotime('- 12 minutes'))."<br>";
              }
              else if($k == 4){
              $date_only_new = date('Y-m-d H:i',strtotime(' -11 minutes'))."<br>";
              }
              else if($k == 5){
              $date_only_new = date('Y-m-d H:i',strtotime('-11 minutes'))."<br>";
              }
              else if($k == 6){
              $date_only_new = date('Y-m-d H:i',strtotime('-7 minutes'))."<br>";
              }
              else if($k == 7){
              $date_only_new = date('Y-m-d H:i',strtotime('-5 minutes'))."<br>";
              }
              else if($k == 8){
              $date_only_new = date('Y-m-d H:i',strtotime('-2 minutes'))."<br>";
              }
             
              else {
              $date_only_new = $ADV_DAY1."<br>";
              }
              $date_only_new1 = $ADV_DAY1."<br>";
              $k++;
               if(empty($row['CopddD_New'])){
                    $CopddD_New=NULL;
                    $Copdd_Old=$row['Copdd_Old'];
                    
                     echo "<br>Sno: " . $row["Sno"]. " - Name: " . $row["NAME"]. "<br>";
                    if($row["NAME"]){
	                 $query1 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date, wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,sym_reduce_per) values('".$row["Sno"]."','".$row["yealry_number"]."','".$row['Daily']."','".$row['Monthly']."','".$Copdd_Old."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$ruduce[$ruduce1]."')";
                     //echo $query1;
                     $mysqli->query($query1);
			         $query2 = "update items set flag = 1 where Sno=".$row["Sno"];
                     $mysqli->query($query2);
                    }
                     
                     //MASTER GARBHINI INSERT INTO PATIENT
            $month=date('m');
           
            $year = '%'.$this->session->userdata['acyear'].'%';
            $year1=$this->session->userdata['acyear'];
            $d=cal_days_in_month(CAL_GREGORIAN,$month,$year1);
            $dd='%GARBHINI-SR%';
            $start_date=$year1.'-'.$month.'-01 00:00:00';
            //echo "<br>";
            $end_date=$year1.'-'.$month.'-'.$d.' 23:59:00'; 
           
             $auto_on_off = "SELECT count(*) as total FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date'";
          
	         $auto_on_off1 = $mysqli->query($auto_on_off);
	         $auto_on_off2=$auto_on_off1->fetch_assoc();
             $auto_on_off3=$auto_on_off2['total'];
            
            $rand =rand(4,5);
           
            if($auto_on_off3 <= $rand){
              
                
               $G= "SELECT * FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date' ORDER BY id DESC LIMIT 1";
               $G1 = $mysqli->query($G);
	           $G2=$G1->fetch_assoc();
               $G3= date('Y-m-d',strtotime($G2['create_date']));
               $today=date('Y-m-d');
               $datetime1 = date_create($G3); 
               $datetime2 = date_create($today); 
  
               $interval = date_diff($datetime1, $datetime2); 
               $interval1=$interval->format('%a'); 
               $rand1=rand(4,6);
               if($interval1 <= $rand1){
                  // echo "no";
                   
                         
               }else{
                   //echo "yes";
                    $last_id = "SELECT * FROM patient where create_date LIKE '$year' and  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $last_id1 = $mysqli->query($last_id);
	                $last_id2=$last_id1->fetch_assoc();
	                     $patient_id=$last_id2['patient_id'] + 1;
                         $yearly_reg_no=$last_id2['yearly_reg_no'] + 1;
                         $year_no = $last_id2['yearly_no'] + 1;
                         $daily_reg_no = $last_id2['daily_reg_no'] + 1;
                        // $old_reg_no = $last_id2['old_reg_no'] + 1;
                        
                        $master_gar = "SELECT * FROM garbhini_navjat where status ='0'  ORDER BY id DESC LIMIT 1";
                        $master_gar1 = $mysqli->query($master_gar);
	                    $master_gar2=$master_gar1->fetch_assoc();
                        $master_id=$master_gar2['id'];
                         
                      $date_new1=date('Y-m-d');   
                       if($m == 1){  
                           if($master_gar2["m_name"]){
                      $query1 = "insert into patient(patient_id,yearly_reg_no,yearly_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,master_g_id,follow_up) values('".$patient_id."','".$yearly_reg_no."','".$year_no."','".$daily_reg_no."','','".$master_gar2['m_name']."','".$master_gar2['sex']."','".$master_gar2['age']."','".$master_gar2['address']."','".$master_gar2['department_id']."','".$master_gar2['dignosis']."','".$master_gar2['ipd_opd']."','','','".$date_new1."','".$master_gar2['id']."','".$master_gar2['follow_up']."')";
                      $mysqli->query($query1);
			          $query2 = "update garbhini_navjat set status=1 where id=".$master_id;
                      $mysqli->query($query2);
                      }
                      }
               }

            } else {
                echo "No garghan limit over";
            }
                      //END GARBHINI
             
               if(($single_record == $m  ) && ($total_admit_todays <= $admit_limit)){
                 
                   
                   if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit)){
                       if(($row['VIBHAG'] == '35') || ($row['VIBHAG'] == '28'))
                         {
                          }
                        else{
                             $gender1=$row['SEX'];
                          $depart_id1= $row['VIBHAG'];
                           if($depart_id1 == '28'){
                            $depart_id='34';
                        }else{
                             $depart_id= $row['VIBHAG'];
                        }
                        
                        $dep_bed_limit = "SELECT * FROM data_lmit_dept_ipd where dept_id=".$depart_id;
            	         $dep_bed_limit1 = $mysqli->query($dep_bed_limit);
            	         $dep_bed_limit11=$dep_bed_limit1->fetch_assoc();
            	         
            	         if($SEX_Check=='M'){
                         $data_limit=$dep_bed_limit11['data_limit_m'];
            	         }else{
            			 $data_limit=$dep_bed_limit11['data_limit_f'];
            	         }
            	         
            	         $dep_bed_limit_total=$data_limit;
                        // end master data_lmit_dept_ipd
            			
            			 //patient check in bed with gender
            	          $check_bed = "SELECT * FROM patient_ipd where discharge_date LIKE '%0000-00-00%' and  sex='$SEX_Check' and department_id=".$depart_id;
            	          $bed_status1 = $mysqli->query($check_bed);
            	          echo "//////////////////";  echo "<br>";
            	          echo "depart_id:".$depart_id;
            	          echo "//////////////////";  echo "<br>";
            	         echo  '$dep_bed_limit_total :'.$dep_bed_limit_total;
            	         echo "<br>";
            	         echo "//////////////////";
            	         echo  'bed_status_total :'.$bed_status_total=$bed_status1->num_rows;
            	         echo "//////////////////";
            	        // end patient check in bed with gender
                        
                         $bed = "SELECT * FROM beds WHERE gender ='$gender1' AND department_id ='$depart_id' AND status ='0' LIMIT  1";
                         $bed_no = $mysqli->query($bed);
	                     $bed_no1=$bed_no->fetch_assoc(); 
	                       if ($bed_no1) {
                            $admit_bed=$bed_no1['id'];
                            }else{
	                          $admit_bed ='';
	                        }
	                    
	                    //Admit only available diagnosis in ipd
	                   // $nivan=$row['NIDAN']."I";
	                   // $nivan1='%'.$nivan.'%';
	                    
	                    $che=trim($row['NIDAN']);
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $row['NIDAN'];
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $nivan = '%'.$new_str.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }else{
                            $nivan = '%'.$che.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }
	                    echo $nivan1 = $nivan;
	                    
	                    $proxy_id = $row['proxy_id'];
	                    //$department_id = $row['VIBHAG'];
	                    $department_id = $depart_id;
	                    
	                    $admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND proxy_id = '$proxy_id' AND department_id = '$department_id' AND ipd_opd ='ipd'";
	                    
	                    //$admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND ipd_opd ='ipd'";
                        $admit_avai_diagnosis1 = $mysqli->query($admit_avai_diagnosis);
	                    $admit_avai_diagnosis2=$admit_avai_diagnosis1->fetch_assoc(); 
	                    
	                    echo "<br>=====> 3 ";
	                    print_r($admit_avai_diagnosis2);
	                    echo "<br><br><br>"; 
	                    
	                    if($bed_status_total < $dep_bed_limit_total){ 
	                    //if($admit_avai_diagnosis2){ 
	                    if($admit_avai_diagnosis2 && $admit_bed != ''){ 
						$bed_status='1';
 
                            
                            
                        $query12 = "insert into patient_ipd(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,ipd_flag) values('".$row["Sno"]."','".$row["yealry_number"]."','".$row['Daily']."','".$row['Monthly']."','".$Copdd_Old."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$row['Address']."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$ipd_flag."')";
                        $this->db->query($query12);
                       // $mysqli->query($query12); 
                        $query22 = "update patient_ipd set ipd_flag = 1 where patient_id=".$row["Sno"];
                        $mysqli->query($query22);
                        
                         $query222 = "update beds set status = 1 where id=".$admit_bed;
                         $mysqli->query($query222);
					     }
                        }
                      }
                   }
                 } 
                else{
                   
                   echo "<br>no admit";
                }
			  
                }else {
                    
                    
                    //$CopddD_New=$row['CopddD_New'];
                    
                    // CJOB Auto Push Code Start ------------------------------------------------------------
                    
                    //$CopddD_New=$row['CopddD_New'];
                    $tempQuery1 = "SELECT * FROM  patient ORDER BY id DESC LIMIT 1";
                    $tempQueryResult1 = $mysqli->query($tempQuery1);
	                $tempQueryRow1=$tempQueryResult1->fetch_assoc();
	                /*print_r($tempQueryRow1);
	                die();*/
	               
                    $tempQuery = "SELECT * FROM  patient WHERE  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $tempQueryResult = $mysqli->query($tempQuery);
	                $tempQueryRow=$tempQueryResult->fetch_assoc();
	                /*print_r($tempQueryRow);
	                die();*/
                    //$CopddD_New=$row['CopddD_New'];
                    $CopddD_New=$tempQueryRow['yearly_reg_no']+1;
                    
                    // CJOB Auto Push Code End ----------------------------------------------------------------
                    
                    //check dublicate New Yearly Number
                     $d_number=date('Y',strtotime($ADV_DAY1));
                     $d_number_like='%'.$d_number.'%';
	                 $check_number = "SELECT * FROM patient WHERE  create_date LIKE  '$d_number_like' AND ipd_opd ='opd' AND yearly_reg_no ='$CopddD_New'";
	                 $check_number_q = $mysqli->query($check_number);
	                 $check_number_result=$check_number_q->num_rows;
                     //check dublicate New Yearly Number end 
                    
                    $Copdd_Old=NULL;
                    echo "<br>Sno: " . $row["Sno"]. " - Name: " . $row["NAME"]. "<br>";
                    if($check_number_result==0){
                    if($row["NAME"]){
                          $year_new = date('Y',strtotime($date_only_new1));
                        $check_last_record = "select * from patient where year(create_date)  = '$year_new' AND yearly_reg_no = '$CopddD_New'";
                        $check_last_record1 = $mysqli->query($check_last_record);
                        $check_last_record2=$check_last_record1->num_rows;
                        if($check_last_record2 >= 1)
                        {

                        }
                        else
                        {
	                //echo $query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation ,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id) values('".$row["Sno"]."','".$row["yealry_number"]."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row['proxy_id']."')";
	                echo $query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation ,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id) values('".$CopddD_New."','".$CopddD_New."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row['proxy_id']."')";
                    $yes= $this->db->query($query1);
                    echo 'yes'.$yes;
                    echo "<br>";
                    
                    //echo $query1;
                    if($yes){
			        $query2 = "update items set flag = 1 where Sno=".$row["Sno"];
                    $mysqli->query($query2);
                    }
                    }
                    }
                   }
            
                  if(($single_record == $m  ) && ($total_admit_todays <= $admit_limit)){
                 
                 
                   if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit)){
                     
                          if(($row['VIBHAG'] == '35') ||($row['VIBHAG'] == '28'))
                          {
                          }
                          else{
                             
                              $gender1=$row['SEX'];
                          $depart_id1= $row['VIBHAG'];
                           if($depart_id1 == '28'){
                            $depart_id='34';
                        }else{
                             $depart_id= $row['VIBHAG'];
                        }
                        
                        
                        
                        
                           
                        /////////////////////////////######## IPF CASE PAPER############//////////////////
                         $hb =array(11.5,12.0,12.5,13.0,13.5,14.0,14.5);
	                     $hb1=array_rand($hb);
	                     $hb[$hb1];
	                     
	                     $TLC =array(4000,4500,5000,5500,6000,6500,7000,7500,8000,8500,9000,9500,10000,11000);
	                     $TLC1=array_rand($TLC);
	                     $TLC[$TLC1];
	                     
	                     
	                     $DLC_Neutro =array(50,55,60,65,70);
	                     $DLC_Neutro1=array_rand($DLC_Neutro);
	                     $DLC_Neutro[$DLC_Neutro1];
	                     
	                     $Lymphocytes =array(20,25,30,35,40);
	                     $Lymphocytes1=array_rand($Lymphocytes);
	                     $Lymphocytes[$Lymphocytes1];
	                     
	                     
	                     $Monocytes =array(1,2,3,4);
	                     $Monocytes1=array_rand($Monocytes);
	                     $Monocytes[$Monocytes1];
	                     
	                     $Eosinophils =array(0.1,0.2,0.3,0.4);
	                     $Eosinophils1=array_rand($Eosinophils);
	                     $Eosinophils[$Eosinophils1];
	                     
	                     
	                     $ESR =array(10,14,16,18,20);
	                     $ESR1=array_rand($ESR);
	                     $ESR[$ESR1];
	                     
	                   
	                     $Platelet_Count=array(1.5,2.0,2.5,3.0,3.5,4.0,4.5);
	                     $Platelet_Count1=array_rand($Platelet_Count);
	                     $Platelet_Count[$Platelet_Count1];
	                     
	                     $B_Sugar=array(70,80,90,100,110);
	                     $B_Sugar1=array_rand($B_Sugar);
	                     $B_Sugar[$B_Sugar1];
	                     
	                     $Blood_Sugar=array(110,120,130,140,150);
	                     $Blood_Sugar1=array_rand($Blood_Sugar);
	                     $Blood_Sugar[$Blood_Sugar1];
	                     
	                     $Blood_Urea=array(20,25,30,35,40);
	                     $Blood_Urea1=array_rand($Blood_Urea);
	                     $Blood_Urea[$Blood_Urea1];
	                     
	                     $S_Creatinine=array(0.4,0.5,0.7,0.9,1.2,1.4);
	                     $S_Creatinine1=array_rand($S_Creatinine);
	                     $S_Creatinine[$S_Creatinine1];
                        
                         $S_Uric_Acid=array(2,3,4,5,6);
	                     $S_Uric_Acid1=array_rand($S_Uric_Acid);
	                     $S_Uric_Acid[$S_Uric_Acid1];
	                     
	                     $SNat	=array(135,140,145,150,155);
	                     $SNat1=array_rand($SNat);
	                     $SNat[$SNat1];
	                     
	                     
	                     
	                     
	                     $SK=array(3.5,4.0,4.5,5.0,5.5);
	                     $SK1=array_rand($SK);
	                     $SK[$SK1];
	                     
	                     $Total_Cholestrol=array(150,160,170,180,190,200);
	                     $Total_Cholestrol1=array_rand($Total_Cholestrol);
	                     $Total_Cholestrol[$Total_Cholestrol1];
	                     
	                     $STg=array(60,80,90,100,120,140,150,160,170);
	                     $STg1=array_rand($STg);
	                     $STg[$STg1];
	                     
	                     
	                     $HDL=array(30,40,50,60,70);
	                     $HDL1=array_rand($HDL);
	                     $HDL[$HDL1];
	                     
	                     $LDL=array(110,120,130,140,150);
	                     $LDL1=array_rand($LDL);
	                     $LDL[$LDL1];
	                     
	                     $VLDL=array(14,15,18,20,25,28,34,36,38,42,44,45);
	                     $VLDL1=array_rand($VLDL);
	                     $VLDL[$VLDL1];
	                     
	                     
	                    $atime=array('9:00','9:05','9:10','09:15','09:20','09:30');
	                     $atime1=array_rand($atime);
	                     $atime[$atime1];
	                     
	                     $dtime=array('9:15','9:30','9:45','10:00','10:30','10:45');
	                     $dtime1=array_rand($dtime);
	                     $dtime[$dtime1];
	                     
	                     $phone=array(98,97,96,94);
	                     $phone1=array_rand($phone);
	                     $phone[$phone1];
	                     
	                     $digits = 8;
                         $digi8=rand(pow(10, $digits1),pow(10,$digits)-1);
                         $phonedigit10=$phone[$phone1].$digi8;
	                     
	                     
	                      //##
                         $BillirubinT=array(0.1,0.2,0.4,0.8,0.5);
	                     $BillirubinT1=array_rand($BillirubinT);
	                     $BillirubinT[$BillirubinT1];
	                     
	                     $BillirubinI=array(0.3,0.7,0.4,0.8,0.5);
	                     $BillirubinI1=array_rand($BillirubinI);
	                     $BillirubinI[$BillirubinI1];
                        
                         $Color=array('Yellow','Brown','Dark Brown','Black');
	                     $Color1=array_rand($Color);
	                     $Color[$Color1];
	                     
	                     $MUCOUS=array('+++','++++');
	                     $MUCOUS1=array_rand($MUCOUS);
	                     $MUCOUS[$MUCOUS1];
	                     
	                     $Comsistency=array('Liguid','Semi Solid','Solid','Hard');
	                     $Comsistency1=array_rand($Comsistency);
	                     $Comsistency[$Comsistency1];
	                     
	                     $raj=array('सामान्य ','अप्रवृत्ती ','अतिप्रवृत्ती ','अल्प प्रवृत्ती – काल');
	                     $raj1=array_rand($raj);
	                     $raj[$raj1];
	                     
	                     
	                     $samajik=array('Medium','Average', 'Above Poverty Line','Below Poverty Line','Poor','Modirate');
	                     $samajik1=array_rand($samajik);
	                     $samajik[$samajik1];
	                     
	                     $aharfood=array('Non vegetarian','Vegetarian', 'Non vegetarian +  Vegetarian');
	                     $aharfood1=array_rand($aharfood);
	                     $aharfood[$aharfood1];
	                     
	                     
	                     $aharghatak=array('Medium','Average', 'Above average','Below average','Poor');
	                     $aharghatak1=array_rand($aharghatak);
	                     $aharghatak[$aharghatak1];
	                     
	                     
	                     $nidtra=array('Normal');
	                     $nidtra1=array_rand($nidtra);
	                     $nidtra[$nidtra1];
	                     
	                     
	                     $vyasan=array('Tea','Coffee','Tobacco','Smoking');
	                     $vyasan1=array_rand($vyasan);
	                     $vyasan[$vyasan1];
	                     
	                     $mutrapra=array('4-Yellow','5-Faint yellow','6-Dark yellow','7-Pale Yellow','8-Yellow');
	                     $mutrapra1=array_rand($mutrapra);
	                     $mutrapra[$mutrapra1];
	                     
	                     
	                     $urine=array('NAD','NILL');
	                     $urine1=array_rand($urine);
	                     $urine[$urine1];
	                     
	                     $purushpra=array('1-Yellow','2-Dark yellow','1-Brown','2-Dark yellow','1-Dark Brown','2-blackest');
	                     $purushpra1=array_rand($purushpra);
	                     $purushpra[$purushpra1];
	                     
	                     $apanwayu=array('NAD','Normal','Excessive');
	                     $apanwayu1=array_rand($apanwayu);
	                     $apanwayu[$apanwayu1];
                        
                        
                         $koshth=array('क्रूर','मध्यम ','मृदू');
	                     $koshth1=array_rand($koshth);
	                     $koshth[$koshth1];
	                     
	                     
	                     $samanyaatur=array('Pitta','Vata','Pittakapha','Vatapitta','VataKaPha','Sam');
	                     $samanyaatur1=array_rand($samanyaatur);
	                     $samanyaatur[$samanyaatur1];
	                     
	                     
	                     $tap=array('96.5','96','97.5','97');
	                     $tap1=array_rand($tap);
	                     $tap[$tap1];
	                     
	                     
	                     $sharir=array('Medium','Modrate','Well built','Thin','Central Obesity');
	                     $sharir1=array_rand($sharir);
	                     $sharir[$sharir1];
	                     
	                     $aharshakti=array('Medium','Strong');
	                     $aharshakti1=array_rand($aharshakti);
	                     $aharshakti[$aharshakti1];
	                     
	                     
	                     $vyamshakti=array('Medium','Strong');
	                     $vyamshakti1=array_rand($vyamshakti);
	                     $vyamshakti[$vyamshakti1];
	                     
	                     
	                    $rand_no=rand(1,5);
	                     if($rand_no=='1'){
	                         $second='अल्पोपशय';$three='अल्पोपशय';$four='25';$five='50';$six='75';$seven='उपशय';$eight='उपशय';$nine='उपशय';
	                         
	                         $SPO2='88,90,92,91,93,94,96,97,98';
	                         $Input='2000,2020,2010,2060,2100,2080,2160,2140,2120';
	                         $Output='1600,1640,1680,1670,1720,1750,1800,1940,1960';
	                         
	                     }else if($rand_no=='2'){
	                         $second='25';$three='50';$four='75';$five='अल्पोपशय';$six='अल्पोपशय';$seven='अल्पोपशय';$eight='उपशय';$nine='उपशय';
	                        
	                         $SPO2='90,91,92,94,93,94,98,97,98';
	                         $Input='2010,2020,2040,2160,2100,2080,2160,2140,2120';
	                         $Output='1640,1650,1670,1670,1750,1780,1800,1940,1960';
	                     }
	                     else if($rand_no=='3'){
	                          $second='Same complaint';$three='10';$four='25';$five='50';$six='75';$seven='उपशय';$eight='उपशय';$nine='उपशय';
	                          
	                          $SPO2='92,91,92,88,93,94,98,96,98';
	                          $Input='2040,2020,2010,2060,2100,2090,2140,2140,2120';
	                          $Output='1750,1700,1680,1800,1850,1670,1680,1840,1940';
	                     }
	                     else if($rand_no=='4'){
	                         $second='10';$three='25';$four='50';$five='75';$six='उपशय';$seven='उपशय';$eight='अल्पोपशय';$nine='अल्पोपशय'; 
	                     
	                         $SPO2='89,90,91,93,94,94,97,96,98';
	                         $Input='2020,2020,2010,2080,2080,2180,2160,2140,2120';
	                         $Output='1680,1670,1700,1750,1840,1850,1900,1950,1950';
	                     }
	                     
	                     else if($rand_no=='5'){
	                          
	                         $second='Same complaint';$three='Same complaint';$four='10';$five='25';$six='50';$seven='75';$eight='अल्पोपशय';$nine='अल्पोपशय';
	                         
	                         $SPO2='89,88,90,94,94,94,96,97,98';
	                         $Input='2000,2010,2040,2030,2120,2080,2160,2140,2140';
	                         $Output='1600,1620,1690,1670,1740,1750,1800,1940,1960';
	                         
	                     }
	                     else{
	                           $second='';$three='';$four='';$five='';$six='';$seven='';$eight='';$nine='';
	                           
	                           $SPO2='88,91,90,88,93,95,97,96,98'; 
	                           $Input='2030,2020,2080,2060,2120,2080,2140,2150,2120';
	                           $Output='1640,1640,1690,1670,1720,1750,1840,1940,1980';
	                     }
						 
	                     /* $second=array('अल्पोपशय','25','Same complaint','10');
	                     $second1=array_rand($second);
	                     $second[$second1];
	                     
	                     $three=array('अल्पोपशय','25','Same complaint','10','50');
	                     $three1=array_rand($three);
	                     $three[$three1];
	                     
	                     $four=array('75','25','10','50');
	                     $four1=array_rand($four);
	                     $four[$four1];
	                     
	                     $five=array('अल्पोपशय','25','75','50');
	                     $five1=array_rand($five);
	                     $five[$five1];
	                     
	                     $six=array('अल्पोपशय','उपशय','75','50');
	                     $six1=array_rand($six);
	                     $six[$six1];
	                     
	                     $seven=array('अल्पोपशय','उपशय','75','उपशय','उपशय');
	                     $seven1=array_rand($seven);
	                     $seven[$seven1];
	                     
	                     $eight=array('अल्पोपशय','उपशय','अल्पोपशय','उपशय','उपशय');
	                     $eight1=array_rand($eight);
	                     $eight[$eight1];
	                     
	                     $nine=array('अल्पोपशय','उपशय','अल्पोपशय','उपशय','उपशय');
	                     $nine1=array_rand($nine);
	                     $nine[$nine1];
                        */
                        
                        
                         $gcondition=array('Fair','Moderate');
	                     $gcondition1=array_rand($gcondition);
	                     $gcondition[$gcondition1];
	                     
	                     $Scl=array('95','96','98','99','100','102','103','105');
	                     $Scl1=array_rand($Scl);
	                     $Scl[$Scl1];
	                     
	                   //  ,B_Sugar,Blood_Sugar,Blood_Urea,S_Creatinine,S_Uric_Acid,SNat,SK,Total_Cholestrol,STg,HDL,LDL,VLDL,atime,dtime,phone
                        
                      //  ,'".$B_Sugar[$B_Sugar1]."','".$Blood_Sugar[$Blood_Sugar1]."','".$Blood_Urea[$Blood_Urea1]."','".$S_Creatinine[$S_Creatinine1]."','".$S_Uric_Acid[$S_Uric_Acid1]."','".$SNat[$SNat1]."','".$SK[$SK1]."','".$Total_Cholestrol[$Total_Cholestrol1]."','". $STg[$STg1]."','".$HDL[$HDL1]."','".$LDL[$LDL1]."','".$VLDL[$VLDL1]."','".$atime[$atime1]."','".$dtime[$dtime1]."','".$phonedigit10."'
                        
                        
                        
                        /////////////////////////////######## IPF CASE PAPER############//////////////////
                        
                        
                         $SEX_Check=$row['SEX'];
                        
                          //master data_lmit_dept_ipd
                         $dep_bed_limit = "SELECT * FROM data_lmit_dept_ipd where dept_id=".$depart_id;
            	         $dep_bed_limit1 = $mysqli->query($dep_bed_limit);
            	         $dep_bed_limit11=$dep_bed_limit1->fetch_assoc();
            	         
            	         if($SEX_Check=='M'){
                         $data_limit=$dep_bed_limit11['data_limit_m'];
            	         }else{
            			 $data_limit=$dep_bed_limit11['data_limit_f'];
            	         }
            	         
            	         $dep_bed_limit_total=$data_limit;
                        // end master data_lmit_dept_ipd
            			
            			 //patient check in bed with gender
            	          $check_bed = "SELECT * FROM patient_ipd where discharge_date LIKE '%0000-00-00%' and  sex='$SEX_Check' and department_id=".$depart_id;
            	          $bed_status1 = $mysqli->query($check_bed);
            	          echo "//////////////////";  echo "<br>";
            	          echo "depart_id:".$depart_id;
            	          echo "//////////////////";  echo "<br>";
            	         echo  '$dep_bed_limit_total :'.$dep_bed_limit_total;
            	         echo "<br>";
            	         echo "//////////////////";
            	         echo  'bed_status_total :'.$bed_status_total=$bed_status1->num_rows;
            	         echo "//////////////////";
            	        // end patient check in bed with gender
                        
                        
                         $bed = "SELECT * FROM beds WHERE gender ='$SEX_Check' AND department_id ='$depart_id' AND status ='0' LIMIT  1";
                         $bed_no = $mysqli->query($bed);
	                     $bed_no1=$bed_no->fetch_assoc(); 
	                       if ($bed_no1) {
                            $admit_bed=$bed_no1['id'];
                            }else{
	                          $admit_bed ='';
	                        }
	                    
	                    //Admit only available diagnosis in ipd
	                   //echo $nivan=$row['NIDAN'];
	                   // $nivan1='%'.$nivan.'%';
	                   
	                    $che=trim($row['NIDAN']);
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $row['NIDAN'];
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $nivan = '%'.$new_str.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }else{
                            $nivan = '%'.$che.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }
	                    echo $nivan1 = $nivan;
	                    
	                    $proxy_id = $row['proxy_id'];
	                    //$department_id = $row['VIBHAG'];
	                    $department_id = $depart_id;
	                    
	                    $admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND proxy_id = '$proxy_id' AND department_id = '$department_id' AND ipd_opd ='ipd'";
	                    
	                    //$admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND ipd_opd ='ipd'";
	                    
                        $admit_avai_diagnosis1 = $mysqli->query($admit_avai_diagnosis);
	                    $admit_avai_diagnosis2=$admit_avai_diagnosis1->fetch_assoc();
	                     
	                    echo "<br>=====> 4 ";
	                    print_r($admit_avai_diagnosis2);
	                    echo "<br><br><br>"; 
	                  
                        
	                     
	                    if($bed_status_total < $dep_bed_limit_total){  
	                    //if($admit_avai_diagnosis2){ 
	                    if($admit_avai_diagnosis2 && $admit_bed != ''){ 
						$bed_status='1';
						
                           $query12 = "insert into patient_ipd(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,ipd_flag,bedNo,Hb,TLC,DLC_Neutro,Lymphocytes,Monocytes,Eosinophils,ESR,Platelet_Count,B_Sugar,Blood_Sugar,Blood_Urea,S_Creatinine,S_Uric_Acid,SNat,SK,Total_Cholestrol,STg,HDL,LDL,VLDL,atime,dtime,phone ,BillirubinT,BillirubinI,Color,MUCOUS,Comsistency,raj,samajik,aharfood,aharghatak,nidtra,vyasan,mutrapra,urine,purushpra,apanwayu,koshth,samanyaatur,tap,sharir,aharshakti,vyamshakti,second,three,four,five,six,seven,eight,nine,SPO2,Input,Output,proxy_id,gcondition,Scl) values('".$row["Sno"]."','".$row["yealry_number"]."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$ipd_flag."','".$admit_bed."','".$hb[$hb1]."','".$TLC[$TLC1]."','".$DLC_Neutro[$DLC_Neutro1]."','".$Lymphocytes[$Lymphocytes1]."','".$Monocytes[$Monocytes1]."','".$Eosinophils[$Eosinophils1]."','".$ESR[$ESR1]."','".$Platelet_Count[$Platelet_Count1]."','".$B_Sugar[$B_Sugar1]."','".$Blood_Sugar[$Blood_Sugar1]."','".$Blood_Urea[$Blood_Urea1]."','".$S_Creatinine[$S_Creatinine1]."','".$S_Uric_Acid[$S_Uric_Acid1]."','".$SNat[$SNat1]."','".$SK[$SK1]."','".$Total_Cholestrol[$Total_Cholestrol1]."','". $STg[$STg1]."','".$HDL[$HDL1]."','".$LDL[$LDL1]."','".$VLDL[$VLDL1]."','".$atime[$atime1]."','".$dtime[$dtime1]."','".$phonedigit10."','".$BillirubinT[$BillirubinT1]."','".$BillirubinI[$BillirubinI1]."','".$Color[$Color1]."','".$MUCOUS[$MUCOUS1]."','".$Comsistency[$Comsistency1]."','".$raj[$raj1]."','".$samajik[$samajik1]."','".$aharfood[$aharfood1]."','".$aharghatak[$aharghatak1]."','".$nidtra[$nidtra1]."','".$vyasan[$vyasan1]."','".$mutrapra[$mutrapra1]."','".$urine[$urine1]."','".$purushpra[$purushpra1]."','".$apanwayu[$apanwayu1]."','".$koshth[$koshth1]."','".$samanyaatur[$samanyaatur1]."','".$tap[$tap1]."','".$sharir[$sharir1]."','".$aharshakti[$aharshakti1]."','".$vyamshakti[$vyamshakti1]."','".$second."','".$three."','".$four."','". $five."','".$six."','".$seven."','".$eight."','".$nine."','".$SPO2."','".$Input."','".$Output."','".$row['proxy_id']."','".$gcondition[$gcondition1]."','".$Scl[$Scl1]."')";
                           //$mysqli->query($query12); 
                           $this->db->query($query12);
                           echo $query12;
                           $query22 = "update patient_ipd set ipd_flag = 1 where patient_id=".$row["Sno"];
                          $mysqli->query($query22);
                          
                          $query2222 = "update patient set flag = 1,ipd_patient_flag = 1 where yearly_reg_no='$CopddD_New' ORDER BY id DESC LIMIT 1";
                          $mysqli->query($query2222);
                          
                              $query222 = "update beds set status = 1 where id=".$admit_bed;
                             $mysqli->query($query222);
					         }
                            }
                          }  
                   }
                 } 
                 else{
                   
                   echo "<br>no admit";
                  }
			  
                }
                
              
       }
	 
	   
       echo "insert data succesfully using crone job (only new...)" ;
      } else {
       echo "master data no available(only new)";
      }
	}
	 
      $mysqli->close();
    }
    /*else  if(($date33 <= $date) && ($date44 >= $date) && ($w_day !='Sun') &&($rowcount_two<=$rand_data_limit) && (empty($holiday))){*/
	   /*else  if(($date33 <= $date) && ($date44 >= $date) && ($w_day !='Sun') &&($ADV_DAY1) &&($rowcount_two<=$rand_data_limit))*/
	   /*else  if(($date33 <= $date) && ($date44 >= $date) && ($w_day !='Sun') &&($ADV_DAY1))*/
	   else  if(($date33 <= $date) && ($date44 >= $date) && ($w_day !='Sun') &&($ADV_DAY1) && ($rowcount_two<=$rand_data_limit))
	   { 
	       
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                //$rand=rand(75,85);
                if($rowcount_two>=75){
                    $ancCheckDate = date('Y-m-d', strtotime($ADV_DAY1));
                    $tempANCItemQuery = "SELECT * FROM  items_anc WHERE  create_date like '$ancCheckDate' and flag = 0 LIMIT 1";
                    $tempANCItemQueryResult = $mysqli->query($tempANCItemQuery);
                    $ANCResultRow=$tempANCItemQueryResult->fetch_assoc();
                    
                    if($ANCResultRow['fol_up_status'] == 'N'){
                        $tempQuery = "SELECT * FROM  patient WHERE  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                        $tempQueryResult = $mysqli->query($tempQuery);
                        $tempQueryRow=$tempQueryResult->fetch_assoc();
                        $CopddD_New=$tempQueryRow['yearly_reg_no']+1;
                        
                        $query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,discharge_date,create_date,wieght,occupation,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,proxy_id,flag,lmp,edd,fhs,ag) values('".$CopddD_New."','".$CopddD_New."','".$CopddD_New."','".$ANCResultRow["name"]."','F','".$ANCResultRow['age']."','".$ANCResultRow["address"]."','29','".$ANCResultRow['dignosis']."','opd','0000-00-00','".$ANCResultRow["create_date"]."','".$ANCResultRow["weight"]."','".$ANCResultRow["occupation"]."','".$ANCResultRow["pulse"]."','".$ANCResultRow["bp"]."','".$ANCResultRow["nadi"]."','".$ANCResultRow["ur"]."','".$ANCResultRow["cvs"]."','".$ANCResultRow["udar"]."','".$ANCResultRow["netra"]."','".$ANCResultRow["jivha"]."','".$ANCResultRow["kusudha"]."','".$ANCResultRow["ahar"]."','".$ANCResultRow["mal"]."','".$ANCResultRow["proxy_id"]."','1','".$ANCResultRow["lmp_date"]."','".$ANCResultRow["edd_date"]."','".$ANCResultRow["fhs"]."','".$ANCResultRow["ag"]."')";
                        $yes= $this->db->query($query1);
                        if($yes){
                            $query2 = "update items_anc set patient_id='".$CopddD_New."', yearly_reg_no='".$CopddD_New."' where name=".$ANCResultRow["name"];
                            $mysqli->query($query2);
                            $query3 = "update items_anc set flag=1 where id='".$ANCResultRow["id"]."'";
                            $mysqli->query($query3);
                        }
                    }else{
                        if($ANCResultRow['yearly_reg_no'] != '' || $ANCResultRow['yearly_reg_no'] != NULL){
                            $query1 = "insert into patient(patient_id,yearly_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,discharge_date,create_date,wieght,occupation,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,proxy_id,flag,lmp,edd,fhs,ag) values('".$ANCResultRow['yearly_reg_no']."','".$ANCResultRow['yearly_reg_no']."','".$ANCResultRow['yearly_reg_no']."','".$ANCResultRow["name"]."','F','".$ANCResultRow['age']."','".$ANCResultRow["address"]."','29','".$ANCResultRow['dignosis']."','opd','0000-00-00','".$ANCResultRow["create_date"]."','".$ANCResultRow["weight"]."','".$ANCResultRow["occupation"]."','".$ANCResultRow["pulse"]."','".$ANCResultRow["bp"]."','".$ANCResultRow["nadi"]."','".$ANCResultRow["ur"]."','".$ANCResultRow["cvs"]."','".$ANCResultRow["udar"]."','".$ANCResultRow["netra"]."','".$ANCResultRow["jivha"]."','".$ANCResultRow["kusudha"]."','".$ANCResultRow["ahar"]."','".$ANCResultRow["mal"]."','".$ANCResultRow["proxy_id"]."','1','".$ANCResultRow["lmp_date"]."','".$ANCResultRow["edd_date"]."','".$ANCResultRow["fhs"]."','".$ANCResultRow["ag"]."')";
                            $yes= $this->db->query($query1);
                            if($yes){
                                $query3 = "update items_anc set flag=1 where id='".$ANCResultRow["id"]."'";
                                $mysqli->query($query3);
                            }
                        }
                    }
                }
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	       
       $sql1="SELECT * FROM  patient WHERE  yearly_reg_no !='' ORDER BY id DESC LIMIT 1;";
       $result1 = $mysqli->query($sql1);
	   $row1=$result1->fetch_assoc();
	   echo "Sr no is ".$srno=$row1['yearly_reg_no'];
	   if(empty($srno)){
		  $srno=0; 
	   }else{
		   $srno=$row1['yearly_reg_no'];
	   }
	    echo "Sr no is real ".$srno;



            ///KSHARSUTRA IPD PATIENT FOLLOW UP START ///

                    $follow_up_date_ks = date('Y-m-d', strtotime($ADV_DAY1));

                    $old_date_ks = date('Y-m-d', strtotime("-5 days", strtotime($ADV_DAY1)));

                    $kshar_sutra = "SELECT patient.*, patient_ipd.discharge_date as dd 
                    FROM patient 
                    JOIN patient_ipd ON patient_ipd.yearly_reg_no = patient.yearly_reg_no
                    WHERE patient_ipd.discharge_date = '$old_date_ks' 
                    AND patient.dignosis LIKE '%BHAGANDAR%' 
                    AND patient.ipd_patient_flag = '1' 
                    AND patient.ks_follow_up_flag = '0'";

                    $kshar_sutra_result = $this->db->query($kshar_sutra);

                    if ($kshar_sutra_result) 
                    {
                        foreach ($kshar_sutra_result->result_array() as $row111) 
                        {
                            $query12 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,
                            date_of_birth,address,department_id,dignosis,ipd_no,
                            discharge_date,create_date,ipd_opd,flag,ipd_patient_flag,ks_follow_up_flag,fol_up_date,
                            wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,
                            netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id,sym_reduce_per) 
                            values('".$row111["patient_id"]."','".$row111["yearly_no"]."','".$row111['daily_reg_no']."',
                            '".$row111['monthly_reg_no']."','".$row111['yearly_reg_no']."','".$row111["firstname"]."',
                            '".$row111['sex']."','".$row111['date_of_birth']."','".$row111['address']."',
                            '".$row111['department_id']."','".$row111['dignosis']."',
                            '".$row111['ipd_no']."','".$row111['discharge_date']."',
                            '".$follow_up_date_ks."','opd','1','1','1','".$fol_up_date."','".$row111['wieght']."',
                            '".$row111['occupation']."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."',
                            '".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."',
                            '".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."',
                            '".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."',
                            '".$nidra[$nidra1]."','".$row111['proxy_id']."','".$ruduce[$ruduce1]."')";

                            $this->db->query($query12);

                            $query22 = "UPDATE patient SET ks_follow_up_flag = 1 WHERE id = " . $row111["id"];
                            $this->db->query($query22);
                        }
                    } 
                    else 
                    {
                    echo "Error executing query: " . $this->db->error();
                    }

                    // SECOND FOLLOW UP
                    $kshar_sutra_next_follow_up = "SELECT * FROM patient WHERE ipd_patient_flag = '1' AND ks_follow_up_flag = '1'
                    AND dignosis LIKE '%BHAGANDAR%' AND old_reg_no !=''";
                    $kshar_sutra_next_follow_up_new = $this->db->query($kshar_sutra_next_follow_up);
                    if($kshar_sutra_next_follow_up_new)
                    {
                        foreach ($kshar_sutra_next_follow_up_new->result_array() as $row11) 
                        {
                            $ks_old_follow_up_date = date("Y-m-d",strtotime($row11["create_date"]));
                            $old_date_ks_n = date('Y-m-d', strtotime("+5 days", strtotime($ks_old_follow_up_date)));
                            $follow_up_date_ks_n = date('Y-m-d', strtotime($ADV_DAY1));


                            $last_count_new = "select COUNT(id) from patient where create_date = '$follow_up_date_ks_n'";
                            $total_old_ks = $this->db->query($last_count_new);
                            $count_new_ks = count($total_old_ks);


                            if($old_date_ks_n == $follow_up_date_ks_n && $count_new_ks >='45')
                            {
                                $query12 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,
                                date_of_birth,address,department_id,dignosis,ipd_no,
                                discharge_date,create_date,ipd_opd,flag,ipd_patient_flag,ks_follow_up_flag,fol_up_date,
                                wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,
                                netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id,sym_reduce_per) 
                                values('".$row11["patient_id"]."','".$row11["yearly_no"]."','".$row11['daily_reg_no']."',
                                '".$row11['monthly_reg_no']."','".$row11['old_reg_no']."','".$row11["firstname"]."',
                                '".$row11['sex']."','".$row11['date_of_birth']."','".$row11['address']."',
                                '".$row11['department_id']."','".$row11['dignosis']."',
                                '".$row11['ipd_no']."','".$row11['discharge_date']."',
                                '".$follow_up_date_ks_n."','opd','1','1','3','".$fol_up_date."','".$row11['wieght']."',
                                '".$row11['occupation']."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."',
                                '".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."',
                                '".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."',
                                '".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."',
                                '".$nidra[$nidra1]."','".$row11['proxy_id']."','".$ruduce[$ruduce1]."')";

                                $this->db->query($query12);
                                $query22 = "UPDATE patient SET ks_follow_up_flag = 2 WHERE id = " . $row11["id"];
                                $this->db->query($query22);
                            }
                        }
                    }
                    else 
                    {
                        echo "Error executing query: " . $this->db->error();
                    }



///KSHARSUTRA IPD PATIENT FOLLOW UP END ///



	   $rand=rand(6,9);
       echo "<br>";
       echo "old ipd rand day ".$rand."<br>";
       $old_date=date('Y-m-d', strtotime("-$rand days", strtotime($ADV_DAY1)));
      // date('Y-m-d', strtotime("-$rand days", strtotime($ADV_DAY1)));
      
       $old_date1='%'.$old_date.'%';
	   $old_rand=rand(1,2);
	  // $old_date1 = "SELECT * FROM patient WHERE flag= 0 AND department_id!='35'  AND create_date LIKE  '$old_date1' AND yearly_reg_no !='' ORDER BY rand(id)  LIMIT  $old_rand";
	   $old_date1 = "SELECT * FROM patient WHERE flag= 0 AND department_id!='35'  AND manual_status='0'  AND create_date LIKE  '$old_date1' AND yearly_reg_no !=''  OR created_by = '' ORDER BY rand(id)  LIMIT  $old_rand";
	   $result11 = $mysqli->query($old_date1);
	   // $row1=$result11->fetch_assoc();
	   //$old_date111=$row1['created_date'];
	   
	   echo "old_record is ".$result11->num_rows;
	   
	  
	   if ($result11->num_rows > 0) {
	    $flag='1';
	    $ipd_opd1='opd';
	    $ipd_opd2='ipd';
	    $n=1;
	    
	       
	    
	    if($result_t_old <= $today_old_percentage_M){
	    while($row1 = $result11->fetch_assoc()) {
	         
	         if($n == 1){
               $date_opd_old = date('Y-m-d H:i:s',strtotime('-10 minutes'))."<br>";
              }
              else if($n == 2){
               $date_opd_old = date('Y-m-d H:i:s',strtotime('-5 minutes'))."<br>";
              }
              else if($n == 3){
               $date_opd_old = date('Y-m-d H:i:s',strtotime('-2 minutes'))."<br>";
              }
            
              else {
              $date_opd_old = date('Y-m-d H:i:s')."<br>";
              }
              $date_opd_old1=$ADV_DAY1;
              //echo $date_opd_old;
             
                    $yearly_reg_no=NULL;
                    $old_reg_no = $row1['yearly_reg_no'];
                    
                   echo "<br> id old: " . $row1["id"]. " - Name: " . $row1["firstname"]." - yearly reg id: " . $row1["yearly_reg_no"]."<br>";
                   
                   
                   
             
	         //$bp=array('130/80','124/86','138/88','116/90','110/70','136/84','132/72','128/60','142/90');
	         
	        $bp = array('122/82','128/78','120/80','118/78','110/70','116/76','130/82','112/72','114/74','124/84','126/86');
            if($row['VIBHAG'] !=32){
                $Pulse =array('78','84','86','80','76','74','70','88','90','72','82');
            }else{
                $Pulse =array('92','104','108','106','96','98','94','90','100','102','110');
            }
	         
	         $nadi=array('मंडूकगति', 'सर्पगती ' , 'हंसगति','अविशेष');
             //$Pulse =array(76,78,88,90,68,72,82,66,74,92,64);
             
             
             $netra=array('आविल','अच्छ','इषतपीत') ;
             $givwa=array('साम','निराम');
             $sudha=array('तीक्ष्णाग्नि', 'समाग्नि', 'विषमाग्नि');    
            
             $ahar=array('प्रभुत ','अल्प ','मध्यम');
             $mal=array('साम ','निराम ','कठीण ','दुर्गंधीयुक्त ','अविशेष');
             $mutra=array('पीत','आविल','दुर्गंधीयुक्त','अविशेष');
             $nidra=array('अविशेष','प्रभुत','अल्प');

             
	          
	          
	       
	          $c_o=$row1['dignosis'];
	          $h_o='NAD';
	          $f_o='NAD';
	          $Pulse1=array_rand($Pulse);
	          $Pulse[$Pulse1];
	          $bp1=array_rand($bp);
	          $bp[$bp1];
	          
	          $nadi1=array_rand($nadi);
	          $nadi[$nadi1];
	          $ur= 'अविशेष';
	          $cvs ='S1S2 N';
              $udar='soft';
	          
	         
	          
	          
	           $netra1=array_rand($netra);
	           $netra[$netra1];
	          
	           $givwa1=array_rand($givwa);
	           $givwa[$givwa1];
	           
	           
	           $sudha1=array_rand($sudha);
	           $sudha[$sudha1];
	           
	           $ahar1=array_rand($ahar);
	           $ahar[$ahar1];
	           
	           $mal1=array_rand($mal);
	           $mal[$mal1];
	           
	           $mutra1=array_rand($mutra);
	           $mutra[$mutra1];
	           
	           $nidra1=array_rand($nidra);
	           $nidra[$nidra1];
	           
                $ruduce =array(10,25,50,75);
                $ruduce1=array_rand($ruduce);
                $ruduce[$ruduce1];
	           
                   //FOLLOW UP OLD GARBHINI 
                    if($row1['dignosis']=='GARBHINI-SRIIIII'){
                        $follow_up=$row1['follow_up'] + 1;
                        $master_g_id=$row1['master_g_id'];
                        $date202= date('Y-m-d',strtotime($row1['create_date']));
                        $today202=$ADV_DAY1;
                        $datetime1 = date_create($date202); 
                        $datetime2 = date_create($today202); 
  
                        $inter = date_diff($datetime1, $datetime2); 
                        $inter1=$inter->format('%a'); 
                        if($inter1 <=30){
                             
                        }else{
                        $date_opd_old1=$ADV_DAY1; 
                        if($row1["firstname"]){
                        $query12 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,flag,'master_g_id','follow_up','wieght') values('".$row1["patient_id"]."','".$row1["yearly_no"]."','".$row1['daily_reg_no']."','".$row1['monthly_reg_no']."','".$row1['yearly_reg_no']."','".$row1["firstname"]."','".$row1['sex']."','".$row1['date_of_birth']."','".$row1['address']."','".$row1['department_id']."','".$row1['dignosis']."','".$ipd_opd1."','".$row1['ipd_no']."','".$row1['discharge_date']."','".$date_opd_old1."','".$flag."','".$master_g_id."','".$follow_up."','".$row1['wieght']."')";
                        $mysqli->query($query12);
                        }
                        if($follow_up==9){
                          $master_gar_nav = "SELECT * FROM garbhini_navjat where id='$master_g_id'";
                          $master_gar_nav1 = $mysqli->query($master_gar_nav);
	                      $master_gar_nav12=$master_gar_nav1->fetch_assoc();
                          $master_nav=$master_gar_nav12['id'];
                          
                         $last_id1 = "SELECT * total FROM patient_ipd where create_date LIKE '$year' ORDER BY id DESC LIMIT 1";
                         $last_id11 = $mysqli->query($last_id1);
	                     $last_id22=$last_id11->fetch_assoc();
	                     $patient_id1=$last_id22['patient_id'] + 1;
	                     if($last_id22['yearly_reg_no']){
                         $yearly_reg_no1=$last_id22['yearly_reg_no'] + 1;
	                     }else{
	                       $yearly_reg_no1=$last_id22['old_reg_no'] + 1;  
	                     }
                         $year_no1 = $last_id22['yearly_no'] + 1;
                         $daily_reg_no1 = $last_id22['daily_reg_no'] + 1;
                          
                          //Garbhini and navjat entry
                          $query13 = "insert into patient_ipd(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,'master_g_id','follow_up',wieght) values('".$patient_id1."','".$year_no1."','".$daily_reg_no1."','','".$yearly_reg_no1."','".$row1["firstname"]."','".$row1['sex']."','".$row1['date_of_birth']."','".$row1['address']."','".$row1['department_id']."','".$row1['dignosis']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row1['discharge_date']."','".$date_opd_old1."','".$master_g_id."','".$follow_up."','".$row1['wieght']."')";
                          $mysqli->query($query13); 
                           
                          $query13 = "insert into patient_ipd(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,'master_g_id','follow_up',wieght) values('".$patient_id1."','".$year_no1."','".$daily_reg_no1."','','".$yearly_reg_no1."','".$master_gar_nav12["b_name"]."','".$master_gar_nav12['b_sex']."','','".$master_gar_nav12['address']."','".$master_gar_nav12['department_id']."','".$master_gar_nav12['b_dignosis']."','".$ipd_opd2."','','','".$date_opd_old1."','".$master_g_id."','''".$row1['wieght']."')";
                          $mysqli->query($query13); 
                          $query22 = "update patient set flag = 1 where id=".$row1["id"];
                         }
                        }
               
                       }
                       else{
                       $fol_up_date=date('Y-m-d',strtotime($row1["create_date"]));
                       if($row1["firstname"]){
	                   $query12 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,flag,fol_up_date,wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id,sym_reduce_per) values('".$row1["patient_id"]."','".$row1["yearly_no"]."','".$row1['daily_reg_no']."','".$row1['monthly_reg_no']."','".$row1['yearly_reg_no']."','".$row1["firstname"]."','".$row1['sex']."','".$row1['date_of_birth']."','".$row1['address']."','".$row1['department_id']."','".$row1['dignosis']."','".$ipd_opd1."','".$row1['ipd_no']."','".$row1['discharge_date']."','".$date_opd_old1."','".$flag."','".$fol_up_date."','".$row1['wieght']."','".$row1['occupation']."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row1['proxy_id']."','".$ruduce[$ruduce1]."')";
                       //$mysqli->query($query12);
                       $this->db->query($query12);
                       $query22 = "update patient set flag = 1 where id=".$row1["id"];
                       $mysqli->query($query22);
                       }
                       }
                       echo $i."<br>";
                       $n++;
               
			 
         }
	    }
	    
	     if($result_t_new<= $today_new_percentage_M){
       //if($result_t_new){
	   $rand=(rand(1,3));
	   
       // CJOB Auto Push Code Start -------------------------------------------------------------------
       
       //$sql = "SELECT * FROM items WHERE flag= 0 AND Sno > $srno ORDER by id ASC LIMIT  $rand";
        $sql = "SELECT * FROM items WHERE flag= 0  ORDER by id ASC  LIMIT  $rand";
        
        // CJOB Auto Push Code End -------------------------------------------------------------------
        
       $result = $mysqli->query($sql);
         //echo $result->num_rows;
         if ($result->num_rows > 0) 
	   {
          // output data of each row
        
        
           //admit patient
           echo  "<br>current date for admit ".$date_admit = $ADV_DAY;
           echo "<br>";
           echo "strat date for admit ".$date_admit1=$ADV_DAY1." 01:00";
           echo "<br>";
           
           echo "end date for admit ".$date_admit2 = $ADV_DAY1." 23:45";
           $sql_admit = "SELECT * FROM patient WHERE flag = 1 AND ipd_opd ='opd' AND ipd_flag = 0 LIMIT  1";
           $result_admit = $mysqli->query($sql_admit);
	       $row_admit=$result_admit->fetch_assoc();
	      
	       $single_record=$result_admit->num_rows;
	       //$old_date111=$row1['created_date'];
	       // end admit patient
	       
	       //admit_todays  
	        $admit_todays1='%'.$ADV_DAY1.'%';
	        $admit_todays = "SELECT * FROM patient_ipd WHERE  create_date LIKE  '$admit_todays1' AND ipd_opd ='ipd' AND ipd_flag = 1";
	         $admit_todayss = $mysqli->query($admit_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_admit_todays=$admit_todayss->num_rows;
            echo "<br>today_total_admit ".$total_admit_todays."<br>";
            // end admit_todays
            
           
            
             //master limit admit patient
             $admit_todays_limit = "SELECT * FROM admit_patient_limit";
	         $admit_todayss1 = $mysqli->query($admit_todays_limit);
	         $admit_todayss11=$admit_todayss1->fetch_assoc();
             $admit_limit=$admit_todayss11['data_limit'];
            // end master limit admit patient
            
            
            
              $value=date('d',strtotime($ADV_DAY1)); 
	           if ($value % 2) {
                 //$admit_limit=$admit_todayss11['data_limit'] + 2;
                 $admit_limit=$admit_todayss11['data_limit'];
                } else {
                   $admit_limit=$admit_todayss11['data_limit'] + 1;
                }
            
               /* $value=date('d',strtotime($ADV_DAY1)); 
	           if ($value % 2) {
                 $admit_limit=$admit_todayss11['data_limit'];
                } else {
                   $admit_limit=$admit_todayss11['data_limit'] - 1;
                }*/
            
            
             //master limit occupancy patient
             $occupancy_todays_limit = "SELECT * FROM occupancy_limit";
	         $occupancy_todayss1 = $mysqli->query($occupancy_todays_limit);
	         $occupancy_todayss11=$occupancy_todayss1->fetch_assoc();
             $occupancy_limit=$occupancy_todayss11['data_limit'];
            // end master limit occupancy patient
            
            
            //occupancy_todays  
	        $occupancy_todays = "SELECT * FROM patient_ipd WHERE  discharge_date ='0000-00-00' AND ipd_opd ='ipd'";
	        $occupancy_todayss = $mysqli->query($occupancy_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_occupancy_todays=$occupancy_todayss->num_rows;
            echo "<br>today_total_occupancy ".$total_occupancy_todays."<br>";
            // end occupancy_todays
            
             
            
            //master limit discharge patient
             $discharge_todays_limit = "SELECT * FROM discharge_patient_limit";
	         $discharge_todayss1 = $mysqli->query($discharge_todays_limit);
	         $discharge_todayss11=$discharge_todayss1->fetch_assoc();
             $discharge_limit=$discharge_todayss11['data_limit'];
            // end master limit discharge patient
            
            ////// if($total_occupancy_todays < 80)
            ////// { 
            //////      $admit_limit=$admit_todayss11['data_limit'] + 3;
            ////// }else if($total_occupancy_todays > 90)
            ////// {
            //////      $discharge_limit=$discharge_todayss11['data_limit'] + 5;
            ////// }
            /*if($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            { 
                 $admit_limit = rand(6,9);
            }elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            {
                 $admit_limit = -1;
            }
            elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            {
                $admit_limit = 9;
            }
            else{
                $admit_limit = $admit_todayss11['data_limit'];
            }*/
             if(date('Y',strtotime($ADV_DAY1)) == '2019'){
                if($total_occupancy_todays <= 30)
                { 
                     $admit_limit = rand(4,7);
                }elseif($total_occupancy_todays >= 35)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 30 && $total_occupancy_todays < 35)
                {
                    $admit_limit = 3;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2020'){
                if($total_occupancy_todays <= 45)
                { 
                     $admit_limit = rand(9,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 45 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 5;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2021'){
                if($total_occupancy_todays <= 55)
                { 
                     $admit_limit = rand(6,8);
                }elseif($total_occupancy_todays >= 60)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 55 && $total_occupancy_todays < 60)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2022'){
                if($total_occupancy_todays <= 40)
                { 
                     $admit_limit = rand(8,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
           elseif(date('Y',strtotime($ADV_DAY1)) == '2023'){
                if($total_occupancy_todays <= 45)
                { 
                     $admit_limit = rand(8,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 45 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2024'){


                 if($admit_todayss11['data_limit'] !='-1'){

                if($total_occupancy_todays <= 65)
                { 
                     $admit_limit = rand(15,20);
                }elseif($total_occupancy_todays >= 75)
                {
                     $admit_limit = -1;
                }
              elseif($total_occupancy_todays > 90 && $total_occupancy_todays < 100)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
               }
            }
              elseif(date('Y',strtotime($ADV_DAY1)) == '2025'){


                 if($admit_todayss11['data_limit'] !='-1'){

                if($total_occupancy_todays <= 60)
                { 
                     $admit_limit = rand(15,20);
                }elseif($total_occupancy_todays >= 65)
                {
                     $admit_limit = -1;
                }
              elseif($total_occupancy_todays > 65 && $total_occupancy_todays < 65)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
               }
            }
            
            
            // random discharge limit
            //  $value=date('d',strtotime($ADV_DAY1)); 
	           //if ($value % 2) {
            //      $discharge_limit=$discharge_todayss11['data_limit'] - 1;
            //     } else {
            //       $discharge_limit=$discharge_todayss11['data_limit'];
            //     }
            
            // random discharge limit end
            
             echo "<br>today_total_admit_limit ".$admit_limit."<br>";
            
            //discharge_todays  
	        $discharge_todays1='%'.$ADV_DAY1.'%';
	        $discharge_todays = "SELECT * FROM patient_ipd WHERE  discharge_date LIKE  '$discharge_todays1' AND ipd_opd ='ipd'";
	        $discharge_todayss = $mysqli->query($discharge_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_discharge_todays=$discharge_todayss->num_rows;
            echo "<br>today_total_discharge ".$total_discharge_todays."<br>";
            echo "<br>today_total_discharge_limit ".$discharge_limit."<br>";
            // end discharge_todays
            
            // discharge patient 
            echo  "<br>current date for discharge ".$date_discharge = $ADV_DAY;
            echo "<br>";
            echo "strat date for discharge ".$date_discharge1=$ADV_DAY1." 01:00";
            echo "<br>";
            echo "end date for discharge ".$date_discharge2 = $ADV_DAY1." 23:45";
            
            //if($total_discharge_todays < $discharge_limit){
                // $rand_dis=rand(6,10);
                // $old_date_dis=date('Y-m-d', strtotime("-$rand_dis days", strtotime($ADV_DAY1)));
                // $old_date_dis1='%'.$old_date_dis.'%';
                // //echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd'  LIMIT 1";
                // /////echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd' or DATEDIFF('$ADV_DAY1', create_date) > '$rand_dis' AND discharge_date ='0000-00-00' AND ipd_opd ='ipd' LIMIT 1";
                // echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd' or DATEDIFF('$ADV_DAY1', '$old_date_dis') > '$rand_dis' AND discharge_date ='0000-00-00' AND ipd_opd ='ipd' LIMIT 1";
                // $discharge_patient1 = $mysqli->query($discharge_patient);
                // $discharge_patient2 = $discharge_patient1->fetch_assoc();
                // $dis_id = $discharge_patient2['id'];
                // $master_id_dis = $discharge_patient2['master_g_id'];
                // $bed_remove=$discharge_patient2['bedNo'];
                if($discharge_todayss11['data_limit']!='-1'){
                echo '<br>';
                echo $Check_discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date < '$ADV_DAY1' AND ipd_opd ='ipd' order by rand() LIMIT 1";
                //////echo $Check_discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date < '$ADV_DAY1' AND ipd_opd ='ipd' LIMIT 1";
                $Check_discharge_patient1 = $mysqli->query($Check_discharge_patient);
                $Check_discharge_patient2 = $Check_discharge_patient1->fetch_assoc();
                
                $che=trim($Check_discharge_patient2['dignosis']);
                $len=strlen($che);
                $dd= substr($che,$len - 1);
                $str = $Check_discharge_patient2['dignosis'];
                $arry=explode("-",$str);
                $t_c=count($arry);
                if($t_c=='2'){
                    $dd1=substr($che, 0, -1);
                    $new_str = trim($arry[0]);
                    $dis_dia = '%'.$new_str.'%';
                    $dis_p_dignosis_name=$Check_discharge_patient2['dignosis'];
                }else{
                    $dis_dia = '%'.$che.'%';
                    $dis_p_dignosis_name=$Check_discharge_patient2['dignosis'];
                }
                $dis_proxy_id = $Check_discharge_patient2['proxy_id'];
                $dis_department_id = $Check_discharge_patient2['department_id'];
                $dis_p_id = $Check_discharge_patient2['id'];
                $dis_p_create_date = date('Y-m-d', strtotime($Check_discharge_patient2['create_date']));
                
                $tretment=$this->db->select("*")
                    ->from('treatments1')
                    ->where('dignosis LIKE',$dis_dia)
                    ->where('proxy_id',$dis_proxy_id)
                    ->where('department_id', $dis_department_id)
                    ->where('ipd_opd','ipd')
                    ->get()
                    ->row();
                $ipd_days= $tretment->ipd_days;
                
                echo '<br>';
                echo $ipd_days;
                echo '<br>';
                
                $date1=date_create(date("Y-m-d", strtotime($dis_p_create_date)));
                $date2=date_create(date("Y-m-d", strtotime($ADV_DAY1)));
                $diff=date_diff($date1,$date2);
                $Days = $diff->d;
                
                echo '<br>';
                echo 'Discharge Diff. Days ==> '.$Days;
                echo '<br>';
                
                if($Days >= $ipd_days){
                    echo '<br>';
                    echo 'Patient On Bed Days :- '.$Days.'<br>';
                    echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE id = '$dis_p_id' AND ipd_opd ='ipd'";
                    $discharge_patient1 = $mysqli->query($discharge_patient);
                    $discharge_patient2 = $discharge_patient1->fetch_assoc();
                    $dis_id = $discharge_patient2['id'];
                    $master_id_dis = $discharge_patient2['master_g_id'];
                    $bed_remove=$discharge_patient2['bedNo'];
                ////////}
           
           //}
           
        //   ////Treatment Wise Discharge
        //   // disharge with numbers
        //     $dis_create_date=$discharge_patient2['create_date'];
        //     $dis_dia='%'.$discharge_patient2['dignosis'].'%';
        //     $dis_proxy_id=$discharge_patient2['proxy_id'];
        //     $tretment=$this->db->select("*")

			     //                    ->from('treatments1')

			     //                    ->where('dignosis LIKE',$dis_dia)
			     //                    ->where('proxy_id',$dis_proxy_id)
			     //                    ->where('ipd_opd','ipd')
        //                              ->get()
        //                              ->row();
        //         $ipd_days= $tretment->ipd_days;      
                
        //         if($ipd_days <= 6){
        //             $ipd_days=$ipd_days + 1;
        //         }else{
        //             $ipd_days=$ipd_days;
                    
        //         }
                
        //         $date=date_create($dis_create_date);
                
        //         date_add($date,date_interval_create_from_date_string($ipd_days." days"));
        //         if($ipd_days){
        //          $date_of_dis=date_format($date,"Y-m-d");
        //         }
        //         else {
        //           $date_of_dis=$ADV_DAY1;
        //         }                            
            
            echo "<br>dis id before".$dis_id;
              ////if(($date_discharge1 <= $date_discharge) && ($date_discharge2 >= $date_discharge) && ($total_discharge_todays <= $discharge_limit)){
            if(($date_discharge1 <= $date_discharge) && ($date_discharge2 >= $date_discharge)){
                  /////////////////////if((date('Y-m-d',strtotime($date_discharge1)) <= date('Y-m-d',strtotime($date_discharge))) && (date('Y-m-d',strtotime($date_discharge2)) >= date('Y-m-d',strtotime($date_discharge)))){
                   echo "<br>discharge_id :".$dis_id."<br>";
            // $date_of_dis=$ADV_DAY;
            $date_of_dis=$ADV_DAY1;
             $query3 = "update patient_ipd set discharge_date = '$date_of_dis' where id = ".$dis_id;
             $mysqli->query($query3);
             if($master_id_dis){
             $discharge_patient_nav = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND master_g_id ='$master_id_dis' AND ipd_opd ='ipd'";
             $discharge_patient_nav1 = $mysqli->query($discharge_patient_nav);
             $discharge_patient_nav2 = $discharge_patient_nav1->fetch_assoc();
             $dis_id_nav = $discharge_patient_nav2['id']; 
             
             $query33 = "update patient_ipd set discharge_date = '$date_of_dis' where id = ".$dis_id_nav;
             $mysqli->query($query33);
             }
             if($bed_remove){
                 $query2222 = "update beds set status = 0 where id=".$bed_remove;
                      $mysqli->query($query2222);
                      
                       $query22222 = "update patient_ipd set bed_status = 0 where id = ".$dis_id;
                      $mysqli->query($query22222);
             }else{
                 
                 
             }
              }
            
            }
                }
            //end discharge patient
            
            
             
            
        
        
              $m=0;
              $j=1;
              $ipd_opd2='opd';
              $ipd_opd='ipd';
              
             $adress_def=array();
             $address = "SELECT * FROM address";
             $address1 = $mysqli->query($address);
	         while($address2=$address1->fetch_assoc()){
	        // $auto_on_off2['description']."<br>";
	           array_push($adress_def,$address2['name']);
	         }
	         
	         

        while($row = $result->fetch_assoc()) {
              $m++;
              if(($row['SEX']=='M') && ($row['VIBHAG'] !=32)){
                  
	              $occupation= array('Farmer','Office','Business','Job','Labor','Jobless','Teacher','other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
              	
	         }
	         else if(($row['SEX']=='F') && ($row['VIBHAG'] !=32)){
	              $occupation= array('Farmer','Office','Business','Job','Labor','Jobless','Teacher','other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
	         }
	         else{
	              $occupation= array('Student','other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
                  $key = array_rand($a);
	         }
	          
	          
	          $c_o=$row['NIDAN'];
	         $h_o='NAD';
	         $f_o='NAD';
	         $bp=array('130/80','124/86','128/88','116/90','110/70','112/84','1114/72','122/60','126/90');
	         $nadi=array('मंडूकगति', 'सर्पगती ' , 'हंसगति','अविशेष');
             $Pulse =array(76,78,88,90,68,72,82,66,74,92,64);
             $ur= 'अविशेष';
             $cvs ='S1S2 N';
             $udar='soft';
             $netra=array('आविल','अच्छ','इषतपीत') ;
             $givwa=array('साम','निराम');
             $sudha=array('तीक्ष्णाग्नि', 'समाग्नि', 'विषमाग्नि');      
            
             $ahar=array('प्रभुत ','अल्प ','मध्यम');
             $mal=array('साम ','निराम ','कठीण ','दुर्गंधीयुक्त ','अविशेष');
             $mutra=array('पीत','आविल','दुर्गंधीयुक्त','अविशेष');
             $nidra=array('अविशेष','प्रभुत','अल्प');

              $key = array_rand($a); 
	          $a[$key];
	          $key1 =array_rand($occupation);
	          $occupation[$key1];
	          $key2=array_rand($adress_def);
	          $adress_def[$key2];
	          
	          
	          $c_o1=array_rand($c_o);
	          $c_o[$c_o1];
	          
	          $bp1=array_rand($bp);
	          $bp[$bp1];
	          
	          $nadi1=array_rand($nadi);
	          $nadi[$nadi1];
	          
	          $Pulse1=array_rand($Pulse);
	          $Pulse[$Pulse1];
	          
	          $netra1=array_rand($netra);
	          $netra[$netra1];
	          
	           $givwa1=array_rand($givwa);
	           $givwa[$givwa1];
	           
	           
	           $sudha1=array_rand($sudha);
	           $sudha[$sudha1];
	           
	           $ahar1=array_rand($ahar);
	           $ahar[$ahar1];
	           
	           $mal1=array_rand($mal);
	           $mal[$mal1];
	           
	           $mutra1=array_rand($mutra);
	           $mutra[$mutra1];
	           
	           $nidra1=array_rand($nidra);
	           $nidra[$nidra1];
	           
	           $ruduce =array(10,25,50,75);
               $ruduce1=array_rand($ruduce);
	           $ruduce[$ruduce1];
	          
              if($j == 1){
               $date_new = date('Y-m-d H:i',strtotime('- 10 minutes'))."<br>";
              }
              else if($j == 2){
               $date_new = date('Y-m-d H:i',strtotime('- 7 minutes'))."<br>";
              }
               else if($j == 3){
               $date_new = date('Y-m-d H:i',strtotime('- 4 minutes'))."<br>";
              }
               else if($j == 4){
               $date_new = date('Y-m-d H:i',strtotime('- 2 minutes'))."<br>";
              }
               
              else {
              $date_new =$ADV_DAY."<br>";
              }
             $date_new1=$ADV_DAY1;
              $j++;
                if(empty($row['CopddD_New'])){
                    $CopddD_New=NULL;
                    $Copdd_Old=$row['Copdd_Old'];
                      echo "<br>Sno: " . $row["Sno"]. " - Name: " . $row["NAME"]."<br>";
                      
                      if($row["NAME"]){
	                  $query1 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,sym_reduce_per) values('".$row["Sno"]."','".$row["yealry_number"]."','".$row['Daily']."','".$row['Monthly']."','".$Copdd_Old."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_new1."','".$a[$key]."','".$occupation[$key1]."' ,'".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$ruduce[$ruduce1]."')";
                      $yes=$mysqli->query($query1); 
                       if($yes){
			          $query2 = "update items set flag=1 where Sno=".$row["Sno"];
                      $mysqli->query($query2);
                      }
                      }
            //MASTER GARBHINI INSERT INTO PATIENT
            $month=date('m');
           
            $year = '%'.$this->session->userdata['acyear'].'%';
            $year1=$this->session->userdata['acyear'];
            $d=cal_days_in_month(CAL_GREGORIAN,$month,$year1);
            $dd='%GARBHINI-SR%';
            $start_date=$year1.'-'.$month.'-01 00:00:00';
            //echo "<br>";
            $end_date=$year1.'-'.$month.'-'.$d.' 23:59:00'; 
           
             $auto_on_off = "SELECT count(*) as total FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date'";
          
	         $auto_on_off1 = $mysqli->query($auto_on_off);
	         $auto_on_off2=$auto_on_off1->fetch_assoc();
             $auto_on_off3=$auto_on_off2['total'];
            
            $rand =rand(4,5);
           
            if($auto_on_off3 <= $rand){
              
                
               $G= "SELECT * FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date' ORDER BY id DESC LIMIT 1";
               $G1 = $mysqli->query($G);
	           $G2=$G1->fetch_assoc();
               $G3= date('Y-m-d',strtotime($G2['create_date']));
               $today=date('Y-m-d');
               $datetime1 = date_create($G3); 
               $datetime2 = date_create($today); 
  
               $interval = date_diff($datetime1, $datetime2); 
               $interval1=$interval->format('%a'); 
               $rand1=rand(4,6);
               if($interval1 <= $rand1){
                  // echo "no";
                   
                         
               }else{
                   // echo "yes";
                    $last_id = "SELECT * FROM patient where create_date LIKE '$year' and  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $last_id1 = $mysqli->query($last_id);
	                $last_id2=$last_id1->fetch_assoc();
	                     $patient_id=$last_id2['patient_id'] + 1;
                         $yearly_reg_no=$last_id2['yearly_reg_no'] + 1;
                         $year_no = $last_id2['yearly_no'] + 1;
                         $daily_reg_no = $last_id2['daily_reg_no'] + 1;
                        // $old_reg_no = $last_id2['old_reg_no'] + 1;
                        
                        $master_gar = "SELECT * FROM garbhini_navjat where status ='0'  ORDER BY id DESC LIMIT 1";
                        $master_gar1 = $mysqli->query($master_gar);
	                    $master_gar2=$master_gar1->fetch_assoc();
                        $master_id=$master_gar2['id'];
                         
                      if($m == 1){  
                    if($master_gar2['m_name']){
                      $date_new1=$ADV_DAY1;
                      if($master_gar2['m_name']){
                      $query1 = "insert into patient(patient_id,yearly_reg_no,yearly_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,master_g_id,follow_up,wieght,occupation) values('".$patient_id."','".$yearly_reg_no."','".$year_no."','".$daily_reg_no."','','".$master_gar2['m_name']."','".$master_gar2['sex']."','".$master_gar2['age']."','".$adress_def[$key2]."','".$master_gar2['department_id']."','".$master_gar2['dignosis']."','".$master_gar2['ipd_opd']."','','','".$date_new1."','".$master_gar2['id']."','".$master_gar2['follow_up']."','".$a[$key]."','".$occupation[$key1]."')";
                      $mysqli->query($query1);
			          $query2 = "update garbhini_navjat set status=1 where id=".$master_id;
                      $mysqli->query($query2);
                      }
                          
                      }
                          
                      }     
                   }

                   } else {
                   echo "No garbhini limit over";
                  }
                      //END GARBHINI
                      
                      
              
                     if(($single_record == $m ) && ($total_admit_todays <= $admit_limit)){
                  
                   
                      //if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit) && ($total_discharge_todays <= $discharge_limit)) {
                      if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit)) {
                          if(($row['VIBHAG'] == '35') || ($row['VIBHAG'] == '28')){
                          }
                          else{
                          
                          $gender1=$row['SEX'];
                          $depart_id1= $row['VIBHAG'];
                          
                        if($depart_id1 == '28'){
                            $depart_id='34';
                        }else{
                             $depart_id= $row['VIBHAG'];
                        }
                        
                        $dep_bed_limit = "SELECT * FROM data_lmit_dept_ipd where dept_id=".$depart_id;
            	         $dep_bed_limit1 = $mysqli->query($dep_bed_limit);
            	         $dep_bed_limit11=$dep_bed_limit1->fetch_assoc();
            	         
            	         if($SEX_Check=='M'){
                         $data_limit=$dep_bed_limit11['data_limit_m'];
            	         }else{
            			 $data_limit=$dep_bed_limit11['data_limit_f'];
            	         }
            	         
            	         $dep_bed_limit_total=$data_limit;
                        // end master data_lmit_dept_ipd
            			
            			 //patient check in bed with gender
            	          $check_bed = "SELECT * FROM patient_ipd where discharge_date LIKE '%0000-00-00%' and  sex='$SEX_Check' and department_id=".$depart_id;
            	          $bed_status1 = $mysqli->query($check_bed);
            	          echo "//////////////////";  echo "<br>";
            	          echo "depart_id:".$depart_id;
            	          echo "//////////////////";  echo "<br>";
            	         echo  '$dep_bed_limit_total :'.$dep_bed_limit_total;
            	         echo "<br>";
            	         echo "//////////////////";
            	         echo  'bed_status_total :'.$bed_status_total=$bed_status1->num_rows;
            	         echo "//////////////////";
            	        // end patient check in bed with gender
                        
                         $bed = "SELECT * FROM beds WHERE gender ='$gender1' AND department_id ='$depart_id' AND status ='0' LIMIT  1";
                         $bed_no = $mysqli->query($bed);
	                     $bed_no1=$bed_no->fetch_assoc(); 
	                       if ($bed_no1) {
                            $admit_bed=$bed_no1['id'];
                            }else{
	                          $admit_bed ='';
	                        }
	                        //Admit only available diagnosis in ipd
	                   // $nivan=$row['NIDAN']."I";
	                   // $nivan1='%'.$nivan.'%';
	                    
	                    $che=trim($row['NIDAN']);
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $row['NIDAN'];
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $nivan = '%'.$new_str.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }else{
                            $nivan = '%'.$che.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }
	                    echo $nivan1 = $nivan;
	                    
	                    $proxy_id = $row['proxy_id'];
	                    //$department_id = $row['VIBHAG'];
	                    $department_id = $depart_id;
	                    
	                    $admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND proxy_id = '$proxy_id' AND department_id = '$department_id' AND ipd_opd ='ipd'";
	                    
	                    //$admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND ipd_opd ='ipd'";
                        $admit_avai_diagnosis1 = $mysqli->query($admit_avai_diagnosis);
	                    $admit_avai_diagnosis2=$admit_avai_diagnosis1->fetch_assoc(); 
	                    
	                    echo "<br>=====> 5 ";
	                    print_r($admit_avai_diagnosis2);
	                    echo "<br><br><br>"; 
	                    
	                    if($bed_status_total < $dep_bed_limit_total){ 
	                    //if($admit_avai_diagnosis2){ 
	                    if($admit_avai_diagnosis2 && $admit_bed != ''){ 
	                        
	                        $bed_status='1';
                      $query12 = "insert into patient_ipd(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,bedNo,bed_status,discharge_date,create_date) values('".$row["Sno"]."','".$row["yealry_number"]."','".$row['Daily']."','".$row['Monthly']."','".$row['Copdd_Old']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$row['Address']."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd."','".$row1['ipd_no']."','".$admit_bed."','".$bed_status."','".$row['Dischargedate']."','".$date_new."')";
                      $mysqli->query($query12); 
                      $query22 = "update patient_ipd set ipd_flag = 1 where patient_id=".$row["Sno"];
                      $mysqli->query($query22);
                      
                      $query222 = "update beds set status = 1 where id=".$admit_bed;
                      $mysqli->query($query222);
	                    }
	                    }
                       }
                      }
                      else {
                         echo "<br>no admit<br>";
                       
                     }
                   }
                }
                else {
                    //$CopddD_New=$row['CopddD_New'];
                    
                    // CJOB Auto Push Code Start ------------------------------------------------------------
                    
                    //$CopddD_New=$row['CopddD_New'];
                    $tempQuery1 = "SELECT * FROM  patient ORDER BY id DESC LIMIT 1";
                    $tempQueryResult1 = $mysqli->query($tempQuery1);
	                $tempQueryRow1=$tempQueryResult1->fetch_assoc();
	                /*print_r($tempQueryRow1);
	                die();*/
	               
                    $tempQuery = "SELECT * FROM  patient WHERE  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $tempQueryResult = $mysqli->query($tempQuery);
	                $tempQueryRow=$tempQueryResult->fetch_assoc();
	                /*print_r($tempQueryRow);
	                die();*/
                    //$CopddD_New=$row['CopddD_New'];
                    $CopddD_New=$tempQueryRow['yearly_reg_no']+1;
                    
                    // CJOB Auto Push Code End ----------------------------------------------------------------
                    
                    
                    //check dublicate New Yearly Number
                     $d_number=date('Y',strtotime($ADV_DAY1));
                     $d_number_like='%'.$d_number.'%';
	                 $check_number = "SELECT * FROM patient WHERE  create_date LIKE  '$d_number_like' AND ipd_opd ='opd' AND yearly_reg_no ='$CopddD_New'";
	                 $check_number_q = $mysqli->query($check_number);
	                 $check_number_result=$check_number_q->num_rows;
                     //check dublicate New Yearly Number end 
                    
                    

                     $Copdd_Old=NULL;
                     $date_new1=$ADV_DAY1;
                     echo "<br>Sno: " . $row["Sno"]. " - Name: " . $row["NAME"]."<br>";
                     if($check_number_result==0){
                     if($row["NAME"]){

                         $year_new = date('Y',strtotime($date_new1));
                        $check_last_record = "select * from patient where year(create_date)  = '$year_new' AND yearly_reg_no = '$CopddD_New'";
                        $check_last_record1 = $mysqli->query($check_last_record);
                        $check_last_record2=$check_last_record1->num_rows;
                        if($check_last_record2 >= 1)
                        {

                        }
                        else
                        {
                        
	                  //$query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id) values('".$row["Sno"]."','".$row["yealry_number"]."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row['proxy_id']."')";
	                  $query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id) values('".$CopddD_New."','".$CopddD_New."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row['proxy_id']."')";
                      //$mysqli->query($query1);
                     $yes= $this->db->query($query1);
                     // echo $query1;
                     if($yes){
			          $query2 = "update items set flag=1 where Sno=".$row["Sno"];
                      $mysqli->query($query2);
                     }
                        }
                     }
                     }
                      
                      //MASTER GARBHINI INSERT INTO PATIENT
            $month=date('m');
           
            $year = '%'.$this->session->userdata['acyear'].'%';
            $year1=$this->session->userdata['acyear'];
            $d=cal_days_in_month(CAL_GREGORIAN,$month,$year1);
            $dd='%GARBHINI-SRiiii%';
            $start_date=$year1.'-'.$month.'-01 00:00:00';
            //echo "<br>";
            $end_date=$year1.'-'.$month.'-'.$d.' 23:59:00'; 
           
             $auto_on_off = "SELECT count(*) as total FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date'";
          
	         $auto_on_off1 = $mysqli->query($auto_on_off);
	         $auto_on_off2=$auto_on_off1->fetch_assoc();
             $auto_on_off3=$auto_on_off2['total'];
            
            $rand =rand(4,5);
           
            if($auto_on_off3 <= $rand){
              
                
               $G= "SELECT * FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date' ORDER BY id DESC LIMIT 1";
               $G1 = $mysqli->query($G);
	           $G2=$G1->fetch_assoc();
               $G3= date('Y-m-d',strtotime($G2['create_date']));
               $today=date('Y-m-d');
               $datetime1 = date_create($G3); 
               $datetime2 = date_create($today); 
  
               $interval = date_diff($datetime1, $datetime2); 
               $interval1=$interval->format('%a'); 
               $rand1=rand(4,6);
               if($interval1 <= $rand1){
                  // echo "no";
                   
                         
               }else{
                   //echo "yes";
                    $last_id = "SELECT * FROM patient where create_date LIKE '$year' and  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $last_id1 = $mysqli->query($last_id);
	                $last_id2=$last_id1->fetch_assoc();
	                     $patient_id=$last_id2['patient_id'] + 1;
                         $yearly_reg_no=$last_id2['yearly_reg_no'] + 1;
                         $year_no = $last_id2['yearly_no'] + 1;
                         $daily_reg_no = $last_id2['daily_reg_no'] + 1;
                        // $old_reg_no = $last_id2['old_reg_no'] + 1;
                        
                        $master_gar = "SELECT * FROM garbhini_navjat where status ='0'  ORDER BY id DESC LIMIT 1";
                        $master_gar1 = $mysqli->query($master_gar);
	                    $master_gar2=$master_gar1->fetch_assoc();
                        $master_id=$master_gar2['id'];
                         
                        $date_new1=$ADV_DAY1;
                         if($m == 1){ 
                             if($master_gar2['m_name']){
                      $query1 = "insert into patient(patient_id,yearly_reg_no,yearly_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,master_g_id,follow_up,wieght,occupation) values('".$patient_id."','".$yearly_reg_no."','".$year_no."','".$daily_reg_no."','','".$master_gar2['m_name']."','".$master_gar2['sex']."','".$master_gar2['age']."','".$adress_def[$key2]."','".$master_gar2['department_id']."','".$master_gar2['dignosis']."','".$master_gar2['ipd_opd']."','','','".$date_new1."','".$master_gar2['id']."','".$master_gar2['follow_up']."','".$a[$key]."','".$occupation[$key1]."')";
                      $mysqli->query($query1);
			          $query2 = "update garbhini_navjat set status=1 where id=".$master_id;
                      $mysqli->query($query2);
                             }
                         }          
               }

            } else {
                echo "No garghan limit over";
            }
                      //END GARBHINI
              
                     if(($single_record == $m  ) && ($total_admit_todays <= $admit_limit)){
                  
                  
                      if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit)) {
                            if(($row['VIBHAG'] == '35') || ($row['VIBHAG'] == '28')){
                          }
                          else{
                               echo "ADMITTTTTTTTA";
                          $gender1=$row['SEX'];
                          $depart_id1= $row['VIBHAG'];
                           if($depart_id1 == '28'){
                            $depart_id='34';
                        }else{
                             $depart_id= $row['VIBHAG'];
                        }
                        
                        
                        /////////////////////////////######## IPF CASE PAPER############//////////////////
                         $hb =array(11.5,12.0,12.5,13.0,13.5,14.0,14.5);
	                     $hb1=array_rand($hb);
	                     $hb[$hb1];
	                     
	                     $TLC =array(4000,4500,5000,5500,6000,6500,7000,7500,8000,8500,9000,9500,10000,11000);
	                     $TLC1=array_rand($TLC);
	                     $TLC[$TLC1];
	                     
	                     
	                     $DLC_Neutro =array(50,55,60,65,70);
	                     $DLC_Neutro1=array_rand($DLC_Neutro);
	                     $DLC_Neutro[$DLC_Neutro1];
	                     
	                     $Lymphocytes =array(20,25,30,35,40);
	                     $Lymphocytes1=array_rand($Lymphocytes);
	                     $Lymphocytes[$Lymphocytes1];
	                     
	                     
	                     $Monocytes =array(1,2,3,4);
	                     $Monocytes1=array_rand($Monocytes);
	                     $Monocytes[$Monocytes1];
	                     
	                     $Eosinophils =array(0.1,0.2,0.3,0.4);
	                     $Eosinophils1=array_rand($Eosinophils);
	                     $Eosinophils[$Eosinophils1];
	                     
	                     
	                     $ESR =array(10,14,16,18,20);
	                     $ESR1=array_rand($ESR);
	                     $ESR[$ESR1];
	                     
	                    
	                     
	                     $Platelet_Count=array(1.5,2.0,2.5,3.0,3.5,4.0,4.5);
	                     $Platelet_Count1=array_rand($Platelet_Count);
	                     $Platelet_Count[$Platelet_Count1];
                        
                         $B_Sugar=array(70,80,90,100,110);
	                     $B_Sugar1=array_rand($B_Sugar);
	                     $B_Sugar[$B_Sugar1];
	                     
	                     $Blood_Sugar=array(110,120,130,140,150);
	                     $Blood_Sugar1=array_rand($Blood_Sugar);
	                     $Blood_Sugar[$Blood_Sugar1];
	                     
	                     $Blood_Urea=array(20,25,30,35,40);
	                     $Blood_Urea1=array_rand($Blood_Urea);
	                     $Blood_Urea[$Blood_Urea1];
	                     
	                     $S_Creatinine=array(0.4,0.5,0.7,0.9,1.2,1.4);
	                     $S_Creatinine1=array_rand($S_Creatinine);
	                     $S_Creatinine[$S_Creatinine1];
                        
                         $S_Uric_Acid=array(2,3,4,5,6);
	                     $S_Uric_Acid1=array_rand($S_Uric_Acid);
	                     $S_Uric_Acid[$S_Uric_Acid1];
	                     
	                     $SNat	=array(135,140,145,150,155);
	                     $SNat1=array_rand($SNat);
	                     $SNat[$SNat1];
	                     
	                     
	                     
	                     
	                     $SK=array(3.5,4.0,4.5,5.0,5.5);
	                     $SK1=array_rand($SK);
	                     $SK[$SK1];
	                     
	                     $Total_Cholestrol=array(150,160,170,180,190,200);
	                     $Total_Cholestrol1=array_rand($Total_Cholestrol);
	                     $Total_Cholestrol[$Total_Cholestrol1];
	                     
	                     $STg=array(60,80,90,100,120,140,150,160,170);
	                     $STg1=array_rand($STg);
	                     $STg[$STg1];
	                     
	                     
	                     $HDL=array(30,40,50,60,70);
	                     $HDL1=array_rand($HDL);
	                     $HDL[$HDL1];
	                     
	                     $LDL=array(110,120,130,140,150);
	                     $LDL1=array_rand($LDL);
	                     $LDL[$LDL1];
	                     
	                     $VLDL=array(14,15,18,20,25,28,34,36,38,42,44,45);
	                     $VLDL1=array_rand($VLDL);
	                     $VLDL[$VLDL1];
	                     
	                     
	                     $atime=array('9:00','9:05','9:10','09:15','09:20','09:30');
	                     $atime1=array_rand($atime);
	                     $atime[$atime1];
	                     
	                     $dtime=array('9:15','9:30','9:45','10:00','10:30','10:45');
	                     $dtime1=array_rand($dtime);
	                     $dtime[$dtime1];
	                     
	                     $phone=array(98,97,96,94);
	                     $phone1=array_rand($phone);
	                     $phone[$phone1];
	                     
	                     $digits = 8;
                         $digi8=rand(pow(10, $digits1),pow(10,$digits)-1);
                         $phonedigit10=$phone[$phone1].$digi8;
                         
                         
                         //##
                         $BillirubinT=array(0.1,0.2,0.4,0.8,0.5);
	                     $BillirubinT1=array_rand($BillirubinT);
	                     $BillirubinT[$BillirubinT1];
	                     
	                     $BillirubinI=array(0.3,0.7,0.4,0.8,0.5);
	                     $BillirubinI1=array_rand($BillirubinI);
	                     $BillirubinI[$BillirubinI1];
                        
                         $Color=array('Yellow','Brown','Dark Brown','Black');
	                     $Color1=array_rand($Color);
	                     $Color[$Color1];
	                     
	                     $MUCOUS=array('+++','++++');
	                     $MUCOUS1=array_rand($MUCOUS);
	                     $MUCOUS[$MUCOUS1];
	                     
	                     $Comsistency=array('Liguid','Semi Solid','Solid','Hard');
	                     $Comsistency1=array_rand($Comsistency);
	                     $Comsistency[$Comsistency1];
	                     
	                     $raj=array('सामान्य ','अप्रवृत्ती ','अतिप्रवृत्ती ','अल्प प्रवृत्ती – काल');
	                     $raj1=array_rand($raj);
	                     $raj[$raj1];
	                     
	                     
	                     $samajik=array('Medium','Average', 'Above Poverty Line','Below Poverty Line','Poor','Modirate');
	                     $samajik1=array_rand($samajik);
	                     $samajik[$samajik1];
	                     
	                     $aharfood=array('Non vegetarian','Vegetarian', 'Non vegetarian +  Vegetarian');
	                     $aharfood1=array_rand($aharfood);
	                     $aharfood[$aharfood1];
	                     
	                     
	                     $aharghatak=array('Medium','Average', 'Above average','Below average','Poor');
	                     $aharghatak1=array_rand($aharghatak);
	                     $aharghatak[$aharghatak1];
	                     
	                     
	                     $nidtra=array('Normal');
	                     $nidtra1=array_rand($nidtra);
	                     $nidtra[$nidtra1];
	                     
	                     
	                     $vyasan=array('Tea','Coffee','Tobacco','Smoking');
	                     $vyasan1=array_rand($vyasan);
	                     $vyasan[$vyasan1];
	                     
	                     $mutrapra=array('4-Yellow','5-Faint yellow','6-Dark yellow','7-Pale Yellow','8-Yellow');
	                     $mutrapra1=array_rand($mutrapra);
	                     $mutrapra[$mutrapra1];
	                     
	                     
	                     $urine=array('NAD','NILL');
	                     $urine1=array_rand($urine);
	                     $urine[$urine1];
	                     
	                     $purushpra=array('1-Yellow','2-Dark yellow','1-Brown','2-Dark yellow','1-Dark Brown','2-blackest');
	                     $purushpra1=array_rand($purushpra);
	                     $purushpra[$purushpra1];
	                     
	                     $apanwayu=array('NAD','Normal','Excessive');
	                     $apanwayu1=array_rand($apanwayu);
	                     $apanwayu[$apanwayu1];
                        
                        
                         $koshth=array('क्रूर','मध्यम ','मृदू');
	                     $koshth1=array_rand($koshth);
	                     $koshth[$koshth1];
	                     
	                     
	                     $samanyaatur=array('Pitta','Vata','Pittakapha','Vatapitta','VataKaPha','Sam');
	                     $samanyaatur1=array_rand($samanyaatur);
	                     $samanyaatur[$samanyaatur1];
	                     
	                     
	                     $tap=array('96.5','96','97.5','97');
	                     $tap1=array_rand($tap);
	                     $tap[$tap1];
	                     
	                     
	                     $sharir=array('Medium','Modrate','Well built','Thin','Central Obesity');
	                     $sharir1=array_rand($sharir);
	                     $sharir[$sharir1];
	                     
	                     $aharshakti=array('Medium','Strong');
	                     $aharshakti1=array_rand($aharshakti);
	                     $aharshakti[$aharshakti1];
	                     
	                     
	                     $vyamshakti=array('Medium','Strong');
	                     $vyamshakti1=array_rand($vyamshakti);
	                     $vyamshakti[$vyamshakti1];
	                     
	                     $rand_no=rand(1,5);
	                     if($rand_no=='1'){
	                         $second='अल्पोपशय';$three='अल्पोपशय';$four='25';$five='50';$six='75';$seven='उपशय';$eight='उपशय';$nine='उपशय';
	                         
	                         $SPO2='88,90,92,91,93,94,96,97,98';
	                         $Input='2000,2020,2010,2060,2100,2080,2160,2140,2120';
	                         $Output='1600,1640,1680,1670,1720,1750,1800,1940,1960';
	                         
	                     }else if($rand_no=='2'){
	                         $second='25';$three='50';$four='75';$five='अल्पोपशय';$six='अल्पोपशय';$seven='अल्पोपशय';$eight='उपशय';$nine='उपशय';
	                        
	                         $SPO2='90,91,92,94,93,94,98,97,98';
	                         $Input='2010,2020,2040,2160,2100,2080,2160,2140,2120';
	                         $Output='1640,1650,1670,1670,1750,1780,1800,1940,1960';
	                     }
	                     else if($rand_no=='3'){
	                          $second='Same complaint';$three='10';$four='25';$five='50';$six='75';$seven='उपशय';$eight='उपशय';$nine='उपशय';
	                          
	                          $SPO2='92,91,92,88,93,94,98,96,98';
	                          $Input='2040,2020,2010,2060,2100,2090,2140,2140,2120';
	                          $Output='1750,1700,1680,1800,1850,1670,1680,1840,1940';
	                     }
	                     else if($rand_no=='4'){
	                         $second='10';$three='25';$four='50';$five='75';$six='उपशय';$seven='उपशय';$eight='अल्पोपशय';$nine='अल्पोपशय'; 
	                     
	                         $SPO2='89,90,91,93,94,94,97,96,98';
	                         $Input='2020,2020,2010,2080,2080,2180,2160,2140,2120';
	                         $Output='1680,1670,1700,1750,1840,1850,1900,1950,1950';
	                     }
	                     
	                     else if($rand_no=='5'){
	                          
	                         $second='Same complaint';$three='Same complaint';$four='10';$five='25';$six='50';$seven='75';$eight='अल्पोपशय';$nine='अल्पोपशय';
	                         
	                         $SPO2='89,88,90,94,94,94,96,97,98';
	                         $Input='2000,2010,2040,2030,2120,2080,2160,2140,2140';
	                         $Output='1600,1620,1690,1670,1740,1750,1800,1940,1960';
	                         
	                     }
	                     else{
	                           $second='';$three='';$four='';$five='';$six='';$seven='';$eight='';$nine='';
	                           
	                           $SPO2='88,91,90,88,93,95,97,96,98'; 
	                           $Input='2030,2020,2080,2060,2120,2080,2140,2150,2120';
	                           $Output='1640,1640,1690,1670,1720,1750,1840,1940,1980';
	                     }
	                     
	                     $gcondition=array('Fair','Moderate');
	                     $gcondition1=array_rand($gcondition);
	                     $gcondition[$gcondition1];
	                     
	                     $Scl=array('95','96','98','99','100','102','103','105');
	                     $Scl1=array_rand($Scl);
	                     $Scl[$Scl1];
	                     
	                     
	                     
	                    
	                     
	                     
                        
                       // ,'".$SPO2."','".$Input."','".$Output."','". $five."','".$six."','".$seven."','".$eight."'
                        
                      //  ,gcondition,Scl,Color,MUCOUS,Comsistency,raj,samajik,aharfood,aharghatak,nidtra,vyasan,mutrapra,urine,purushpra,apanwayu,koshth,samanyaatur,tap,sharir,aharshakti,vyamshakti
                        
                     //  ,'".$gcondition[$gcondition1]."','".$Scl[$Scl1]."','".$four[$four1]."','". $five[$five1]."','".$six[$six1]."','".$seven[$seven1]."','".$eight[$eight1]."','".$nine[$nine1]."','".$aharghatak[$aharghatak1]."','".$nidtra[$nidtra1]."','".$vyasan[$vyasan1]."','".$mutrapra[$mutrapra1]."','".$urine[$urine1]."','".$purushpra[$purushpra1]."','".$apanwayu[$apanwayu1]."','".$koshth[$koshth1]."','".$samanyaatur[$samanyaatur1]."','".$tap[$tap1]."','".$sharir[$sharir1]."','".$aharshakti[$aharshakti1]."','".$vyamshakti[$vyamshakti1]."'
                        
                        /////////////////////////////######## IPF CASE PAPER############//////////////////
                        
                        
                        $SEX_Check=$row['SEX'];
                        
                          //master data_lmit_dept_ipd
                         $dep_bed_limit = "SELECT * FROM data_lmit_dept_ipd where dept_id=".$depart_id;
            	         $dep_bed_limit1 = $mysqli->query($dep_bed_limit);
            	         $dep_bed_limit11=$dep_bed_limit1->fetch_assoc();
            	         
            	         if($SEX_Check=='M'){
                         $data_limit=$dep_bed_limit11['data_limit_m'];
            	         }else{
            			 $data_limit=$dep_bed_limit11['data_limit_f'];
            	         }
            	         
            	         $dep_bed_limit_total=$data_limit;
                        // end master data_lmit_dept_ipd
            			
            			 //patient check in bed with gender
            	          $check_bed = "SELECT * FROM patient_ipd where discharge_date LIKE '%0000-00-00%' and  sex='$SEX_Check' and department_id=".$depart_id;
            	          $bed_status1 = $mysqli->query($check_bed);
            	          echo "//////////////////";  echo "<br>";
            	          echo "depart_id:".$depart_id;
            	          echo "//////////////////";  echo "<br>";
            	         echo  '$dep_bed_limit_total :'.$dep_bed_limit_total;
            	         echo "<br>";
            	         echo "//////////////////";
            	         echo  'bed_status_total :'.$bed_status_total=$bed_status1->num_rows;
            	         echo "//////////////////";
            	        // end patient check in bed with gender
                        
                        
                         $bed = "SELECT * FROM beds WHERE gender ='$SEX_Check' AND department_id ='$depart_id' AND status ='0' LIMIT  1";
                         $bed_no = $mysqli->query($bed);
	                     $bed_no1=$bed_no->fetch_assoc(); 
	                       if ($bed_no1) {
                            $admit_bed=$bed_no1['id'];
                            }else{
	                          $admit_bed ='';
	                        }
	                    
	                    
	                    //Admit only available diagnosis in ipd
	                   // $nivan=$row['NIDAN'];
	                   // $nivan1='%'.$nivan.'%';
	                    
	                    $che=trim($row['NIDAN']);
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $row['NIDAN'];
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $nivan = '%'.$new_str.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }else{
                            $nivan = '%'.$che.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }
	                    echo $nivan1 = $nivan;
	                    
	                    $proxy_id = $row['proxy_id'];
	                    $department_id = $depart_id;
	                    
	                    $admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND proxy_id = '$proxy_id' AND department_id = '$department_id' AND ipd_opd ='ipd'";
	                    
	                    //$admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND ipd_opd ='ipd'";
                        $admit_avai_diagnosis1 = $mysqli->query($admit_avai_diagnosis);
	                    $admit_avai_diagnosis2=$admit_avai_diagnosis1->fetch_assoc(); 
	                    
	                    echo "<br>=====> 6 ";
	                    print_r($admit_avai_diagnosis2);
	                    echo "<br><br><br>"; 
	                 
	                 if($bed_status_total < $dep_bed_limit_total){ 
	                 //if($admit_avai_diagnosis2){ 
	                 if($admit_avai_diagnosis2 && $admit_bed != ''){ 
	                  $bed_status='1';
                      $query12 = "insert into patient_ipd(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,bedNo,bed_status,discharge_date,create_date,Hb,TLC,DLC_Neutro,Lymphocytes,Monocytes,Eosinophils,ESR,Platelet_Count,B_Sugar,Blood_Sugar,Blood_Urea,S_Creatinine,S_Uric_Acid,SNat,SK,Total_Cholestrol,STg,HDL,LDL,VLDL,atime,dtime,phone,BillirubinT,BillirubinI,Color,MUCOUS,Comsistency,raj,samajik,aharfood,aharghatak,nidtra,vyasan,mutrapra,urine,purushpra,apanwayu,koshth,samanyaatur,tap,sharir,aharshakti,vyamshakti,second,three,four,five,six,seven,eight,nine,SPO2,Input,Output,proxy_id,gcondition,Scl) values('".$row["Sno"]."','".$row["yealry_number"]."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd."','".$row1['ipd_no']."','".$admit_bed."','".$bed_status."','".$row['Dischargedate']."','".$date_new1."','".$hb[$hb1]."','".$TLC[$TLC1]."','".$DLC_Neutro[$DLC_Neutro1]."','".$Lymphocytes[$Lymphocytes1]."','".$Monocytes[$Monocytes1]."','".$Eosinophils[$Eosinophils1]."','".$ESR[$ESR1]."','".$Platelet_Count[$Platelet_Count1]."','".$B_Sugar[$B_Sugar1]."','".$Blood_Sugar[$Blood_Sugar1]."','".$Blood_Urea[$Blood_Urea1]."','".$S_Creatinine[$S_Creatinine1]."','".$S_Uric_Acid[$S_Uric_Acid1]."','".$SNat[$SNat1]."','".$SK[$SK1]."','".$Total_Cholestrol[$Total_Cholestrol1]."','". $STg[$STg1]."','".$HDL[$HDL1]."','".$LDL[$LDL1]."','".$VLDL[$VLDL1]."','".$atime[$atime1]."','".$dtime[$dtime1]."','".$phonedigit10."','".$BillirubinT[$BillirubinT1]."','".$BillirubinI[$BillirubinI1]."','".$Color[$Color1]."','".$MUCOUS[$MUCOUS1]."','".$Comsistency[$Comsistency1]."','".$raj[$raj1]."','".$samajik[$samajik1]."','".$aharfood[$aharfood1]."','".$aharghatak[$aharghatak1]."','".$nidtra[$nidtra1]."','".$vyasan[$vyasan1]."','".$mutrapra[$mutrapra1]."','".$urine[$urine1]."','".$purushpra[$purushpra1]."','".$apanwayu[$apanwayu1]."','".$koshth[$koshth1]."','".$samanyaatur[$samanyaatur1]."','".$tap[$tap1]."','".$sharir[$sharir1]."','".$aharshakti[$aharshakti1]."','".$vyamshakti[$vyamshakti1]."','".$second."','".$three."','".$four."','". $five."','".$six."','".$seven."','".$eight."','".$nine."','".$SPO2."','".$Input."','".$Output."','".$row['proxy_id']."','".$gcondition[$gcondition1]."','".$Scl[$Scl1]."')";
                      //$mysqli->query($query12); 
                      $this->db->query($query12);
                      echo $query12;
                      $query22 = "update patient_ipd set ipd_flag = 1 where patient_id=".$row["Sno"];
                      $mysqli->query($query22);
                      
                      $query2222 = "update patient set flag = 1,ipd_patient_flag = 1 where yearly_reg_no='$CopddD_New' ORDER BY id DESC LIMIT 1";
                      $mysqli->query($query2222);
                      
                      $query222 = "update beds set status = 1 where id=".$admit_bed;
                      $mysqli->query($query222);
	                       }
                          }
                        }
                      }
                      else {
                         echo "<br>no admit<br>";
                       
                     }
                   }
                }
             
			     
       }
	 
	   
       echo "insert data succesfully using crone job(old-new...)" ;
       } 
      }
      else {
       echo "master data no available/Today's limit complete ";
      }  
		   

	}
	   
	else{
	   
	     
	   $rand=(rand(1,3));
       
   	   // CJOB Auto Push Code Start -------------------------------------------------------------
   
       //$sql = "SELECT * FROM items WHERE flag=0 AND Sno > $srno ORDER by id ASC LIMIT  $rand";
       $sql = "SELECT * FROM items WHERE flag=0  ORDER by id ASC  LIMIT  $rand";
    
        // CJOB Auto Push Code End ---------------------------------------------------------------
   
       $result = $mysqli->query($sql);
      
         if ($result->num_rows > 0) 
	   {
        
        
         //admit patient
           echo  "<br>current date for admit ".$date_admit = $ADV_DAY;
           echo "<br>";
           echo "strat date for admit ".$date_admit1=$ADV_DAY1." 01:45";
           echo "<br>";
           
           echo "end date for admit ".$date_admit2 = $ADV_DAY1." 23:45";
           echo "<br>";
           $sql_admit = "SELECT * FROM patient WHERE flag = 1 AND ipd_opd ='opd' AND ipd_flag = 0 LIMIT  1";
           $result_admit = $mysqli->query($sql_admit);
	       $row_admit=$result_admit->fetch_assoc();
	      
	       echo "$single_record".$single_record=$result_admit->num_rows;
	       //$old_date111=$row1['created_date'];
	       // end admit patient
	       
	       //admit_todays  
	        $admit_todays1='%'.$ADV_DAY1.'%';
	        $admit_todays = "SELECT * FROM patient_ipd WHERE  create_date LIKE  '$admit_todays1' AND ipd_opd ='ipd' AND ipd_flag = 1";
	         $admit_todayss = $mysqli->query($admit_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();
            $total_admit_todays=$admit_todayss->num_rows;
            echo "<br>today_total_admit".$total_admit_todays."<br>";
            // end admit_todays
            
            
            
             //master limit admit patient
             $admit_todays_limit = "SELECT * FROM admit_patient_limit";
	         $admit_todayss1 = $mysqli->query($admit_todays_limit);
	         $admit_todayss11=$admit_todayss1->fetch_assoc();
             $admit_limit=$admit_todayss11['data_limit'];
            // end master limit admit patient
            
              $value=date('d',strtotime($ADV_DAY1)); 
	           if ($value % 2) {
                 //$admit_limit=$admit_todayss11['data_limit'] + 2;
                 $admit_limit=$admit_todayss11['data_limit'];
                } else {
                   $admit_limit=$admit_todayss11['data_limit'] + 1;
                }
            
            
            
            
             //master limit discharge patient
             $discharge_todays_limit = "SELECT * FROM discharge_patient_limit";
	         $discharge_todayss1 = $mysqli->query($discharge_todays_limit);
	         $discharge_todayss11=$discharge_todayss1->fetch_assoc();
             $discharge_limit=$discharge_todayss11['data_limit'];
             
            //////  if($total_occupancy_todays < 80)
            ////// { 
            //////      $admit_limit=$admit_todayss11['data_limit'] + 3;
            ////// }else if($total_occupancy_todays > 90)
            ////// {
            //////      $discharge_limit=$discharge_todayss11['data_limit'] + 5;
            ////// }
          /*  if($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            { 
                 $admit_limit = rand(6,9);
            }elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            {
                 $admit_limit = -1;
            }
            elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 50)
            {
                $admit_limit = 9;
            }
            else{
                $admit_limit = $admit_todayss11['data_limit'];
            }*/
             if(date('Y',strtotime($ADV_DAY1)) == '2019'){
                if($total_occupancy_todays <= 30)
                { 
                     $admit_limit = rand(4,7);
                }elseif($total_occupancy_todays >= 35)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 30 && $total_occupancy_todays < 35)
                {
                    $admit_limit = 3;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2020'){
                if($total_occupancy_todays <= 45)
                { 
                     $admit_limit = rand(9,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 45 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 5;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2021'){
                if($total_occupancy_todays <= 55)
                { 
                     $admit_limit = rand(6,8);
                }elseif($total_occupancy_todays >= 60)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 55 && $total_occupancy_todays < 60)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
            elseif(date('Y',strtotime($ADV_DAY1)) == '2022'){
                if($total_occupancy_todays <= 40)
                { 
                     $admit_limit = rand(8,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 40 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
           elseif(date('Y',strtotime($ADV_DAY1)) == '2023'){
                if($total_occupancy_todays <= 45)
                { 
                     $admit_limit = rand(8,10);
                }elseif($total_occupancy_todays >= 55)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 45 && $total_occupancy_todays < 55)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
            }
              elseif(date('Y',strtotime($ADV_DAY1)) == '2024'){


                 if($admit_todayss11['data_limit'] !='-1'){
                if($total_occupancy_todays <= 65)
                { 
                     $admit_limit = rand(15,20);
                }elseif($total_occupancy_todays >= 75)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 90 && $total_occupancy_todays < 100)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
               }
            }
             elseif(date('Y',strtotime($ADV_DAY1)) == '2025'){


                 if($admit_todayss11['data_limit'] !='-1'){
                if($total_occupancy_todays <= 60)
                { 
                     $admit_limit = rand(15,20);
                }elseif($total_occupancy_todays >= 65)
                {
                     $admit_limit = -1;
                }
                elseif($total_occupancy_todays > 60 && $total_occupancy_todays < 65)
                {
                    $admit_limit = 8;
                }
                else{
                    $admit_limit = $admit_todayss11['data_limit'];
                }
               }
            }
            
            // end master limit discharge patient
            
            
            // random discharge limit
            //  $value=date('d',strtotime($ADV_DAY1)); 
	           //if ($value % 2) {
            //      $discharge_limit=$discharge_todayss11['data_limit'] - 1;
            //     } else {
            //       $discharge_limit=$discharge_todayss11['data_limit'];
            //     }
            
            // random discharge limit end
            
            
             echo "<br>today_total_admit_limit ".$admit_limit."<br>";
            
            //discharge_todays  

	        $discharge_todays1='%'.$ADV_DAY1.'%';
	        $discharge_todays = "SELECT * FROM patient_ipd WHERE  discharge_date LIKE  '$discharge_todays1' AND discharge_date !='' AND ipd_opd ='ipd'";
	        $discharge_todayss = $mysqli->query($discharge_todays);
	        //$admit_todayss1=$admit_todayss->fetch_assoc();


            $total_discharge_todays=$discharge_todayss->num_rows;
            echo "<br>today_total_discharge ".$total_discharge_todays."<br>";
            echo "<br>today_total_discharge_limit ".$discharge_limit."<br>";
            // end discharge_todays
            
            // discharge patient 
            echo  "<br>current date for discharge ".$date_discharge = $ADV_DAY;
            echo "<br>";
            echo "strat date for discharge ".$date_discharge1=$ADV_DAY1." 01:00";
            echo "<br>";
            echo "end date for discharge ".$date_discharge2 = $ADV_DAY1."  23:45";
            
            //if($total_discharge_todays < $discharge_limit){
                // $rand_dis=rand(6,10);
                // $old_date_dis=date('Y-m-d', strtotime("-$rand_dis days", strtotime($ADV_DAY1)));
                // $old_date_dis1='%'.$old_date_dis.'%';
                
                // //echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date like '%0000-00-00%' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd'  LIMIT 1";
                // /////echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd' or DATEDIFF('$ADV_DAY1', create_date) > '$rand_dis' AND discharge_date ='0000-00-00' AND ipd_opd ='ipd' LIMIT 1";
                // echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date LIKE  '$old_date_dis1' AND ipd_opd ='ipd' or DATEDIFF('$ADV_DAY1', '$old_date_dis') > '$rand_dis' AND discharge_date ='0000-00-00' AND ipd_opd ='ipd' LIMIT 1";
                
                // $discharge_patient1 = $mysqli->query($discharge_patient);
                // $discharge_patient2 = $discharge_patient1->fetch_assoc();
                // $dis_id = $discharge_patient2['id'];
                // $bed_remove=$discharge_patient2['bedNo'];
                // $master_id_dis = $discharge_patient2['master_g_id'];
                if($discharge_todayss11['data_limit']!='-1'){
                echo '<br>';
                echo $Check_discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date < '$ADV_DAY1' AND ipd_opd ='ipd' order by rand() LIMIT 1";
                /////echo $Check_discharge_patient = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND create_date < '$ADV_DAY1' AND ipd_opd ='ipd' LIMIT 1";
                $Check_discharge_patient1 = $mysqli->query($Check_discharge_patient);
                $Check_discharge_patient2 = $Check_discharge_patient1->fetch_assoc();
                
                $che=trim($Check_discharge_patient2['dignosis']);
                $len=strlen($che);
                $dd= substr($che,$len - 1);
                $str = $Check_discharge_patient2['dignosis'];
                $arry=explode("-",$str);
                $t_c=count($arry);
                if($t_c=='2'){
                    $dd1=substr($che, 0, -1);
                    $new_str = trim($arry[0]);
                    $dis_dia = '%'.$new_str.'%';
                    $dis_p_dignosis_name=$Check_discharge_patient2['dignosis'];
                }else{
                    $dis_dia = '%'.$che.'%';
                    $dis_p_dignosis_name=$Check_discharge_patient2['dignosis'];
                }
                $dis_proxy_id = $Check_discharge_patient2['proxy_id'];
                $dis_department_id = $Check_discharge_patient2['department_id'];
                $dis_p_id = $Check_discharge_patient2['id'];
                $dis_p_create_date = date('Y-m-d', strtotime($Check_discharge_patient2['create_date']));
                
                $tretment=$this->db->select("*")
                    ->from('treatments1')
                    ->where('dignosis LIKE',$dis_dia)
                    ->where('proxy_id',$dis_proxy_id)
                    ->where('department_id', $dis_department_id)
                    ->where('ipd_opd','ipd')
                    ->get()
                    ->row();
                $ipd_days= $tretment->ipd_days;      
                
                echo '<br>';
                echo $ipd_days;
                echo '<br>';
                
                $date1=date_create(date("Y-m-d", strtotime($dis_p_create_date)));
                $date2=date_create(date("Y-m-d", strtotime($ADV_DAY1)));
                $diff=date_diff($date1,$date2);
                $Days = $diff->d;
                
                echo '<br>';
                echo 'Discharge Diff. Days ==> '.$Days;
                echo '<br>';
                 
                if($Days >= $ipd_days){
                    echo '<br>';
                    echo 'Patient On Bed Days :- '.$Days.'<br>';
                    echo $discharge_patient = "SELECT * FROM `patient_ipd` WHERE id = '$dis_p_id' AND ipd_opd ='ipd'";
                    $discharge_patient1 = $mysqli->query($discharge_patient);
                    $discharge_patient2 = $discharge_patient1->fetch_assoc();
                    $dis_id = $discharge_patient2['id'];
                    $master_id_dis = $discharge_patient2['master_g_id'];
                    $bed_remove=$discharge_patient2['bedNo'];
                //////////}
            //}
            // ////Treatment Wise Discharge
            // // disharge with numbers
            // $dis_create_date=$discharge_patient2['create_date'];
            // $dis_dia='%'.$discharge_patient2['dignosis'].'%';
            // $dis_proxy_id=$discharge_patient2['proxy_id'];
            // $tretment=$this->db->select("*")

			         //                ->from('treatments1')

			         //                ->where('dignosis LIKE',$dis_dia)
			         //                ->where('proxy_id',$dis_proxy_id)
			         //                ->where('ipd_opd','ipd')
            //                          ->get()
            //                          ->row();
            //     $ipd_days= $tretment->ipd_days;                        
                
            //     $date=date_create($dis_create_date);
                
            //     date_add($date,date_interval_create_from_date_string($ipd_days." days"));
            //     if($ipd_days){
            //      $date_of_dis=date_format($date,"Y-m-d");
            //     }
            //     else {
            //       $date_of_dis=$ADV_DAY1;
            //     }               
            
              ////if(($date_discharge1 <= $date_discharge) && ($date_discharge2 >= $date_discharge) && ($total_discharge_todays <= $discharge_limit)){
            if(($date_discharge1 <= $date_discharge) && ($date_discharge2 >= $date_discharge)){
                  //////////////////////if((date('Y-m-d',strtotime($date_discharge1)) <= date('Y-m-d',strtotime($date_discharge))) && (date('Y-m-d',strtotime($date_discharge2)) >= date('Y-m-d',strtotime($date_discharge)))){
                   echo "<br>discharge_id :".$dis_id."<br>";
             //$date_of_dis=$ADV_DAY;
             $date_of_dis=$ADV_DAY1;
             $query3 = "update patient_ipd set discharge_date = '$date_of_dis' where id = ".$dis_id;
             $mysqli->query($query3);
             
              if($master_id_dis){
             $discharge_patient_nav = "SELECT * FROM `patient_ipd` WHERE discharge_date ='0000-00-00' AND master_g_id ='$master_id_dis' AND ipd_opd ='ipd'";
             $discharge_patient_nav1 = $mysqli->query($discharge_patient_nav);
             $discharge_patient_nav2 = $discharge_patient_nav1->fetch_assoc();
             $dis_id_nav = $discharge_patient_nav2['id']; 
             
             $query33 = "update patient_ipd set discharge_date = '$date_of_dis' where id = ".$dis_id_nav;
             $mysqli->query($query33);
             
              if($bed_remove){
                 $query2222 = "update beds set status = 0 where id=".$bed_remove;
                      $mysqli->query($query2222);
                      
                       $query22222 = "update patient_ipd set bed_status = 0 where id = ".$dis_id;
                      $mysqli->query($query22222);
             }
             
             
             }
              }
                }


       }
            //end discharge patient
            
            
              $m=0;
              $k=1;
              $ipd_opd2='opd';
              $ipd_opd='ipd';
              $ipd_flag = 1;
             
             $adress_def=array();
             $address = "SELECT * FROM address";
             $address1 = $mysqli->query($address);
	         while($address2=$address1->fetch_assoc()){
	        // $auto_on_off2['description']."<br>";
	           array_push($adress_def,$address2['name']);
	         }
	         
	         
	         
             while($row = $result->fetch_assoc()) {
             $m++;
               if(($row['SEX']=='M') && ($row['VIBHAG'] !=32)){
                  
	              $occupation= array('Farmer','Office','Business','Job','Labor','Jobless','Teacher','other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
              	
	         }
	         else if(($row['SEX']=='F') && ($row['VIBHAG'] !=32)){
	              $occupation= array('Farmer','Office','Business','Job','Labor','Jobless','Teacher','other');
	               if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
	         }
	         else{
	              $occupation= array('Student','Other');
	              if(!empty($row['Weight'])){
	                 $a=array($row['Weight']); 
	              }
	              else {
	              $a=array(41,49,44,48,50,55,61,51,63,56,67);
	              }
                  $key = array_rand($a);
	         }
	         
	         $c_o=$row['NIDAN'];
			 $h_o='NAD';
	         $f_o='NAD';
	         //$bp=array('130/80','124/86','138/88','116/90','110/70','136/84','132/72','128/60','140/90');
	         $bp = array('122/82','128/78','120/80','118/78','110/70','116/76','130/82','112/72','114/74','124/84','126/86');
	         $nadi=array('मंडूकगति', 'सर्पगती' , 'हंसगति','अविशेष');
              
              //$Pulse =array(76,78,88,90,68,72,82,66,74,92,64);
            if($row['VIBHAG'] !=32){
                $Pulse =array('78','84','86','80','76','74','70','88','90','72','82');
            }else{
                $Pulse =array('92','104','108','106','96','98','94','90','100','102','110');
            }
	         
             $ur= 'अविशेष';
             $cvs ='S1S2 N';
             $udar='soft';
             $netra=array('आविल','अच्छ','ईषत्पित्त')  ;
             $givwa=array('साम','निराम');
             $sudha=array('तीक्ष्णाग्नि', 'समाग्नि', 'विषमाग्नि');     
            
             $ahar=array('प्रभुत ','अल्प ','मध्यम');
             $mal=array('साम ','निराम ','कठीण ','दुर्गंधीयुक्त ','अविशेष');
             $mutra=array('पीत','आविल','दुर्गंधीयुक्त','अविशेष');
             $nidra=array('अविशेष','प्रभुत','अल्प');   
             
              $key = array_rand($a); 
	          $a[$key];
	          $key1 =array_rand($occupation);
	          $occupation[$key1];
	          $key2=array_rand($adress_def);
	          $adress_def[$key2];
	          
	          $c_o1=array_rand($c_o);
	          $c_o[$c_o1];
	          
	          $bp1=array_rand($bp);
	          $bp[$bp1];
	          
	          $nadi1=array_rand($nadi);
	          $nadi[$nadi1];
	          
	          $Pulse1=array_rand($Pulse);
	          $Pulse[$Pulse1];
	          
	          $netra1=array_rand($netra);
	          $netra[$netra1];
	          
	           $givwa1=array_rand($givwa);
	           $givwa[$givwa1];
	           
	           
	           $sudha1=array_rand($sudha);
	           $sudha[$sudha1];
	           
	           $ahar1=array_rand($ahar);
	           $ahar[$ahar1];
	           
	           $mal1=array_rand($mal);
	           $mal[$mal1];
	           
	           $mutra1=array_rand($mutra);
	           $mutra[$mutra1];
	           
	           $nidra1=array_rand($nidra);
	           $nidra[$nidra1];
	           
	           $ruduce =array(10,25,50,75);
               $ruduce1=array_rand($ruduce);
	           $ruduce[$ruduce1];
	          
              if($k == 1){
               $date_only_new = date('Y-m-d H:i',strtotime('-15 minutes'))."<br>";
              }
              else if($k == 2){
               $date_only_new = date('Y-m-d H:i',strtotime('- 14 minutes'))."<br>";
              }
              else if($k == 3){
               $date_only_new = date('Y-m-d H:i',strtotime('- 12 minutes'))."<br>";
              }
              else if($k == 4){
              $date_only_new = date('Y-m-d H:i',strtotime(' -11 minutes'))."<br>";
              }
              else if($k == 5){
              $date_only_new = date('Y-m-d H:i',strtotime('-11 minutes'))."<br>";
              }
              else if($k == 6){
              $date_only_new = date('Y-m-d H:i',strtotime('-7 minutes'))."<br>";
              }
              else if($k == 7){
              $date_only_new = date('Y-m-d H:i',strtotime('-5 minutes'))."<br>";
              }
              else if($k == 8){
              $date_only_new = date('Y-m-d H:i',strtotime('-2 minutes'))."<br>";
              }
             
              else {
              $date_only_new = $ADV_DAY1."<br>";
              }
              $date_only_new1 = $ADV_DAY1."<br>";
              $k++;
               if(empty($row['CopddD_New'])){
                    $CopddD_New=NULL;
                    $Copdd_Old=$row['Copdd_Old'];
                    
                     echo "<br>Sno: " . $row["Sno"]. " - Name: " . $row["NAME"]. "<br>";
                    if($row["NAME"]){
	                 $query1 = "insert into patient(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date, wieght,occupation,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,sym_reduce_per) values('".$row["Sno"]."','".$row["yealry_number"]."','".$row['Daily']."','".$row['Monthly']."','".$Copdd_Old."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$ruduce[$ruduce1]."')";
                     //echo $query1;
                     $mysqli->query($query1);
			         $query2 = "update items set flag = 1 where Sno=".$row["Sno"];
                     $mysqli->query($query2);
                    }
                     
                     //MASTER GARBHINI INSERT INTO PATIENT
            $month=date('m');
           
            $year = '%'.$this->session->userdata['acyear'].'%';
            $year1=$this->session->userdata['acyear'];
            $d=cal_days_in_month(CAL_GREGORIAN,$month,$year1);
            $dd='%GARBHINI-SR%';
            $start_date=$year1.'-'.$month.'-01 00:00:00';
            //echo "<br>";
            $end_date=$year1.'-'.$month.'-'.$d.' 23:59:00'; 
           
             $auto_on_off = "SELECT count(*) as total FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date'";
          
	         $auto_on_off1 = $mysqli->query($auto_on_off);
	         $auto_on_off2=$auto_on_off1->fetch_assoc();
             $auto_on_off3=$auto_on_off2['total'];
            
            $rand =rand(4,5);
           
            if($auto_on_off3 <= $rand){
              
                
               $G= "SELECT * FROM patient where create_date LIKE '$year' and dignosis LIKE '$dd' and create_date >='$start_date'and create_date <='$end_date' ORDER BY id DESC LIMIT 1";
               $G1 = $mysqli->query($G);
	           $G2=$G1->fetch_assoc();
               $G3= date('Y-m-d',strtotime($G2['create_date']));
               $today=date('Y-m-d');
               $datetime1 = date_create($G3); 
               $datetime2 = date_create($today); 
  
               $interval = date_diff($datetime1, $datetime2); 
               $interval1=$interval->format('%a'); 
               $rand1=rand(4,6);
               if($interval1 <= $rand1){
                  // echo "no";
                   
                         
               }else{
                   //echo "yes";
                    $last_id = "SELECT * FROM patient where create_date LIKE '$year' and  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $last_id1 = $mysqli->query($last_id);
	                $last_id2=$last_id1->fetch_assoc();
	                     $patient_id=$last_id2['patient_id'] + 1;
                         $yearly_reg_no=$last_id2['yearly_reg_no'] + 1;
                         $year_no = $last_id2['yearly_no'] + 1;
                         $daily_reg_no = $last_id2['daily_reg_no'] + 1;
                        // $old_reg_no = $last_id2['old_reg_no'] + 1;
                        
                        $master_gar = "SELECT * FROM garbhini_navjat where status ='0'  ORDER BY id DESC LIMIT 1";
                        $master_gar1 = $mysqli->query($master_gar);
	                    $master_gar2=$master_gar1->fetch_assoc();
                        $master_id=$master_gar2['id'];
                         
                      $date_new1=date('Y-m-d');   
                       if($m == 1){  
                           if($master_gar2["m_name"]){
                      $query1 = "insert into patient(patient_id,yearly_reg_no,yearly_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,master_g_id,follow_up) values('".$patient_id."','".$yearly_reg_no."','".$year_no."','".$daily_reg_no."','','".$master_gar2['m_name']."','".$master_gar2['sex']."','".$master_gar2['age']."','".$master_gar2['address']."','".$master_gar2['department_id']."','".$master_gar2['dignosis']."','".$master_gar2['ipd_opd']."','','','".$date_new1."','".$master_gar2['id']."','".$master_gar2['follow_up']."')";
                      $mysqli->query($query1);
			          $query2 = "update garbhini_navjat set status=1 where id=".$master_id;
                      $mysqli->query($query2);
                      }
                      }
               }

            } else {
                echo "No garghan limit over";
            }
                      //END GARBHINI
             
               if(($single_record == $m  ) && ($total_admit_todays <= $admit_limit)){
                 
                   
                   if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit)){
                       if(($row['VIBHAG'] == '35') || ($row['VIBHAG'] == '28'))
                         {
                          }
                        else{
                             $gender1=$row['SEX'];
                          $depart_id1= $row['VIBHAG'];
                           if($depart_id1 == '28'){
                            $depart_id='34';
                        }else{
                             $depart_id= $row['VIBHAG'];
                        }
                        
                        $dep_bed_limit = "SELECT * FROM data_lmit_dept_ipd where dept_id=".$depart_id;
            	         $dep_bed_limit1 = $mysqli->query($dep_bed_limit);
            	         $dep_bed_limit11=$dep_bed_limit1->fetch_assoc();
            	         
            	         if($SEX_Check=='M'){
                         $data_limit=$dep_bed_limit11['data_limit_m'];
            	         }else{
            			 $data_limit=$dep_bed_limit11['data_limit_f'];
            	         }
            	         
            	         $dep_bed_limit_total=$data_limit;
                        // end master data_lmit_dept_ipd
            			
            			 //patient check in bed with gender
            	          $check_bed = "SELECT * FROM patient_ipd where discharge_date LIKE '%0000-00-00%' and  sex='$SEX_Check' and department_id=".$depart_id;
            	          $bed_status1 = $mysqli->query($check_bed);
            	          echo "//////////////////";  echo "<br>";
            	          echo "depart_id:".$depart_id;
            	          echo "//////////////////";  echo "<br>";
            	         echo  '$dep_bed_limit_total :'.$dep_bed_limit_total;
            	         echo "<br>";
            	         echo "//////////////////";
            	         echo  'bed_status_total :'.$bed_status_total=$bed_status1->num_rows;
            	         echo "//////////////////";
            	        // end patient check in bed with gender
                        
                         $bed = "SELECT * FROM beds WHERE gender ='$gender1' AND department_id ='$depart_id' AND status ='0' LIMIT  1";
                         $bed_no = $mysqli->query($bed);
	                     $bed_no1=$bed_no->fetch_assoc(); 
	                       if ($bed_no1) {
                            $admit_bed=$bed_no1['id'];
                            }else{
	                          $admit_bed ='';
	                        }
	                    
	                    //Admit only available diagnosis in ipd
	                   // $nivan=$row['NIDAN']."I";
	                   // $nivan1='%'.$nivan.'%';
	                    
	                    $che=trim($row['NIDAN']);
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $row['NIDAN'];
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $nivan = '%'.$new_str.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }else{
                            $nivan = '%'.$che.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }
	                    echo $nivan1 = $nivan;
	                    
	                    $proxy_id = $row['proxy_id'];
	                    //$department_id = $row['VIBHAG'];
	                    $department_id = $depart_id;
	                    
	                    $admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND proxy_id = '$proxy_id' AND department_id = '$department_id' AND ipd_opd ='ipd'";
	                    
	                    //$admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND ipd_opd ='ipd'";
                        $admit_avai_diagnosis1 = $mysqli->query($admit_avai_diagnosis);
	                    $admit_avai_diagnosis2=$admit_avai_diagnosis1->fetch_assoc(); 
	                    
	                    echo "<br>=====> 7 ";
	                    print_r($admit_avai_diagnosis2);
	                    echo "<br><br><br>"; 
	                    
	                    if($bed_status_total < $dep_bed_limit_total){ 
	                    //if($admit_avai_diagnosis2){ 
	                    if($admit_avai_diagnosis2 && $admit_bed != ''){ 
						$bed_status='1';
 
                            
                            
                        $query12 = "insert into patient_ipd(patient_id,yearly_no,daily_reg_no,monthly_reg_no,old_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,ipd_flag) values('".$row["Sno"]."','".$row["yealry_number"]."','".$row['Daily']."','".$row['Monthly']."','".$Copdd_Old."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$row['Address']."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$ipd_flag."')";
                        $this->db->query($query12);
                       // $mysqli->query($query12); 
                        $query22 = "update patient_ipd set ipd_flag = 1 where patient_id=".$row["Sno"];
                        $mysqli->query($query22);
                        
                         $query222 = "update beds set status = 1 where id=".$admit_bed;
                         $mysqli->query($query222);
					     }
                        }
                      }
                   }
                 } 
                else{
                   
                   echo "<br>no admit";
                }
			  
                }else {
                    
                    
                    //$CopddD_New=$row['CopddD_New'];
                    
                    // CJOB Auto Push Code Start ------------------------------------------------------------
                    
                    //$CopddD_New=$row['CopddD_New'];
                    $tempQuery1 = "SELECT * FROM  patient ORDER BY id DESC LIMIT 1";
                    $tempQueryResult1 = $mysqli->query($tempQuery1);
	                $tempQueryRow1=$tempQueryResult1->fetch_assoc();
	                /*print_r($tempQueryRow1);
	                die();*/
	               
                    $tempQuery = "SELECT * FROM  patient WHERE  yearly_reg_no !='' ORDER BY id DESC LIMIT 1";
                    $tempQueryResult = $mysqli->query($tempQuery);
	                $tempQueryRow=$tempQueryResult->fetch_assoc();
	                /*print_r($tempQueryRow);
	                die();*/
                    //$CopddD_New=$row['CopddD_New'];
                    $CopddD_New=$tempQueryRow['yearly_reg_no']+1;
                    
                    // CJOB Auto Push Code End ----------------------------------------------------------------
                    
                    //check dublicate New Yearly Number
                     $d_number=date('Y',strtotime($ADV_DAY1));
                     $d_number_like='%'.$d_number.'%';
	                 $check_number = "SELECT * FROM patient WHERE  create_date LIKE  '$d_number_like' AND ipd_opd ='opd' AND yearly_reg_no ='$CopddD_New'";
	                 $check_number_q = $mysqli->query($check_number);
	                 $check_number_result=$check_number_q->num_rows;
                     //check dublicate New Yearly Number end 
                    
                    $Copdd_Old=NULL;
                    echo "<br>Sno: " . $row["Sno"]. " - Name: " . $row["NAME"]. "<br>";
                    if($check_number_result==0){
                    if($row["NAME"]){
                         $year_new = date('Y',strtotime($date_only_new1));
                        $check_last_record = "select * from patient where year(create_date)  = '$year_new' AND yearly_reg_no = '$CopddD_New'";
                        $check_last_record1 = $mysqli->query($check_last_record);
                        $check_last_record2=$check_last_record1->num_rows;
                        if($check_last_record2 >= 1)
                        {

                        }
                        else
                        {
	                //echo $query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation ,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id) values('".$row["Sno"]."','".$row["yealry_number"]."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row['proxy_id']."')";
	                echo $query1 = "insert into patient(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,wieght,occupation ,c_o,h_o,f_h,pulse,bp,nadi,ur,cvs,udar,netra,givwa,shudha,ahar,mal,mutra,nidra,proxy_id) values('".$CopddD_New."','".$CopddD_New."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd2."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$a[$key]."','".$occupation[$key1]."','".$c_o."','".$h_o."','".$f_o."','".$Pulse[$Pulse1]."','".$bp[$bp1]."','".$nadi[$nadi1]."','".$ur."','".$cvs."','".$udar."','".$netra[$netra1]."','".$givwa[$givwa1]."','".$sudha[$sudha1]."','".$ahar[$ahar1]."','".$mal[$mal1]."','".$mutra[$mutra1]."','".$nidra[$nidra1]."','".$row['proxy_id']."')";
                    $yes= $this->db->query($query1);
                    echo 'yes'.$yes;
                    echo "<br>";
                    
                    //echo $query1;
                    if($yes){
			        $query2 = "update items set flag = 1 where Sno=".$row["Sno"];
                    $mysqli->query($query2);
                    }
                    }
                    }
                   }
            
                  if(($single_record == $m  ) && ($total_admit_todays <= $admit_limit)){
                 
                 
                   if(($date_admit1 <= $date_admit) && ($date_admit2 >= $date_admit)){
                     
                          if(($row['VIBHAG'] == '35') ||($row['VIBHAG'] == '28'))
                          {
                          }
                          else{
                             
                              $gender1=$row['SEX'];
                          $depart_id1= $row['VIBHAG'];
                           if($depart_id1 == '28'){
                            $depart_id='34';
                        }else{
                             $depart_id= $row['VIBHAG'];
                        }
                        
                        
                        
                        
                           
                        /////////////////////////////######## IPF CASE PAPER############//////////////////
                         $hb =array(11.5,12.0,12.5,13.0,13.5,14.0,14.5);
	                     $hb1=array_rand($hb);
	                     $hb[$hb1];
	                     
	                     $TLC =array(4000,4500,5000,5500,6000,6500,7000,7500,8000,8500,9000,9500,10000,11000);
	                     $TLC1=array_rand($TLC);
	                     $TLC[$TLC1];
	                     
	                     
	                     $DLC_Neutro =array(50,55,60,65,70);
	                     $DLC_Neutro1=array_rand($DLC_Neutro);
	                     $DLC_Neutro[$DLC_Neutro1];
	                     
	                     $Lymphocytes =array(20,25,30,35,40);
	                     $Lymphocytes1=array_rand($Lymphocytes);
	                     $Lymphocytes[$Lymphocytes1];
	                     
	                     
	                     $Monocytes =array(1,2,3,4);
	                     $Monocytes1=array_rand($Monocytes);
	                     $Monocytes[$Monocytes1];
	                     
	                     $Eosinophils =array(0.1,0.2,0.3,0.4);
	                     $Eosinophils1=array_rand($Eosinophils);
	                     $Eosinophils[$Eosinophils1];
	                     
	                     
	                     $ESR =array(10,14,16,18,20);
	                     $ESR1=array_rand($ESR);
	                     $ESR[$ESR1];
	                     
	                   
	                     $Platelet_Count=array(1.5,2.0,2.5,3.0,3.5,4.0,4.5);
	                     $Platelet_Count1=array_rand($Platelet_Count);
	                     $Platelet_Count[$Platelet_Count1];
	                     
	                     $B_Sugar=array(70,80,90,100,110);
	                     $B_Sugar1=array_rand($B_Sugar);
	                     $B_Sugar[$B_Sugar1];
	                     
	                     $Blood_Sugar=array(110,120,130,140,150);
	                     $Blood_Sugar1=array_rand($Blood_Sugar);
	                     $Blood_Sugar[$Blood_Sugar1];
	                     
	                     $Blood_Urea=array(20,25,30,35,40);
	                     $Blood_Urea1=array_rand($Blood_Urea);
	                     $Blood_Urea[$Blood_Urea1];
	                     
	                     $S_Creatinine=array(0.4,0.5,0.7,0.9,1.2,1.4);
	                     $S_Creatinine1=array_rand($S_Creatinine);
	                     $S_Creatinine[$S_Creatinine1];
                        
                         $S_Uric_Acid=array(2,3,4,5,6);
	                     $S_Uric_Acid1=array_rand($S_Uric_Acid);
	                     $S_Uric_Acid[$S_Uric_Acid1];
	                     
	                     $SNat	=array(135,140,145,150,155);
	                     $SNat1=array_rand($SNat);
	                     $SNat[$SNat1];
	                     
	                     
	                     
	                     
	                     $SK=array(3.5,4.0,4.5,5.0,5.5);
	                     $SK1=array_rand($SK);
	                     $SK[$SK1];
	                     
	                     $Total_Cholestrol=array(150,160,170,180,190,200);
	                     $Total_Cholestrol1=array_rand($Total_Cholestrol);
	                     $Total_Cholestrol[$Total_Cholestrol1];
	                     
	                     $STg=array(60,80,90,100,120,140,150,160,170);
	                     $STg1=array_rand($STg);
	                     $STg[$STg1];
	                     
	                     
	                     $HDL=array(30,40,50,60,70);
	                     $HDL1=array_rand($HDL);
	                     $HDL[$HDL1];
	                     
	                     $LDL=array(110,120,130,140,150);
	                     $LDL1=array_rand($LDL);
	                     $LDL[$LDL1];
	                     
	                     $VLDL=array(14,15,18,20,25,28,34,36,38,42,44,45);
	                     $VLDL1=array_rand($VLDL);
	                     $VLDL[$VLDL1];
	                     
	                     
	                    $atime=array('9:00','9:05','9:10','09:15','09:20','09:30');
	                     $atime1=array_rand($atime);
	                     $atime[$atime1];
	                     
	                     $dtime=array('9:15','9:30','9:45','10:00','10:30','10:45');
	                     $dtime1=array_rand($dtime);
	                     $dtime[$dtime1];
	                     
	                     $phone=array(98,97,96,94);
	                     $phone1=array_rand($phone);
	                     $phone[$phone1];
	                     
	                     $digits = 8;
                         $digi8=rand(pow(10, $digits1),pow(10,$digits)-1);
                         $phonedigit10=$phone[$phone1].$digi8;
	                     
	                     
	                      //##
                         $BillirubinT=array(0.1,0.2,0.4,0.8,0.5);
	                     $BillirubinT1=array_rand($BillirubinT);
	                     $BillirubinT[$BillirubinT1];
	                     
	                     $BillirubinI=array(0.3,0.7,0.4,0.8,0.5);
	                     $BillirubinI1=array_rand($BillirubinI);
	                     $BillirubinI[$BillirubinI1];
                        
                         $Color=array('Yellow','Brown','Dark Brown','Black');
	                     $Color1=array_rand($Color);
	                     $Color[$Color1];
	                     
	                     $MUCOUS=array('+++','++++');
	                     $MUCOUS1=array_rand($MUCOUS);
	                     $MUCOUS[$MUCOUS1];
	                     
	                     $Comsistency=array('Liguid','Semi Solid','Solid','Hard');
	                     $Comsistency1=array_rand($Comsistency);
	                     $Comsistency[$Comsistency1];
	                     
	                     $raj=array('सामान्य ','अप्रवृत्ती ','अतिप्रवृत्ती ','अल्प प्रवृत्ती – काल');
	                     $raj1=array_rand($raj);
	                     $raj[$raj1];
	                     
	                     
	                     $samajik=array('Medium','Average', 'Above Poverty Line','Below Poverty Line','Poor','Modirate');
	                     $samajik1=array_rand($samajik);
	                     $samajik[$samajik1];
	                     
	                     $aharfood=array('Non vegetarian','Vegetarian', 'Non vegetarian +  Vegetarian');
	                     $aharfood1=array_rand($aharfood);
	                     $aharfood[$aharfood1];
	                     
	                     
	                     $aharghatak=array('Medium','Average', 'Above average','Below average','Poor');
	                     $aharghatak1=array_rand($aharghatak);
	                     $aharghatak[$aharghatak1];
	                     
	                     
	                     $nidtra=array('Normal');
	                     $nidtra1=array_rand($nidtra);
	                     $nidtra[$nidtra1];
	                     
	                     
	                     $vyasan=array('Tea','Coffee','Tobacco','Smoking');
	                     $vyasan1=array_rand($vyasan);
	                     $vyasan[$vyasan1];
	                     
	                     $mutrapra=array('4-Yellow','5-Faint yellow','6-Dark yellow','7-Pale Yellow','8-Yellow');
	                     $mutrapra1=array_rand($mutrapra);
	                     $mutrapra[$mutrapra1];
	                     
	                     
	                     $urine=array('NAD','NILL');
	                     $urine1=array_rand($urine);
	                     $urine[$urine1];
	                     
	                     $purushpra=array('1-Yellow','2-Dark yellow','1-Brown','2-Dark yellow','1-Dark Brown','2-blackest');
	                     $purushpra1=array_rand($purushpra);
	                     $purushpra[$purushpra1];
	                     
	                     $apanwayu=array('NAD','Normal','Excessive');
	                     $apanwayu1=array_rand($apanwayu);
	                     $apanwayu[$apanwayu1];
                        
                        
                         $koshth=array('क्रूर','मध्यम ','मृदू');
	                     $koshth1=array_rand($koshth);
	                     $koshth[$koshth1];
	                     
	                     
	                     $samanyaatur=array('Pitta','Vata','Pittakapha','Vatapitta','VataKaPha','Sam');
	                     $samanyaatur1=array_rand($samanyaatur);
	                     $samanyaatur[$samanyaatur1];
	                     
	                     
	                     $tap=array('96.5','96','97.5','97');
	                     $tap1=array_rand($tap);
	                     $tap[$tap1];
	                     
	                     
	                     $sharir=array('Medium','Modrate','Well built','Thin','Central Obesity');
	                     $sharir1=array_rand($sharir);
	                     $sharir[$sharir1];
	                     
	                     $aharshakti=array('Medium','Strong');
	                     $aharshakti1=array_rand($aharshakti);
	                     $aharshakti[$aharshakti1];
	                     
	                     
	                     $vyamshakti=array('Medium','Strong');
	                     $vyamshakti1=array_rand($vyamshakti);
	                     $vyamshakti[$vyamshakti1];
	                     
	                     
	                    $rand_no=rand(1,5);
	                     if($rand_no=='1'){
	                         $second='अल्पोपशय';$three='अल्पोपशय';$four='25';$five='50';$six='75';$seven='उपशय';$eight='उपशय';$nine='उपशय';
	                         
	                         $SPO2='88,90,92,91,93,94,96,97,98';
	                         $Input='2000,2020,2010,2060,2100,2080,2160,2140,2120';
	                         $Output='1600,1640,1680,1670,1720,1750,1800,1940,1960';
	                         
	                     }else if($rand_no=='2'){
	                         $second='25';$three='50';$four='75';$five='अल्पोपशय';$six='अल्पोपशय';$seven='अल्पोपशय';$eight='उपशय';$nine='उपशय';
	                        
	                         $SPO2='90,91,92,94,93,94,98,97,98';
	                         $Input='2010,2020,2040,2160,2100,2080,2160,2140,2120';
	                         $Output='1640,1650,1670,1670,1750,1780,1800,1940,1960';
	                     }
	                     else if($rand_no=='3'){
	                          $second='Same complaint';$three='10';$four='25';$five='50';$six='75';$seven='उपशय';$eight='उपशय';$nine='उपशय';
	                          
	                          $SPO2='92,91,92,88,93,94,98,96,98';
	                          $Input='2040,2020,2010,2060,2100,2090,2140,2140,2120';
	                          $Output='1750,1700,1680,1800,1850,1670,1680,1840,1940';
	                     }
	                     else if($rand_no=='4'){
	                         $second='10';$three='25';$four='50';$five='75';$six='उपशय';$seven='उपशय';$eight='अल्पोपशय';$nine='अल्पोपशय'; 
	                     
	                         $SPO2='89,90,91,93,94,94,97,96,98';
	                         $Input='2020,2020,2010,2080,2080,2180,2160,2140,2120';
	                         $Output='1680,1670,1700,1750,1840,1850,1900,1950,1950';
	                     }
	                     
	                     else if($rand_no=='5'){
	                          
	                         $second='Same complaint';$three='Same complaint';$four='10';$five='25';$six='50';$seven='75';$eight='अल्पोपशय';$nine='अल्पोपशय';
	                         
	                         $SPO2='89,88,90,94,94,94,96,97,98';
	                         $Input='2000,2010,2040,2030,2120,2080,2160,2140,2140';
	                         $Output='1600,1620,1690,1670,1740,1750,1800,1940,1960';
	                         
	                     }
	                     else{
	                           $second='';$three='';$four='';$five='';$six='';$seven='';$eight='';$nine='';
	                           
	                           $SPO2='88,91,90,88,93,95,97,96,98'; 
	                           $Input='2030,2020,2080,2060,2120,2080,2140,2150,2120';
	                           $Output='1640,1640,1690,1670,1720,1750,1840,1940,1980';
	                     }
						 
	                     /* $second=array('अल्पोपशय','25','Same complaint','10');
	                     $second1=array_rand($second);
	                     $second[$second1];
	                     
	                     $three=array('अल्पोपशय','25','Same complaint','10','50');
	                     $three1=array_rand($three);
	                     $three[$three1];
	                     
	                     $four=array('75','25','10','50');
	                     $four1=array_rand($four);
	                     $four[$four1];
	                     
	                     $five=array('अल्पोपशय','25','75','50');
	                     $five1=array_rand($five);
	                     $five[$five1];
	                     
	                     $six=array('अल्पोपशय','उपशय','75','50');
	                     $six1=array_rand($six);
	                     $six[$six1];
	                     
	                     $seven=array('अल्पोपशय','उपशय','75','उपशय','उपशय');
	                     $seven1=array_rand($seven);
	                     $seven[$seven1];
	                     
	                     $eight=array('अल्पोपशय','उपशय','अल्पोपशय','उपशय','उपशय');
	                     $eight1=array_rand($eight);
	                     $eight[$eight1];
	                     
	                     $nine=array('अल्पोपशय','उपशय','अल्पोपशय','उपशय','उपशय');
	                     $nine1=array_rand($nine);
	                     $nine[$nine1];
                        */
                        
                        
                         $gcondition=array('Fair','Moderate');
	                     $gcondition1=array_rand($gcondition);
	                     $gcondition[$gcondition1];
	                     
	                     $Scl=array('95','96','98','99','100','102','103','105');
	                     $Scl1=array_rand($Scl);
	                     $Scl[$Scl1];
	                     
	                   //  ,B_Sugar,Blood_Sugar,Blood_Urea,S_Creatinine,S_Uric_Acid,SNat,SK,Total_Cholestrol,STg,HDL,LDL,VLDL,atime,dtime,phone
                        
                      //  ,'".$B_Sugar[$B_Sugar1]."','".$Blood_Sugar[$Blood_Sugar1]."','".$Blood_Urea[$Blood_Urea1]."','".$S_Creatinine[$S_Creatinine1]."','".$S_Uric_Acid[$S_Uric_Acid1]."','".$SNat[$SNat1]."','".$SK[$SK1]."','".$Total_Cholestrol[$Total_Cholestrol1]."','". $STg[$STg1]."','".$HDL[$HDL1]."','".$LDL[$LDL1]."','".$VLDL[$VLDL1]."','".$atime[$atime1]."','".$dtime[$dtime1]."','".$phonedigit10."'
                        
                        
                        
                        /////////////////////////////######## IPF CASE PAPER############//////////////////
                        
                        
                         $SEX_Check=$row['SEX'];
                        
                          //master data_lmit_dept_ipd
                         $dep_bed_limit = "SELECT * FROM data_lmit_dept_ipd where dept_id=".$depart_id;
            	         $dep_bed_limit1 = $mysqli->query($dep_bed_limit);
            	         $dep_bed_limit11=$dep_bed_limit1->fetch_assoc();
            	         
            	         if($SEX_Check=='M'){
                         $data_limit=$dep_bed_limit11['data_limit_m'];
            	         }else{
            			 $data_limit=$dep_bed_limit11['data_limit_f'];
            	         }
            	         
            	         $dep_bed_limit_total=$data_limit;
                        // end master data_lmit_dept_ipd
            			
            			 //patient check in bed with gender
            	          $check_bed = "SELECT * FROM patient_ipd where discharge_date LIKE '%0000-00-00%' and  sex='$SEX_Check' and department_id=".$depart_id;
            	          $bed_status1 = $mysqli->query($check_bed);
            	          echo "//////////////////";  echo "<br>";
            	          echo "depart_id:".$depart_id;
            	          echo "//////////////////";  echo "<br>";
            	         echo  '$dep_bed_limit_total :'.$dep_bed_limit_total;
            	         echo "<br>";
            	         echo "//////////////////";
            	         echo  'bed_status_total :'.$bed_status_total=$bed_status1->num_rows;
            	         echo "//////////////////";
            	        // end patient check in bed with gender
                        
                        
                         $bed = "SELECT * FROM beds WHERE gender ='$SEX_Check' AND department_id ='$depart_id' AND status ='0' LIMIT  1";
                         $bed_no = $mysqli->query($bed);
	                     $bed_no1=$bed_no->fetch_assoc(); 
	                       if ($bed_no1) {
                            $admit_bed=$bed_no1['id'];
                            }else{
	                          $admit_bed ='';
	                        }
	                    
	                    //Admit only available diagnosis in ipd
	                   //echo $nivan=$row['NIDAN'];
	                   // $nivan1='%'.$nivan.'%';
	                    
	                    $che=trim($row['NIDAN']);
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $row['NIDAN'];
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $nivan = '%'.$new_str.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }else{
                            $nivan = '%'.$che.'%';
                            $p_dignosis_name=$row['NIDAN'];
                        }
	                    echo $nivan1 = $nivan;
	                    
	                    $proxy_id = $row['proxy_id'];
	                    //$department_id = $row['VIBHAG'];
	                    $department_id = $depart_id;
	                    
	                    $admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND proxy_id = '$proxy_id' AND department_id = '$department_id' AND ipd_opd ='ipd'";
	                    
	                    //$admit_avai_diagnosis = "SELECT * FROM treatments1 WHERE dignosis like '$nivan1' AND ipd_opd ='ipd'";
	                    
                        $admit_avai_diagnosis1 = $mysqli->query($admit_avai_diagnosis);
	                    $admit_avai_diagnosis2=$admit_avai_diagnosis1->fetch_assoc();
	                    
	                    echo "<br>=====> 8 ";
	                    print_r($admit_avai_diagnosis2);
	                    echo "<br><br><br>";   
                        
	                     
	                    if($bed_status_total < $dep_bed_limit_total){  
	                    //if($admit_avai_diagnosis2){ 
	                    if($admit_avai_diagnosis2 && $admit_bed != ''){ 
						$bed_status='1';
						
                           $query12 = "insert into patient_ipd(patient_id,yearly_no,yearly_reg_no,daily_reg_no,monthly_reg_no,firstname,sex,date_of_birth,address,department_id,dignosis,ipd_opd,ipd_no,discharge_date,create_date,ipd_flag,bedNo,Hb,TLC,DLC_Neutro,Lymphocytes,Monocytes,Eosinophils,ESR,Platelet_Count,B_Sugar,Blood_Sugar,Blood_Urea,S_Creatinine,S_Uric_Acid,SNat,SK,Total_Cholestrol,STg,HDL,LDL,VLDL,atime,dtime,phone ,BillirubinT,BillirubinI,Color,MUCOUS,Comsistency,raj,samajik,aharfood,aharghatak,nidtra,vyasan,mutrapra,urine,purushpra,apanwayu,koshth,samanyaatur,tap,sharir,aharshakti,vyamshakti,second,three,four,five,six,seven,eight,nine,SPO2,Input,Output,proxy_id,gcondition,Scl) values('".$row["Sno"]."','".$row["yealry_number"]."','".$CopddD_New."','".$row['Daily']."','".$row['Monthly']."','".$row["NAME"]."','".$row['SEX']."','".$row['AGE']."','".$adress_def[$key2]."','".$row['VIBHAG']."','".$row['NIDAN']."','".$ipd_opd."','".$row1['ipd_no']."','".$row['Dischargedate']."','".$date_only_new1."','".$ipd_flag."','".$admit_bed."','".$hb[$hb1]."','".$TLC[$TLC1]."','".$DLC_Neutro[$DLC_Neutro1]."','".$Lymphocytes[$Lymphocytes1]."','".$Monocytes[$Monocytes1]."','".$Eosinophils[$Eosinophils1]."','".$ESR[$ESR1]."','".$Platelet_Count[$Platelet_Count1]."','".$B_Sugar[$B_Sugar1]."','".$Blood_Sugar[$Blood_Sugar1]."','".$Blood_Urea[$Blood_Urea1]."','".$S_Creatinine[$S_Creatinine1]."','".$S_Uric_Acid[$S_Uric_Acid1]."','".$SNat[$SNat1]."','".$SK[$SK1]."','".$Total_Cholestrol[$Total_Cholestrol1]."','". $STg[$STg1]."','".$HDL[$HDL1]."','".$LDL[$LDL1]."','".$VLDL[$VLDL1]."','".$atime[$atime1]."','".$dtime[$dtime1]."','".$phonedigit10."','".$BillirubinT[$BillirubinT1]."','".$BillirubinI[$BillirubinI1]."','".$Color[$Color1]."','".$MUCOUS[$MUCOUS1]."','".$Comsistency[$Comsistency1]."','".$raj[$raj1]."','".$samajik[$samajik1]."','".$aharfood[$aharfood1]."','".$aharghatak[$aharghatak1]."','".$nidtra[$nidtra1]."','".$vyasan[$vyasan1]."','".$mutrapra[$mutrapra1]."','".$urine[$urine1]."','".$purushpra[$purushpra1]."','".$apanwayu[$apanwayu1]."','".$koshth[$koshth1]."','".$samanyaatur[$samanyaatur1]."','".$tap[$tap1]."','".$sharir[$sharir1]."','".$aharshakti[$aharshakti1]."','".$vyamshakti[$vyamshakti1]."','".$second."','".$three."','".$four."','". $five."','".$six."','".$seven."','".$eight."','".$nine."','".$SPO2."','".$Input."','".$Output."','".$row['proxy_id']."','".$gcondition[$gcondition1]."','".$Scl[$Scl1]."')";
                           //$mysqli->query($query12); 
                           $this->db->query($query12);
                           echo $query12;
                           $query22 = "update patient_ipd set ipd_flag = 1 where patient_id=".$row["Sno"];
                          $mysqli->query($query22);
                          
                          $query2222 = "update patient set flag = 1,ipd_patient_flag = 1 where yearly_reg_no='$CopddD_New' ORDER BY id DESC LIMIT 1";
                          $mysqli->query($query2222);
                          
                              $query222 = "update beds set status = 1 where id=".$admit_bed;
                             $mysqli->query($query222);
					         }
                            }
                          }  
                   }
                 } 
                 else{
                   
                   echo "<br>no admit";
                  }
			  
                }
                
              
       }
	 
	   
       echo "insert data succesfully using crone job (only new...)" ;
      } else {
       echo "master data no available(only new)";
      }
	}
	 
      $mysqli->close();
    }
	   
     else{ 
         echo "Today's OPD/IPD is Closed";
     }
    }
   
    else {
        echo "Auto Stopped";
    }
	}
     


    public function index()
    {
        /// echo("hello");exit;
        // redirect to dashboard home page
       
        if($this->session->userdata('isLogIn')) 
        $this->redirectTo($this->session->userdata('user_role'));

        $this->form_validation->set_rules('email', display('email'),'required|max_length[50]|valid_email');
        $this->form_validation->set_rules('password', display('password'),'required|max_length[32]|md5');
        //$this->form_validation->set_rules('user_role',display('user_role'),'required');
        #-------------------------------#
        $setting = $this->setting_model->read();
        $data['title']   = (!empty($setting->title)?$setting->title:null);
        $data['logo']    = (!empty($setting->logo)?$setting->logo:null); 
        $data['favicon'] = (!empty($setting->favicon)?$setting->favicon:null); 
        $data['footer_text'] = (!empty($setting->footer_text)?$setting->footer_text:null); 

        $data['user'] = (object)$postData = [
            'email'     => $this->input->post('email',true),
            'password'  => md5($this->input->post('password',true)),
            'user_role' => $this->input->post('user_role',true), 
            'acyear' => $this->input->post('acyear'),
        ]; 



        #-------------------------------#
        if ($this->form_validation->run() === true) 
        {

            $this->session->set_userdata($postData);

            //check user data
            $check_user = $this->dashboard_model->check_user($postData); 

            if ($postData['user_role'] == 10) 
            {
                $check_user = $this->dashboard_model->check_patient($postData); 
            } 
            else 
            {
                $check_user = $this->dashboard_model->check_user($postData); 
            }

            if ($check_user->num_rows() === 1) {
                //retrive setting data and store to session



                //store data in session
                
                
               $temp = explode(',',$setting->title);
               
               $title = $temp[0]."</h4><br><h3 style='margin-top:-7px;text-transform:uppercase;'>".$temp[1]."</h3>";
               
                
                $this->session->set_userdata([
                    'isLogIn'   => true,
                    'user_id' => (($postData['user_role']==10)?$check_user->row()->id:$check_user->row()->user_id),
                    'patient_id' => (($postData['user_role']==10)?$check_user->row()->patient_id:null),
                    'email'     => $check_user->row()->email,
                    'fullname'  => $check_user->row()->firstname.' '.$check_user->row()->lastname,
                    'user_role' => (($postData['user_role']==10)?10:$check_user->row()->user_role),
                    'picture'   => $check_user->row()->picture,
                    'department_id'   => $check_user->row()->department_id, 
                    'title'     => (!empty($title)?$title:null),
                    /*'title'     => (!empty($setting->title)?$setting->title:null),*/
                    'address'   => (!empty($setting->description)?$setting->description:null),
                    'logo'      => (!empty($setting->logo)?$setting->logo:null),
                    'favicon'      => (!empty($setting->favicon)?$setting->favicon:null),
                    'footer_text' => (!empty($setting->footer_text)?$setting->footer_text:null),
                    'status' => $check_user->row()->status
                ]);

                //redirect to dashboard home page
                $this->redirectTo($postData['user_role']);

            } else {
                #set exception message
                $this->session->set_flashdata('exception',display('incorrect_email_password'));
                //redirect to login form
                redirect('login');
            }

        } else {
            $this->load->view('layout/login_wrapper',$data);
        } 
    }  
    
    
    public function redirectTo($user_role = null)
    {
        
        if($user_role){
            redirect('dashboard/home');
        }
        else{
            redirect('login');
        }
    }

    public function home()
    {    
       
        
        if ($this->session->userdata('isLogIn') == false)
        redirect('login');  

        $data['title'] = display('home');
        #------------------------------#
        $data['notify']   = $this->dashboard_model->notify(); 
        $data['enquires'] = $this->dashboard_model->enquiry();  
        $data['chart']    = $this->dashboard_model->chart();    
        $data['content']  = $this->load->view('home',$data,true);
        $this->load->view('layout/main_wrapper',$data);
    } 

    public function profile()
    {  
        $data['title'] = display('profile');
        #------------------------------# 
        $user_id = $this->session->userdata('user_id');
        $data['user']    = $this->dashboard_model->profile($user_id);
        $data['content'] = $this->load->view('profile', $data, true);
        $this->load->view('layout/main_wrapper',$data);
    } 

    public function email_check($email, $user_id)
    { 
        $emailExists = $this->db->select('email')
            ->where('email',$email) 
            ->where_not_in('user_id',$user_id) 
            ->get('user')
            ->num_rows();

        if ($emailExists > 0) {
            $this->form_validation->set_message('email_check', 'The {field} field must contain a unique value.');
            return false;
        } else {
            return true;
        }
    }

  



public function form()
    {
        $data['title'] = display('edit_profile');
        $user_id = $this->session->userdata('user_id');
        #-------------------------------#
        $this->form_validation->set_rules('firstname', display('first_name') ,'required|max_length[50]');
        $this->form_validation->set_rules('lastname', display('last_name'),'required|max_length[50]');

        $this->form_validation->set_rules('email',display('email'), "required|max_length[50]|valid_email|callback_email_check[$user_id]");

        $this->form_validation->set_rules('password', display('password'),'required|max_length[32]|md5');

        $this->form_validation->set_rules('phone', display('phone') ,'max_length[20]');
        $this->form_validation->set_rules('mobile', display('mobile'),'required|max_length[20]');
        $this->form_validation->set_rules('blood_group', display('blood_group'),'max_length[10]');
        $this->form_validation->set_rules('sex', display('sex'),'required|max_length[10]');
        $this->form_validation->set_rules('date_of_birth', display('date_of_birth'),'max_length[10]');
        $this->form_validation->set_rules('address',display('address'),'required|max_length[255]');
        $this->form_validation->set_rules('status',display('status'),'required');
        #-------------------------------#
        
        //picture upload
        $picture = $this->fileupload->do_upload(
            'assets/images/doctor/',
            'picture'
        );
        
        // if picture is uploaded then resize the picture
        if ($picture !== false && $picture != null) 
        {
            $this->fileupload->do_resize(
                $picture, 
                293,
                350
            );
        }
        
        //if picture is not uploaded
        if ($picture === false) 
        {
            $this->session->set_flashdata('exception', display('invalid_picture'));
        }
        
        
        //Signiture picture upload
        $signiture = $this->fileupload->do_upload(
            'assets/images/doctor_signiture/',
            'signiture'
        );
        
        // if picture is uploaded then resize the picture
        if ($signiture !== false && $signiture != null) 
        {
            $this->fileupload->do_resize(
                $signiture, 
                256,
                64
            );
        }
        
        //if picture is not uploaded
        if ($signiture === false) 
        {
            $this->session->set_flashdata('exception', display('invalid_picture'));
        }
        
        
        
        #-------------------------------# 
        $data['doctor'] = (object)$postData = [
            'user_id'      => $this->input->post('user_id',true),
            'firstname'    => $this->input->post('firstname',true),
            'lastname'     => $this->input->post('lastname',true),
            'designation'  => $this->input->post('designation',true),
            'department_id' => $this->input->post('department_id',true),
            'address'      => $this->input->post('address',true),
            'phone'        => $this->input->post('phone',true),
            'mobile'       => $this->input->post('mobile',true),
            'email'        => $this->input->post('email',true),
            'password'     => md5($this->input->post('password',true)),
            'short_biography' => $this->input->post('short_biography',true),
            'picture'      => (!empty($picture)?$picture:$this->input->post('old_picture')),
            
            'signiture'      => (!empty($signiture)?$signiture:$this->input->post('old_signiture')),
            
            'specialist'   => $this->input->post('specialist',true),
            'date_of_birth' => date('Y-m-d', strtotime($this->input->post('date_of_birth',true))),
            'sex'          => $this->input->post('sex',true),
            'blood_group'  => $this->input->post('blood_group',true),
            'degree'       => $this->input->post('degree',true),
            'created_by'   => $this->session->userdata('user_id'),
            'create_date'  => date('Y-m-d'),
            'status'       => $this->input->post('status',true),
        ]; 
        #-------------------------------#
        
        if ($this->form_validation->run() === true) 
        {

            if ($this->dashboard_model->update($postData)) 
            {
                #set success message
                $this->session->set_flashdata('message',display('update_successfully'));
            } 
            else 
            {
                #set exception message
                $this->session->set_flashdata('exception', display('please_try_again'));
            }

            //update profile picture
            if ($postData['user_id'] == $this->session->userdata('user_id')) 
            {                  
                $this->session->set_userdata([
                    'picture'   => $postData['picture'],
                    'signiture'   => $postData['signiture'],
                    'fullname'  => $postData['firstname'].' '.$postData['lastname']
                ]); 
            }
            
            redirect('dashboard/form/');

        } 
        else 
        {
            $user_id = $this->session->userdata('user_id');
            $data['doctor'] = $this->dashboard_model->profile($user_id); 
            $data['department_list'] = $this->department_model->department_list(); 
            $data['content'] = $this->load->view('profile_form',$data,true);
            $this->load->view('layout/main_wrapper',$data);
        } 
    }
    
    
  

    public function logout()
    {   
        $this->session->sess_destroy(); 
        redirect('login');
    } 
    
    

    
    
    // public function investi_panch_count()
    // {
    //     error_reporting(0);
    //     echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
    //     date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
    //     echo date('d-m-Y H:i:s');
    //     echo "<script>
    //         $(document).ready(function () {
    //              setTimeout('location.reload(true);', '10000');
    //         });
    //     </script>";
        
    //     ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //     /////////////////////////////////////                                                         /////////////////////////////////////
    //     /////////////////////////////////////      OPD Investigation & Panchakarma Counting CODE      /////////////////////////////////////
    //     /////////////////////////////////////                                                         /////////////////////////////////////
    //     ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
    //     $start_time= date('H:i',strtotime('18:15'));
    //     $time_date=date('H:i');
        
    //     $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'opd')->order_by('id','DESC')->limit(1)->get('investi_panch_opd_total_count')->row();
    //     print_r('<br>');
    //     $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
    //     print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
    //     $current_date = date('Y-m-d');
    //     print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
    //     $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
    //     print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');print_r('<br>');
        
    //     $section_opd = 'opd';
        
    //     $rand_limit_patient = rand(50, 60);
        
    //     $res = $this->db->where(['create_date'=> $push_date, 'yearly_reg_no != '=>''])->get('patient')->result();
    //     if($current_date == $push_date)
    //     {
    //         //print_r($res);
            
    //         $index = 0;
    //         $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
    //         $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
    //         $Yonipichu = 0; $Other = 0; $Hematology = 0; $Serology = 0; $BioChemistry = 0; 
    //         $Microbiology = 0; $XRay = 0; $ECG = 0; $USG = 0; 
            
    //         $Hematology_Test = 0; $Serology_Test = 0; $BioChemistry_Test = 0; 
    //         $Microbiology_Test = 0; $XRay_Test = 0; $ECG_Test = 0; $USG_Test = 0; 
            
    //         $startDate2 = date('Y-m-d', strtotime($push_date));
    //         print_r('OPD Investigation & Panchakarma Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
    //         if($res != '' || $res != null){
                
    //             ///////////// $this->db->select('yearly_reg_no');
    //             ///////////// $this->db->from('patient_ipd');
    //             ///////////// $this->db->where('create_date like', '%'.$startDate2.'%');
    //             ///////////// $this->db->where('ipd_opd', 'ipd');
    //             ///////////// $subQuery =  $this->db->get_compiled_select();
                
    //             ///////////// $this->db->where('create_date like', '%'.$startDate2.'%');
    //             ///////////// $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
    //             ///////////// $this->db->where('ipd_opd', 'opd');
    //             ///////////// $this->db->limit($rand_limit_patient);
    //             ///////////// $patientList =  $this->db->get('patient')->result();
                
    //             $this->db->select('yearly_reg_no');
    //             $this->db->from('patient_ipd');
    //             $this->db->where('yearly_reg_no != ','');
    //             $this->db->where('create_date like', '%'.$startDate2.'%');
    //             $this->db->where('ipd_opd', 'ipd');
    //             $subQuery1 =  $this->db->get_compiled_select();
                
    //             $this->db->select('old_reg_no');
    //             $this->db->from('patient_ipd');
    //             $this->db->where('old_reg_no != ','');
    //             $this->db->where('create_date like', '%'.$startDate2.'%');
    //             $this->db->where('ipd_opd', 'ipd');
    //             $subQuery2 =  $this->db->get_compiled_select();
                
    //             $this->db->where('ipd_opd', 'opd');
    //              $this->db->where('dignosis !=', '');
    //             $this->db->where('manual_status', '0');
    //             $this->db->where('ipd_patient_flag', '0');
    //             $this->db->where('create_date like', '%'.$startDate2.'%');
    //             $this->db->where("yearly_reg_no NOT IN ($subQuery1)", NULL, FALSE);
    //             $this->db->or_where('ipd_opd', 'opd');
    //              $this->db->where('dignosis !=', '');
    //             $this->db->where('manual_status', '0');
    //             $this->db->where('ipd_patient_flag', '0');
    //             $this->db->where('create_date like', '%'.$startDate2.'%');
    //             $this->db->where("old_reg_no NOT IN ($subQuery2)", NULL, FALSE);
    //             //$this->db->limit($rand_limit_patient);
    //             $patientList =  $this->db->get('patient')->result();
    //              // print_r($patientList);
    //           //  print_r($this->db->last_query());
    //             // echo 'hiiii';
    //             // die();
    //             // print_r(count($patientList));
                
                
    //             foreach($patientList as $patient){
    //                 print_r('Yearly Reg No ==>==>==>==> ');print_r($patient->yearly_reg_no);print_r(' -------> ');
    //                 print_r('Old Reg No ==>==>==>==> ');print_r($patient->old_reg_no);print_r('<br>');
                    
    //                 //////////////////////////////////////// Treatement Fetching Code Start ///////////////////////////////////
    //                 $section_tret='opd';
    //                 $che=trim($patient->dignosis);
    //                 $section_tret='opd';
    //                 $len=strlen($che);
    //                 $dd= substr($che,$len - 1);
    //                 $str = $patient->dignosis;
    //                 $arry=explode("-",$str);
    //                 $t_c=count($arry);
    //                 if($t_c=='2'){
    //                     $dd1=substr($che, 0, -1);
    //                     $new_str = trim($arry[0]);
    //                     $p_dignosis = '%'.$new_str.'%';
    //                     $p_dignosis_name=$patient->dignosis;
    //                 }else{
    //                     $p_dignosis = '%'.$che.'%';
    //                     $p_dignosis_name=$patient->dignosis;
    //                 }
    //                 if($patient->manual_status==0){
    //                                   if($patient->proxy_id){
    //                                  $tretment=$this->db->select("*")
	// 		                         ->from('treatments1')
    //                                  ->where('dignosis LIKE',$p_dignosis)
    //                                  ->where('proxy_id',$patient->proxy_id)
    //                                  ->where('department_id',$patient->department_id)
	// 		                         ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();
    //                                   }
    //                                   else
    //                                   {
    //                                   $tretment=$this->db->select("*")
	// 		                         ->from('treatments1')
    //                                  ->where('dignosis LIKE',$p_dignosis)
    //                                   ->where('department_id',$patient->department_id)
    //                                  ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();  
    //                                   if(empty($tretment)){
    //                                   $tretment=$this->db->select("*")
    //                                   ->from('treatments1')
    //                                   ->where('department_id',$patient->department_id)
	// 		                          ->where('ipd_opd',$patient->department_id)
    //                                  ->get()
    //                                  ->row();   
    //                                   }
    //                                   }
    //                               }else{
    //                                   $tretment=$this->db->select("*")
    //                                   ->from('manual_treatments')
    //                                  ->where('patient_id_auto',$patient->id)
	// 		                         ->where('dignosis LIKE',$p_dignosis)
	// 		                         ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();
    //                               }
    //                 //////////////////////////////////////// Treatement Fetching Code End ///////////////////////////////////
                    
    //                 if($tretment){
    //                     if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER || $tretment->HEMATOLOGICAL || $tretment->SEROLOGYCAL || $tretment->BIOCHEMICAL || $tretment->MICROBIOLOGICAL || $tretment->X_RAY || $tretment->ECG || $tretment->USG){
    //                         print_r("Panchakarma ==>==>==> ");
    //                         if($tretment->SNEHAN){ 
    //                             print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
    //                             $Snehan = $Snehan + 1;
    //                         }
    //                         if($tretment->SWEDAN){ 
    //                             print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
    //                             $Swedan = $Swedan + 1;
    //                         }
    //                         if($tretment->VAMAN){ 
    //                             print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
    //                             $Vaman = $Vaman + 1;
    //                         }
    //                         if($tretment->VIRECHAN){ 
    //                             print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
    //                             $Virechan = $Virechan + 1;
    //                         }
    //                         if($tretment->NASYA){ 
    //                             print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
    //                             $Nasya = $Nasya + 1;
    //                         }
    //                         if($tretment->RAKTAMOKSHAN){ 
    //                             print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
    //                             $Raktmokshan = $Raktmokshan + 1;
    //                         }
    //                         if($tretment->SHIRODHARA_SHIROBASTI){ 
    //                             print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
    //                             $Shirodhara = $Shirodhara + 1;
    //                         }
    //                         if($tretment->SHIROBASTI){ 
    //                             print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
    //                             $Shirobasti = $Shirobasti + 1;
    //                         }
    //                         if($tretment->UTTARBASTI){ 
    //                             print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
    //                             $Uttarbasti = $Uttarbasti + 1;
    //                         }
    //                         if($tretment->BASTI){ 
    //                             print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
    //                             $Basti = $Basti + 1;
    //                         }
    //                         if($tretment->YONIDHAVAN){ 
    //                             print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
    //                             $Yonidhavan = $Yonidhavan + 1;
    //                         }
    //                         if($tretment->YONIPICHU){ 
    //                             print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
    //                             $Yonipichu = $Yonipichu + 1;
    //                         }
    //                         if($tretment->OTHER){ 
    //                             print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
    //                             $Other = $Other + 1;
    //                         }
                            
    //                         print_r("Investigation ==>==>==> ");
    //                         if($tretment->HEMATOLOGICAL){   print_r('<br>');
    //                             print_r("Hematology");print_r(' ==>==>==>==> ');print_r($tretment->HEMATOLOGICAL);
    //                             $Hematology = $Hematology + 1;
                                
    //                             $ex = explode(',',trim($tretment->HEMATOLOGICAL));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $Hematology_Test = $Hematology_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->SEROLOGYCAL){
    //                             print_r("Serology");print_r(' ==>==>==>==> ');print_r($tretment->SEROLOGYCAL);
    //                             $Serology = $Serology + 1;
                                
    //                             $ex = explode(',',trim($tretment->SEROLOGYCAL));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $Serology_Test = $Serology_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 if($ex[$i] == 'WIDAL TEST')
    //                                               {
    //                                                 $ex_random_val_wd20 = explode(',',trim($rs->WD_20));
    //                                                 $ex_random_val_wd40 = explode(',',trim($rs->WD_40));
    //                                                 $ex_random_val_wd80 = explode(',',trim($rs->WD_80));
    //                                                 $ex_random_val_wd160 = explode(',',trim($rs->WD_160));
    //                                                 $ex_random_val_wd320 = explode(',',trim($rs->WD_320));
    //                                               }
    //                                               else
    //                                               {
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                               }
    //                                             }
                                              
    //                                           $rand_val_wd20 = array_rand($ex_random_val_wd20);
    //                                           $rand_val_wd40 = array_rand($ex_random_val_wd40);
    //                                           $rand_val_wd80 = array_rand($ex_random_val_wd80);
    //                                           $rand_val_wd160 = array_rand($ex_random_val_wd160);
    //                                           $rand_val_wd320 = array_rand($ex_random_val_wd320);
                                              
                                              
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'WD_20_RESULT' =>$ex_random_val_wd20[$rand_val_wd20],
    //                                                 'WD_40_RESULT' =>$ex_random_val_wd40[$rand_val_wd40],
    //                                                 'WD_80_RESULT' =>$ex_random_val_wd80[$rand_val_wd80],
    //                                                 'WD_160_RESULT' =>$ex_random_val_wd160[$rand_val_wd160],
    //                                                 'WD_320_RESULT' =>$ex_random_val_wd320[$rand_val_wd320],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->BIOCHEMICAL){
    //                             print_r("Bio-Chemistry");print_r(' ==>==>==>==> ');print_r($tretment->BIOCHEMICAL);
    //                             $BioChemistry = $BioChemistry + 1;
                                
    //                             $ex = explode(',',trim($tretment->BIOCHEMICAL));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $BioChemistry_Test = $BioChemistry_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                               if($ex[$i] == 'WIDAL TEST')
    //                                               {
    //                                                 $ex_random_val_wd20 = explode(',',trim($rs->WD_20));
    //                                                 $ex_random_val_wd40 = explode(',',trim($rs->WD_40));
    //                                                 $ex_random_val_wd80 = explode(',',trim($rs->WD_80));
    //                                                 $ex_random_val_wd160 = explode(',',trim($rs->WD_160));
    //                                                 $ex_random_val_wd320 = explode(',',trim($rs->WD_320));
    //                                               }
    //                                               else
    //                                               {
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                               }
    //                                             }
    //                                           $rand_val_wd20 = array_rand($ex_random_val_wd20);
    //                                           $rand_val_wd40 = array_rand($ex_random_val_wd40);
    //                                           $rand_val_wd80 = array_rand($ex_random_val_wd80);
    //                                           $rand_val_wd160 = array_rand($ex_random_val_wd160);
    //                                           $rand_val_wd320 = array_rand($ex_random_val_wd320);
                                              
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'WD_20_RESULT' =>$ex_random_val_wd20[$rand_val_wd20],
    //                                                 'WD_40_RESULT' =>$ex_random_val_wd40[$rand_val_wd40],
    //                                                 'WD_80_RESULT' =>$ex_random_val_wd80[$rand_val_wd80],
    //                                                 'WD_160_RESULT' =>$ex_random_val_wd160[$rand_val_wd160],
    //                                                 'WD_320_RESULT' =>$ex_random_val_wd320[$rand_val_wd320],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->MICROBIOLOGICAL){
    //                             print_r("Microbiology");print_r(' ==>==>==>==> ');print_r($tretment->MICROBIOLOGICAL);
    //                             $Microbiology = $Microbiology + 1;
                                
    //                             $ex = explode(',',trim($tretment->MICROBIOLOGICAL));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $Microbiology_Test = $Microbiology_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->X_RAY){
    //                             print_r("X-Ray");print_r(' ==>==>==>==> ');print_r($tretment->X_RAY);
    //                             $XRay = $XRay + 1;
                                
    //                             $ex = explode(',',trim($tretment->X_RAY));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $XRay_Test = $XRay_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->ECG){
    //                             print_r("ECG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
    //                             $ECG = $ECG + 1;
                                
    //                             $ex = explode(',',trim($tretment->ECG));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $ECG_Test = $ECG_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->USG){
    //                             print_r("USG");print_r(' ==>==>==>==> ');print_r($tretment->USG);
    //                             $USG = $USG + 1;
                                
    //                             $ex = explode(',',trim($tretment->USG));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $USG_Test = $USG_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         print_r('<br>');
                            
    //                         (object)$postPatientInvestPanchData = ([
    //                                 'patient_auto_id' => $patient->id,
    //                                 'patient_name' => $patient->firstname,
    //                                 'ipd_opd' => $patient->ipd_opd,
    //                                 'sex' => $patient->sex,
    //                                 'create_date' => $startDate2,
    //                                 'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
    //                                 'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
    //                                 'vaman' => ($tretment->VAMAN) ? $tretment->VAMAN : NULL,
    //                                 'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
    //                                 'nasya' => ($tretment->NASYA) ? $tretment->NASYA : NULL,
    //                                 'raktmokshan' => ($tretment->RAKTAMOKSHAN) ? $tretment->RAKTAMOKSHAN : NULL,
    //                                 'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
    //                                 'shirobasti' => ($tretment->SHIROBASTI) ? $tretment->SHIROBASTI : NULL,
    //                                 'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
    //                                 'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
    //                                 'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
    //                                 'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
    //                                 'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
    //                                 'hematology' => ($tretment->HEMATOLOGICAL) ? $tretment->HEMATOLOGICAL : NULL,
    //                                 'serology' => ($tretment->SEROLOGYCAL) ? $tretment->SEROLOGYCAL : NULL,
    //                                 'biochemistry' => ($tretment->BIOCHEMICAL) ? $tretment->BIOCHEMICAL : NULL,
    //                                 'microbiology' => ($tretment->MICROBIOLOGICAL) ? $tretment->MICROBIOLOGICAL : NULL,
    //                                 'xray' => ($tretment->X_RAY) ? $tretment->X_RAY : NULL,
    //                                 'ecg' => ($tretment->ECG) ? $tretment->ECG : NULL,
    //                                 'usg' => ($tretment->USG) ? $tretment->USG : NULL
    //                         ]);
    //                         $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('investi_panch_opd_patient_count')->num_rows();
    //                         if($searchRes == 0){
    //                             $updateRes = $this->db->insert('investi_panch_opd_patient_count', $postPatientInvestPanchData);
    //                         }
    //                     }
    //                 }
                    
    //             }
    //             $investi_panch_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology,
    //                 'Serology' => $Serology,
    //                 'BioChemistry' => $BioChemistry,
    //                 'Microbiology' => $Microbiology,
    //                 'XRay' => $XRay,
    //                 'ECG' => $ECG,
    //                 'USG' => $USG
    //             ];
    //             $investi_panch_test_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology_Test,
    //                 'Serology' => $Serology_Test,
    //                 'BioChemistry' => $BioChemistry_Test,
    //                 'Microbiology' => $Microbiology_Test,
    //                 'XRay' => $XRay_Test,
    //                 'ECG' => $ECG_Test,
    //                 'USG' => $USG_Test
    //             ];
    //             $index = $index + 1;
    //             print_r($investi_panch_count);print_r("<br>");
    //             print_r($investi_panch_test_count);print_r("<br>");
    //         }
    //         else{
    //             $investi_panch_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology,
    //                 'Serology' => $Serology,
    //                 'BioChemistry' => $BioChemistry,
    //                 'Microbiology' => $Microbiology,
    //                 'XRay' => $XRay,
    //                 'ECG' => $ECG,
    //                 'USG' => $USG
    //             ];
    //             $investi_panch_test_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology_Test,
    //                 'Serology' => $Serology_Test,
    //                 'BioChemistry' => $BioChemistry_Test,
    //                 'Microbiology' => $Microbiology_Test,
    //                 'XRay' => $XRay_Test,
    //                 'ECG' => $ECG_Test,
    //                 'USG' => $USG_Test
    //             ];
    //             $index = $index + 1;
    //             print_r($investi_panch_count);print_r("<br>");
    //             print_r($investi_panch_test_count);print_r("<br>");
    //         }
            
    //         for($i=0; $i<count($investi_panch_count);$i++){
    //             print_r($investi_panch_count[$i]['Hematology']);
    //             (object)$postPatientInvestPanchCountData = ([
    //                     'ipd_opd' => $section_opd,
    //                     'create_date' => $startDate2,
    //                     'snehan_count' => $investi_panch_count[$i]['Snehan'],
    //                     'swedan_count' => $investi_panch_count[$i]['Swedan'],
    //                     'vaman_count' => $investi_panch_count[$i]['Vaman'],
    //                     'virechan_count' => $investi_panch_count[$i]['Virechan'],
    //                     'nasya_count' => $investi_panch_count[$i]['Nasya'],
    //                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
    //                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
    //                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
    //                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
    //                     'basti_count' => $investi_panch_count[$i]['Basti'],
    //                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
    //                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
    //                     'others_count' => $investi_panch_count[$i]['Other'],
    //                     'hematology_count' => $investi_panch_count[$i]['Hematology'],
    //                     'serology_count' => $investi_panch_count[$i]['Serology'],
    //                     'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'],
    //                     'microbiology_count' => $investi_panch_count[$i]['Microbiology'],
    //                     'xray_count' => $investi_panch_count[$i]['XRay'],
    //                     'ecg_count' => $investi_panch_count[$i]['ECG'],
    //                     'usg_count' => $investi_panch_count[$i]['USG'],
    //                 ]);
    //             $res = $this->db->insert('investi_panch_opd_total_count', $postPatientInvestPanchCountData);
                
    //             (object)$postPatientInvestPanchTestCountData = ([
    //                     'ipd_opd' => $section_opd,
    //                     'create_date' => $startDate2,
    //                     'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
    //                     'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
    //                     'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
    //                     'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
    //                     'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
    //                     'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
    //                     'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
    //                     'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
    //                     'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
    //                     'basti_count' => $investi_panch_test_count[$i]['Basti'],
    //                     'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
    //                     'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
    //                     'others_count' => $investi_panch_test_count[$i]['Other'],
    //                     'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
    //                     'serology_count' => $investi_panch_test_count[$i]['Serology'],
    //                     'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
    //                     'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
    //                     'xray_count' => $investi_panch_test_count[$i]['XRay'],
    //                     'ecg_count' => $investi_panch_test_count[$i]['ECG'],
    //                     'usg_count' => $investi_panch_test_count[$i]['USG'],
    //                 ]);
    //             $res1 = $this->db->insert('investi_panch_opd_test_total_count', $postPatientInvestPanchTestCountData);
    //             if($res && $res1)
    //             {
    //                 print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
    //             }
    //         }
    //     }
    //     elseif($current_date > $push_date)
    //     {            
    //         //print_r($res);
            
    //         $index = 0;
    //         $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
    //         $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
    //         $Yonipichu = 0; $Other = 0; $Hematology = 0; $Serology = 0; $BioChemistry = 0; 
    //         $Microbiology = 0; $XRay = 0; $ECG = 0; $USG = 0; 
            
    //         $Hematology_Test = 0; $Serology_Test = 0; $BioChemistry_Test = 0; 
    //         $Microbiology_Test = 0; $XRay_Test = 0; $ECG_Test = 0; $USG_Test = 0; 
            
    //         $startDate2 = date('Y-m-d', strtotime($push_date));
    //         print_r('OPD Investigation & Panchakarma Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
    //         if($res != '' || $res != null){
                
    //             ///////////// $this->db->select('yearly_reg_no');
    //             ///////////// $this->db->from('patient_ipd');
    //             ///////////// $this->db->where('create_date like', '%'.$startDate2.'%');
    //             ///////////// $this->db->where('ipd_opd', 'ipd');
    //             ///////////// $subQuery =  $this->db->get_compiled_select();
                
    //             ///////////// $this->db->where('create_date like', '%'.$startDate2.'%');
    //             ///////////// $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
    //             ///////////// $this->db->where('ipd_opd', 'opd');
    //             ///////////// $this->db->limit($rand_limit_patient);
    //             ///////////// $patientList =  $this->db->get('patient')->result();
                
    //             $this->db->select('yearly_reg_no');
    //             $this->db->from('patient_ipd');
    //             $this->db->where('yearly_reg_no != ','');
    //             $this->db->where('create_date like', '%'.$startDate2.'%');
    //             $this->db->where('ipd_opd', 'ipd');
    //             $subQuery1 =  $this->db->get_compiled_select();
                
    //             $this->db->select('old_reg_no');
    //             $this->db->from('patient_ipd');
    //             $this->db->where('old_reg_no != ','');
    //             $this->db->where('create_date like', '%'.$startDate2.'%');
    //             $this->db->where('ipd_opd', 'ipd');
    //             $subQuery2 =  $this->db->get_compiled_select();
                
    //             $this->db->where('ipd_opd', 'opd');
    //             $this->db->where('dignosis !=', '');
    //             $this->db->where('manual_status', '0');
    //            $this->db->where('ipd_patient_flag', '0');
    //             $this->db->where('create_date like', '%'.$startDate2.'%');
    //             $this->db->where("yearly_reg_no NOT IN ($subQuery1)", NULL, FALSE);
    //             $this->db->or_where('ipd_opd', 'opd');
    //             $this->db->where('dignosis !=', '');
    //             $this->db->where('manual_status', '0');
    //            $this->db->where('ipd_patient_flag', '0');
    //             $this->db->where('create_date like', '%'.$startDate2.'%');
    //             $this->db->where("old_reg_no NOT IN ($subQuery2)", NULL, FALSE);
    //             //$this->db->limit($rand_limit_patient);
    //             $patientList =  $this->db->get('patient')->result();
    //             // print_r($this->db->last_query());
                
    //             // print_r(count($patientList));
    //             // print_r($patientList);
                
    //             foreach($patientList as $patient){
    //                 print_r('Yearly Reg No ==>==>==>==> ');print_r($patient->yearly_reg_no);print_r(' -------> ');
    //                 print_r('Old Reg No ==>==>==>==> ');print_r($patient->old_reg_no);print_r('<br>');
                    
    //                 //////////////////////////////////////// Treatement Fetching Code Start ///////////////////////////////////
    //                 $section_tret='opd';
    //                 $che=trim($patient->dignosis);
    //                 $section_tret='opd';
    //                 $len=strlen($che);
    //                 $dd= substr($che,$len - 1);
    //                 $str = $patient->dignosis;
    //                 $arry=explode("-",$str);
    //                 $t_c=count($arry);
    //                 if($t_c=='2'){
    //                     $dd1=substr($che, 0, -1);
    //                     $new_str = trim($arry[0]);
    //                     $p_dignosis = '%'.$new_str.'%';
    //                     $p_dignosis_name=$patient->dignosis;
    //                 }else{
    //                     $p_dignosis = '%'.$che.'%';
    //                     $p_dignosis_name=$patient->dignosis;
    //                 }
    //               if($patient->manual_status==0){
    //                                   if($patient->proxy_id){
    //                                  $tretment=$this->db->select("*")
	// 		                         ->from('treatments1')
    //                                  ->where('dignosis LIKE',$p_dignosis)
    //                                  ->where('proxy_id',$patient->proxy_id)
    //                                  ->where('department_id',$patient->department_id)
	// 		                         ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();
    //                                   }
    //                                   else
    //                                   {
    //                                   $tretment=$this->db->select("*")
	// 		                         ->from('treatments1')
    //                                  ->where('dignosis LIKE',$p_dignosis)
    //                                   ->where('department_id',$patient->department_id)
    //                                  ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();  
    //                                   if(empty($tretment)){
    //                                   $tretment=$this->db->select("*")
    //                                   ->from('treatments1')
    //                                   ->where('department_id',$patient->department_id)
	// 		                          ->where('ipd_opd',$patient->department_id)
    //                                  ->get()
    //                                  ->row();   
    //                                   }
    //                                   }
    //                               }else{
    //                                   $tretment=$this->db->select("*")
    //                                   ->from('manual_treatments')
    //                                  ->where('patient_id_auto',$patient->id)
	// 		                         ->where('dignosis LIKE',$p_dignosis)
	// 		                         ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();
    //                               }
    //                 //////////////////////////////////////// Treatement Fetching Code End ///////////////////////////////////
                    
    //                 if($tretment){
    //                     if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER || $tretment->HEMATOLOGICAL || $tretment->SEROLOGYCAL || $tretment->BIOCHEMICAL || $tretment->MICROBIOLOGICAL || $tretment->X_RAY || $tretment->ECG || $tretment->USG){
    //                         print_r("Panchakarma ==>==>==> ");
    //                         if($tretment->SNEHAN){ 
    //                             print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
    //                             $Snehan = $Snehan + 1;
    //                         }
    //                         if($tretment->SWEDAN){ 
    //                             print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
    //                             $Swedan = $Swedan + 1;
    //                         }
    //                         if($tretment->VAMAN){ 
    //                             print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
    //                             $Vaman = $Vaman + 1;
    //                         }
    //                         if($tretment->VIRECHAN){ 
    //                             print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
    //                             $Virechan = $Virechan + 1;
    //                         }
    //                         if($tretment->NASYA){ 
    //                             print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
    //                             $Nasya = $Nasya + 1;
    //                         }
    //                         if($tretment->RAKTAMOKSHAN){ 
    //                             print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
    //                             $Raktmokshan = $Raktmokshan + 1;
    //                         }
    //                         if($tretment->SHIRODHARA_SHIROBASTI){ 
    //                             print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
    //                             $Shirodhara = $Shirodhara + 1;
    //                         }
    //                         if($tretment->SHIROBASTI){ 
    //                             print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
    //                             $Shirobasti = $Shirobasti + 1;
    //                         }
    //                         if($tretment->UTTARBASTI){ 
    //                             print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
    //                             $Uttarbasti = $Uttarbasti + 1;
    //                         }
    //                         if($tretment->BASTI){ 
    //                             print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
    //                             $Basti = $Basti + 1;
    //                         }
    //                         if($tretment->YONIDHAVAN){ 
    //                             print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
    //                             $Yonidhavan = $Yonidhavan + 1;
    //                         }
    //                         if($tretment->YONIPICHU){ 
    //                             print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
    //                             $Yonipichu = $Yonipichu + 1;
    //                         }
    //                         if($tretment->OTHER){ 
    //                             print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
    //                             $Other = $Other + 1;
    //                         }
                            
    //                         print_r("Investigation ==>==>==> ");
    //                         if($tretment->HEMATOLOGICAL){   print_r('<br>');
    //                             print_r("Hematology");print_r(' ==>==>==>==> ');print_r($tretment->HEMATOLOGICAL);
    //                             $Hematology = $Hematology + 1;
                                
    //                             $ex = explode(',',trim($tretment->HEMATOLOGICAL));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $Hematology_Test = $Hematology_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                        if($tretment->SEROLOGYCAL){
    //                             print_r("Serology");print_r(' ==>==>==>==> ');print_r($tretment->SEROLOGYCAL);
    //                             $Serology = $Serology + 1;
                                
    //                             $ex = explode(',',trim($tretment->SEROLOGYCAL));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $Serology_Test = $Serology_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 if($ex[$i] == 'WIDAL TEST')
    //                                               {
    //                                                 $ex_random_val_wd20 = explode(',',trim($rs->WD_20));
    //                                                 $ex_random_val_wd40 = explode(',',trim($rs->WD_40));
    //                                                 $ex_random_val_wd80 = explode(',',trim($rs->WD_80));
    //                                                 $ex_random_val_wd160 = explode(',',trim($rs->WD_160));
    //                                                 $ex_random_val_wd320 = explode(',',trim($rs->WD_320));
    //                                               }
    //                                               else
    //                                               {
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                               }
    //                                             }
                                              
    //                                           $rand_val_wd20 = array_rand($ex_random_val_wd20);
    //                                           $rand_val_wd40 = array_rand($ex_random_val_wd40);
    //                                           $rand_val_wd80 = array_rand($ex_random_val_wd80);
    //                                           $rand_val_wd160 = array_rand($ex_random_val_wd160);
    //                                           $rand_val_wd320 = array_rand($ex_random_val_wd320);
                                              
                                              
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'WD_20_RESULT' =>$ex_random_val_wd20[$rand_val_wd20],
    //                                                 'WD_40_RESULT' =>$ex_random_val_wd40[$rand_val_wd40],
    //                                                 'WD_80_RESULT' =>$ex_random_val_wd80[$rand_val_wd80],
    //                                                 'WD_160_RESULT' =>$ex_random_val_wd160[$rand_val_wd160],
    //                                                 'WD_320_RESULT' =>$ex_random_val_wd320[$rand_val_wd320],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->BIOCHEMICAL){
    //                             print_r("Bio-Chemistry");print_r(' ==>==>==>==> ');print_r($tretment->BIOCHEMICAL);
    //                             $BioChemistry = $BioChemistry + 1;
                                
    //                             $ex = explode(',',trim($tretment->BIOCHEMICAL));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $BioChemistry_Test = $BioChemistry_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->MICROBIOLOGICAL){
    //                             print_r("Microbiology");print_r(' ==>==>==>==> ');print_r($tretment->MICROBIOLOGICAL);
    //                             $Microbiology = $Microbiology + 1;
                                
    //                             $ex = explode(',',trim($tretment->MICROBIOLOGICAL));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $Microbiology_Test = $Microbiology_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->X_RAY){
    //                             print_r("X-Ray");print_r(' ==>==>==>==> ');print_r($tretment->X_RAY);
    //                             $XRay = $XRay + 1;
                                
    //                             $ex = explode(',',trim($tretment->X_RAY));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $XRay_Test = $XRay_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->ECG){
    //                             print_r("ECG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
    //                             $ECG = $ECG + 1;
                                
    //                             $ex = explode(',',trim($tretment->ECG));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $ECG_Test = $ECG_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         if($tretment->USG){
    //                             print_r("USG");print_r(' ==>==>==>==> ');print_r($tretment->USG);
    //                             $USG = $USG + 1;
                                
    //                             $ex = explode(',',trim($tretment->USG));
    //                             if($ex[0]!='' || $ex[0]!=null){
    //                                 // print_r($ex);
    //                                 // print_r(count($ex));
    //                                 // echo '<br>';
    //                                 $USG_Test = $USG_Test + count($ex);
                                    
    //                                 for($i=0;$i<count($ex);$i++){
    //                                     echo "======>"."Ex -> ".$ex[$i];
    //                                     $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
    //                                     //print_r($result);
    //                                     if($result){
    //                                         foreach($result as $rs){
    //                                             print_r($rs->test_name);print_r(" =====> ");
    //                                             if($patient->department_id == 32){
    //                                                 $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                             }
    //                                             else{
    //                                                 $ex_random_val = explode(',',trim($rs->random_value));
    //                                             }
    //                                             $rand_val = array_rand($ex_random_val);
    //                                             print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                             (object)$postData = [
    //                                                 'patient_auto_id' => $patient->id,
    //                                                 'name' => $patient->firstname,
    //                                                 'dignosis' => $patient->dignosis,
    //                                                 'test_name' => $rs->test_name,
    //                                                 'test_type' => $rs->test_type,
    //                                                 'report_type' => $rs->report_type,
    //                                                 'report_section' => $rs->report_section,
    //                                                 'unit' => $rs->unit,
    //                                                 'reference_range' => $rs->reference_range,
    //                                                 'result' => $ex_random_val[$rand_val],
    //                                                 'ipd_opd' => $patient->ipd_opd,
    //                                                 'create_date' => $startDate2
    //                                             ];
    //                                             $this->db->insert('investi_opd_report_result', $postData);
    //                                         }
    //                                     }
    //                                 }
    //                             }
    //                         }
    //                         print_r('<br>');
                            
    //                         (object)$postPatientInvestPanchData = ([
    //                                 'patient_auto_id' => $patient->id,
    //                                 'patient_name' => $patient->firstname,
    //                                 'ipd_opd' => $patient->ipd_opd,
    //                                 'sex' => $patient->sex,
    //                                 'create_date' => $startDate2,
    //                                 'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
    //                                 'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
    //                                 'vaman' => ($tretment->VAMAN) ? $tretment->VAMAN : NULL,
    //                                 'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
    //                                 'nasya' => ($tretment->NASYA) ? $tretment->NASYA : NULL,
    //                                 'raktmokshan' => ($tretment->RAKTAMOKSHAN) ? $tretment->RAKTAMOKSHAN : NULL,
    //                                 'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
    //                                 'shirobasti' => ($tretment->SHIROBASTI) ? $tretment->SHIROBASTI : NULL,
    //                                 'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
    //                                 'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
    //                                 'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
    //                                 'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
    //                                 'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
    //                                 'hematology' => ($tretment->HEMATOLOGICAL) ? $tretment->HEMATOLOGICAL : NULL,
    //                                 'serology' => ($tretment->SEROLOGYCAL) ? $tretment->SEROLOGYCAL : NULL,
    //                                 'biochemistry' => ($tretment->BIOCHEMICAL) ? $tretment->BIOCHEMICAL : NULL,
    //                                 'microbiology' => ($tretment->MICROBIOLOGICAL) ? $tretment->MICROBIOLOGICAL : NULL,
    //                                 'xray' => ($tretment->X_RAY) ? $tretment->X_RAY : NULL,
    //                                 'ecg' => ($tretment->ECG) ? $tretment->ECG : NULL,
    //                                 'usg' => ($tretment->USG) ? $tretment->USG : NULL
    //                         ]);
    //                         $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('investi_panch_opd_patient_count')->num_rows();
    //                         if($searchRes == 0){
    //                             $updateRes = $this->db->insert('investi_panch_opd_patient_count', $postPatientInvestPanchData);
    //                         }
    //                     }
    //                 }
                    
    //             }
    //             $investi_panch_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology,
    //                 'Serology' => $Serology,
    //                 'BioChemistry' => $BioChemistry,
    //                 'Microbiology' => $Microbiology,
    //                 'XRay' => $XRay,
    //                 'ECG' => $ECG,
    //                 'USG' => $USG
    //             ];
    //             $investi_panch_test_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology_Test,
    //                 'Serology' => $Serology_Test,
    //                 'BioChemistry' => $BioChemistry_Test,
    //                 'Microbiology' => $Microbiology_Test,
    //                 'XRay' => $XRay_Test,
    //                 'ECG' => $ECG_Test,
    //                 'USG' => $USG_Test
    //             ];
    //             $index = $index + 1;
    //             print_r($investi_panch_count);print_r("<br>");
    //             print_r($investi_panch_test_count);print_r("<br>");
    //         }
    //         else{
    //             $investi_panch_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology,
    //                 'Serology' => $Serology,
    //                 'BioChemistry' => $BioChemistry,
    //                 'Microbiology' => $Microbiology,
    //                 'XRay' => $XRay,
    //                 'ECG' => $ECG,
    //                 'USG' => $USG
    //             ];
    //             $investi_panch_test_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology_Test,
    //                 'Serology' => $Serology_Test,
    //                 'BioChemistry' => $BioChemistry_Test,
    //                 'Microbiology' => $Microbiology_Test,
    //                 'XRay' => $XRay_Test,
    //                 'ECG' => $ECG_Test,
    //                 'USG' => $USG_Test
    //             ];
    //             $index = $index + 1;
    //             print_r($investi_panch_count);print_r("<br>");
    //             print_r($investi_panch_test_count);print_r("<br>");
    //         }
            
    //         for($i=0; $i<count($investi_panch_count);$i++){
    //             print_r($investi_panch_count[$i]['Hematology']);
    //             (object)$postPatientInvestPanchCountData = ([
    //                     'ipd_opd' => $section_opd,
    //                     'create_date' => $startDate2,
    //                     'snehan_count' => $investi_panch_count[$i]['Snehan'],
    //                     'swedan_count' => $investi_panch_count[$i]['Swedan'],
    //                     'vaman_count' => $investi_panch_count[$i]['Vaman'],
    //                     'virechan_count' => $investi_panch_count[$i]['Virechan'],
    //                     'nasya_count' => $investi_panch_count[$i]['Nasya'],
    //                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
    //                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
    //                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
    //                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
    //                     'basti_count' => $investi_panch_count[$i]['Basti'],
    //                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
    //                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
    //                     'others_count' => $investi_panch_count[$i]['Other'],
    //                     'hematology_count' => $investi_panch_count[$i]['Hematology'],
    //                     'serology_count' => $investi_panch_count[$i]['Serology'],
    //                     'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'],
    //                     'microbiology_count' => $investi_panch_count[$i]['Microbiology'],
    //                     'xray_count' => $investi_panch_count[$i]['XRay'],
    //                     'ecg_count' => $investi_panch_count[$i]['ECG'],
    //                     'usg_count' => $investi_panch_count[$i]['USG'],
    //                 ]);
    //             $res = $this->db->insert('investi_panch_opd_total_count', $postPatientInvestPanchCountData);
                
    //             (object)$postPatientInvestPanchTestCountData = ([
    //                     'ipd_opd' => $section_opd,
    //                     'create_date' => $startDate2,
    //                     'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
    //                     'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
    //                     'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
    //                     'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
    //                     'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
    //                     'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
    //                     'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
    //                     'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
    //                     'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
    //                     'basti_count' => $investi_panch_test_count[$i]['Basti'],
    //                     'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
    //                     'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
    //                     'others_count' => $investi_panch_test_count[$i]['Other'],
    //                     'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
    //                     'serology_count' => $investi_panch_test_count[$i]['Serology'],
    //                     'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
    //                     'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
    //                     'xray_count' => $investi_panch_test_count[$i]['XRay'],
    //                     'ecg_count' => $investi_panch_test_count[$i]['ECG'],
    //                     'usg_count' => $investi_panch_test_count[$i]['USG'],
    //                 ]);
    //             $res1 = $this->db->insert('investi_panch_opd_test_total_count', $postPatientInvestPanchTestCountData);
    //             if($res && $res1)
    //             {
    //                 print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
    //             }
    //         }
    //     }
        
        
        
    //     ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    //     /////////////////////////////////////                                                         /////////////////////////////////////
    //     /////////////////////////////////////      IPD Investigation & Panchakarma Counting CODE      /////////////////////////////////////
    //     /////////////////////////////////////                                                         /////////////////////////////////////
    //     ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        
    //     $start_time= date('H:i',strtotime('18:15'));
    //     $time_date=date('H:i');
        
    //     $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'ipd')->order_by('id','DESC')->limit(1)->get('investi_panch_ipd_total_count')->row();
    //     print_r('<br>');
    //     $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
    //     print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
    //     $current_date = date('Y-m-d');
    //     print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
    //     $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
    //     print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');print_r('<br>');
        
    //     $section_ipd = 'ipd';
    //     $res = $this->db->where('create_date', $push_date)->get('patient_ipd')->result();
        
    //     if($current_date == $push_date){
    //         //print_r($res);
            
    //         $index = 0;
    //         $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
    //         $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
    //         $Yonipichu = 0; $Other = 0; $Hematology = 0; $Serology = 0; $BioChemistry = 0; 
    //         $Microbiology = 0; $XRay = 0; $ECG = 0; $USG = 0; 
            
    //         $Hematology_Test = 0; $Serology_Test = 0; $BioChemistry_Test = 0; 
    //         $Microbiology_Test = 0; $XRay_Test = 0; $ECG_Test = 0; $USG_Test = 0; 
            
    //         $startDate2 = date('Y-m-d', strtotime($push_date));
    //         print_r('IPD Investigation & Panchakarma Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
    //         if($res != '' || $res != null){
    //             $start_date = date('Y-m-d',strtotime($push_date));
    //             $end_date   = date('Y-m-d',strtotime($push_date));
    //             // $start_date_f= $start_date." 23:59:00";
    //             // $end_date_f= $end_date." 23:59:00";
                
    //             $start_date_f= $start_date;
    //             $end_date_f= $end_date;
                
    //             $patients1 = $this->db->select("*")
    //                 ->from('patient_ipd')
    //                 ->join('department','department.dprt_id = patient_ipd.department_id')
    //                 ->where('discharge_date >', $start_date_f)
    //                 ->where('create_date <=', $start_date_f)
    //                 ->where('dignosis !=', '')
    //                 ->where('manual_status', '0')
    //                 ->where('ipd_opd', 'ipd')
    //                 ->get()
    //                 ->result();
                        
    //             //print_r('q1   ');
    //           // print_r($this->db->last_query());
                        
    //             $patients2 = $this->db->select("*")
    //                 ->from('patient_ipd')
    //                 ->join('department','department.dprt_id = patient_ipd.department_id')
    //                 ->where('create_date <=', $start_date_f)
    //                 ->where('dignosis !=', '')
    //                 ->where('manual_status', '0')
    //                 ->where('discharge_date LIKE', '%0000-00-00%')
    //                 ->where('ipd_opd', 'ipd')
    //                 ->get()
    //                 ->result();
                
    //             //print_r('q2   ');                    
    //           // print_r($this->db->last_query());
    //             $patientList = array_merge($patients1, $patients2);
    //             foreach($patientList as $patient){
    //                 print_r('Yearly Reg No ==>==>==>==> ');print_r($patient->yearly_reg_no);print_r('<br>');
                    
    //                 $che=trim($patient->dignosis);
    //                 $section_tret='ipd';
    //                  $len=strlen($che);
    //                  $dd= substr($che,$len - 1);
    //                  $str = $patient->dignosis;
    //                  $arry=explode("-",$str);
    //                  $t_c=count($arry);
    //                 if($t_c=='2'){
    //                     $dd1=substr($che, 0, -1);
    //                     $new_str = trim($arry[0]);
    //                     $p_dignosis = '%'.$new_str.'%';
    //                     $p_dignosis_name=$patient->dignosis;
    //                 }else{
    //                     $p_dignosis = '%'.$che.'%';
    //                     $p_dignosis_name=$patient->dignosis;
    //                 }
                    
    //                 if($patient->manual_status==0){
    //                                   if($patient->proxy_id){
    //                                  $tretment=$this->db->select("*")
	// 		                         ->from('treatments1')
    //                                  ->where('dignosis LIKE',$p_dignosis)
    //                                  ->where('proxy_id',$patient->proxy_id)
    //                                  ->where('department_id',$patient->department_id)
	// 		                         ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();
    //                                   }
    //                                   else
    //                                   {
    //                                   $tretment=$this->db->select("*")
	// 		                         ->from('treatments1')
    //                                  ->where('dignosis LIKE',$p_dignosis)
    //                                   ->where('department_id',$patient->department_id)
    //                                  ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();  
    //                                   if(empty($tretment)){
    //                                   $tretment=$this->db->select("*")
    //                                   ->from('treatments1')
    //                                   ->where('department_id',$patient->department_id)
	// 		                          ->where('ipd_opd',$patient->department_id)
    //                                  ->get()
    //                                  ->row();   
    //                                   }
    //                                   }
    //                               }else{
    //                                   $tretment=$this->db->select("*")
    //                                   ->from('manual_treatments')
    //                                  ->where('patient_id_auto',$patient->id)
	// 		                         ->where('dignosis LIKE',$p_dignosis)
	// 		                         ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();
    //                               }
    //                 // $tretment1 = $tretment;
                    
    //                 // $datefrom_n=date('Y-m-d',strtotime($startDate2));  
    //                 // $admit_date=date('Y-m-d',strtotime($patient->create_date));
    //                 // if($patient->discharge_date=='0000-00-00'){
    //                 //     //$discharge_date=date('Y-m-d', strtotime($admit_date. ' + 5 days'));
    //                 //     $today_date=date('Y-m-d', strtotime($datefrom_n));
    //                 // } else{
    //                 //     //$discharge_date=date('Y-m-d',strtotime($patient->discharge_date));
    //                 //     $today_date=date('Y-m-d', strtotime($datefrom_n));
    //                 // }  
                    
    //                 // $date1=date_create($admit_date);
    //                 // $date2=date_create($today_date);
    //                 // $diff=date_diff($date1,$date2);
    //                 // $n= $diff->format("%a");
                    
    //                 // $DISTRIBUTION_IPD=$tretment->DISTRIBUTION_IPD; 
    //                 // $ipd_days=$tretment->ipd_days; 
    //                 // $last_days=$ipd_days - $DISTRIBUTION_IPD;
    //                 // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1; 
    //                 // if($DISTRIBUTION_IPD < $n){
    //                 //     if($patient->manual_status==0){
    //                 //         $section_tret='ipd';
    //                 //         // $tretarray=$this->db->select("*")
    //                 //         //     ->from('treatments1')
    //                 //         //     ->where('dignosis LIKE',$p_dignosis)
    //                 //         //     ->where('proxy_id',$patient->proxy_id)
    //                 //         //     ->where('department_id',$patient->department_id)
    //                 //         //     ->where('ipd_opd',$section_tret)
    //                 //         //     ->get()->result();
                            
    //                 //         if($patient->proxy_id){
    //                 //             $tretment=$this->db->select("*")
    //                 //                 ->from('treatments1')
    //                 //                 ->where('dignosis LIKE',$p_dignosis)
    //                 //                 //->where('dignosis LIKE',$p_dignosis_name)
    //                 //                 ->where('proxy_id',$patient->proxy_id)
    //                 //                 ->where('department_id',$patient->department_id)
    //                 //                 ->order_by("id", "desc")
    //                 //                 ->where('ipd_opd ',$section_tret)
    //                 //                 ->get()
    //                 //                 ->row();
    //                 //         }
    //                 //         else{
    //                 //             $tretment=$this->db->select("*")
    //                 //                 ->from('treatments1')
    //                 //                 ->where('dignosis LIKE',$p_dignosis)
    //                 //                 ->where('department_id',$patient->department_id)
    //                 //                 ->order_by("id", "desc")
    //                 //                 ->where('ipd_opd ',$section_tret)
    //                 //                 ->get()
    //                 //                 ->row();  
    //                 //         }
    //                 //     }else{
    //                 //         $tretment=$this->db->select("*")
    //                 //             ->from('manual_treatments')
    //                 //             ->where('patient_id_auto',$patient->id)
    //                 //             ->where('dignosis LIKE',$p_dignosis)
    //                 //             //->where('dignosis LIKE',$p_dignosis_name)
    //                 //             ->where('ipd_opd ',$section_tret)
    //                 //             ->get()
    //                 //             ->row();
    //                 //     }
    //                 // }
                    
    //                 if($tretment){
    //                     if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER || $tretment->HEMATOLOGICAL || $tretment->SEROLOGYCAL || $tretment->BIOCHEMICAL || $tretment->MICROBIOLOGICAL || $tretment->X_RAY || $tretment->ECG || $tretment->USG){
                            
    //                       $admit_date=date("Y-m-d",strtotime($patient->create_date));
    //                         $admit_v_date=strtotime($patient->create_date);
    //                         $vaman_date=strtotime("+6 days",$admit_v_date); 
    //                         $vaman_virachan_date = date("Y-m-d",$vaman_date);
                            
                            
    //                         $shirobasti_date=strtotime("+1 days",$admit_v_date); 
    //                         $shirobasti_final_date = date("Y-m-d",$shirobasti_date);
                            
                            
    //                         $push_final_date = date('Y-m-d',strtotime($push_date));
                            
                            
    //                         $date1=date_create($admit_date);
    //                         $date2=date_create($push_date);
    //                         $diff=date_diff($date1,$date2);
    //                         $diffDay = $diff->format("%a");
    //                         $shirobastiCheck = ($diffDay % 2);
                            
    //                         print_r("Panchakarma ==>==>==> ");
    //                         if($tretment->SNEHAN){ 
    //                             print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
    //                             $Snehan = $Snehan + 1;
    //                         }
    //                         if($tretment->SWEDAN){ 
    //                             print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
    //                             $Swedan = $Swedan + 1;
    //                         }
    //                         if($tretment->VAMAN && $vaman_virachan_date==$push_final_date){ 
    //                             print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
    //                             $Vaman = $Vaman + 1;
    //                         }
    //                         if($tretment->VIRECHAN){ 
    //                             print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
    //                             $Virechan = $Virechan + 1;
    //                         }
    //                         if($tretment->NASYA && $admit_date == $push_final_date){ 
    //                             print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
    //                             $Nasya = $Nasya + 1;
    //                         }
    //                         if($tretment->RAKTAMOKSHAN && $admit_date == $push_final_date){ 
    //                             print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
    //                             $Raktmokshan = $Raktmokshan + 1;
    //                         }
    //                         if($tretment->SHIRODHARA_SHIROBASTI){ 
    //                             print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
    //                             $Shirodhara = $Shirodhara + 1;
    //                         }
    //                         if($tretment->SHIROBASTI && $shirobasti_final_date == $push_final_date){ 
    //                             print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
    //                             $Shirobasti = $Shirobasti + 1;
    //                         }
    //                         if($tretment->UTTARBASTI){ 
    //                             print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
    //                             $Uttarbasti = $Uttarbasti + 1;
    //                         }
    //                         if($tretment->BASTI){ 
    //                             print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
    //                             $Basti = $Basti + 1;
    //                         }
    //                         if($tretment->YONIDHAVAN){ 
    //                             print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
    //                             $Yonidhavan = $Yonidhavan + 1;
    //                         }
    //                         if($tretment->YONIPICHU){ 
    //                             print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
    //                             $Yonipichu = $Yonipichu + 1;
    //                         }
    //                         if($tretment->OTHER){ 
    //                             print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
    //                             $Other = $Other + 1;
    //                         }
                            
    //                         if($admit_date==date('Y-m-d',strtotime($push_date))){
    //                             print_r("Investigation ==>==>==> ");
    //                             if($tretment->HEMATOLOGICAL){  
    //                                 print_r('<br>');
    //                                 print_r("Hematology");print_r(' ==>==>==>==> ');print_r($tretment->HEMATOLOGICAL);
    //                                 $Hematology = $Hematology + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->HEMATOLOGICAL));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $Hematology_Test = $Hematology_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         // print_r($result);
    //                                         print_r($p_dignosis);print_r("<br>");
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->SEROLOGYCAL){
    //                                 print_r("Serology");print_r(' ==>==>==>==> ');print_r($tretment->SEROLOGYCAL);
    //                                 $Serology = $Serology + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->SEROLOGYCAL));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $Serology_Test = $Serology_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->BIOCHEMICAL){
    //                                 print_r("Bio-Chemistry");print_r(' ==>==>==>==> ');print_r($tretment->BIOCHEMICAL);
    //                                 $BioChemistry = $BioChemistry + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->BIOCHEMICAL));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $BioChemistry_Test = $BioChemistry_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->MICROBIOLOGICAL){
    //                                 print_r("Microbiology");print_r(' ==>==>==>==> ');print_r($tretment->MICROBIOLOGICAL);
    //                                 $Microbiology = $Microbiology + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->MICROBIOLOGICAL));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $Microbiology_Test = $Microbiology_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->X_RAY){
    //                                 print_r("X-Ray");print_r(' ==>==>==>==> ');print_r($tretment->X_RAY);
    //                                 $XRay = $XRay + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->X_RAY));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $XRay_Test = $XRay_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->ECG){
    //                                 print_r("ECG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
    //                                 $ECG = $ECG + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->ECG));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $ECG_Test = $ECG_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->USG){
    //                                 print_r("USG");print_r(' ==>==>==>==> ');print_r($tretment->USG);
    //                                 $USG = $USG + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->USG));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $USG_Test = $USG_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             print_r('<br>');
    //                         }
                            
    //                         (object)$postPatientInvestPanchData = ([
    //                                 'patient_auto_id' => $patient->id,
    //                                 'patient_name' => $patient->firstname,
    //                                 'ipd_opd' => $patient->ipd_opd,
    //                                 'sex' => $patient->sex,
    //                                 'create_date' => $startDate2,
    //                                 'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
    //                                 'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
    //                                 'vaman' => ($vaman_virachan_date == $push_final_date) ? $tretment->VAMAN : NULL,
    //                                 'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
    //                                 'nasya' => ($admit_date==$push_final_date) ? $tretment->NASYA : NULL,
    //                                 'raktmokshan' => ($admit_date==$push_final_date) ? $tretment->RAKTAMOKSHAN : NULL,
    //                                 'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
    //                                 'shirobasti' => ($shirobasti_final_date == $push_final_date) ? $tretment->SHIROBASTI : NULL,
    //                                 'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
    //                                 'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
    //                                 'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
    //                                 'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
    //                                 'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
    //                                 'hematology' => ($tretment->HEMATOLOGICAL && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->HEMATOLOGICAL : NULL,
    //                                 'serology' => ($tretment->SEROLOGYCAL && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->SEROLOGYCAL : NULL,
    //                                 'biochemistry' => ($tretment->BIOCHEMICAL && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->BIOCHEMICAL : NULL,
    //                                 'microbiology' => ($tretment->MICROBIOLOGICAL && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->MICROBIOLOGICAL : NULL,
    //                                 'xray' => ($tretment->X_RAY && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->X_RAY : NULL,
    //                                 'ecg' => ($tretment->ECG && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->ECG : NULL,
    //                                 'usg' => ($tretment->USG && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->USG : NULL
    //                         ]);
    //                         $updateRes = $this->db->insert('investi_panch_ipd_patient_count', $postPatientInvestPanchData);
    //                         // $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('investi_panch_ipd_patient_count')->num_rows();
    //                         // if($searchRes == 0){
    //                         //     $updateRes = $this->db->insert('investi_panch_ipd_patient_count', $postPatientInvestPanchData);
    //                         // }
    //                     }
    //                 }
    //             }
    //             $investi_panch_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology,
    //                 'Serology' => $Serology,
    //                 'BioChemistry' => $BioChemistry,
    //                 'Microbiology' => $Microbiology,
    //                 'XRay' => $XRay,
    //                 'ECG' => $ECG,
    //                 'USG' => $USG
    //             ];
    //             $investi_panch_test_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology_Test,
    //                 'Serology' => $Serology_Test,
    //                 'BioChemistry' => $BioChemistry_Test,
    //                 'Microbiology' => $Microbiology_Test,
    //                 'XRay' => $XRay_Test,
    //                 'ECG' => $ECG_Test,
    //                 'USG' => $USG_Test
    //             ];
    //             $index = $index + 1;
    //             print_r($investi_panch_count);print_r("<br>");
    //             print_r($investi_panch_test_count);print_r("<br>");
    //         }
    //         else{
    //             $investi_panch_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology,
    //                 'Serology' => $Serology,
    //                 'BioChemistry' => $BioChemistry,
    //                 'Microbiology' => $Microbiology,
    //                 'XRay' => $XRay,
    //                 'ECG' => $ECG,
    //                 'USG' => $USG
    //             ];
    //             $investi_panch_test_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology_Test,
    //                 'Serology' => $Serology_Test,
    //                 'BioChemistry' => $BioChemistry_Test,
    //                 'Microbiology' => $Microbiology_Test,
    //                 'XRay' => $XRay_Test,
    //                 'ECG' => $ECG_Test,
    //                 'USG' => $USG_Test
    //             ];
    //             $index = $index + 1;
    //             print_r($investi_panch_count);print_r("<br>");
    //             print_r($investi_panch_test_count);print_r("<br>");
    //         }
    //         for($i=0; $i<count($investi_panch_count);$i++){
    //             (object)$postPatientInvestPanchCountData = ([
    //                     'ipd_opd' => $section_ipd,
    //                     'create_date' => $startDate2,
    //                     'snehan_count' => $investi_panch_count[$i]['Snehan'],
    //                     'swedan_count' => $investi_panch_count[$i]['Swedan'],
    //                     'vaman_count' => $investi_panch_count[$i]['Vaman'],
    //                     'virechan_count' => $investi_panch_count[$i]['Virechan'],
    //                     'nasya_count' => $investi_panch_count[$i]['Nasya'],
    //                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
    //                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
    //                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
    //                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
    //                     'basti_count' => $investi_panch_count[$i]['Basti'],
    //                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
    //                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
    //                     'others_count' => $investi_panch_count[$i]['Other'],
    //                     'hematology_count' => $investi_panch_count[$i]['Hematology'],
    //                     'serology_count' => $investi_panch_count[$i]['Serology'],
    //                     'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'],
    //                     'microbiology_count' => $investi_panch_count[$i]['Microbiology'],
    //                     'xray_count' => $investi_panch_count[$i]['XRay'],
    //                     'ecg_count' => $investi_panch_count[$i]['ECG'],
    //                     'usg_count' => $investi_panch_count[$i]['USG'],
    //                 ]);
    //             $res = $this->db->insert('investi_panch_ipd_total_count', $postPatientInvestPanchCountData);
                
    //             (object)$postPatientInvestPanchTestCountData = ([
    //                     'ipd_opd' => $section_ipd,
    //                     'create_date' => $startDate2,
    //                     'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
    //                     'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
    //                     'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
    //                     'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
    //                     'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
    //                     'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
    //                     'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
    //                     'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
    //                     'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
    //                     'basti_count' => $investi_panch_test_count[$i]['Basti'],
    //                     'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
    //                     'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
    //                     'others_count' => $investi_panch_test_count[$i]['Other'],
    //                     'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
    //                     'serology_count' => $investi_panch_test_count[$i]['Serology'],
    //                     'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
    //                     'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
    //                     'xray_count' => $investi_panch_test_count[$i]['XRay'],
    //                     'ecg_count' => $investi_panch_test_count[$i]['ECG'],
    //                     'usg_count' => $investi_panch_test_count[$i]['USG'],
    //                 ]);
    //             $res1 = $this->db->insert('investi_panch_ipd_test_total_count', $postPatientInvestPanchTestCountData);
    //             if($res && $res1)
    //             {
    //                 print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
    //             }
    //         }
    //     }
    //     elseif($current_date > $push_date)
    //     {
    //         //print_r($res);
            
    //         $index = 0;
    //         $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
    //         $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
    //         $Yonipichu = 0; $Other = 0; $Hematology = 0; $Serology = 0; $BioChemistry = 0; 
    //         $Microbiology = 0; $XRay = 0; $ECG = 0; $USG = 0; 
            
    //         $Hematology_Test = 0; $Serology_Test = 0; $BioChemistry_Test = 0; 
    //         $Microbiology_Test = 0; $XRay_Test = 0; $ECG_Test = 0; $USG_Test = 0; 
            
    //         $startDate2 = date('Y-m-d', strtotime($push_date));
    //         print_r('IPD Investigation & Panchakarma Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
    //         if($res != '' || $res != null){
    //             $start_date = date('Y-m-d',strtotime($push_date));
    //             $end_date   = date('Y-m-d',strtotime($push_date));
    //             // $start_date_f= $start_date." 23:59:00";
    //             // $end_date_f= $end_date." 23:59:00";
                
    //             $start_date_f= $start_date;
    //             $end_date_f= $end_date;
                
    //             $patients1 = $this->db->select("*")
    //                 ->from('patient_ipd')
    //                 ->join('department','department.dprt_id = patient_ipd.department_id')
    //                 ->where('discharge_date >', $start_date_f)
    //                 ->where('create_date <=', $start_date_f)
    //                 ->where('dignosis !=', '')
    //                 ->where('manual_status', '0')
    //                 ->where('ipd_opd', 'ipd')
    //                 ->get()
    //                 ->result();
                        
    //             //print_r('q1   ');
    //             //print_r($this->db->last_query());
                        
    //             $patients2 = $this->db->select("*")
    //                 ->from('patient_ipd')
    //                 ->join('department','department.dprt_id = patient_ipd.department_id')
    //                 ->where('create_date <=', $start_date_f)
    //                 ->where('dignosis !=', '')
    //                 ->where('manual_status', '0')
    //                 ->where('discharge_date LIKE', '%0000-00-00%')
    //                 ->where('ipd_opd', 'ipd')
    //                 ->get()
    //                 ->result();
                
    //             //print_r('q2   ');                    
    //           // print_r($this->db->last_query());
    //             $patientList = array_merge($patients1, $patients2);
    //             foreach($patientList as $patient){
    //                 print_r('Yearly Reg No ==>==>==>==> ');print_r($patient->yearly_reg_no);print_r('<br>');
                    
    //                 $che=trim($patient->dignosis);
    //                 $section_tret='ipd';
    //                  $len=strlen($che);
    //                  $dd= substr($che,$len - 1);
    //                  $str = $patient->dignosis;
    //                  $arry=explode("-",$str);
    //                  $t_c=count($arry);
    //                 if($t_c=='2'){
    //                     $dd1=substr($che, 0, -1);
    //                     $new_str = trim($arry[0]);
    //                     $p_dignosis = '%'.$new_str.'%';
    //                     $p_dignosis_name=$patient->dignosis;
    //                 }else{
    //                     $p_dignosis = '%'.$che.'%';
    //                     $p_dignosis_name=$patient->dignosis;
    //                 }
                    
    //                 if($patient->manual_status==0){
    //                                   if($patient->proxy_id){
    //                                  $tretment=$this->db->select("*")
	// 		                         ->from('treatments1')
    //                                  ->where('dignosis LIKE',$p_dignosis)
    //                                  ->where('proxy_id',$patient->proxy_id)
    //                                  ->where('department_id',$patient->department_id)
	// 		                         ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();
    //                                   }
    //                                   else
    //                                   {
    //                                   $tretment=$this->db->select("*")
	// 		                         ->from('treatments1')
    //                                  ->where('dignosis LIKE',$p_dignosis)
    //                                   ->where('department_id',$patient->department_id)
    //                                  ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();  
    //                                   if(empty($tretment)){
    //                                   $tretment=$this->db->select("*")
    //                                   ->from('treatments1')
    //                                   ->where('department_id',$patient->department_id)
	// 		                          ->where('ipd_opd',$patient->department_id)
    //                                  ->get()
    //                                  ->row();   
    //                                   }
    //                                   }
    //                               }else{
    //                                   $tretment=$this->db->select("*")
    //                                   ->from('manual_treatments')
    //                                  ->where('patient_id_auto',$patient->id)
	// 		                         ->where('dignosis LIKE',$p_dignosis)
	// 		                         ->where('ipd_opd ',$section_tret)
    //                                  ->get()
    //                                  ->row();
    //                               }
                    
    //                 // $tretment1 = $tretment;
                    
    //                 // $datefrom_n=date('Y-m-d',strtotime($startDate2));  
    //                 // $admit_date=date('Y-m-d',strtotime($patient->create_date));
    //                 // if($patient->discharge_date=='0000-00-00'){
    //                 //     //$discharge_date=date('Y-m-d', strtotime($admit_date. ' + 5 days'));
    //                 //     $today_date=date('Y-m-d', strtotime($datefrom_n));
    //                 // } else{
    //                 //     //$discharge_date=date('Y-m-d',strtotime($patient->discharge_date));
    //                 //     $today_date=date('Y-m-d', strtotime($datefrom_n));
    //                 // }  
                    
    //                 // $date1=date_create($admit_date);
    //                 // $date2=date_create($today_date);
    //                 // $diff=date_diff($date1,$date2);
    //                 // $n= $diff->format("%a");
                    
    //                 // $DISTRIBUTION_IPD=$tretment->DISTRIBUTION_IPD; 
    //                 // $ipd_days=$tretment->ipd_days; 
    //                 // $last_days=$ipd_days - $DISTRIBUTION_IPD;
    //                 // $DISTRIBUTION_IPD=$DISTRIBUTION_IPD - 1; 
    //                 // if($DISTRIBUTION_IPD < $n){
    //                 //     if($patient->manual_status==0){
    //                 //         $section_tret='ipd';
    //                 //         // $tretarray=$this->db->select("*")
    //                 //         //     ->from('treatments1')
    //                 //         //     ->where('dignosis LIKE',$p_dignosis)
    //                 //         //     ->where('proxy_id',$patient->proxy_id)
    //                 //         //     ->where('department_id',$patient->department_id)
    //                 //         //     ->where('ipd_opd',$section_tret)
    //                 //         //     ->get()->result();
                            
    //                 //         if($patient->proxy_id){
    //                 //             $tretment=$this->db->select("*")
    //                 //                 ->from('treatments1')
    //                 //                 ->where('dignosis LIKE',$p_dignosis)
    //                 //                 //->where('dignosis LIKE',$p_dignosis_name)
    //                 //                 ->where('proxy_id',$patient->proxy_id)
    //                 //                 ->where('department_id',$patient->department_id)
    //                 //                 ->order_by("id", "desc")
    //                 //                 ->where('ipd_opd ',$section_tret)
    //                 //                 ->get()
    //                 //                 ->row();
    //                 //         }
    //                 //         else{
    //                 //             $tretment=$this->db->select("*")
    //                 //                 ->from('treatments1')
    //                 //                 ->where('dignosis LIKE',$p_dignosis)
    //                 //                 ->where('department_id',$patient->department_id)
    //                 //                 ->order_by("id", "desc")
    //                 //                 ->where('ipd_opd ',$section_tret)
    //                 //                 ->get()
    //                 //                 ->row();  
    //                 //         }
    //                 //     }else{
    //                 //         $tretment=$this->db->select("*")
    //                 //             ->from('manual_treatments')
    //                 //             ->where('patient_id_auto',$patient->id)
    //                 //             ->where('dignosis LIKE',$p_dignosis)
    //                 //             //->where('dignosis LIKE',$p_dignosis_name)
    //                 //             ->where('ipd_opd ',$section_tret)
    //                 //             ->get()
    //                 //             ->row();
    //                 //     }
    //                 // }
                    
    //                 if($tretment){
    //                     if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER || $tretment->HEMATOLOGICAL || $tretment->SEROLOGYCAL || $tretment->BIOCHEMICAL || $tretment->MICROBIOLOGICAL || $tretment->X_RAY || $tretment->ECG || $tretment->USG){
                            
    //                         $admit_date=date("Y-m-d",strtotime($patient->create_date));
    //                         $admit_v_date=strtotime($patient->create_date);
    //                         $vaman_date=strtotime("+6 days",$admit_v_date); 
    //                         $vaman_virachan_date = date("Y-m-d",$vaman_date);
                            
                            
    //                         $shirobasti_date=strtotime("+1 days",$admit_v_date); 
    //                         $shirobasti_final_date = date("Y-m-d",$shirobasti_date);
                            
                            
    //                         $push_final_date = date('Y-m-d',strtotime($push_date));
                            
                            
                            
    //                          echo "<br><br><br><br><br><br><br><br><br><br><br><br><br>";
                            
    //                         $date1=date_create($admit_date);
    //                         $date2=date_create($push_date);
    //                         $diff=date_diff($date1,$date2);
    //                         $diffDay = $diff->format("%a");
    //                         $shirobastiCheck = ($diffDay % 2);
                            
    //                         print_r("Panchakarma ==>==>==> ");
    //                         if($tretment->SNEHAN){ 
    //                             print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
    //                             $Snehan = $Snehan + 1;
    //                         }
    //                         if($tretment->SWEDAN){ 
    //                             print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
    //                             $Swedan = $Swedan + 1;
    //                         }
                            
                            
    //                         if($tretment->VAMAN && $vaman_virachan_date == $push_final_date){ 
    //                             print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
    //                             $Vaman = $Vaman + 1;
    //                         }
                            
                            
    //                         if($tretment->VIRECHAN){ 
    //                             print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
    //                             $Virechan = $Virechan + 1;
    //                         }
    //                         if($tretment->NASYA && $admit_date == $push_final_date){ 
    //                             print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
    //                             $Nasya = $Nasya + 1;
    //                         }
    //                         if($tretment->RAKTAMOKSHAN && $admit_date == $push_final_date){ 
    //                             print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
    //                             $Raktmokshan = $Raktmokshan + 1;
    //                         }
    //                         if($tretment->SHIRODHARA_SHIROBASTI){ 
    //                             print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
    //                             $Shirodhara = $Shirodhara + 1;
    //                         }
    //                         if($tretment->SHIROBASTI && $shirobasti_final_date == $push_final_date){ 
    //                             print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
    //                             $Shirobasti = $Shirobasti + 1;
    //                         }
    //                         if($tretment->UTTARBASTI){ 
    //                             print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
    //                             $Uttarbasti = $Uttarbasti + 1;
    //                         }
    //                         if($tretment->BASTI){ 
    //                             print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
    //                             $Basti = $Basti + 1;
    //                         }
    //                         if($tretment->YONIDHAVAN){ 
    //                             print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
    //                             $Yonidhavan = $Yonidhavan + 1;
    //                         }
    //                         if($tretment->YONIPICHU){ 
    //                             print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
    //                             $Yonipichu = $Yonipichu + 1;
    //                         }
    //                         if($tretment->OTHER){ 
    //                             print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
    //                             $Other = $Other + 1;
    //                         }
                            
    //                         if($admit_date==date('Y-m-d',strtotime($push_date))){
    //                             print_r("Investigation ==>==>==> ");
    //                             if($tretment->HEMATOLOGICAL){  
    //                                 print_r('<br>');
    //                                 print_r("Hematology");print_r(' ==>==>==>==> ');print_r($tretment->HEMATOLOGICAL);
    //                                 $Hematology = $Hematology + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->HEMATOLOGICAL));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $Hematology_Test = $Hematology_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         // print_r($result);
    //                                         print_r($p_dignosis);print_r("<br>");
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->SEROLOGYCAL){
    //                                 print_r("Serology");print_r(' ==>==>==>==> ');print_r($tretment->SEROLOGYCAL);
    //                                 $Serology = $Serology + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->SEROLOGYCAL));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $Serology_Test = $Serology_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->BIOCHEMICAL){
    //                                 print_r("Bio-Chemistry");print_r(' ==>==>==>==> ');print_r($tretment->BIOCHEMICAL);
    //                                 $BioChemistry = $BioChemistry + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->BIOCHEMICAL));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $BioChemistry_Test = $BioChemistry_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->MICROBIOLOGICAL){
    //                                 print_r("Microbiology");print_r(' ==>==>==>==> ');print_r($tretment->MICROBIOLOGICAL);
    //                                 $Microbiology = $Microbiology + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->MICROBIOLOGICAL));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $Microbiology_Test = $Microbiology_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->X_RAY){
    //                                 print_r("X-Ray");print_r(' ==>==>==>==> ');print_r($tretment->X_RAY);
    //                                 $XRay = $XRay + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->X_RAY));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $XRay_Test = $XRay_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->ECG){
    //                                 print_r("ECG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
    //                                 $ECG = $ECG + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->ECG));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $ECG_Test = $ECG_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             if($tretment->USG){
    //                                 print_r("USG");print_r(' ==>==>==>==> ');print_r($tretment->USG);
    //                                 $USG = $USG + 1;
                                    
    //                                 $ex = explode(',',trim($tretment->USG));
    //                                 if($ex[0]!='' || $ex[0]!=null){
    //                                     // print_r($ex);
    //                                     // print_r(count($ex));
    //                                     // echo '<br>';
    //                                     $USG_Test = $USG_Test + count($ex);
                                        
    //                                     for($i=0;$i<count($ex);$i++){
    //                                         echo "======>"."Ex -> ".$ex[$i];
    //                                         $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
    //                                         //print_r($result);
    //                                         //////if($result){
    //                                             foreach($result as $rs){
    //                                                 print_r($rs->test_name);print_r(" =====> ");
    //                                                 if($patient->sex == 'M'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
    //                                                     }
    //                                                 }elseif($patient->sex == 'F'){
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
    //                                                     }
    //                                                 }else{
    //                                                     if($patient->department_id == 32){
    //                                                         $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
    //                                                     }
    //                                                     else{
    //                                                         $ex_random_val = explode(',',trim($rs->random_value));
    //                                                     }
    //                                                 }
    //                                                 $rand_val = array_rand($ex_random_val);
    //                                                 print_r($ex_random_val[$rand_val]);print_r("<br>");
    //                                                 (object)$postData = [
    //                                                     'patient_auto_id' => $patient->id,
    //                                                     'name' => $patient->firstname,
    //                                                     'dignosis' => $patient->dignosis,
    //                                                     'test_name' => $rs->test_name,
    //                                                     'test_type' => $rs->test_type,
    //                                                     'report_type' => $rs->report_type,
    //                                                     'report_section' => $rs->report_section,
    //                                                     'unit' => $rs->unit,
    //                                                     'reference_range' => $rs->reference_range,
    //                                                     'result' => $ex_random_val[$rand_val],
    //                                                     'ipd_opd' => $patient->ipd_opd,
    //                                                     'create_date' => $startDate2
    //                                                 ];
    //                                                 $this->db->insert('investi_ipd_report_result', $postData);
    //                                             }
    //                                         //////}
    //                                     }
    //                                 }
    //                             }
    //                             print_r('<br>');
    //                         }
                            
    //                         (object)$postPatientInvestPanchData = ([
    //                                 'patient_auto_id' => $patient->id,
    //                                 'patient_name' => $patient->firstname,
    //                                 'ipd_opd' => $patient->ipd_opd,
    //                                 'sex' => $patient->sex,
    //                                 'create_date' => $startDate2,
    //                                 'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
    //                                 'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
    //                                 'vaman' => ($vaman_virachan_date == $push_final_date) ? $tretment->VAMAN : NULL,
    //                                 'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
    //                                 'nasya' => ($admit_date == $push_final_date) ? $tretment->NASYA : NULL,
    //                                 'raktmokshan' => ($admit_date == $push_final_date) ? $tretment->RAKTAMOKSHAN : NULL,
    //                                 'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
    //                                 'shirobasti' => ($shirobasti_final_date == $push_final_date) ? $tretment->SHIROBASTI : NULL,
    //                                 'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
    //                                 'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
    //                                 'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
    //                                 'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
    //                                 'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
    //                                 'hematology' => ($tretment->HEMATOLOGICAL && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->HEMATOLOGICAL : NULL,
    //                                 'serology' => ($tretment->SEROLOGYCAL && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->SEROLOGYCAL : NULL,
    //                                 'biochemistry' => ($tretment->BIOCHEMICAL && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->BIOCHEMICAL : NULL,
    //                                 'microbiology' => ($tretment->MICROBIOLOGICAL && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->MICROBIOLOGICAL : NULL,
    //                                 'xray' => ($tretment->X_RAY && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->X_RAY : NULL,
    //                                 'ecg' => ($tretment->ECG && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->ECG : NULL,
    //                                 'usg' => ($tretment->USG && $admit_date==date('Y-m-d',strtotime($push_date))) ? $tretment->USG : NULL
    //                         ]);
    //                         $updateRes = $this->db->insert('investi_panch_ipd_patient_count', $postPatientInvestPanchData);
                            
    //                         print_r($this->db->last_query());
    //                         // $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('investi_panch_ipd_patient_count')->num_rows();
    //                         // if($searchRes == 0){
    //                         //     $updateRes = $this->db->insert('investi_panch_ipd_patient_count', $postPatientInvestPanchData);
    //                         // }
    //                     }
    //                 }
    //             }
    //             $investi_panch_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology,
    //                 'Serology' => $Serology,
    //                 'BioChemistry' => $BioChemistry,
    //                 'Microbiology' => $Microbiology,
    //                 'XRay' => $XRay,
    //                 'ECG' => $ECG,
    //                 'USG' => $USG
    //             ];
    //             $investi_panch_test_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology_Test,
    //                 'Serology' => $Serology_Test,
    //                 'BioChemistry' => $BioChemistry_Test,
    //                 'Microbiology' => $Microbiology_Test,
    //                 'XRay' => $XRay_Test,
    //                 'ECG' => $ECG_Test,
    //                 'USG' => $USG_Test
    //             ];
    //             $index = $index + 1;
    //             print_r($investi_panch_count);print_r("<br>");
    //             print_r($investi_panch_test_count);print_r("<br>");
    //         }
    //         else{
    //             $investi_panch_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology,
    //                 'Serology' => $Serology,
    //                 'BioChemistry' => $BioChemistry,
    //                 'Microbiology' => $Microbiology,
    //                 'XRay' => $XRay,
    //                 'ECG' => $ECG,
    //                 'USG' => $USG
    //             ];
    //             $investi_panch_test_count[$index] = [
    //                 'Snehan' => $Snehan,
    //                 'Swedan' => $Swedan,
    //                 'Vaman' => $Vaman,
    //                 'Virechan' => $Virechan,
    //                 'Nasya' => $Nasya,
    //                 'Raktmokshan' => $Raktmokshan,
    //                 'Shirodhara' => $Shirodhara,
    //                 'Shirobasti' => $Shirobasti,
    //                 'Uttarbasti' => $Uttarbasti,
    //                 'Basti' => $Basti,
    //                 'Yonidhavan' => $Yonidhavan,
    //                 'Yonipichu' => $Yonipichu,
    //                 'Other' => $Other,
    //                 'Hematology' => $Hematology_Test,
    //                 'Serology' => $Serology_Test,
    //                 'BioChemistry' => $BioChemistry_Test,
    //                 'Microbiology' => $Microbiology_Test,
    //                 'XRay' => $XRay_Test,
    //                 'ECG' => $ECG_Test,
    //                 'USG' => $USG_Test
    //             ];
    //             $index = $index + 1;
    //             print_r($investi_panch_count);print_r("<br>");
    //             print_r($investi_panch_test_count);print_r("<br>");
    //         }
    //         for($i=0; $i<count($investi_panch_count);$i++){
    //             (object)$postPatientInvestPanchCountData = ([
    //                     'ipd_opd' => $section_ipd,
    //                     'create_date' => $startDate2,
    //                     'snehan_count' => $investi_panch_count[$i]['Snehan'],
    //                     'swedan_count' => $investi_panch_count[$i]['Swedan'],
    //                     'vaman_count' => $investi_panch_count[$i]['Vaman'],
    //                     'virechan_count' => $investi_panch_count[$i]['Virechan'],
    //                     'nasya_count' => $investi_panch_count[$i]['Nasya'],
    //                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
    //                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
    //                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
    //                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
    //                     'basti_count' => $investi_panch_count[$i]['Basti'],
    //                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
    //                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
    //                     'others_count' => $investi_panch_count[$i]['Other'],
    //                     'hematology_count' => $investi_panch_count[$i]['Hematology'],
    //                     'serology_count' => $investi_panch_count[$i]['Serology'],
    //                     'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'],
    //                     'microbiology_count' => $investi_panch_count[$i]['Microbiology'],
    //                     'xray_count' => $investi_panch_count[$i]['XRay'],
    //                     'ecg_count' => $investi_panch_count[$i]['ECG'],
    //                     'usg_count' => $investi_panch_count[$i]['USG'],
    //                 ]);
    //             $res = $this->db->insert('investi_panch_ipd_total_count', $postPatientInvestPanchCountData);
                
    //             (object)$postPatientInvestPanchTestCountData = ([
    //                     'ipd_opd' => $section_ipd,
    //                     'create_date' => $startDate2,
    //                     'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
    //                     'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
    //                     'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
    //                     'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
    //                     'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
    //                     'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
    //                     'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
    //                     'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
    //                     'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
    //                     'basti_count' => $investi_panch_test_count[$i]['Basti'],
    //                     'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
    //                     'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
    //                     'others_count' => $investi_panch_test_count[$i]['Other'],
    //                     'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
    //                     'serology_count' => $investi_panch_test_count[$i]['Serology'],
    //                     'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
    //                     'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
    //                     'xray_count' => $investi_panch_test_count[$i]['XRay'],
    //                     'ecg_count' => $investi_panch_test_count[$i]['ECG'],
    //                     'usg_count' => $investi_panch_test_count[$i]['USG'],
    //                 ]);
    //             $res1 = $this->db->insert('investi_panch_ipd_test_total_count', $postPatientInvestPanchTestCountData);
    //             if($res && $res1)
    //             {
    //                 print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
    //             }
    //         }
    //     }
        
    // }
    
    
    
    
    
    
  
    
    /////////////////////////////////////////////////////////// END Panchkarma Cout ////////////////////////////////////////////////////////////
      public function physiotherapy_count()
      {
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
        date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
        echo date('d-m-Y H:i:s');
        echo "<script>
            $(document).ready(function () {
                 setTimeout('location.reload(true);', '10000');
            });
        </script>";
        
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////         OPD PHYSIOTHERAPY Counting CODE                 /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        
        $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'opd')->order_by('id','DESC')->limit(1)->get('physiohterapy_opd_total_count')->row();
        print_r('<br>');
        $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
        print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
        $current_date = date('Y-m-d');
        print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
        $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
        print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');print_r('<br>');
        
        $section_opd = 'opd';
        
        $rand_limit_patient = rand(60, 80);
        
        $res = $this->db->where(['create_date'=> $push_date, 'yearly_reg_no != '=>''])->get('patient')->result();
        if($current_date == $push_date){
            //print_r($res);
             $index = 0;
            //$PHYSIOTHERAPY = 0;
            $physiohterapy = 0;
            
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('OPD PHYSIOTHERAPY Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
            if($res != '' || $res != null){
                
                $this->db->select('yearly_reg_no');
                $this->db->from('patient_ipd');
                $this->db->where('yearly_reg_no !=', '');
                $this->db->where('create_date like', '%'.$startDate2.'%');
                $this->db->where('ipd_opd', 'ipd');
                $subQuery =  $this->db->get_compiled_select();
                
                $this->db->select('old_reg_no');
                $this->db->from('patient_ipd');
                $this->db->where('old_reg_no !=', '');
                $this->db->where('create_date like', '%'.$startDate2.'%');
                $this->db->where('ipd_opd', 'ipd');
                $subQuery1 =  $this->db->get_compiled_select();
                
                $this->db->where('create_date like', '%'.$startDate2.'%');
                $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                $this->db->where('yearly_reg_no !=', '');
                $this->db->where('ipd_opd', 'opd');
                $this->db->or_where('create_date like', '%'.$startDate2.'%');
                $this->db->where("old_reg_no NOT IN ($subQuery1)", NULL, FALSE);
                $this->db->where('old_reg_no !=', '');
                $this->db->where('ipd_opd', 'opd');
                $this->db->order_by('id', rand());
                $this->db->limit($rand_limit_patient);
                $patientList =  $this->db->get('patient')->result();
                // print_r(count($patientList));
                // print_r($patientList);
                // print_r($this->db->last_query());
                foreach($patientList as $patient){
                    print_r('Yearly Reg No ==>==>==>==> ');print_r($patient->yearly_reg_no);print_r(' ------> ');
                    print_r('Old Reg No ==>==>==>==> ');print_r($patient->old_reg_no);print_r('<br>');
                    
                    //////////////////////////////////////// Treatement Fetching Code Start ///////////////////////////////////
                    $che=trim($patient->dignosis);
                    //print_r($che);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0){
                        if($patient->proxy_id){
                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                ->where('proxy_id',$patient->proxy_id)
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();
                        }
                        else{
                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();  
                        }
                    }else{
                        $tretment=$this->db->select("*")
                            ->from('manual_treatments')
                            ->where('patient_id_auto',$patient->id)
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();
                    }
                    //////////////////////////////////////// Treatement Fetching Code End ///////////////////////////////////
                     $physiohterapy_name = 0;
                    if($tretment){
                        if($tretment->PHYSIOTHERAPY){
                            print_r("PHYSIOTHERAPY ==>==>==> ");
                            if($tretment->PHYSIOTHERAPY){ 
                                
                                    print_r("PHYSIOTHERAPY");print_r(' ==>==>==>==> ');print_r($tretment->PHYSIOTHERAPY); 
                                    $physiohterapy = $physiohterapy + 1; 
                                    $physiohterapy_name = $tretment->PHYSIOTHERAPY;
                            }
                            
                            print_r('<br>');
                          
                            (object)$postphysiohterapyPanchData = ([
                                    'patient_auto_id' => $patient->id,
                                    'name' => $patient->firstname,
                                    'ipd_opd' => $patient->ipd_opd,
                                    'dignosis' => $patient->dignosis,
                                    'create_date' => $startDate2,
                                    'physiohterapy' => ($physiohterapy_name) ? $physiohterapy_name : NULL,
                            ]);
                            $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('physiohterapy_opd_report_result')->num_rows();
                            if($searchRes == 0){
                                $updateRes = $this->db->insert('physiohterapy_opd_report_result', $postphysiohterapyPanchData);
                                 print_r($postphysiohterapyPanchData);
                                  print_r('<br>');
                            }
                        }
                    }
                    
                }
                $physiohterapy_count[$index] = [
                    'physiohterapy' => $physiohterapy
                ];
                $index = $index + 1;
                print_r($physiohterapy_count);print_r("<br>");
            }
            else{
                $physiohterapy_count[$index] = [
                    'physiohterapy' => $physiohterapy
                ];
                
                $index = $index + 1;
                print_r($physiohterapy_count);print_r("<br>");
            }
            
            for($i=0; $i<count($physiohterapy_count);$i++){
                print_r($physiohterapy_count[$i]['Hematology']);
                (object)$postPatientphysiohterapyCountData = ([
                        'ipd_opd' => $section_opd,
                        'create_date' => $startDate2,
                        'physiohterapy_count' => $physiohterapy_count[$i]['Snehan'],
                    ]);
                $res = $this->db->insert('physiohterapy_opd_total_count', $postPatientphysiohterapyCountData);
                
                print_r($postPatientphysiohterapyCountData);
                
               
                if($res)
                {
                    print_r('physiohterapy Counting Inserted Successfully');
                }
            }
        }
        elseif($current_date > $push_date){
            //print_r($res);
             $index = 0;
            //$PHYSIOTHERAPY = 0;
            $physiohterapy = 0;
            
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('OPD PHYSIOTHERAPY Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
            if($res != '' || $res != null){
                
                $this->db->select('yearly_reg_no');
                $this->db->from('patient_ipd');
                $this->db->where('yearly_reg_no !=', '');
                $this->db->where('create_date like', '%'.$startDate2.'%');
                $this->db->where('ipd_opd', 'ipd');
                $subQuery =  $this->db->get_compiled_select();
                
                $this->db->select('old_reg_no');
                $this->db->from('patient_ipd');
                $this->db->where('old_reg_no !=', '');
                $this->db->where('create_date like', '%'.$startDate2.'%');
                $this->db->where('ipd_opd', 'ipd');
                $subQuery1 =  $this->db->get_compiled_select();
                
                $this->db->where('create_date like', '%'.$startDate2.'%');
                $this->db->where("yearly_reg_no NOT IN ($subQuery)", NULL, FALSE);
                $this->db->where('yearly_reg_no !=', '');
                $this->db->where('ipd_opd', 'opd');
                $this->db->or_where('create_date like', '%'.$startDate2.'%');
                $this->db->where("old_reg_no NOT IN ($subQuery1)", NULL, FALSE);
                $this->db->where('old_reg_no !=', '');
                $this->db->where('ipd_opd', 'opd');
                $this->db->order_by('id', rand());
                $this->db->limit($rand_limit_patient);
                $patientList =  $this->db->get('patient')->result();
                // print_r(count($patientList));
                // print_r($patientList);
                // print_r($this->db->last_query());
                foreach($patientList as $patient){
                    print_r('Yearly Reg No ==>==>==>==> ');print_r($patient->yearly_reg_no);print_r(' ------> ');
                    print_r('Old Reg No ==>==>==>==> ');print_r($patient->old_reg_no);print_r('<br>');
                    
                    //////////////////////////////////////// Treatement Fetching Code Start ///////////////////////////////////
                    $che=trim($patient->dignosis);
                    //print_r($che);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0){
                        if($patient->proxy_id){
                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                ->where('proxy_id',$patient->proxy_id)
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();
                        }
                        else{
                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();  
                        }
                    }else{
                        $tretment=$this->db->select("*")
                            ->from('manual_treatments')
                            ->where('patient_id_auto',$patient->id)
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();
                    }
                    //////////////////////////////////////// Treatement Fetching Code End ///////////////////////////////////
                     $physiohterapy_name = 0;
                    if($tretment){
                        if($tretment->PHYSIOTHERAPY){
                            print_r("PHYSIOTHERAPY ==>==>==> ");
                            if($tretment->PHYSIOTHERAPY){ 
                                
                                    print_r("PHYSIOTHERAPY");print_r(' ==>==>==>==> ');print_r($tretment->PHYSIOTHERAPY); 
                                    $physiohterapy = $physiohterapy + 1; 
                                    $physiohterapy_name = $tretment->PHYSIOTHERAPY;
                            }
                            
                            print_r('<br>');
                          
                            (object)$postphysiohterapyPanchData = ([
                                    'patient_auto_id' => $patient->id,
                                    'name' => $patient->firstname,
                                    'ipd_opd' => $patient->ipd_opd,
                                    'dignosis' => $patient->dignosis,
                                    'create_date' => $startDate2,
                                    'physiohterapy' => ($physiohterapy_name) ? $physiohterapy_name : NULL,
                            ]);
                            $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('physiohterapy_opd_report_result')->num_rows();
                            if($searchRes == 0){
                                $updateRes = $this->db->insert('physiohterapy_opd_report_result', $postphysiohterapyPanchData);
                                print_r($postphysiohterapyPanchData);
                            }
                        }
                    }
                    
                }
                $physiohterapy_count[$index] = [
                    'physiohterapy' => $physiohterapy
                ];
                $index = $index + 1;
                print_r($physiohterapy_count);print_r("<br>");
            }
            else{
                $physiohterapy_count[$index] = [
                    'physiohterapy' => $physiohterapy
                ];
                
                $index = $index + 1;
                print_r($physiohterapy_count);print_r("<br>");
            }
            
            for($i=0; $i<count($physiohterapy_count);$i++){
                //print_r($physiohterapy_count[$i]['Hematology']);
                (object)$postPatientphysiohterapyCountData = ([
                        'ipd_opd' => $section_opd,
                        'create_date' => $startDate2,
                        'physiohterapy_count' => $physiohterapy_count[$i]['physiohterapy'],
                    ]);
                $res = $this->db->insert('physiohterapy_opd_total_count', $postPatientphysiohterapyCountData);
                                print_r($postPatientphysiohterapyCountData);

               
                if($res)
                {
                    print_r('physiohterapy Counting Inserted Successfully');
                }
            }
        }
        
        
        
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////            IPD physiohterapy Counting CODE              /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        
        $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'ipd')->order_by('id','DESC')->limit(1)->get('physiohterapy_ipd_total_count')->row();
        print_r('<br>');
        $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
        print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
        $current_date = date('Y-m-d');
        print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
        $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
        print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');print_r('<br>');
        
        $section_ipd = 'ipd';
        $res = $this->db->where('create_date', $push_date)->get('patient_ipd')->result();
        
        if($current_date == $push_date){
            //print_r($res);
            
            $index = 0;
            $physiohterapy = 0;
            
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('IPD PHYSIOTHERAPY Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
            if($res != '' || $res != null){
                $start_date = date('Y-m-d',strtotime($push_date));
                $end_date   = date('Y-m-d',strtotime($push_date));
                $start_date_f= $start_date." 23:59:00";
                $end_date_f= $end_date." 23:59:00";
                
                $patients1 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('discharge_date >=', $start_date_f)
                    ->where('create_date <=', $end_date_f)
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                        
                //print_r('q1   ');
                //print_r($this->db->last_query());
                        
                $patients2 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('create_date <=', $end_date_f)
                    ->where('discharge_date LIKE', '%0000-00-00%')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                
                //print_r('q2   ');                    
                //print_r($this->db->last_query());
                $patientList = array_merge($patients1, $patients2);
                foreach($patientList as $patient){
                    print_r('Yearly Reg No ==>==>==>==> ');print_r($patient->yearly_reg_no);print_r('<br>');
                    
                    $che=trim($patient->dignosis);
                    $section_tret='ipd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    
                    if($patient->manual_status==0){
                        if($patient->proxy_id){
                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                //->where('dignosis LIKE',$p_dignosis_name)
                                ->where('proxy_id',$patient->proxy_id)
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();
                        }
                        else{
                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();  
                        } 
                    }else{
                        $tretment=$this->db->select("*")
                            ->from('manual_treatments')
                            ->where('patient_id_auto',$patient->id)
                            ->where('dignosis LIKE',$p_dignosis)
                            //->where('dignosis LIKE',$p_dignosis_name)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();
                    }
                    
                    
                    $physiohterapy_name = 0;
                    
                    if($tretment){
                        if($tretment->PHYSIOTHERAPY){
                            
                            // $admit_date=date('Y-m-d',strtotime($patient->create_date));
                            // $date1=date_create($admit_date);
                            // $date2=date_create($push_date);
                            // $diff=date_diff($date1,$date2);
                            // $diffDay = $diff->format("%a");
                            // $shirobastiCheck = ($diffDay % 2);
                            
                            print_r("PHYSIOTHERAPY ==>==>==> ");
                            
                            if($tretment->PHYSIOTHERAPY){ 
                               
                                    print_r("physiohterapy");print_r(' ==>==>==>==> ');print_r($tretment->PHYSIOTHERAPY); 
                                    $physiohterapy = $physiohterapy + 1; 
                                    $physiohterapy_name = $tretment->PHYSIOTHERAPY;
                                }
                            }
                            (object)$postPatientphysiohterapyData = ([
                                    'patient_auto_id' => $patient->id,
                                    'name' => $patient->firstname,
                                    'dignosis' => $patient->dignosis,
                                    'ipd_opd' => $patient->ipd_opd,
                                    'create_date' => $startDate2,
                                    'physiohterapy' => ($physiohterapy_name) ? $physiohterapy_name : NULL,
                            ]);
                            $updateRes = $this->db->insert('physiohterapy_ipd_report_result', $postPatientphysiohterapyData);
                            print_r($postPatientphysiohterapyData);
                            print_r('<br>');
                        }
                    }
                $physiohterapy_count[$index] = [
                    'physiohterapy' => $physiohterapy,
                    
                ];
                $index = $index + 1;
                print_r($physiohterapy_count);print_r("<br>");
            
            }
            else{
                $physiohterapy_count[$index] = [
                    'physiohterapy' => $physiohterapy,
                    
                ];
                $index = $index + 1;
                print_r($physiohterapy_count);print_r("<br>");
            }
            for($i=0; $i<count($physiohterapy_count);$i++){
                (object)$postPatientphysiohterapyCountData = ([
                        'ipd_opd' => $section_ipd,
                        'create_date' => $startDate2,
                        'physiohterapy_count' => $physiohterapy_count[$i]['physiohterapy'],
                    ]);
                $res = $this->db->insert('physiohterapy_ipd_total_count', $postPatientphysiohterapyCountData);
                
               
                if($res)
                {
                    print_r('IPD Physiotherapy Counting Inserted Successfully');
                }
            }
        }
        elseif($current_date > $push_date){
            //print_r($res);
            
            $index = 0;
            $physiohterapy = 0;
            
          
            
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('IPD PHYSIOTHERAPY Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
            if($res != '' || $res != null){
                $start_date = date('Y-m-d',strtotime($push_date));
                $end_date   = date('Y-m-d',strtotime($push_date));
                $start_date_f= $start_date." 23:59:00";
                $end_date_f= $end_date." 23:59:00";
                
                $patients1 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('discharge_date >=', $start_date_f)
                    ->where('create_date <=', $end_date_f)
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                        
                //print_r('q1   ');
                //print_r($this->db->last_query());
                        
                $patients2 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('create_date <=', $end_date_f)
                    ->where('discharge_date LIKE', '%0000-00-00%')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                
                //print_r('q2   ');                    
                //print_r($this->db->last_query());
                $patientList = array_merge($patients1, $patients2);
                foreach($patientList as $patient){
                    print_r('Yearly Reg No ==>==>==>==> ');print_r($patient->yearly_reg_no);print_r('<br>');
                    
                    $che=trim($patient->dignosis);
                    //print_r($che);
                    
                    $section_tret='ipd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    
                    if($patient->manual_status==0){
                        if($patient->proxy_id){
                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                //->where('dignosis LIKE',$p_dignosis_name)
                                ->where('proxy_id',$patient->proxy_id)
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();
                        }
                        else{
                            $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('dignosis LIKE',$p_dignosis)
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd ',$section_tret)
                                ->get()
                                ->row();  
                        } 
                    }else{
                        $tretment=$this->db->select("*")
                            ->from('manual_treatments')
                            ->where('patient_id_auto',$patient->id)
                            ->where('dignosis LIKE',$p_dignosis)
                            //->where('dignosis LIKE',$p_dignosis_name)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();
                    }
                    
                    $physiohterapy_name = 0;
                    if($tretment){
                        if($tretment->PHYSIOTHERAPY){
                            
                            $admit_date=date('Y-m-d',strtotime($patient->create_date));
                            $date1=date_create($admit_date);
                            $date2=date_create($push_date);
                            $diff=date_diff($date1,$date2);
                            $diffDay = $diff->format("%a");
                            $shirobastiCheck = ($diffDay % 2);
                            
                            print_r("PHYSIOTHERAPY ==>==>==> ");
                            
                            if($tretment->PHYSIOTHERAPY){ 
                               
                                    print_r("physiohterapy");print_r(' ==>==>==>==> ');print_r($tretment->PHYSIOTHERAPY); 
                                    $physiohterapy = $physiohterapy + 1; 
                                    $physiohterapy_name = $tretment->PHYSIOTHERAPY;
                                }
                            }
                            (object)$postPatientphysiohterapyData = ([
                                    'patient_auto_id' => $patient->id,
                                    'name' => $patient->firstname,
                                    'ipd_opd' => $patient->ipd_opd,
                                    'create_date' => $startDate2,
                                    'physiohterapy' => ($physiohterapy_name) ? $physiohterapy_name : NULL,
                            ]);
                            $updateRes = $this->db->insert('physiohterapy_ipd_report_result', $postPatientphysiohterapyData);
                        }
                    }
                $physiohterapy_count[$index] = [
                    'physiohterapy' => $physiohterapy,
                    
                ];
                $index = $index + 1;
                print_r($physiohterapy_count);print_r("<br>");
            
            }
            else{
                $physiohterapy_count[$index] = [
                    'physiohterapy' => $physiohterapy,
                    
                ];
                $index = $index + 1;
                print_r($physiohterapy_count);print_r("<br>");
            }
            for($i=0; $i<count($physiohterapy_count);$i++){
                (object)$postPatientphysiohterapyCountData = ([
                        'ipd_opd' => $section_ipd,
                        'create_date' => $startDate2,
                        'physiohterapy_count' => $physiohterapy_count[$i]['physiohterapy'],
                    ]);
                $res = $this->db->insert('physiohterapy_ipd_total_count', $postPatientphysiohterapyCountData);
                
               
                if($res )
                {
                    print_r('IPD Physiohterapy Counting Inserted Successfully');
                }
            }
        }
            
        
        
    }
    



    public function investiUpdate()
    {
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
        date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
        echo date('d-m-Y H:i:s');
      	echo "<br>";
        echo "<script>
            $(document).ready(function () {
                 setTimeout('location.reload(true);', '10000');
            });
        </script>";
        
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////      OPD Investigation & Panchakarma Counting CODE      /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'opd')
        ->where('patho','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient')
        ->row();
      // print_r($this->db->last_query());
      //die();
      $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));

      echo "Last Date OPD=================>".$last_create_date;
      echo "<br>";
      echo "Current Date OPD=================>".$current_date;
      echo "<br>";
      echo "Push Date OPD=================>".$last_create_date;
      echo "<br>";
     
            // if($current_date > $last_create_date) {
            //   echo"gfhfghfgfhfjfghjfhjgfhdfghcbvfgghf";
        // }
            
            //  die();
      //$rand_limit_patient = rand(30,40);
        if($last_create_date == $current_date)
        {
        
            $index = 0;
            $Hematology = 0; $Serology = 0; $BioChemistry = 0; 
            $Microbiology = 0; 
            $Hematology_Test = 0; $Serology_Test = 0; $BioChemistry_Test = 0; 
            $Microbiology_Test = 0;


            $patientList =  
              $this->db->select('*')
              ->from('patient')
              //->where('yearly_reg_no !=','')
              ->where('patho','0')
              ->where('ipd_patient_flag','0')
              ->where('dignosis !=','')
              ->where('create_date',$last_create_date)
              ->where('ipd_opd','opd')
              ->order_by('RAND()')
              ->limit($rand_limit_patient)
              ->get()
              ->result();
            //print_r($this->db->last_query());
            //die();
            foreach($patientList as $patient)
            {
              //echo "Push Date =================>".
				$startDate2=$patient->create_date;
              
             
              echo "<br>";
                $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                  if($patient->manual_status==0){
                                      if($patient->proxy_id){
                                     $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else
                                      {
                                      $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                      if(empty($tretment)){
                                      $tretment=$this->db->select("*")
                                      ->from('treatments1')
                                      ->where('department_id',$patient->department_id)
			                          ->where('ipd_opd',$patient->department_id)
                                     ->get()
                                     ->row();   
                                      }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                  }

                                    // if($patient->yearly_reg_no)
                                    // {
                                        if($tretment)
                                        {
                                            if($tretment->HEMATOLOGICAL || $tretment->SEROLOGYCAL || $tretment->BIOCHEMICAL || $tretment->MICROBIOLOGICAL)
                                            {
                                                print_r("Investigation ==>==>==> ");
                                                if($tretment->HEMATOLOGICAL){   print_r('<br>');
                                                    print_r("Hematology");print_r(' ==>==>==>==> ');print_r($tretment->HEMATOLOGICAL);
                                                    $Hematology = $Hematology + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->HEMATOLOGICAL));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $Hematology_Test = $Hematology_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $last_create_date
                                                                    ];
                                                                    $this->db->insert('investi_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                               if($tretment->SEROLOGYCAL){
                                                    print_r("Serology");print_r(' ==>==>==>==> ');print_r($tretment->SEROLOGYCAL);
                                                    $Serology = $Serology + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->SEROLOGYCAL));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $Serology_Test = $Serology_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        if($ex[$i] == 'WIDAL TEST')
                                                                      {
                                                                        $ex_random_val_wd20 = explode(',',trim($rs->WD_20));
                                                                        $ex_random_val_wd40 = explode(',',trim($rs->WD_40));
                                                                        $ex_random_val_wd80 = explode(',',trim($rs->WD_80));
                                                                        $ex_random_val_wd160 = explode(',',trim($rs->WD_160));
                                                                        $ex_random_val_wd320 = explode(',',trim($rs->WD_320));
                                                                      }
                                                                      else
                                                                      {
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                      }
                                                                    }
                                                                  
                                                                  $rand_val_wd20 = array_rand($ex_random_val_wd20);
                                                                  $rand_val_wd40 = array_rand($ex_random_val_wd40);
                                                                  $rand_val_wd80 = array_rand($ex_random_val_wd80);
                                                                  $rand_val_wd160 = array_rand($ex_random_val_wd160);
                                                                  $rand_val_wd320 = array_rand($ex_random_val_wd320);
                                                                  
                                                                  
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'WD_20_RESULT' =>$ex_random_val_wd20[$rand_val_wd20],
                                                                        'WD_40_RESULT' =>$ex_random_val_wd40[$rand_val_wd40],
                                                                        'WD_80_RESULT' =>$ex_random_val_wd80[$rand_val_wd80],
                                                                        'WD_160_RESULT' =>$ex_random_val_wd160[$rand_val_wd160],
                                                                        'WD_320_RESULT' =>$ex_random_val_wd320[$rand_val_wd320],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $last_create_date
                                                                    ];
                                                                    $this->db->insert('investi_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                if($tretment->BIOCHEMICAL){
                                                    print_r("Bio-Chemistry");print_r(' ==>==>==>==> ');print_r($tretment->BIOCHEMICAL);
                                                    $BioChemistry = $BioChemistry + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->BIOCHEMICAL));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $BioChemistry_Test = $BioChemistry_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $last_create_date
                                                                    ];
                                                                    $this->db->insert('investi_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                if($tretment->MICROBIOLOGICAL){
                                                    print_r("Microbiology");print_r(' ==>==>==>==> ');print_r($tretment->MICROBIOLOGICAL);
                                                    $Microbiology = $Microbiology + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->MICROBIOLOGICAL));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $Microbiology_Test = $Microbiology_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $last_create_date
                                                                    ];
                                                                    $this->db->insert('investi_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }


                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'hematology' => ($tretment->HEMATOLOGICAL) ? $tretment->HEMATOLOGICAL : NULL,
                                                'serology' => ($tretment->SEROLOGYCAL) ? $tretment->SEROLOGYCAL : NULL,
                                                'biochemistry' => ($tretment->BIOCHEMICAL) ? $tretment->BIOCHEMICAL : NULL,
                                                'microbiology' => ($tretment->MICROBIOLOGICAL) ? $tretment->MICROBIOLOGICAL : NULL,
                                                            ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('investi_patient_count_opd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('investi_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            
                                            }
                                            
        
                                        }
                                   // }
                                    $data = array(
                                        'patho' => '1'
                                    );
                                    
                                    $this->db->where('create_date',$last_create_date);
                                     $this->db->or_where('ipd_patient_flag','1');
                                    $this->db->update('patient', $data);
                                    //  print_r($this->db->last_query());
                                    }                       
                    $investi_panch_count[$index] = [
                        'Hematology' => $Hematology,
                        'Serology' => $Serology,
                        'BioChemistry' => $BioChemistry,
                        'Microbiology' => $Microbiology,
                        ];
            //  echo "<pre>";
             // print_r($investi_panch_count);
              // die();
                    $investi_panch_test_count[$index] = [
                        'Hematology' => $Hematology_Test,
                        'Serology' => $Serology_Test,
                        'BioChemistry' => $BioChemistry_Test,
                        'Microbiology' => $Microbiology_Test,
                        ];
              
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count_opd_total = $this->db->select('*')->from('investi_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                              	//print_r($this->db->last_query());
                            //  die();
                              if($last_count_opd_total) 
                                {
                                    $hematology_count = $last_count_opd_total->hematology_count;
                                    $serology_count = $last_count_opd_total->serology_count;
                                    $biochemistry_count = $last_count_opd_total->biochemistry_count;
                                    $microbiology_count = $last_count_opd_total->microbiology_count;
                                  
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'hematology_count' => $investi_panch_count[$i]['Hematology'] + $hematology_count,
                                        'serology_count' => $investi_panch_count[$i]['Serology'] + $serology_count,
                                        'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'] + $biochemistry_count,
                                        'microbiology_count' => $investi_panch_count[$i]['Microbiology'] + $microbiology_count,
                                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('investi_total_count_opd', $postPatientInvestPanchCountData);
                                    if($res)
                                    {
                                    print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'hematology_count' => $investi_panch_count[$i]['Hematology'],
                                    'serology_count' => $investi_panch_count[$i]['Serology'],
                                    'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'],
                                    'microbiology_count' => $investi_panch_count[$i]['Microbiology'],
                                                ]);
                                    //echo "<pre>";
                                    //print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('investi_total_count_opd', $postPatientInvestPanchCountData);
                                   // echo "<pre>";
                                    if($res)
                                    {
                                    print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                  //25
                                }






                                $last_count = $this->db->select('*')->from('investi_test_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                              	//print_r($this->db->last_query());
                            //  die();
                              if($last_count) 
                                {
                                    $hematology_count = $last_count->hematology_count;
                                    $serology_count = $last_count->serology_count;
                                    $biochemistry_count = $last_count->biochemistry_count;
                                    $microbiology_count = $last_count->microbiology_count;
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'hematology_count' => $investi_panch_test_count[$i]['Hematology'] + $hematology_count,
                                        'serology_count' => $investi_panch_test_count[$i]['Serology'] + $serology_count,
                                        'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'] + $biochemistry_count,
                                        'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'] + $microbiology_count,
                                                    ]);
                                    //echo "<pre>";
                                    //print_r($postPatientInvestPanchCountData);


                                    // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
                                    $this->db->where('create_date', $last_create_date);
                                    $res1 =  $this->db->update('investi_test_total_count_opd', $postPatientInvestPanchCountData);

                                    //  print_r($this->db->last_query());
                                    //  die();
                                    if($res1)
                                    {
                                    print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {
                                    (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
                                    'serology_count' => $investi_panch_test_count[$i]['Serology'],
                                    'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
                                    'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
                                                ]);
                                    $res1 = $this->db->insert('investi_test_total_count_opd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                  //25
                                }
                            }
        }


        elseif($current_date > $last_create_date)
        {
        
            $index = 0;
            $Hematology = 0; $Serology = 0; $BioChemistry = 0; 
            $Microbiology = 0; 
            $Hematology_Test = 0; $Serology_Test = 0; $BioChemistry_Test = 0; 
            $Microbiology_Test = 0;


            $patientList =  
              $this->db->select('*')
              ->from('patient')
              //->where('yearly_reg_no !=','')
              ->where('patho','0')
              ->where('ipd_patient_flag','0')
              ->where('dignosis !=','')
              ->where('create_date',$last_create_date)
              ->where('ipd_opd','opd')
              ->order_by('RAND()')
              ->limit($rand_limit_patient)
              ->get()
              ->result();
            //print_r($this->db->last_query());
            //die();
            foreach($patientList as $patient)
            {
              //echo "Push Date =================>".
				$startDate2=$patient->create_date;
              
             
              echo "<br>";
                $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                  if($patient->manual_status==0){
                                      if($patient->proxy_id){
                                     $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else
                                      {
                                      $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                      if(empty($tretment)){
                                      $tretment=$this->db->select("*")
                                      ->from('treatments1')
                                      ->where('department_id',$patient->department_id)
			                          ->where('ipd_opd',$patient->department_id)
                                     ->get()
                                     ->row();   
                                      }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                  }

                                    // if($patient->yearly_reg_no)
                                    // {
                                        if($tretment)
                                        {
                                            if($tretment->HEMATOLOGICAL || $tretment->SEROLOGYCAL || $tretment->BIOCHEMICAL || $tretment->MICROBIOLOGICAL)
                                            {
                                                print_r("Investigation ==>==>==> ");
                                                if($tretment->HEMATOLOGICAL){   print_r('<br>');
                                                    print_r("Hematology");print_r(' ==>==>==>==> ');print_r($tretment->HEMATOLOGICAL);
                                                    $Hematology = $Hematology + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->HEMATOLOGICAL));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $Hematology_Test = $Hematology_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $last_create_date
                                                                    ];
                                                                    $this->db->insert('investi_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                               if($tretment->SEROLOGYCAL){
                                                    print_r("Serology");print_r(' ==>==>==>==> ');print_r($tretment->SEROLOGYCAL);
                                                    $Serology = $Serology + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->SEROLOGYCAL));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $Serology_Test = $Serology_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        if($ex[$i] == 'WIDAL TEST')
                                                                      {
                                                                        $ex_random_val_wd20 = explode(',',trim($rs->WD_20));
                                                                        $ex_random_val_wd40 = explode(',',trim($rs->WD_40));
                                                                        $ex_random_val_wd80 = explode(',',trim($rs->WD_80));
                                                                        $ex_random_val_wd160 = explode(',',trim($rs->WD_160));
                                                                        $ex_random_val_wd320 = explode(',',trim($rs->WD_320));
                                                                      }
                                                                      else
                                                                      {
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                      }
                                                                    }
                                                                  
                                                                  $rand_val_wd20 = array_rand($ex_random_val_wd20);
                                                                  $rand_val_wd40 = array_rand($ex_random_val_wd40);
                                                                  $rand_val_wd80 = array_rand($ex_random_val_wd80);
                                                                  $rand_val_wd160 = array_rand($ex_random_val_wd160);
                                                                  $rand_val_wd320 = array_rand($ex_random_val_wd320);
                                                                  
                                                                  
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'WD_20_RESULT' =>$ex_random_val_wd20[$rand_val_wd20],
                                                                        'WD_40_RESULT' =>$ex_random_val_wd40[$rand_val_wd40],
                                                                        'WD_80_RESULT' =>$ex_random_val_wd80[$rand_val_wd80],
                                                                        'WD_160_RESULT' =>$ex_random_val_wd160[$rand_val_wd160],
                                                                        'WD_320_RESULT' =>$ex_random_val_wd320[$rand_val_wd320],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $last_create_date
                                                                    ];
                                                                    $this->db->insert('investi_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                if($tretment->BIOCHEMICAL){
                                                    print_r("Bio-Chemistry");print_r(' ==>==>==>==> ');print_r($tretment->BIOCHEMICAL);
                                                    $BioChemistry = $BioChemistry + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->BIOCHEMICAL));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $BioChemistry_Test = $BioChemistry_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $last_create_date
                                                                    ];
                                                                    $this->db->insert('investi_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                if($tretment->MICROBIOLOGICAL){
                                                    print_r("Microbiology");print_r(' ==>==>==>==> ');print_r($tretment->MICROBIOLOGICAL);
                                                    $Microbiology = $Microbiology + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->MICROBIOLOGICAL));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $Microbiology_Test = $Microbiology_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $last_create_date
                                                                    ];
                                                                    $this->db->insert('investi_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }


                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'hematology' => ($tretment->HEMATOLOGICAL) ? $tretment->HEMATOLOGICAL : NULL,
                                                'serology' => ($tretment->SEROLOGYCAL) ? $tretment->SEROLOGYCAL : NULL,
                                                'biochemistry' => ($tretment->BIOCHEMICAL) ? $tretment->BIOCHEMICAL : NULL,
                                                'microbiology' => ($tretment->MICROBIOLOGICAL) ? $tretment->MICROBIOLOGICAL : NULL,
                                                            ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('investi_patient_count_opd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('investi_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            
                                            }
                                            
        
                                        }
                                  //  }
                                    $data = array(
                                        'patho' => '1'
                                    );
                                    
                                    $this->db->where('create_date',$last_create_date);
                                     $this->db->or_where('ipd_patient_flag','1');
                                    $this->db->update('patient', $data);
                                    //  print_r($this->db->last_query());
                                    }                       
                    $investi_panch_count[$index] = [
                        'Hematology' => $Hematology,
                        'Serology' => $Serology,
                        'BioChemistry' => $BioChemistry,
                        'Microbiology' => $Microbiology,
                        ];
            //  echo "<pre>";
             // print_r($investi_panch_count);
              // die();
                    $investi_panch_test_count[$index] = [
                        'Hematology' => $Hematology_Test,
                        'Serology' => $Serology_Test,
                        'BioChemistry' => $BioChemistry_Test,
                        'Microbiology' => $Microbiology_Test,
                        ];
              
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count_opd_total = $this->db->select('*')->from('investi_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                              	//print_r($this->db->last_query());
                            //  die();
                              if($last_count_opd_total) 
                                {
                                    $hematology_count = $last_count_opd_total->hematology_count;
                                    $serology_count = $last_count_opd_total->serology_count;
                                    $biochemistry_count = $last_count_opd_total->biochemistry_count;
                                    $microbiology_count = $last_count_opd_total->microbiology_count;
                                  
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'hematology_count' => $investi_panch_count[$i]['Hematology'] + $hematology_count,
                                        'serology_count' => $investi_panch_count[$i]['Serology'] + $serology_count,
                                        'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'] + $biochemistry_count,
                                        'microbiology_count' => $investi_panch_count[$i]['Microbiology'] + $microbiology_count,
                                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('investi_total_count_opd', $postPatientInvestPanchCountData);
                                    if($res)
                                    {
                                    print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'hematology_count' => $investi_panch_count[$i]['Hematology'],
                                    'serology_count' => $investi_panch_count[$i]['Serology'],
                                    'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'],
                                    'microbiology_count' => $investi_panch_count[$i]['Microbiology'],
                                                ]);
                                    //echo "<pre>";
                                    //print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('investi_total_count_opd', $postPatientInvestPanchCountData);
                                   // echo "<pre>";
                                    if($res)
                                    {
                                    print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                  //25
                                }






                                $last_count = $this->db->select('*')->from('investi_test_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                              	//print_r($this->db->last_query());
                            //  die();
                              if($last_count) 
                                {
                                    $hematology_count = $last_count->hematology_count;
                                    $serology_count = $last_count->serology_count;
                                    $biochemistry_count = $last_count->biochemistry_count;
                                    $microbiology_count = $last_count->microbiology_count;
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'hematology_count' => $investi_panch_test_count[$i]['Hematology'] + $hematology_count,
                                        'serology_count' => $investi_panch_test_count[$i]['Serology'] + $serology_count,
                                        'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'] + $biochemistry_count,
                                        'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'] + $microbiology_count,
                                                    ]);
                                    //echo "<pre>";
                                    //print_r($postPatientInvestPanchCountData);


                                    // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
                                    $this->db->where('create_date', $last_create_date);
                                    $res1 =  $this->db->update('investi_test_total_count_opd', $postPatientInvestPanchCountData);

                                    //  print_r($this->db->last_query());
                                    //  die();
                                    if($res1)
                                    {
                                    print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {
                                    (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
                                    'serology_count' => $investi_panch_test_count[$i]['Serology'],
                                    'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
                                    'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
                                                ]);
                                    $res1 = $this->db->insert('investi_test_total_count_opd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                  //25
                                }
                            }
        }


         ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////      IPD Investigation & Panchakarma Counting CODE      /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'ipd')
        ->where('patho','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient_ipd')
        ->row();
            // print_r($this->db->last_query());
            //die();
        $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));

        echo "Last Date IPD=================>".$last_create_date;
        echo "<br>";
        echo "Current Date IPD=================>".$current_date;
        echo "<br>";
        echo "Push Date IPD=================>".$last_create_date;
        echo "<br>";
     
            // if($current_date > $last_create_date) {
            //   echo"gfhfghfgfhfjfghjfhjgfhdfghcbvfgghf";
        // }
        if($last_create_date == $current_date)
        {
        
            $index = 0;
            $Hematology = 0; $Serology = 0; $BioChemistry = 0; 
            $Microbiology = 0; 
            $Hematology_Test = 0; $Serology_Test = 0; $BioChemistry_Test = 0; 
            $Microbiology_Test = 0;


            $patients1 = $this->db->select("*")
            ->from('patient_ipd')
            ->join('department','department.dprt_id = patient_ipd.department_id')
            ->where('discharge_date >=', $last_create_date)
            ->where('create_date <=', $last_create_date)
            ->where('dignosis !=', '')
           // ->where('manual_status', '0')
            //->where('panchkamra','0')
            ->where('ipd_opd', 'ipd')
            ->get()
            ->result();
                
                //print_r('q1   ');
            //print_r($this->db->last_query());
        

            $patients2 = $this->db->select("*")
            ->from('patient_ipd')
            ->join('department','department.dprt_id = patient_ipd.department_id')
            ->where('create_date <=', $last_create_date)
            ->where('dignosis !=', '')
           // ->where('manual_status', '0')
           // ->where('panchkamra','0')
            ->where('discharge_date LIKE', '%0000-00-00%')
            ->where('ipd_opd', 'ipd')
            ->get()
            ->result();


            $patientList = array_merge($patients1, $patients2);


            foreach($patientList as $patient)
            {
              //echo "Push Date =================>".
				$startDate2=$patient->create_date;
              
             
                echo "<br>";
                $section_tret='ipd';
                    $che=trim($patient->dignosis);
                    $section_tret='ipd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                  if($patient->manual_status==0){
                                      if($patient->proxy_id){
                                     $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else
                                      {
                                      $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                      if(empty($tretment)){
                                      $tretment=$this->db->select("*")
                                      ->from('treatments1')
                                      ->where('department_id',$patient->department_id)
			                          ->where('ipd_opd',$patient->department_id)
                                     ->get()
                                     ->row();   
                                      }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                  }


                                        if($tretment)
                                        {
                                            if($tretment->HEMATOLOGICAL || $tretment->SEROLOGYCAL || $tretment->BIOCHEMICAL || $tretment->MICROBIOLOGICAL)
                                            {
                                                if($startDate2==date('Y-m-d',strtotime($last_create_date)))
                                                {
                                                    print_r("Investigation ==>==>==> ");
                                                    if($tretment->HEMATOLOGICAL){  
                                                        print_r('<br>');
                                                        print_r("Hematology");print_r(' ==>==>==>==> ');print_r($tretment->HEMATOLOGICAL);
                                                        $Hematology = $Hematology + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->HEMATOLOGICAL));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $Hematology_Test = $Hematology_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                // print_r($result);
                                                                print_r($p_dignosis);print_r("<br>");
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('investi_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                                    if($tretment->SEROLOGYCAL){
                                                        print_r("Serology");print_r(' ==>==>==>==> ');print_r($tretment->SEROLOGYCAL);
                                                        $Serology = $Serology + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->SEROLOGYCAL));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $Serology_Test = $Serology_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                if($ex[$i] == 'WIDAL TEST')
                                                                                {
                                                                                    $ex_random_val_wd20 = explode(',',trim($rs->WD_20));
                                                                                    $ex_random_val_wd40 = explode(',',trim($rs->WD_40));
                                                                                    $ex_random_val_wd80 = explode(',',trim($rs->WD_80));
                                                                                    $ex_random_val_wd160 = explode(',',trim($rs->WD_160));
                                                                                    $ex_random_val_wd320 = explode(',',trim($rs->WD_320));
                                                                                }
                                                                                else
                                                                                {
                                                                                    $ex_random_val = explode(',',trim($rs->random_value));
                                                                                }
                                                                            }
                                                                        }
                                                                        $rand_val_wd20 = array_rand($ex_random_val_wd20);
                                                                        $rand_val_wd40 = array_rand($ex_random_val_wd40);
                                                                        $rand_val_wd80 = array_rand($ex_random_val_wd80);
                                                                        $rand_val_wd160 = array_rand($ex_random_val_wd160);
                                                                        $rand_val_wd320 = array_rand($ex_random_val_wd320);

                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'WD_20_RESULT' =>$ex_random_val_wd20[$rand_val_wd20],
                                                                            'WD_40_RESULT' =>$ex_random_val_wd40[$rand_val_wd40],
                                                                            'WD_80_RESULT' =>$ex_random_val_wd80[$rand_val_wd80],
                                                                            'WD_160_RESULT' =>$ex_random_val_wd160[$rand_val_wd160],
                                                                            'WD_320_RESULT' =>$ex_random_val_wd320[$rand_val_wd320],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('investi_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                                    if($tretment->BIOCHEMICAL){
                                                        print_r("Bio-Chemistry");print_r(' ==>==>==>==> ');print_r($tretment->BIOCHEMICAL);
                                                        $BioChemistry = $BioChemistry + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->BIOCHEMICAL));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $BioChemistry_Test = $BioChemistry_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('investi_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                                    if($tretment->MICROBIOLOGICAL){
                                                        print_r("Microbiology");print_r(' ==>==>==>==> ');print_r($tretment->MICROBIOLOGICAL);
                                                        $Microbiology = $Microbiology + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->MICROBIOLOGICAL));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $Microbiology_Test = $Microbiology_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('investi_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                                }

                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'hematology' => ($tretment->HEMATOLOGICAL) ? $tretment->HEMATOLOGICAL : NULL,
                                                'serology' => ($tretment->SEROLOGYCAL) ? $tretment->SEROLOGYCAL : NULL,
                                                'biochemistry' => ($tretment->BIOCHEMICAL) ? $tretment->BIOCHEMICAL : NULL,
                                                'microbiology' => ($tretment->MICROBIOLOGICAL) ? $tretment->MICROBIOLOGICAL : NULL,
                                                            ]);
                                               // echo "<epr>";
                                                // print_r($postPatientInvestPanchData);
                                                  echo "<br>";
                                                //  die();
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('investi_patient_count_ipd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('investi_patient_count_ipd', $postPatientInvestPanchData);
                                                }
                                            
                                                
                                            }
                                            $data = array(
                                                'patho' => '1'
                                            );
                                            
                                           // $this->db->where('id', $patient->id);
                                            $this->db->where('create_date',$last_create_date);
                                            $this->db->update('patient_ipd', $data);
                                            //  print_r($this->db->last_query());
        
                                        }
   
                                    }                       
                    $investi_panch_count[$index] = [
                        'Hematology' => $Hematology,
                        'Serology' => $Serology,
                        'BioChemistry' => $BioChemistry,
                        'Microbiology' => $Microbiology,
                        ];
                    //  echo "<pre>";
                    // print_r($investi_panch_count);
                    // die();
                    $investi_panch_test_count[$index] = [
                        'Hematology' => $Hematology_Test,
                        'Serology' => $Serology_Test,
                        'BioChemistry' => $BioChemistry_Test,
                        'Microbiology' => $Microbiology_Test,
                        ];
              
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count_opd_total = $this->db->select('*')->from('investi_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                              	//print_r($this->db->last_query());
                            //  die();
                              if($last_count_opd_total) 
                                {
                                    $hematology_count = $last_count_opd_total->hematology_count;
                                    $serology_count = $last_count_opd_total->serology_count;
                                    $biochemistry_count = $last_count_opd_total->biochemistry_count;
                                    $microbiology_count = $last_count_opd_total->microbiology_count;
                                  
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'hematology_count' => $investi_panch_count[$i]['Hematology'] + $hematology_count,
                                        'serology_count' => $investi_panch_count[$i]['Serology'] + $serology_count,
                                        'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'] + $biochemistry_count,
                                        'microbiology_count' => $investi_panch_count[$i]['Microbiology'] + $microbiology_count,
                                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('investi_total_count_ipd', $postPatientInvestPanchCountData);
                                    if($res)
                                    {
                                    print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'hematology_count' => $investi_panch_count[$i]['Hematology'],
                                    'serology_count' => $investi_panch_count[$i]['Serology'],
                                    'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'],
                                    'microbiology_count' => $investi_panch_count[$i]['Microbiology'],
                                                ]);
                                    //echo "<pre>";
                                    //print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('investi_total_count_ipd', $postPatientInvestPanchCountData);
                                   // echo "<pre>";
                                    if($res)
                                    {
                                    print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                  //25
                                }






                                $last_count = $this->db->select('*')->from('investi_test_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                              	//print_r($this->db->last_query());
                            //  die();
                              if($last_count) 
                                {
                                    $hematology_countt = $last_count->hematology_count;
                                    $serology_count = $last_count->serology_count;
                                    $biochemistry_count = $last_count->biochemistry_count;
                                    $microbiology_count = $last_count->microbiology_count;
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
                                        'serology_count' => $investi_panch_test_count[$i]['Serology'],
                                        'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
                                        'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
                                                    ]);
                                    //echo "<pre>";
                                    //print_r($postPatientInvestPanchCountData);


                                    // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
                                    $this->db->where('create_date', $last_create_date);
                                    $res1 =  $this->db->update('investi_test_total_count_ipd', $postPatientInvestPanchCountData);

                                    //  print_r($this->db->last_query());
                                    //  die();
                                    if($res1)
                                    {
                                    print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {
                                    (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
                                    'serology_count' => $investi_panch_test_count[$i]['Serology'],
                                    'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
                                    'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
                                                ]);
                                    $res1 = $this->db->insert('investi_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                  //25
                                }
                            }
        }
        elseif($current_date > $last_create_date)
        {
        
            $index = 0;
            $Hematology = 0; $Serology = 0; $BioChemistry = 0; 
            $Microbiology = 0; 
            $Hematology_Test = 0; $Serology_Test = 0; $BioChemistry_Test = 0; 
            $Microbiology_Test = 0;


            $patients1 = $this->db->select("*")
            ->from('patient_ipd')
            ->join('department','department.dprt_id = patient_ipd.department_id')
            ->where('discharge_date >=', $last_create_date)
            ->where('create_date <=', $last_create_date)
            ->where('dignosis !=', '')
           // ->where('manual_status', '0')
            //->where('panchkamra','0')
            ->where('ipd_opd', 'ipd')
            ->get()
            ->result();
                
                //print_r('q1   ');
            //print_r($this->db->last_query());
        

            $patients2 = $this->db->select("*")
            ->from('patient_ipd')
            ->join('department','department.dprt_id = patient_ipd.department_id')
            ->where('create_date <=', $last_create_date)
            ->where('dignosis !=', '')
           // ->where('manual_status', '0')
           // ->where('panchkamra','0')
            ->where('discharge_date LIKE', '%0000-00-00%')
            ->where('ipd_opd', 'ipd')
            ->get()
            ->result();


            $patientList = array_merge($patients1, $patients2);


            foreach($patientList as $patient)
            {
              //echo "Push Date =================>".
				$startDate2=$patient->create_date;
              
             
                echo "<br>";
                $section_tret='ipd';
                    $che=trim($patient->dignosis);
                    $section_tret='ipd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                  if($patient->manual_status==0){
                                      if($patient->proxy_id){
                                     $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else
                                      {
                                      $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                      if(empty($tretment)){
                                      $tretment=$this->db->select("*")
                                      ->from('treatments1')
                                      ->where('department_id',$patient->department_id)
			                          ->where('ipd_opd',$patient->department_id)
                                     ->get()
                                     ->row();   
                                      }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                  }


                                        if($tretment)
                                        {
                                            if($tretment->HEMATOLOGICAL || $tretment->SEROLOGYCAL || $tretment->BIOCHEMICAL || $tretment->MICROBIOLOGICAL)
                                            {
                                                if($startDate2==date('Y-m-d',strtotime($last_create_date)))
                                                {
                                                    print_r("Investigation ==>==>==> ");
                                                    if($tretment->HEMATOLOGICAL){  
                                                        print_r('<br>');
                                                        print_r("Hematology");print_r(' ==>==>==>==> ');print_r($tretment->HEMATOLOGICAL);
                                                        $Hematology = $Hematology + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->HEMATOLOGICAL));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $Hematology_Test = $Hematology_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                // print_r($result);
                                                                print_r($p_dignosis);print_r("<br>");
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('investi_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                                    if($tretment->SEROLOGYCAL){
                                                        print_r("Serology");print_r(' ==>==>==>==> ');print_r($tretment->SEROLOGYCAL);
                                                        $Serology = $Serology + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->SEROLOGYCAL));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $Serology_Test = $Serology_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                if($ex[$i] == 'WIDAL TEST')
                                                                                {
                                                                                    $ex_random_val_wd20 = explode(',',trim($rs->WD_20));
                                                                                    $ex_random_val_wd40 = explode(',',trim($rs->WD_40));
                                                                                    $ex_random_val_wd80 = explode(',',trim($rs->WD_80));
                                                                                    $ex_random_val_wd160 = explode(',',trim($rs->WD_160));
                                                                                    $ex_random_val_wd320 = explode(',',trim($rs->WD_320));
                                                                                }
                                                                                else
                                                                                {
                                                                                    $ex_random_val = explode(',',trim($rs->random_value));
                                                                                }
                                                                            }
                                                                        }
                                                                        $rand_val_wd20 = array_rand($ex_random_val_wd20);
                                                                        $rand_val_wd40 = array_rand($ex_random_val_wd40);
                                                                        $rand_val_wd80 = array_rand($ex_random_val_wd80);
                                                                        $rand_val_wd160 = array_rand($ex_random_val_wd160);
                                                                        $rand_val_wd320 = array_rand($ex_random_val_wd320);

                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'WD_20_RESULT' =>$ex_random_val_wd20[$rand_val_wd20],
                                                                            'WD_40_RESULT' =>$ex_random_val_wd40[$rand_val_wd40],
                                                                            'WD_80_RESULT' =>$ex_random_val_wd80[$rand_val_wd80],
                                                                            'WD_160_RESULT' =>$ex_random_val_wd160[$rand_val_wd160],
                                                                            'WD_320_RESULT' =>$ex_random_val_wd320[$rand_val_wd320],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('investi_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                                    if($tretment->BIOCHEMICAL){
                                                        print_r("Bio-Chemistry");print_r(' ==>==>==>==> ');print_r($tretment->BIOCHEMICAL);
                                                        $BioChemistry = $BioChemistry + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->BIOCHEMICAL));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $BioChemistry_Test = $BioChemistry_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('investi_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                                    if($tretment->MICROBIOLOGICAL){
                                                        print_r("Microbiology");print_r(' ==>==>==>==> ');print_r($tretment->MICROBIOLOGICAL);
                                                        $Microbiology = $Microbiology + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->MICROBIOLOGICAL));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $Microbiology_Test = $Microbiology_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('investi_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                                }

                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'hematology' => ($tretment->HEMATOLOGICAL) ? $tretment->HEMATOLOGICAL : NULL,
                                                'serology' => ($tretment->SEROLOGYCAL) ? $tretment->SEROLOGYCAL : NULL,
                                                'biochemistry' => ($tretment->BIOCHEMICAL) ? $tretment->BIOCHEMICAL : NULL,
                                                'microbiology' => ($tretment->MICROBIOLOGICAL) ? $tretment->MICROBIOLOGICAL : NULL,
                                                            ]);
                                               // echo "<epr>";
                                                // print_r($postPatientInvestPanchData);
                                                  echo "<br>";
                                                //  die();
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('investi_patient_count_ipd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('investi_patient_count_ipd', $postPatientInvestPanchData);
                                                }
                                            
                                                
                                            }
                                            $data = array(
                                                'patho' => '1'
                                            );
                                            
                                            //$this->db->where('id', $patient->id);
                                            $this->db->where('create_date',$last_create_date);
                                            $this->db->update('patient_ipd', $data);
                                            //  print_r($this->db->last_query());
        
                                        }
   
                                    }                       
                        $investi_panch_count[$index] = [
                        'Hematology' => $Hematology,
                        'Serology' => $Serology,
                        'BioChemistry' => $BioChemistry,
                        'Microbiology' => $Microbiology,
                        ];
            //  echo "<pre>";
             // print_r($investi_panch_count);
              // die();
                    $investi_panch_test_count[$index] = [
                        'Hematology' => $Hematology_Test,
                        'Serology' => $Serology_Test,
                        'BioChemistry' => $BioChemistry_Test,
                        'Microbiology' => $Microbiology_Test,
                        ];
              
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count_opd_total = $this->db->select('*')->from('investi_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                              	//print_r($this->db->last_query());
                            //  die();
                              if($last_count_opd_total) 
                                {
                                    $hematology_count = $last_count_opd_total->hematology_count;
                                    $serology_count = $last_count_opd_total->serology_count;
                                    $biochemistry_count = $last_count_opd_total->biochemistry_count;
                                    $microbiology_count = $last_count_opd_total->microbiology_count;
                                  
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'hematology_count' => $investi_panch_count[$i]['Hematology'] + $hematology_count,
                                        'serology_count' => $investi_panch_count[$i]['Serology'] + $serology_count,
                                        'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'] + $biochemistry_count,
                                        'microbiology_count' => $investi_panch_count[$i]['Microbiology'] + $microbiology_count,
                                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('investi_total_count_ipd', $postPatientInvestPanchCountData);
                                    if($res)
                                    {
                                    print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'hematology_count' => $investi_panch_count[$i]['Hematology'],
                                    'serology_count' => $investi_panch_count[$i]['Serology'],
                                    'biochemistry_count' => $investi_panch_count[$i]['BioChemistry'],
                                    'microbiology_count' => $investi_panch_count[$i]['Microbiology'],
                                                ]);
                                    //echo "<pre>";
                                    //print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('investi_total_count_ipd', $postPatientInvestPanchCountData);
                                   // echo "<pre>";
                                    if($res)
                                    {
                                    print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                  //25
                                }






                                $last_count = $this->db->select('*')->from('investi_test_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                              	//print_r($this->db->last_query());
                            //  die();
                              if($last_count) 
                                {
                                    $hematology_countt = $last_count->hematology_count;
                                    $serology_count = $last_count->serology_count;
                                    $biochemistry_count = $last_count->biochemistry_count;
                                    $microbiology_count = $last_count->microbiology_count;
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
                                        'serology_count' => $investi_panch_test_count[$i]['Serology'],
                                        'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
                                        'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
                                                    ]);
                                    //echo "<pre>";
                                    //print_r($postPatientInvestPanchCountData);


                                    // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
                                    $this->db->where('create_date', $last_create_date);
                                    $res1 =  $this->db->update('investi_test_total_count_ipd', $postPatientInvestPanchCountData);

                                    //  print_r($this->db->last_query());
                                    //  die();
                                    if($res1)
                                    {
                                    print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {
                                    (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'hematology_count' => $investi_panch_test_count[$i]['Hematology'],
                                    'serology_count' => $investi_panch_test_count[$i]['Serology'],
                                    'biochemistry_count' => $investi_panch_test_count[$i]['BioChemistry'],
                                    'microbiology_count' => $investi_panch_test_count[$i]['Microbiology'],
                                                ]);
                                    $res1 = $this->db->insert('investi_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                                    }
                                  //25
                                }
                            }
        }

    }
  
  
//  public function panchUpdate()
//     {
//         error_reporting(0);
//         echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
//         date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
//         echo date('d-m-Y H:i:s');
//       	echo "<br>";
//         echo "<script>
//             $(document).ready(function () {
//                  setTimeout('location.reload(true);', '10000');
//             });
//         </script>";
        
//         ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//         /////////////////////////////////////                                                         /////////////////////////////////////
//         /////////////////////////////////////      OPD Investigation & Panchakarma Counting CODE      /////////////////////////////////////
//         /////////////////////////////////////                                                         /////////////////////////////////////
//         ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
//         $start_time= date('H:i',strtotime('18:15'));
//         $time_date=date('H:i');
//         $current_date = date('Y-m-d');
//         $last_date_res = 
//         $this->db->select('*')
//         ->where('ipd_opd', 'opd')
//         ->where('panchkamra','0')
//         //->where('year(create_date)','2023')
//         ->limit(1)
//         ->order_by('id','ASC')
//         ->get('patient')
//         ->row();
   
//       $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));

//       echo "Last Date OPD=================>".$last_create_date;
//       echo "<br>";
//       echo "Current Date OPD=================>".$current_date;
//       echo "<br>";
//       echo "Push Date OPD=================>".$last_create_date;
//       echo "<br>";
     
           
//      //$rand_limit_patient = rand(50,60);
//       if($last_create_date == $current_date)
//         {

           
        
//             $index = 0;
//             $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
//             $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
//             $Yonipichu = 0; $Other = 0;


//             $patientList =  
//               $this->db->select('*')
//               ->from('patient')
//               //->where('yearly_reg_no !=','')
//               ->where('panchkamra','0')
//               ->where('ipd_patient_flag','0')
//               ->where('dignosis !=','')
//               ->where('create_date',$last_create_date)
//               ->where('ipd_opd','opd')
//               ->order_by('id','ASC')
//               //->order_by('RAND()')
//               //->limit($rand_limit_patient)
//               ->get()
//               ->result();
//                     // print_r($this->db->last_query());
          
//             foreach($patientList as $patient)
//             {
//               //echo "Push Date =================>".
// 				$startDate3=$patient->create_date;
              
             
//               //echo "<br>";
//                     $section_tret='opd';
//                     $che=trim($patient->dignosis);
//                     $section_tret='opd';
//                     $len=strlen($che);
//                     $dd= substr($che,$len - 1);
//                     $str = $patient->dignosis;
//                     $arry=explode("-",$str);
//                     $t_c=count($arry);
//                     if($t_c=='2'){
//                         $dd1=substr($che, 0, -1);
//                         $new_str = trim($arry[0]);
//                         $p_dignosis = '%'.$new_str.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }else{
//                         $p_dignosis = '%'.$che.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                                     if($patient->manual_status==0){
//                                       if($patient->proxy_id){
//                                      $tretment=$this->db->select("*")
// 			                         ->from('treatments1')
//                                      ->where('dignosis LIKE',$p_dignosis)
//                                      ->where('proxy_id',$patient->proxy_id)
//                                      ->where('department_id',$patient->department_id)
// 			                         ->where('ipd_opd ',$section_tret)
//                                      ->get()
//                                      ->row();
//                                       }
//                                       else
//                                       {
//                                       $tretment=$this->db->select("*")
// 			                         ->from('treatments1')
//                                      ->where('dignosis LIKE',$p_dignosis)
//                                       ->where('department_id',$patient->department_id)
//                                      ->where('ipd_opd ',$section_tret)
//                                      ->get()
//                                      ->row();  
//                                       if(empty($tretment)){
//                                       $tretment=$this->db->select("*")
//                                       ->from('treatments1')
//                                       ->where('department_id',$patient->department_id)
// 			                          ->where('ipd_opd',$patient->department_id)
//                                      ->get()
//                                      ->row();   
//                                       }
//                                       }
//                                   }else{
//                                       $tretment=$this->db->select("*")
//                                       ->from('manual_treatments')
//                                      ->where('patient_id_auto',$patient->id)
// 			                         ->where('dignosis LIKE',$p_dignosis)
// 			                         ->where('ipd_opd ',$section_tret)
//                                      ->get()
//                                      ->row();
//                                   }
//                                       //  if($patient->yearly_reg_no)
//                                        // {
//                                             if($patient->department_id == '33' || $patient->department_id == '34' || $patient->department_id == '31')
//                                             {
//                                             if($tretment)
//                                             {
//                                                 if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
//                                                 {
//                                                     print_r("Panchakarma ==>==>==> ");
//                                                     if($tretment->SNEHAN){ 
//                                                     print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
//                                                     $Snehan = $Snehan + 1;
//                                                     }
//                                                     if($tretment->SWEDAN){ 
//                                                     print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
//                                                     $Swedan = $Swedan + 1;
//                                                     }
//                                                     if($tretment->VAMAN){ 
//                                                     print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
//                                                     $Vaman = $Vaman + 1;
//                                                     }
//                                                     if($tretment->VIRECHAN){ 
//                                                     print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
//                                                     $Virechan = $Virechan + 1;
//                                                     }
//                                                     if($tretment->NASYA){ 
//                                                     print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
//                                                     $Nasya = $Nasya + 1;
//                                                     }
//                                                     if($tretment->RAKTAMOKSHAN){ 
//                                                     print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
//                                                     $Raktmokshan = $Raktmokshan + 1;
//                                                     }
//                                                     if($tretment->SHIRODHARA_SHIROBASTI){ 
//                                                     print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
//                                                     $Shirodhara = $Shirodhara + 1;
//                                                     }
//                                                     if($tretment->SHIROBASTI){ 
//                                                     print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
//                                                     $Shirobasti = $Shirobasti + 1;
//                                                     }
//                                                     if($tretment->UTTARBASTI){ 
//                                                     print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
//                                                     $Uttarbasti = $Uttarbasti + 1;
//                                                     }
//                                                     if($tretment->BASTI){ 
//                                                     print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
//                                                     $Basti = $Basti + 1;
//                                                     }
//                                                     if($tretment->YONIDHAVAN){ 
//                                                     print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
//                                                     $Yonidhavan = $Yonidhavan + 1;
//                                                     }
//                                                     if($tretment->YONIPICHU){ 
//                                                     print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
//                                                     $Yonipichu = $Yonipichu + 1;
//                                                     }
//                                                     if($tretment->OTHER){ 
//                                                     print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
//                                                     $Other = $Other + 1;
//                                                     }


//                                                     (object)$postPatientInvestPanchData = ([
//                                                     'patient_auto_id' => $patient->id,
//                                                     'patient_name' => $patient->firstname,
//                                                     'ipd_opd' => $patient->ipd_opd,
//                                                     'sex' => $patient->sex,
//                                                     'create_date' => $patient->create_date,
//                                                     'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
//                                                     'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
//                                                     'vaman' => ($tretment->VAMAN) ? $tretment->VAMAN : NULL,
//                                                     'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
//                                                     'nasya' => ($tretment->NASYA) ? $tretment->NASYA : NULL,
//                                                     'raktmokshan' => ($tretment->RAKTAMOKSHAN) ? $tretment->RAKTAMOKSHAN : NULL,
//                                                     'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
//                                                     'shirobasti' => ($tretment->SHIROBASTI) ? $tretment->SHIROBASTI : NULL,
//                                                     'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
//                                                     'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
//                                                     'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
//                                                     'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
//                                                     'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
//                                                     ]);
//                                                     //echo "<br>";
//                                                     // print_r($postPatientInvestPanchData);
//                                                     //  echo "<br>";
//                                                     $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('panchkarma_patient_count_opd')->num_rows();
//                                                     if($searchRes == 0)
//                                                     {
//                                                     $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                                     }
                                                
//                                                 }
                                            
//                                             }  
//                                             }
//                                        // }
//                                             $data = array(
//                                                 'panchkamra' => '1'
//                                             );
                                            
//                                             $this->db->where('create_date',$last_create_date);
//               								$this->db->or_where('ipd_patient_flag','1');
//                                             $this->db->update('patient', $data);
//                                             //  print_r($this->db->last_query());
        
                                        
   
//                                     }                       
//                     $investi_panch_count[$index] = [
//                         'Snehan' => $Snehan,
//                         'Swedan' => $Swedan,
//                         'Vaman' => $Vaman,
//                         'Virechan' => $Virechan,
//                         'Nasya' => $Nasya,
//                         'Raktmokshan' => $Raktmokshan,
//                         'Shirodhara' => $Shirodhara,
//                         'Shirobasti' => $Shirobasti,
//                         'Uttarbasti' => $Uttarbasti,
//                         'Basti' => $Basti,
//                         'Yonidhavan' => $Yonidhavan,
//                         'Yonipichu' => $Yonipichu,
//                         'Other' => $Other,
//                     ];
//             //  echo "<pre>";
//              // print_r($investi_panch_count);
//               // die();
//                     $investi_panch_test_count[$index] = [
//                         'Snehan' => $Snehan,
//                         'Swedan' => $Swedan,
//                         'Vaman' => $Vaman,
//                         'Virechan' => $Virechan,
//                         'Nasya' => $Nasya,
//                         'Raktmokshan' => $Raktmokshan,
//                         'Shirodhara' => $Shirodhara,
//                         'Shirobasti' => $Shirobasti,
//                         'Uttarbasti' => $Uttarbasti,
//                         'Basti' => $Basti,
//                         'Yonidhavan' => $Yonidhavan,
//                         'Yonipichu' => $Yonipichu,
//                         'Other' => $Other,
//                     ];
              
//                     $index = $index + 1;
//                     print_r($investi_panch_count);print_r("<br>");
//                     print_r($investi_panch_test_count);print_r("<br>");

//                             for($i=0; $i<count($investi_panch_count);$i++)
//                             {
//                                 $last_count = $this->db->select('*')->from('panchkarma_total_count_opd')->where('create_date',$last_create_date)->get()->row();
//                               //	print_r($this->db->last_query());
//                             //  die();
//                               if($last_count) 
//                                 {
                             
//                                     $snehan_count = $last_count->snehan_count;
//                                     $swedan_count = $last_count->swedan_count;
//                                     $vaman_count = $last_count->vaman_count;
//                                     $virechan_count = $last_count->virechan_count;
//                                     $nasya_count = $last_count->nasya_count;
//                                     $raktmokshan_count = $last_count->raktmokshan_count;
//                                     $shirodhara_count = $last_count->shirodhara_count;
//                                     $shirobasti_count = $last_count->shirobasti_count;
//                                     $uttarbasti_count = $last_count->uttarbasti_count;
//                                     $basti_count = $last_count->basti_count;
//                                     $yonidhavan_count = $last_count->yonidhavan_count;
//                                     $yonipichu_count = $last_count->yonipichu_count;
//                                     $others_count = $last_count->others_count;
                                  

//                                     (object)$postPatientInvestPanchCountData = ([
//                                     'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
//                                     'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
//                                     'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
//                                     'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
//                                     'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
//                                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
//                                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
//                                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
//                                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
//                                     'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
//                                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
//                                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
//                                     'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
//                                     ]);
//                                     echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);

//                                     $this->db->where('create_date', $last_create_date);
//                                     $res =  $this->db->update('panchkarma_total_count_opd', $postPatientInvestPanchCountData);

//                                     // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
//                                     $this->db->where('create_date', $last_create_date);
//                                     $res1 =  $this->db->update('panchkarma_test_total_count_opd', $postPatientInvestPanchCountData);

//                                     //  print_r($this->db->last_query());
//                                     //  die();
//                                     if($res && $res1)
//                                     {
//                                     print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
//                                     }
//                                 }   
//                                 else
//                                 {

//                                     (object)$postPatientInvestPanchCountData = ([
//                                     'ipd_opd' => 'opd',
//                                     'create_date' => $last_create_date,
//                                     'snehan_count' => $investi_panch_count[$i]['Snehan'],
//                                     'swedan_count' => $investi_panch_count[$i]['Swedan'],
//                                     'vaman_count' => $investi_panch_count[$i]['Vaman'],
//                                     'virechan_count' => $investi_panch_count[$i]['Virechan'],
//                                     'nasya_count' => $investi_panch_count[$i]['Nasya'],
//                                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
//                                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
//                                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
//                                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
//                                     'basti_count' => $investi_panch_count[$i]['Basti'],
//                                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
//                                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
//                                     'others_count' => $investi_panch_count[$i]['Other'],
//                                     ]);

//                                     echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);

//                                     $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);
//                                     echo "<pre>";
//                                     ///   print_r($this->db->last_query());
//                                     //   die();
//                                     (object)$postPatientInvestPanchTestCountData = ([
//                                    'ipd_opd' => 'opd',
//                                     'create_date' => $last_create_date,
//                                     'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
//                                     'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
//                                     'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
//                                     'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
//                                     'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
//                                     'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
//                                     'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
//                                     'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
//                                     'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
//                                     'basti_count' => $investi_panch_test_count[$i]['Basti'],
//                                     'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
//                                     'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
//                                     'others_count' => $investi_panch_test_count[$i]['Other'],
//                                     ]);
//                                     $res1 = $this->db->insert('panchkarma_test_total_count_opd', $postPatientInvestPanchTestCountData);
//                                     if($res && $res1)
//                                     {
//                                     print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
//                                     }
//                                   //25
//                                 }
//                             }
      
//         }
//         elseif($current_date > $last_create_date)
//         {

//             // echo "hoooooooooooooooooo";
        
//             $index = 0;
//             $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
//             $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
//             $Yonipichu = 0; $Other = 0;


//             $patientList =  
//               $this->db->select('*')
//               ->from('patient')
//               //->where('yearly_reg_no !=','')
//               ->where('panchkamra','0')
//               ->where('ipd_patient_flag','0')
//               ->where('dignosis !=','')
//               ->where('create_date',$last_create_date)
//               ->where('ipd_opd','opd')
//               ->order_by('id','ASC')
//               //->order_by('RAND()')
//               //->limit($rand_limit_patient)
//               ->get()
//               ->result();
//                     // print_r($this->db->last_query());
          
//             foreach($patientList as $patient)
//             {
//               //echo "Push Date =================>".
// 				$startDate3=$patient->create_date;
              
             
//               //echo "<br>";
//                     $section_tret='opd';
//                     $che=trim($patient->dignosis);
//                     $section_tret='opd';
//                     $len=strlen($che);
//                     $dd= substr($che,$len - 1);
//                     $str = $patient->dignosis;
//                     $arry=explode("-",$str);
//                     $t_c=count($arry);
//                     if($t_c=='2'){
//                         $dd1=substr($che, 0, -1);
//                         $new_str = trim($arry[0]);
//                         $p_dignosis = '%'.$new_str.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }else{
//                         $p_dignosis = '%'.$che.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                                     if($patient->manual_status==0){
//                                       if($patient->proxy_id){
//                                      $tretment=$this->db->select("*")
// 			                         ->from('treatments1')
//                                      ->where('dignosis LIKE',$p_dignosis)
//                                      ->where('proxy_id',$patient->proxy_id)
//                                      ->where('department_id',$patient->department_id)
// 			                         ->where('ipd_opd ',$section_tret)
//                                      ->get()
//                                      ->row();
//                                       }
//                                       else
//                                       {
//                                       $tretment=$this->db->select("*")
// 			                         ->from('treatments1')
//                                      ->where('dignosis LIKE',$p_dignosis)
//                                       ->where('department_id',$patient->department_id)
//                                      ->where('ipd_opd ',$section_tret)
//                                      ->get()
//                                      ->row();  
//                                       if(empty($tretment)){
//                                       $tretment=$this->db->select("*")
//                                       ->from('treatments1')
//                                       ->where('department_id',$patient->department_id)
// 			                          ->where('ipd_opd',$patient->department_id)
//                                      ->get()
//                                      ->row();   
//                                       }
//                                       }
//                                   }else{
//                                       $tretment=$this->db->select("*")
//                                       ->from('manual_treatments')
//                                      ->where('patient_id_auto',$patient->id)
// 			                         ->where('dignosis LIKE',$p_dignosis)
// 			                         ->where('ipd_opd ',$section_tret)
//                                      ->get()
//                                      ->row();
//                                   }
//                                         //  if($patient->yearly_reg_no)
//                                         //    {

//                                             if($patient->department_id == '33' || $patient->department_id == '34' || $patient->department_id == '31')
//                                             {
//                                                 if($tretment)
//                                                 {
//                                                     if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
//                                                     {
//                                                         print_r("Panchakarma ==>==>==> ");
//                                                         if($tretment->SNEHAN){ 
//                                                         print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
//                                                         $Snehan = $Snehan + 1;
//                                                         }
//                                                         if($tretment->SWEDAN){ 
//                                                         print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
//                                                         $Swedan = $Swedan + 1;
//                                                         }
//                                                         if($tretment->VAMAN){ 
//                                                         print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
//                                                         $Vaman = $Vaman + 1;
//                                                         }
//                                                         if($tretment->VIRECHAN){ 
//                                                         print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
//                                                         $Virechan = $Virechan + 1;
//                                                         }
//                                                         if($tretment->NASYA){ 
//                                                         print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
//                                                         $Nasya = $Nasya + 1;
//                                                         }
//                                                         if($tretment->RAKTAMOKSHAN){ 
//                                                         print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
//                                                         $Raktmokshan = $Raktmokshan + 1;
//                                                         }
//                                                         if($tretment->SHIRODHARA_SHIROBASTI){ 
//                                                         print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
//                                                         $Shirodhara = $Shirodhara + 1;
//                                                         }
//                                                         if($tretment->SHIROBASTI){ 
//                                                         print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
//                                                         $Shirobasti = $Shirobasti + 1;
//                                                         }
//                                                         if($tretment->UTTARBASTI){ 
//                                                         print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
//                                                         $Uttarbasti = $Uttarbasti + 1;
//                                                         }
//                                                         if($tretment->BASTI){ 
//                                                         print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
//                                                         $Basti = $Basti + 1;
//                                                         }
//                                                         if($tretment->YONIDHAVAN){ 
//                                                         print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
//                                                         $Yonidhavan = $Yonidhavan + 1;
//                                                         }
//                                                         if($tretment->YONIPICHU){ 
//                                                         print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
//                                                         $Yonipichu = $Yonipichu + 1;
//                                                         }
//                                                         if($tretment->OTHER){ 
//                                                         print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
//                                                         $Other = $Other + 1;
//                                                         }


//                                                         (object)$postPatientInvestPanchData = ([
//                                                         'patient_auto_id' => $patient->id,
//                                                         'patient_name' => $patient->firstname,
//                                                         'ipd_opd' => $patient->ipd_opd,
//                                                         'sex' => $patient->sex,
//                                                         'create_date' => $patient->create_date,
//                                                         'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
//                                                         'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
//                                                         'vaman' => ($tretment->VAMAN) ? $tretment->VAMAN : NULL,
//                                                         'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
//                                                         'nasya' => ($tretment->NASYA) ? $tretment->NASYA : NULL,
//                                                         'raktmokshan' => ($tretment->RAKTAMOKSHAN) ? $tretment->RAKTAMOKSHAN : NULL,
//                                                         'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
//                                                         'shirobasti' => ($tretment->SHIROBASTI) ? $tretment->SHIROBASTI : NULL,
//                                                         'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
//                                                         'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
//                                                         'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
//                                                         'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
//                                                         'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
//                                                         ]);
//                                                         //echo "<br>";
//                                                         // print_r($postPatientInvestPanchData);
//                                                         //  echo "<br>";
//                                                         $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('panchkarma_patient_count_opd')->num_rows();
//                                                         if($searchRes == 0)
//                                                         {
//                                                         $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                                         }
                                                    
//                                                     }
                                                
//                                                 }  
//                                             }
//                                         //     }
//                                             $data = array(
//                                                 'panchkamra' => '1'
//                                             );
                                            
//                                             $this->db->where('create_date',$last_create_date);
//               								$this->db->or_where('ipd_patient_flag','1');
//                                             $this->db->update('patient', $data);
//                                             //  print_r($this->db->last_query());
        
                                        
   
//                                     }                       
//                     $investi_panch_count[$index] = [
//                         'Snehan' => $Snehan,
//                         'Swedan' => $Swedan,
//                         'Vaman' => $Vaman,
//                         'Virechan' => $Virechan,
//                         'Nasya' => $Nasya,
//                         'Raktmokshan' => $Raktmokshan,
//                         'Shirodhara' => $Shirodhara,
//                         'Shirobasti' => $Shirobasti,
//                         'Uttarbasti' => $Uttarbasti,
//                         'Basti' => $Basti,
//                         'Yonidhavan' => $Yonidhavan,
//                         'Yonipichu' => $Yonipichu,
//                         'Other' => $Other,
//                     ];
           
//                     $investi_panch_test_count[$index] = [
//                             'Snehan' => $Snehan,
//                             'Swedan' => $Swedan,
//                             'Vaman' => $Vaman,
//                             'Virechan' => $Virechan,
//                             'Nasya' => $Nasya,
//                             'Raktmokshan' => $Raktmokshan,
//                             'Shirodhara' => $Shirodhara,
//                             'Shirobasti' => $Shirobasti,
//                             'Uttarbasti' => $Uttarbasti,
//                             'Basti' => $Basti,
//                             'Yonidhavan' => $Yonidhavan,
//                             'Yonipichu' => $Yonipichu,
//                             'Other' => $Other,
//                     ];
              
//                     $index = $index + 1;
//                     print_r($investi_panch_count);print_r("<br>");
//                     print_r($investi_panch_test_count);print_r("<br>");

//                             for($i=0; $i<count($investi_panch_count);$i++)
//                             {
//                                 $last_count = $this->db->select('*')->from('panchkarma_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                             
//                               if($last_count) 
//                                 {
                             
//                                     $snehan_count = $last_count->snehan_count;
//                                     $swedan_count = $last_count->swedan_count;
//                                     $vaman_count = $last_count->vaman_count;
//                                     $virechan_count = $last_count->virechan_count;
//                                     $nasya_count = $last_count->nasya_count;
//                                     $raktmokshan_count = $last_count->raktmokshan_count;
//                                     $shirodhara_count = $last_count->shirodhara_count;
//                                     $shirobasti_count = $last_count->shirobasti_count;
//                                     $uttarbasti_count = $last_count->uttarbasti_count;
//                                     $basti_count = $last_count->basti_count;
//                                     $yonidhavan_count = $last_count->yonidhavan_count;
//                                     $yonipichu_count = $last_count->yonipichu_count;
//                                     $others_count = $last_count->others_count;
                                  

//                                     (object)$postPatientInvestPanchCountData = ([
//                                     'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
//                                     'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
//                                     'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
//                                     'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
//                                     'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
//                                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
//                                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
//                                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
//                                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
//                                     'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
//                                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
//                                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
//                                     'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
//                                     ]);
//                                     echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);

//                                     $this->db->where('create_date', $last_create_date);
//                                     $res =  $this->db->update('panchkarma_total_count_opd', $postPatientInvestPanchCountData);

//                                     // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
//                                     $this->db->where('create_date', $last_create_date);
//                                     $res1 =  $this->db->update('panchkarma_test_total_count_opd', $postPatientInvestPanchCountData);

                                   
//                                     if($res && $res1)
//                                     {
//                                     print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
//                                     }
//                                 }   
//                                 else
//                                 {

//                                     (object)$postPatientInvestPanchCountData = ([
//                                     'ipd_opd' => 'opd',
//                                     'create_date' => $last_create_date,
//                                     'snehan_count' => $investi_panch_count[$i]['Snehan'],
//                                     'swedan_count' => $investi_panch_count[$i]['Swedan'],
//                                     'vaman_count' => $investi_panch_count[$i]['Vaman'],
//                                     'virechan_count' => $investi_panch_count[$i]['Virechan'],
//                                     'nasya_count' => $investi_panch_count[$i]['Nasya'],
//                                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
//                                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
//                                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
//                                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
//                                     'basti_count' => $investi_panch_count[$i]['Basti'],
//                                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
//                                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
//                                     'others_count' => $investi_panch_count[$i]['Other'],
//                                     ]);

//                                     echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);

//                                     $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);
//                                     echo "<pre>";
                                    
//                                     (object)$postPatientInvestPanchTestCountData = ([
//                                    'ipd_opd' => 'opd',
//                                     'create_date' => $last_create_date,
//                                     'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
//                                     'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
//                                     'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
//                                     'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
//                                     'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
//                                     'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
//                                     'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
//                                     'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
//                                     'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
//                                     'basti_count' => $investi_panch_test_count[$i]['Basti'],
//                                     'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
//                                     'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
//                                     'others_count' => $investi_panch_test_count[$i]['Other'],
//                                     ]);
//                                     $res1 = $this->db->insert('panchkarma_test_total_count_opd', $postPatientInvestPanchTestCountData);
//                                     if($res && $res1)
//                                     {
//                                     print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
//                                     }
//                                   //25
//                                 }
//                             }
      
//         }
//       //die();

//         ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//         /////////////////////////////////////                                                         /////////////////////////////////////
//         /////////////////////////////////////      IPD Investigation & Panchakarma Counting CODE      /////////////////////////////////////
//         /////////////////////////////////////                                                         /////////////////////////////////////
//         /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 

//         $start_time= date('H:i',strtotime('18:15'));
//         $time_date=date('H:i');
//         $current_date = date('Y-m-d');
//         $last_date_res = 
//         $this->db->select('*')
//         ->where('ipd_opd', 'ipd')
//         ->where('panchkamra','0')
//         //->where('year(create_date)','2023')
//         ->limit(1)
//         ->order_by('id','ASC')
//         ->get('patient_ipd')
//         ->row();
//      // print_r($this->db->last_query());
//      echo "<br>";
//        $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));
    
// 		echo "<br><br><br><br>";
//       echo "Last Date IPD=================>".$last_create_date;
//       echo "<br>";
//       echo "Current Date IPD=================>".$current_date;
//       echo "<br>";
//       echo "Push Date IPD=================>".$last_create_date;
//       echo "<br>";

//       if($last_create_date == $current_date)
//       {
//         $index = 0;
//         $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
//         $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
//         $Yonipichu = 0; $Other = 0;
//         //   echo "hiiiiiii";
 
        
//         $patients1 = $this->db->select("*")
//                     ->from('patient_ipd')
//                     ->join('department','department.dprt_id = patient_ipd.department_id')
//                     ->where('discharge_date >=', $last_create_date)
//                     ->where('create_date <=', $last_create_date)
//                     ->where('dignosis !=', '')
//                     ->where('ipd_opd', 'ipd')
//                     ->get()
//                     ->result();

//                 $patients2 = $this->db->select("*")
//                     ->from('patient_ipd')
//                     ->join('department','department.dprt_id = patient_ipd.department_id')
//                     ->where('create_date <=', $last_create_date)
//                     ->where('dignosis !=', '')
//                     ->where('discharge_date LIKE', '%0000-00-00%')
//                     ->where('ipd_opd', 'ipd')
//                     ->get()
//                     ->result();
                
//                 //print_r('q2   ');                    
               
        
//                 $patientList = array_merge($patients1, $patients2);
//                     foreach($patientList as $patient)
//                     {
                     


//                         //echo "Push Date =================>".
//                         $startDate2=$patient->create_date;
//                         echo "<br>";
//                         $section_tret='ipd';
//                         $che=trim($patient->dignosis);
//                         $section_tret='ipd';
//                         $len=strlen($che);
//                         $dd= substr($che,$len - 1);
//                         $str = $patient->dignosis;
//                         $arry=explode("-",$str);
//                         $t_c=count($arry);
//                         if($t_c=='2')
//                         {
//                             $dd1=substr($che, 0, -1);
//                             $new_str = trim($arry[0]);
//                             $p_dignosis = '%'.$new_str.'%';
//                             $p_dignosis_name=$patient->dignosis;
//                         }else{
//                             $p_dignosis = '%'.$che.'%';
//                             $p_dignosis_name=$patient->dignosis;
//                         }

//                         if($patient->manual_status==0){
//                         if($patient->proxy_id){
//                         $tretment=$this->db->select("*")
//                         ->from('treatments1')
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('proxy_id',$patient->proxy_id)
//                         ->where('department_id',$patient->department_id)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();
//                         }
//                         else
//                         {
//                         $tretment=$this->db->select("*")
//                         ->from('treatments1')
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('department_id',$patient->department_id)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();  
//                         if(empty($tretment)){
//                         $tretment=$this->db->select("*")
//                         ->from('treatments1')
//                         ->where('department_id',$patient->department_id)
//                         ->where('ipd_opd',$patient->department_id)
//                         ->get()
//                         ->row();   
//                         }
//                         }
//                         }else{
//                         $tretment=$this->db->select("*")
//                         ->from('manual_treatments')
//                         ->where('patient_id_auto',$patient->id)
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();
//                         }
//                         //  echo "<pre>";
                     

//                         if($tretment)
//                         {
//                             if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
//                             {

//                             echo 'Patient create Date ====>'.$admit_date=date("Y-m-d",strtotime($patient->create_date));
//                            // echo "<br><br><br><br><br>";
//                             $admit_v_date=strtotime($patient->create_date);
//                           //  echo "<br><br><br><br><br>";
//                             $vaman_date=strtotime("+6 days",$admit_v_date); 
//                            // echo "<br><br><br><br><br>";
//                             echo 'Vaman Date ====>'.$vaman_virachan_date = date("Y-m-d",$vaman_date);
//                            // echo "<br><br><br><br><br>";                           
//                             $shirobasti_date=strtotime("+1 days",$admit_v_date); 
//                            // echo "<br><br><br><br><br>";
//                             echo 'Shirobasti Date ====>'.$shirobasti_final_date = date("Y-m-d",$shirobasti_date);
//                           //  echo "<br><br><br><br><br>";
//                             echo 'Fibal Push Date ===>'.$push_final_date = date('Y-m-d',strtotime($last_create_date));
//                            // echo "<br><br><br><br><br>";                        
                            
                          
                            
//                             $date1=date_create($admit_date);
//                             $date2=date_create($last_create_date);
//                             $diff=date_diff($date1,$date2);
//                             $diffDay = $diff->format("%a");
//                             $shirobastiCheck = ($diffDay % 2);


//                                 print_r("Panchakarma ==>==>==> ");
//                             if($tretment->SNEHAN){ 
//                                 print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
//                                 $Snehan = $Snehan + 1;
//                             }
//                             if($tretment->SWEDAN){ 
//                                 print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
//                                 $Swedan = $Swedan + 1;
//                             }
                            
                            
//                             if($tretment->VAMAN && $vaman_virachan_date == $push_final_date){ 
//                                 print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
//                                 $Vaman = $Vaman + 1;
//                             }
                            
//                          //   die();
//                             if($tretment->VIRECHAN){ 
//                                 print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
//                                 $Virechan = $Virechan + 1;
//                             }
//                             if($tretment->NASYA && $admit_date == $push_final_date){ 
//                                 print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
//                                 $Nasya = $Nasya + 1;
//                             }
//                             if($tretment->RAKTAMOKSHAN && $admit_date == $push_final_date){ 
//                                 print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
//                                 $Raktmokshan = $Raktmokshan + 1;
//                             }
//                             if($tretment->SHIRODHARA_SHIROBASTI){ 
//                                 print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
//                                 $Shirodhara = $Shirodhara + 1;
//                             }
//                             if($tretment->SHIROBASTI && $shirobasti_final_date == $push_final_date){ 
//                                 print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
//                                 $Shirobasti = $Shirobasti + 1;
//                             }
//                             if($tretment->UTTARBASTI){ 
//                                 print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
//                                 $Uttarbasti = $Uttarbasti + 1;
//                             }
//                             if($tretment->BASTI){ 
//                                 print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
//                                 $Basti = $Basti + 1;
//                             }
//                             if($tretment->YONIDHAVAN){ 
//                                 print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
//                                 $Yonidhavan = $Yonidhavan + 1;
//                             }
//                             if($tretment->YONIPICHU){ 
//                                 print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
//                                 $Yonipichu = $Yonipichu + 1;
//                             }
//                             if($tretment->OTHER){ 
//                                 print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
//                                 $Other = $Other + 1;
//                             }
                            

//                             (object)$postPatientInvestPanchData = ([
//                                 'patient_auto_id' => $patient->id,
//                                 'patient_name' => $patient->firstname,
//                                 'ipd_opd' => $patient->ipd_opd,
//                                 'sex' => $patient->sex,
//                                 'create_date' => $last_create_date,
//                                 'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
//                                 'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
//                                 'vaman' => ($vaman_virachan_date == $push_final_date) ? $tretment->VAMAN : NULL,
//                                 'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
//                                 'nasya' => ($admit_date == $push_final_date) ? $tretment->NASYA : NULL,
//                                 'raktmokshan' => ($admit_date == $push_final_date) ? $tretment->RAKTAMOKSHAN : NULL,
//                                 'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
//                                 'shirobasti' => ($shirobasti_final_date == $push_final_date) ? $tretment->SHIROBASTI : NULL,
//                                 'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
//                                 'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
//                                 'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
//                                 'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
//                                 'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
//                                 ]);
                                
//                                     $updateRes = $this->db->insert('panchkarma_patient_count_ipd', $postPatientInvestPanchData);
//                             }
//                             $data = array(
//                             'panchkamra' => '1'
//                             );
//                             $this->db->where('create_date',$last_create_date);
//                             $this->db->update('patient_ipd', $data);
//                               print_r($this->db->last_query());
                         
//                         }
//                     }  
                    
                    
//                     $investi_panch_count[$index] = [
//                         'Snehan' => $Snehan,
//                         'Swedan' => $Swedan,
//                         'Vaman' => $Vaman,
//                         'Virechan' => $Virechan,
//                         'Nasya' => $Nasya,
//                         'Raktmokshan' => $Raktmokshan,
//                         'Shirodhara' => $Shirodhara,
//                         'Shirobasti' => $Shirobasti,
//                         'Uttarbasti' => $Uttarbasti,
//                         'Basti' => $Basti,
//                         'Yonidhavan' => $Yonidhavan,
//                         'Yonipichu' => $Yonipichu,
//                         'Other' => $Other,
//                     ];
             
//                     $investi_panch_test_count[$index] = [
//                         'Snehan' => $Snehan,
//                         'Swedan' => $Swedan,
//                         'Vaman' => $Vaman,
//                         'Virechan' => $Virechan,
//                         'Nasya' => $Nasya,
//                         'Raktmokshan' => $Raktmokshan,
//                         'Shirodhara' => $Shirodhara,
//                         'Shirobasti' => $Shirobasti,
//                         'Uttarbasti' => $Uttarbasti,
//                         'Basti' => $Basti,
//                         'Yonidhavan' => $Yonidhavan,
//                         'Yonipichu' => $Yonipichu,
//                         'Other' => $Other,
//                     ];
        
        
        
              
//                     $index = $index + 1;
//                     print_r($investi_panch_count);print_r("<br>");
//                     print_r($investi_panch_test_count);print_r("<br>");

//                             for($i=0; $i<count($investi_panch_count);$i++)
//                             {
//                                 $last_count = $this->db->select('*')->from('panchkarma_total_count_ipd')->where('create_date',$startDate2)->get()->row();
//                               if($last_count){
                                
//                                     $snehan_count = $last_count->snehan_count;
//                                     $swedan_count = $last_count->swedan_count;
//                                     $vaman_count = $last_count->vaman_count;
//                                     $virechan_count = $last_count->virechan_count;
//                                     $nasya_count = $last_count->nasya_count;
//                                     $raktmokshan_count = $last_count->raktmokshan_count;
//                                     $shirodhara_count = $last_count->shirodhara_count;
//                                     $shirobasti_count = $last_count->shirobasti_count;
//                                     $uttarbasti_count = $last_count->uttarbasti_count;
//                                     $basti_count = $last_count->basti_count;
//                                     $yonidhavan_count = $last_count->yonidhavan_count;
//                                     $yonipichu_count = $last_count->yonipichu_count;
//                                     $others_count = $last_count->others_count;
                                  
//                                     (object)$postPatientInvestPanchCountData = ([
//                                     'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
//                                     'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
//                                     'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
//                                     'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
//                                     'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
//                                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
//                                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
//                                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
//                                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
//                                     'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
//                                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
//                                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
//                                     'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
//                                     ]);
//                                     echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);

//                                     $this->db->where('create_date', $startDate2);
//                                     $res =  $this->db->update('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);

//                                     $this->db->where('create_date', $startDate2);
//                                     $res1 =  $this->db->update('panchkarma_test_total_count_ipd', $postPatientInvestPanchCountData);

//                                 //     //  print_r($this->db->last_query());
//                                 //     //  die();
//                                   if($res && $res1)
//                                   {
//                                   print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
//                                   }
//                                  }   
//                                  else
//                                  {

//                                     (object)$postPatientInvestPanchCountData = ([
//                                   'ipd_opd' => 'ipd',
//                                     'create_date' => $startDate2,
//                                     'snehan_count' => $investi_panch_count[$i]['Snehan'],
//                                     'swedan_count' => $investi_panch_count[$i]['Swedan'],
//                                     'vaman_count' => $investi_panch_count[$i]['Vaman'],
//                                     'virechan_count' => $investi_panch_count[$i]['Virechan'],
//                                     'nasya_count' => $investi_panch_count[$i]['Nasya'],
//                                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
//                                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
//                                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
//                                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
//                                     'basti_count' => $investi_panch_count[$i]['Basti'],
//                                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
//                                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
//                                     'others_count' => $investi_panch_count[$i]['Other'],
//                                     ]);

//                                     echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);

//                                     $res = $this->db->insert('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);
//                                     echo "<pre>";
//                                     ///   print_r($this->db->last_query());
//                                     //   die();
//                                     (object)$postPatientInvestPanchTestCountData = ([
//                                     'ipd_opd' => 'ipd',
//                                     'create_date' => $startDate2,
//                                     'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
//                                     'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
//                                     'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
//                                     'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
//                                     'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
//                                     'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
//                                     'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
//                                     'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
//                                     'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
//                                     'basti_count' => $investi_panch_test_count[$i]['Basti'],
//                                     'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
//                                     'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
//                                     'others_count' => $investi_panch_test_count[$i]['Other'],
//                                     ]);
//                                echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);
//                                     $res1 = $this->db->insert('panchkarma_test_total_count_ipd', $postPatientInvestPanchTestCountData);
//                                     if($res && $res1)
//                                     {
//                                     print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
//                                     }
//                                   //25
//                                 }
//                             }
//       }
//       elseif($current_date > $last_create_date)
//       {
//         $index = 0;
//         $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
//         $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
//         $Yonipichu = 0; $Other = 0;
//         //   echo "hiiiiiii";
 
        
//         $patients1 = $this->db->select("*")
//                     ->from('patient_ipd')
//                     ->join('department','department.dprt_id = patient_ipd.department_id')
//                     ->where('discharge_date >=', $last_create_date)
//                     ->where('create_date <=', $last_create_date)
//                     ->where('dignosis !=', '')
//                     //->where('manual_status', '0')
//                     //->where('panchkamra','0')
//                     ->where('ipd_opd', 'ipd')
//                     ->get()
//                     ->result();
                        
//                 //print_r('q1   ');
//               //print_r($this->db->last_query());
                
        
//                 $patients2 = $this->db->select("*")
//                     ->from('patient_ipd')
//                     ->join('department','department.dprt_id = patient_ipd.department_id')
//                     ->where('create_date <=', $last_create_date)
//                     ->where('dignosis !=', '')
//                   //  ->where('manual_status', '0')
//                    // ->where('panchkamra','0')
//                     ->where('discharge_date LIKE', '%0000-00-00%')
//                     ->where('ipd_opd', 'ipd')
//                     ->get()
//                     ->result();
                
//                 //print_r('q2   ');                    
               
        
//                 $patientList = array_merge($patients1, $patients2);
//                     foreach($patientList as $patient)
//                     {
//                         // print_r($patient->firstname);
//                         //  die();
//                         //echo "Push Date =================>".
//                         $startDate2=$patient->create_date;
//                         echo "<br>";
//                         $section_tret='ipd';
//                         $che=trim($patient->dignosis);
//                         $section_tret='ipd';
//                         $len=strlen($che);
//                         $dd= substr($che,$len - 1);
//                         $str = $patient->dignosis;
//                         $arry=explode("-",$str);
//                         $t_c=count($arry);
//                         if($t_c=='2'){
//                         $dd1=substr($che, 0, -1);
//                         $new_str = trim($arry[0]);
//                         $p_dignosis = '%'.$new_str.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                         }else{
//                         $p_dignosis = '%'.$che.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                         }
//                         if($patient->manual_status==0){
//                         if($patient->proxy_id){
//                         $tretment=$this->db->select("*")
//                         ->from('treatments1')
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('proxy_id',$patient->proxy_id)
//                         ->where('department_id',$patient->department_id)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();
//                         }
//                         else
//                         {
//                         $tretment=$this->db->select("*")
//                         ->from('treatments1')
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('department_id',$patient->department_id)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();  
//                         if(empty($tretment)){
//                         $tretment=$this->db->select("*")
//                         ->from('treatments1')
//                         ->where('department_id',$patient->department_id)
//                         ->where('ipd_opd',$patient->department_id)
//                         ->get()
//                         ->row();   
//                         }
//                         }
//                         }else{
//                         $tretment=$this->db->select("*")
//                         ->from('manual_treatments')
//                         ->where('patient_id_auto',$patient->id)
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();
//                         }
//                         //  echo "<pre>";
                     

//                         if($tretment)
//                         {
//                             if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
//                             {



//                            // echo "<br><br><br><br><br>";
//                             echo 'Patient create Date ====>'.$admit_date=date("Y-m-d",strtotime($patient->create_date));
//                            // echo "<br><br><br><br><br>";
//                             $admit_v_date=strtotime($patient->create_date);
//                           //  echo "<br><br><br><br><br>";
//                             $vaman_date=strtotime("+6 days",$admit_v_date); 
//                            // echo "<br><br><br><br><br>";
//                             echo 'Vaman Date ====>'.$vaman_virachan_date = date("Y-m-d",$vaman_date);
//                            // echo "<br><br><br><br><br>";                           
//                             $shirobasti_date=strtotime("+1 days",$admit_v_date); 
//                            // echo "<br><br><br><br><br>";
//                             echo 'Shirobasti Date ====>'.$shirobasti_final_date = date("Y-m-d",$shirobasti_date);
//                           //  echo "<br><br><br><br><br>";
//                             echo 'Fibal Push Date ===>'.$push_final_date = date('Y-m-d',strtotime($last_create_date));
//                            // echo "<br><br><br><br><br>";                        
                            
//                             //die();
//                             // echo "<br><br><br><br><br><br><br><br><br><br><br><br><br>";
                            
//                             $date1=date_create($admit_date);
//                             $date2=date_create($last_create_date);
//                             $diff=date_diff($date1,$date2);
//                             $diffDay = $diff->format("%a");
//                             $shirobastiCheck = ($diffDay % 2);







//                                 print_r("Panchakarma ==>==>==> ");
//                             if($tretment->SNEHAN){ 
//                                 print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
//                                 $Snehan = $Snehan + 1;
//                             }
//                             if($tretment->SWEDAN){ 
//                                 print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
//                                 $Swedan = $Swedan + 1;
//                             }
                            
                            
//                             if($tretment->VAMAN && $vaman_virachan_date == $push_final_date){ 
//                                 print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
//                                 $Vaman = $Vaman + 1;
//                             }
                            
//                          //   die();
//                             if($tretment->VIRECHAN){ 
//                                 print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
//                                 $Virechan = $Virechan + 1;
//                             }
//                             if($tretment->NASYA && $admit_date == $push_final_date){ 
//                                 print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
//                                 $Nasya = $Nasya + 1;
//                             }
//                             if($tretment->RAKTAMOKSHAN && $admit_date == $push_final_date){ 
//                                 print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
//                                 $Raktmokshan = $Raktmokshan + 1;
//                             }
//                             if($tretment->SHIRODHARA_SHIROBASTI){ 
//                                 print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
//                                 $Shirodhara = $Shirodhara + 1;
//                             }
//                             if($tretment->SHIROBASTI && $shirobasti_final_date == $push_final_date){ 
//                                 print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
//                                 $Shirobasti = $Shirobasti + 1;
//                             }
//                             if($tretment->UTTARBASTI){ 
//                                 print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
//                                 $Uttarbasti = $Uttarbasti + 1;
//                             }
//                             if($tretment->BASTI){ 
//                                 print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
//                                 $Basti = $Basti + 1;
//                             }
//                             if($tretment->YONIDHAVAN){ 
//                                 print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
//                                 $Yonidhavan = $Yonidhavan + 1;
//                             }
//                             if($tretment->YONIPICHU){ 
//                                 print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
//                                 $Yonipichu = $Yonipichu + 1;
//                             }
//                             if($tretment->OTHER){ 
//                                 print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
//                                 $Other = $Other + 1;
//                             }
                            

//                             (object)$postPatientInvestPanchData = ([
//                                 'patient_auto_id' => $patient->id,
//                                 'patient_name' => $patient->firstname,
//                                 'ipd_opd' => $patient->ipd_opd,
//                                 'sex' => $patient->sex,
//                                 'create_date' => $last_create_date,
//                                 'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
//                                 'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
//                                 'vaman' => ($vaman_virachan_date == $push_final_date) ? $tretment->VAMAN : NULL,
//                                 'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
//                                 'nasya' => ($admit_date == $push_final_date) ? $tretment->NASYA : NULL,
//                                 'raktmokshan' => ($admit_date == $push_final_date) ? $tretment->RAKTAMOKSHAN : NULL,
//                                 'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
//                                 'shirobasti' => ($shirobasti_final_date == $push_final_date) ? $tretment->SHIROBASTI : NULL,
//                                 'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
//                                 'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
//                                 'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
//                                 'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
//                                 'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
//                                 ]);
                                
//                                     $updateRes = $this->db->insert('panchkarma_patient_count_ipd', $postPatientInvestPanchData);
//                             }
//                             $data = array(
//                             'panchkamra' => '1'
//                             );

//                             $this->db->where('create_date',$last_create_date);
//                             $this->db->update('patient_ipd', $data);
//                               print_r($this->db->last_query());
//                         }

                       
//                     }  
//                    // die();
                    
//                     $investi_panch_count[$index] = [
//                         'Snehan' => $Snehan,
//                         'Swedan' => $Swedan,
//                         'Vaman' => $Vaman,
//                         'Virechan' => $Virechan,
//                         'Nasya' => $Nasya,
//                         'Raktmokshan' => $Raktmokshan,
//                         'Shirodhara' => $Shirodhara,
//                         'Shirobasti' => $Shirobasti,
//                         'Uttarbasti' => $Uttarbasti,
//                         'Basti' => $Basti,
//                         'Yonidhavan' => $Yonidhavan,
//                         'Yonipichu' => $Yonipichu,
//                         'Other' => $Other,
//                     ];
             
//                     $investi_panch_test_count[$index] = [
//                         'Snehan' => $Snehan,
//                         'Swedan' => $Swedan,
//                         'Vaman' => $Vaman,
//                         'Virechan' => $Virechan,
//                         'Nasya' => $Nasya,
//                         'Raktmokshan' => $Raktmokshan,
//                         'Shirodhara' => $Shirodhara,
//                         'Shirobasti' => $Shirobasti,
//                         'Uttarbasti' => $Uttarbasti,
//                         'Basti' => $Basti,
//                         'Yonidhavan' => $Yonidhavan,
//                         'Yonipichu' => $Yonipichu,
//                         'Other' => $Other,
//                     ];
        
        
      
              
//                     $index = $index + 1;
//                     print_r($investi_panch_count);print_r("<br>");
//                     print_r($investi_panch_test_count);print_r("<br>");

//                             for($i=0; $i<count($investi_panch_count);$i++)
//                             {
//                                 $last_count = $this->db->select('*')->from('panchkarma_total_count_ipd')->where('create_date',$startDate2)->get()->row();
//                               if($last_count){
                                
//                                     $snehan_count = $last_count->snehan_count;
//                                     $swedan_count = $last_count->swedan_count;
//                                     $vaman_count = $last_count->vaman_count;
//                                     $virechan_count = $last_count->virechan_count;
//                                     $nasya_count = $last_count->nasya_count;
//                                     $raktmokshan_count = $last_count->raktmokshan_count;
//                                     $shirodhara_count = $last_count->shirodhara_count;
//                                     $shirobasti_count = $last_count->shirobasti_count;
//                                     $uttarbasti_count = $last_count->uttarbasti_count;
//                                     $basti_count = $last_count->basti_count;
//                                     $yonidhavan_count = $last_count->yonidhavan_count;
//                                     $yonipichu_count = $last_count->yonipichu_count;
//                                     $others_count = $last_count->others_count;
                                  
//                                     (object)$postPatientInvestPanchCountData = ([
//                                     'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
//                                     'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
//                                     'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
//                                     'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
//                                     'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
//                                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
//                                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
//                                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
//                                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
//                                     'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
//                                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
//                                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
//                                     'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
//                                     ]);
//                                     echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);

//                                     $this->db->where('create_date', $startDate2);
//                                     $res =  $this->db->update('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);

//                                     $this->db->where('create_date', $startDate2);
//                                     $res1 =  $this->db->update('panchkarma_test_total_count_ipd', $postPatientInvestPanchCountData);

//                                 //     //  print_r($this->db->last_query());
//                                 //     //  die();
//                                   if($res && $res1)
//                                   {
//                                   print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
//                                   }
//                                  }   
//                                  else
//                                  {

//                                     (object)$postPatientInvestPanchCountData = ([
//                                   'ipd_opd' => 'ipd',
//                                     'create_date' => $startDate2,
//                                     'snehan_count' => $investi_panch_count[$i]['Snehan'],
//                                     'swedan_count' => $investi_panch_count[$i]['Swedan'],
//                                     'vaman_count' => $investi_panch_count[$i]['Vaman'],
//                                     'virechan_count' => $investi_panch_count[$i]['Virechan'],
//                                     'nasya_count' => $investi_panch_count[$i]['Nasya'],
//                                     'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
//                                     'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
//                                     'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
//                                     'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
//                                     'basti_count' => $investi_panch_count[$i]['Basti'],
//                                     'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
//                                     'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
//                                     'others_count' => $investi_panch_count[$i]['Other'],
//                                     ]);

//                                     echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);

//                                     $res = $this->db->insert('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);
//                                     echo "<pre>";
                                  
//                                     (object)$postPatientInvestPanchTestCountData = ([
//                                     'ipd_opd' => 'ipd',
//                                     'create_date' => $startDate2,
//                                     'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
//                                     'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
//                                     'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
//                                     'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
//                                     'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
//                                     'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
//                                     'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
//                                     'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
//                                     'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
//                                     'basti_count' => $investi_panch_test_count[$i]['Basti'],
//                                     'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
//                                     'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
//                                     'others_count' => $investi_panch_test_count[$i]['Other'],
//                                     ]);
//                                		echo "<pre>";
//                                     print_r($postPatientInvestPanchCountData);
//                                     $res1 = $this->db->insert('panchkarma_test_total_count_ipd', $postPatientInvestPanchTestCountData);
//                                     if($res && $res1)
//                                     {
//                                     print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
//                                     }
//                                   //25
//                                 }
//                             }
//       }
//     }


 public function panchUpdate()
    {
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
        date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
        echo date('d-m-Y H:i:s');
      	echo "<br>";
        echo "<script>
        $(document).ready(function () 
        {
            setTimeout('location.reload(true);', '10000');
        });
        </script>";

        
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////      OPD Investigation & Panchakarma Counting CODE /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            

        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'opd')
        ->where('panchkamra','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient')
        ->row();
   
        $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));
        echo "Last Date OPD=================>".$last_create_date;
        echo "<br>";
        echo "Current Date OPD=================>".$current_date;
        echo "<br>";
        echo "Push Date OPD=================>".$last_create_date;
        echo "<br>";

        //  $rand_limit_patient = rand(20,30);
         
        //   die();


            if($last_create_date == $current_date)
            {
                $index = 0;
                $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
                $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
                $Yonipichu = 0; $Other = 0;

                $patientList =  
                $this->db->select('*')
                ->from('patient')
                //->where('yearly_reg_no !=','')
                ->where('panchkamra','0')
                ->where('ipd_patient_flag','0')
                ->where('dignosis !=','')
                ->where('create_date',$last_create_date)
                ->where('ipd_opd','opd')
                ->order_by('id','ASC')
                //->order_by('RAND()')
                //->limit($rand_limit_patient)
                ->get()
                ->result();
                // print_r($this->db->last_query());
                
                foreach($patientList as $patient)
                {
                    //echo "Push Date =================>".
                    $startDate3=$patient->create_date;

                    //echo "<br>";
                    $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2')
                    {
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    else
                    {
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }

                    if($patient->manual_status==0)
                    {
                        if($patient->proxy_id)
                        {
                            $tretment=$this->db->select("*")
                            ->from('treatments1')
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('proxy_id',$patient->proxy_id)
                            ->where('department_id',$patient->department_id)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();
                        }
                        else
                        {
                            $tretment=$this->db->select("*")
                            ->from('treatments1')
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('department_id',$patient->department_id)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();  
                            if(empty($tretment))
                            {
                                $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd',$patient->department_id)
                                ->get()
                                ->row();   
                            }
                        }
                    }
                    else
                    {
                        $tretment=$this->db->select("*")
                        ->from('manual_treatments')
                        ->where('patient_id_auto',$patient->id)
                        ->where('dignosis LIKE',$p_dignosis)
                        ->where('ipd_opd ',$section_tret)
                        ->get()
                        ->row();
                    }

                    //  if($patient->yearly_reg_no)
                    // {

                    #Akki 27-08-2024
                    
                    $last_strirog_count = $this->db->select('count(department_id) as striCount')->from('panchkarma_patient_count_opd')->where('department_id','29')->where('create_date',$last_create_date)->get()->row();

                    #print_r($this->db->last_query());die();

                    $last_shalakyatantra_count = $this->db->select('count(department_id) as shalakyaCount')->from('panchkarma_patient_count_opd')->where('department_id','30')->where('create_date',$last_create_date)->get()->row();

                    $last_shalyatantra_count = $this->db->select('count(department_id) as shalyaCount')->from('panchkarma_patient_count_opd')->where('department_id','31')->where('create_date',$last_create_date)->get()->row();

                    $last_balrog_count = $this->db->select('count(department_id) as balrogCount')->from('panchkarma_patient_count_opd')->where('department_id','32')->where('create_date',$last_create_date)->get()->row();

                    $last_panch_count = $this->db->select('count(department_id) as panchCount')->from('panchkarma_patient_count_opd')->where('department_id','33')->where('create_date',$last_create_date)->get()->row();

                    //  echo $last_shalakyatantra_count->shalakyaCount;
                    //  die();

                    #akki 27-08-2024

                    if($patient->department_id == '33' || $patient->department_id == '34' || $patient->department_id == '29' || $patient->department_id == '30' || $patient->department_id == '31' || $patient->department_id == '32')
                    {
                        if($tretment)
                        {
                            if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN ||       $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
                            {
                                print_r("Panchakarma ==>==>==> ");
                                if($tretment->SNEHAN)
                                { 
                                    print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
                                    $Snehan = $Snehan + 1;
                                }
                                if($tretment->SWEDAN)
                                { 
                                    print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
                                    $Swedan = $Swedan + 1;
                                }
                                if($tretment->VAMAN)
                                { 
                                    print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
                                    $Vaman = $Vaman + 1;
                                }
                                if($tretment->VIRECHAN)
                                { 
                                    print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
                                    $Virechan = $Virechan + 1;
                                }
                                if($tretment->NASYA)
                                { 
                                    print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
                                    $Nasya = $Nasya + 1;
                                }
                                if($tretment->RAKTAMOKSHAN)
                                { 
                                    print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
                                    $Raktmokshan = $Raktmokshan + 1;
                                }
                                if($tretment->SHIRODHARA_SHIROBASTI)
                                { 
                                    print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
                                    $Shirodhara = $Shirodhara + 1;
                                }
                                if($tretment->SHIROBASTI)
                                { 
                                    print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
                                    $Shirobasti = $Shirobasti + 1;
                                }
                                if($tretment->UTTARBASTI)
                                { 
                                    print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
                                    $Uttarbasti = $Uttarbasti + 1;
                                }
                                if($tretment->BASTI)
                                { 
                                    print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
                                    $Basti = $Basti + 1;
                                }
                                if($tretment->YONIDHAVAN)
                                { 
                                    print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
                                    $Yonidhavan = $Yonidhavan + 1;
                                }
                                if($tretment->YONIPICHU)
                                { 
                                    print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
                                    $Yonipichu = $Yonipichu + 1;
                                }
                                if($tretment->OTHER)
                                { 
                                    print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
                                    $Other = $Other + 1;
                                }

                                (object)$postPatientInvestPanchData = ([
                                'patient_auto_id' => $patient->id,
                                'patient_name' => $patient->firstname,
                                'ipd_opd' => $patient->ipd_opd,
                                'sex' => $patient->sex,
                                'department_id' => $patient->department_id,
                                'create_date' => $patient->create_date,
                                'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
                                'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
                                'vaman' => ($tretment->VAMAN) ? $tretment->VAMAN : NULL,
                                'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
                                'nasya' => ($tretment->NASYA) ? $tretment->NASYA : NULL,
                                'raktmokshan' => ($tretment->RAKTAMOKSHAN) ? $tretment->RAKTAMOKSHAN : NULL,
                                'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
                                'shirobasti' => ($tretment->SHIROBASTI) ? $tretment->SHIROBASTI : NULL,
                                'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
                                'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
                                'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
                                'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
                                'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
                                ]);

                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('panchkarma_patient_count_opd')->num_rows();

                                #echo "<pre>"; print_r($postPatientInvestPanchData);

                                if($searchRes == 0)
                                {
                                    #$updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);

                                    #######akkki 28-08-2024
                                        
                                            if($patient->department_id == 29)
                                            {
                                                if($last_strirog_count->striCount <= 5){

                                                    $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            }elseif($patient->department_id == 30)
                                            {
                                                if($last_shalakyatantra_count->shalakyaCount <= 4){

                                                    $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            }elseif($patient->department_id == 31)
                                            {
                                                if($last_shalyatantra_count->shalyaCount <= 4){

                                                    $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            }
                                            
                                            elseif($patient->department_id == 32)
                                            {
                                                if($last_balrog_count->balrogCount <= 2){

                                                    $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            }
                                            elseif($patient->department_id == 33)
                                            {
                                                if($last_panch_count->panchCount <= 30){

                                                    $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            }
                                            
                                            
                                            
                                            elseif($patient->department_id != 29 && $patient->department_id != 30 && $patient->department_id != 31 && $patient->department_id != 32 && $patient->department_id != 33){

                                                $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                            }

                                            #print_r($this->db->last_query());die();


                                        #######
                                }
                                                    
                            }        
                        }  
                    }
                    // }

                    $data = array(
                    'panchkamra' => '1'
                    );  
                    $this->db->where('create_date',$last_create_date);
                    $this->db->or_where('ipd_patient_flag','1');
                    $this->db->update('patient', $data);

                    //  print_r($this->db->last_query());
                }   

                $investi_panch_count[$index] = [
                'Snehan' => $Snehan,
                'Swedan' => $Swedan,
                'Vaman' => $Vaman,
                'Virechan' => $Virechan,
                'Nasya' => $Nasya,
                'Raktmokshan' => $Raktmokshan,
                'Shirodhara' => $Shirodhara,
                'Shirobasti' => $Shirobasti,
                'Uttarbasti' => $Uttarbasti,
                'Basti' => $Basti,
                'Yonidhavan' => $Yonidhavan,
                'Yonipichu' => $Yonipichu,
                'Other' => $Other,
                ];

                //  echo "<pre>";
                // print_r($investi_panch_count);
                // die();

                $investi_panch_test_count[$index] = [
                'Snehan' => $Snehan,
                'Swedan' => $Swedan,
                'Vaman' => $Vaman,
                'Virechan' => $Virechan,
                'Nasya' => $Nasya,
                'Raktmokshan' => $Raktmokshan,
                'Shirodhara' => $Shirodhara,
                'Shirobasti' => $Shirobasti,
                'Uttarbasti' => $Uttarbasti,
                'Basti' => $Basti,
                'Yonidhavan' => $Yonidhavan,
                'Yonipichu' => $Yonipichu,
                'Other' => $Other,
                ];
              
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                print_r($investi_panch_test_count);print_r("<br>");
                for($i=0; $i<count($investi_panch_count);$i++)
                {
                    $last_count = $this->db->select('*')->from('panchkarma_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                    //	print_r($this->db->last_query());
                    //  die();
                    if($last_count) 
                    {
                             
                        $snehan_count = $last_count->snehan_count;
                        $swedan_count = $last_count->swedan_count;
                        $vaman_count = $last_count->vaman_count;
                        $virechan_count = $last_count->virechan_count;
                        $nasya_count = $last_count->nasya_count;
                        $raktmokshan_count = $last_count->raktmokshan_count;
                        $shirodhara_count = $last_count->shirodhara_count;
                        $shirobasti_count = $last_count->shirobasti_count;
                        $uttarbasti_count = $last_count->uttarbasti_count;
                        $basti_count = $last_count->basti_count;
                        $yonidhavan_count = $last_count->yonidhavan_count;
                        $yonipichu_count = $last_count->yonipichu_count;
                        $others_count = $last_count->others_count;
                                  

                        (object)$postPatientInvestPanchCountData = ([
                        'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
                        'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
                        'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
                        'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
                        'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
                        'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
                        'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
                        'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
                        'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
                        'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
                        'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
                        'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
                        'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $this->db->where('create_date', $last_create_date);
                        $res =  $this->db->update('panchkarma_total_count_opd', $postPatientInvestPanchCountData);

                        // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
                        $this->db->where('create_date', $last_create_date);
                        $res1 =  $this->db->update('panchkarma_test_total_count_opd', $postPatientInvestPanchCountData);

                        //  print_r($this->db->last_query());
                        //  die();
                        if($res && $res1)
                        {
                            print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                        }
                    }   
                    else
                    {
                        (object)$postPatientInvestPanchCountData = ([
                        'ipd_opd' => 'opd',
                        'create_date' => $last_create_date,
                        'snehan_count' => $investi_panch_count[$i]['Snehan'],
                        'swedan_count' => $investi_panch_count[$i]['Swedan'],
                        'vaman_count' => $investi_panch_count[$i]['Vaman'],
                        'virechan_count' => $investi_panch_count[$i]['Virechan'],
                        'nasya_count' => $investi_panch_count[$i]['Nasya'],
                        'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
                        'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
                        'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
                        'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
                        'basti_count' => $investi_panch_count[$i]['Basti'],
                        'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
                        'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
                        'others_count' => $investi_panch_count[$i]['Other'],
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);
                        echo "<pre>";
                        ///   print_r($this->db->last_query());
                        //   die();
                        (object)$postPatientInvestPanchTestCountData = ([
                        'ipd_opd' => 'opd',
                        'create_date' => $last_create_date,
                        'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
                        'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
                        'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
                        'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
                        'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
                        'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
                        'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
                        'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
                        'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
                        'basti_count' => $investi_panch_test_count[$i]['Basti'],
                        'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
                        'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
                        'others_count' => $investi_panch_test_count[$i]['Other'],
                        ]);
                        $res1 = $this->db->insert('panchkarma_test_total_count_opd', $postPatientInvestPanchTestCountData);
                        if($res && $res1)
                        {
                            print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                        }
                            //25 
                    }
                }
      
            }
            elseif($current_date > $last_create_date)
            {
                // echo "hoooooooooooooooooo";
    
                $index = 0;
                $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
                $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
                $Yonipichu = 0; $Other = 0;

                $patientList =  
                $this->db->select('*')
                ->from('patient')
                //->where('yearly_reg_no !=','')
                ->where('panchkamra','0')
                ->where('ipd_patient_flag','0')
                ->where('dignosis !=','')
                ->where('create_date',$last_create_date)
                ->where('ipd_opd','opd')
                ->order_by('id','ASC')
                //->order_by('RAND()')
                //->limit($rand_limit_patient)
                ->get()
                ->result();
                // print_r($this->db->last_query());
        
                foreach($patientList as $patient)
                {
                    //echo "Push Date =================>".
                    $startDate3=$patient->create_date;
                    //echo "<br>";
                    $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2')
                    {
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    else
                    {
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0)
                    {
                        if($patient->proxy_id)
                        {
                            $tretment=$this->db->select("*")
                            ->from('treatments1')
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('proxy_id',$patient->proxy_id)
                            ->where('department_id',$patient->department_id)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();
                        }
                        else
                        {
                            $tretment=$this->db->select("*")
                            ->from('treatments1')
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('department_id',$patient->department_id)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();  
                            if(empty($tretment))
                            {
                                $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd',$patient->department_id)
                                ->get()
                                ->row();   
                            }
                        }
                    }
                    else
                    {
                        $tretment=$this->db->select("*")
                        ->from('manual_treatments')
                        ->where('patient_id_auto',$patient->id)
                        ->where('dignosis LIKE',$p_dignosis)
                        ->where('ipd_opd ',$section_tret)
                        ->get()
                        ->row();
                    }
                    

                    #Akki 2-08-2024
                    $last_strirog_count = $this->db->select('count(department_id) as striCount')->from('panchkarma_patient_count_opd')->where('department_id',29)->where('create_date',$last_create_date)->get()->row();

                    #print_r($this->db->last_query());die();

                    $last_shalakyatantra_count = $this->db->select('count(department_id) as shalakyaCount')->from('panchkarma_patient_count_opd')->where('department_id',30)->where('create_date',$last_create_date)->get()->row();

                    $last_shalyatantra_count = $this->db->select('count(department_id) as shalyaCount')->from('panchkarma_patient_count_opd')->where('department_id',31)->where('create_date',$last_create_date)->get()->row();

                    $last_balrog_count = $this->db->select('count(department_id) as balrogCount')->from('panchkarma_patient_count_opd')->where('department_id',32)->where('create_date',$last_create_date)->get()->row();

                    $last_panch_count = $this->db->select('count(department_id) as panchCount')->from('panchkarma_patient_count_opd')->where('department_id',33)->where('create_date',$last_create_date)->get()->row();

                    // echo $last_shalakyatantra_count->shalakyaCount;
                    // die();

                    #akki 27-08-2024

                    if($patient->department_id == '33' || $patient->department_id == '34' || $patient->department_id == '29' || $patient->department_id == '30' || $patient->department_id == '31' || $patient->department_id == '32' || $patient->department_id == '33')
                    {
                        
                        if($tretment)
                        {
                            if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
                            {
                                print_r("Panchakarma ==>==>==> ");
                                if($tretment->SNEHAN)
                                { 
                                    print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
                                    $Snehan = $Snehan + 1;
                                }
                                if($tretment->SWEDAN)
                                { 
                                    print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
                                    $Swedan = $Swedan + 1;
                                }
                                if($tretment->VAMAN)
                                { 
                                    print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
                                    $Vaman = $Vaman + 1;
                                }
                                if($tretment->VIRECHAN)
                                { 
                                    print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
                                    $Virechan = $Virechan + 1;
                                }
                                if($tretment->NASYA)
                                { 
                                    print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
                                    $Nasya = $Nasya + 1;
                                }
                                if($tretment->RAKTAMOKSHAN)
                                { 
                                    print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
                                    $Raktmokshan = $Raktmokshan + 1;
                                }
                                if($tretment->SHIRODHARA_SHIROBASTI)
                                { 
                                    print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
                                    $Shirodhara = $Shirodhara + 1;
                                }
                                if($tretment->SHIROBASTI)
                                { 
                                    print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
                                    $Shirobasti = $Shirobasti + 1;
                                }
                                if($tretment->UTTARBASTI)
                                { 
                                    print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
                                    $Uttarbasti = $Uttarbasti + 1;
                                }
                                if($tretment->BASTI)
                                { 
                                    print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
                                    $Basti = $Basti + 1;
                                }
                                if($tretment->YONIDHAVAN)
                                { 
                                    print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
                                    $Yonidhavan = $Yonidhavan + 1;
                                }
                                if($tretment->YONIPICHU)
                                { 
                                    print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
                                    $Yonipichu = $Yonipichu + 1;
                                }
                                if($tretment->OTHER)
                                { 
                                    print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
                                    $Other = $Other + 1;
                                }

                                (object)$postPatientInvestPanchData = ([
                                'patient_auto_id' => $patient->id,
                                'patient_name' => $patient->firstname,
                                'ipd_opd' => $patient->ipd_opd,
                                'sex' => $patient->sex,
                                'department_id' => $patient->department_id,
                                'create_date' => $patient->create_date,
                                'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
                                'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
                                'vaman' => ($tretment->VAMAN) ? $tretment->VAMAN : NULL,
                                'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
                                'nasya' => ($tretment->NASYA) ? $tretment->NASYA : NULL,
                                'raktmokshan' => ($tretment->RAKTAMOKSHAN) ? $tretment->RAKTAMOKSHAN : NULL,
                                'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
                                'shirobasti' => ($tretment->SHIROBASTI) ? $tretment->SHIROBASTI : NULL,
                                'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
                                'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
                                'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
                                'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
                                'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
                                ]);

                                //echo "<br>";
                                // print_r($postPatientInvestPanchData);
                                //  echo "<br>";
                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('panchkarma_patient_count_opd')->num_rows();
                                if($searchRes == 0)
                                {   

                                    #######akkki 28-08-2024
                                
                                    if($patient->department_id == 29)
                                    {
                                        if($last_strirog_count->striCount <= 5){

                                            $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                        }
                                    }elseif($patient->department_id == 30)
                                    {
                                        if($last_shalakyatantra_count->shalakyaCount <= 4){

                                            $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                        }
                                    }elseif($patient->department_id == 31)
                                    {
                                        if($last_shalyatantra_count->shalyaCount <= 4){

                                            $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                        }
                                    }
                                    
                                    elseif($patient->department_id == 32)
                                    {
                                        if($last_balrog_count->balrogCount <= 2){

                                            $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                        }
                                    }
                                    elseif($patient->department_id == 33)
                                    {
                                        if($last_panch_count->panchCount <= 30){

                                            $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                        }
                                    }
                                    
                                    elseif($patient->department_id != 29 && $patient->department_id != 30 && $patient->department_id != 31 && $patient->department_id != 32  && $patient->department_id != 33){

                                        $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
                                    }

                                    #######

                                }  
                            }                
                        }  
                    }

                    $data = array(
                        'panchkamra' => '1'
                    );
                    $this->db->where('create_date',$last_create_date);
                    $this->db->or_where('ipd_patient_flag','1');
                    $this->db->update('patient', $data);
                    //  print_r($this->db->last_query());
                }           
                            
                $investi_panch_count[$index] = [
                'Snehan' => $Snehan,
                'Swedan' => $Swedan,
                'Vaman' => $Vaman,
                'Virechan' => $Virechan,
                'Nasya' => $Nasya,
                'Raktmokshan' => $Raktmokshan,
                'Shirodhara' => $Shirodhara,
                'Shirobasti' => $Shirobasti,
                'Uttarbasti' => $Uttarbasti,
                'Basti' => $Basti,
                'Yonidhavan' => $Yonidhavan,
                'Yonipichu' => $Yonipichu,
                'Other' => $Other,
                ];
        
                $investi_panch_test_count[$index] = [
                'Snehan' => $Snehan,
                'Swedan' => $Swedan,
                'Vaman' => $Vaman,
                'Virechan' => $Virechan,
                'Nasya' => $Nasya,
                'Raktmokshan' => $Raktmokshan,
                'Shirodhara' => $Shirodhara,
                'Shirobasti' => $Shirobasti,
                'Uttarbasti' => $Uttarbasti,
                'Basti' => $Basti,
                'Yonidhavan' => $Yonidhavan,
                'Yonipichu' => $Yonipichu,
                'Other' => $Other,
                ];
            
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                #print_r($investi_panch_test_count);print_r("<br>");

                for($i=0; $i<count($investi_panch_count);$i++)
                {
                    $last_count = $this->db->select('*')->from('panchkarma_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                    
                    if($last_count) 
                    {
                        $snehan_count = $last_count->snehan_count;
                        $swedan_count = $last_count->swedan_count;
                        $vaman_count = $last_count->vaman_count;
                        $virechan_count = $last_count->virechan_count;
                        $nasya_count = $last_count->nasya_count;
                        $raktmokshan_count = $last_count->raktmokshan_count;
                        $shirodhara_count = $last_count->shirodhara_count;
                        $shirobasti_count = $last_count->shirobasti_count;
                        $uttarbasti_count = $last_count->uttarbasti_count;
                        $basti_count = $last_count->basti_count;
                        $yonidhavan_count = $last_count->yonidhavan_count;
                        $yonipichu_count = $last_count->yonipichu_count;
                        $others_count = $last_count->others_count;
                        

                        (object)$postPatientInvestPanchCountData = ([
                        'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
                        'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
                        'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
                        'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
                        'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
                        'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
                        'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
                        'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
                        'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
                        'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
                        'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
                        'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
                        'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $this->db->where('create_date', $last_create_date);
                        $res =  $this->db->update('panchkarma_total_count_opd', $postPatientInvestPanchCountData);

                        // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
                        $this->db->where('create_date', $last_create_date);
                        $res1 =  $this->db->update('panchkarma_test_total_count_opd', $postPatientInvestPanchCountData);

                        if($res && $res1)
                        {
                            print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                        }
                    }   
                    else
                    {
                        (object)$postPatientInvestPanchCountData = ([
                        'ipd_opd' => 'opd',
                        'create_date' => $last_create_date,
                        'snehan_count' => $investi_panch_count[$i]['Snehan'],
                        'swedan_count' => $investi_panch_count[$i]['Swedan'],
                        'vaman_count' => $investi_panch_count[$i]['Vaman'],
                        'virechan_count' => $investi_panch_count[$i]['Virechan'],
                        'nasya_count' => $investi_panch_count[$i]['Nasya'],
                        'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
                        'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
                        'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
                        'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
                        'basti_count' => $investi_panch_count[$i]['Basti'],
                        'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
                        'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
                        'others_count' => $investi_panch_count[$i]['Other'],
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);
                        echo "<pre>";
                                
                        (object)$postPatientInvestPanchTestCountData = ([
                        'ipd_opd' => 'opd',
                        'create_date' => $last_create_date,
                        'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
                        'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
                        'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
                        'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
                        'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
                        'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
                        'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
                        'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
                        'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
                        'basti_count' => $investi_panch_test_count[$i]['Basti'],
                        'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
                        'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
                        'others_count' => $investi_panch_test_count[$i]['Other'],
                        ]);
                        $res1 = $this->db->insert('panchkarma_test_total_count_opd', $postPatientInvestPanchTestCountData);
                        if($res && $res1)
                        {
                        print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
                        }
                        //25
                    }
                }
            }

            #die();

            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            /////////////////////////////////////                                                         /////////////////////////////////////
            /////////////////////////////////////      IPD Investigation & Panchakarma Counting CODE      /////////////////////////////////////
            /////////////////////////////////////                                                         /////////////////////////////////////
            /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 

            $start_time= date('H:i',strtotime('18:15'));
            $time_date=date('H:i');
            $current_date = date('Y-m-d');
            $last_date_res = 
            $this->db->select('*')
            ->where('ipd_opd', 'ipd')
            ->where('panchkamra','0')
            //->where('year(create_date)','2023')
            ->limit(1)
            ->order_by('id','ASC')
            ->get('patient_ipd')
            ->row();
            // print_r($this->db->last_query());
            echo "<br>";
            $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));
    
		    echo "<br><br><br><br>";
            echo "Last Date IPD=================>".$last_create_date;
            echo "<br>";
            echo "Current Date IPD=================>".$current_date;
            echo "<br>";
            echo "Push Date IPD=================>".$last_create_date;
            echo "<br>";

            if($last_create_date == $current_date)
            {
                $index = 0;
                $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
                $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
                $Yonipichu = 0; $Other = 0;
                //   echo "hiiiiiii";
 
               $patients1 = $this->db->select("*")
               ->from('patient_ipd')
               ->join('department','department.dprt_id = patient_ipd.department_id')
               ->where('discharge_date >=', $last_create_date)
               ->where('create_date <=', $last_create_date)
               ->where('dignosis !=', '')
               ->where('ipd_opd', 'ipd')
               ->get()
               ->result();

                $patients2 = $this->db->select("*")
                ->from('patient_ipd')
                ->join('department','department.dprt_id = patient_ipd.department_id')
                ->where('create_date <=', $last_create_date)
                ->where('dignosis !=', '')
                ->where('discharge_date LIKE', '%0000-00-00%')
                ->where('ipd_opd', 'ipd')
                ->get()
                ->result();
                
                //print_r('q2   ');                    
               
        
                $patientList = array_merge($patients1, $patients2);
                foreach($patientList as $patient)
                {
                    //echo "Push Date =================>".
                    $startDate2=$patient->create_date;
                    echo "<br>";
                    $section_tret='ipd';
                    $che=trim($patient->dignosis);
                    $section_tret='ipd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2')
                    {
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    else
                    {
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0)
                    {
                        if($patient->proxy_id)
                        {
                            $tretment=$this->db->select("*")
                            ->from('treatments1')
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('proxy_id',$patient->proxy_id)
                            ->where('department_id',$patient->department_id)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();
                        }
                        else
                        {
                            $tretment=$this->db->select("*")
                            ->from('treatments1')
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('department_id',$patient->department_id)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();  
                            if(empty($tretment))
                            {
                                $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd',$patient->department_id)
                                ->get()
                                ->row();   
                            }
                        }
                    }
                    else
                    {
                        $tretment=$this->db->select("*")
                        ->from('manual_treatments')
                        ->where('patient_id_auto',$patient->id)
                        ->where('dignosis LIKE',$p_dignosis)
                        ->where('ipd_opd ',$section_tret)
                        ->get()
                        ->row();
                    }
                    //  echo "<pre>";
                    if($tretment)
                    {
                        if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
                        {
                            echo 'Patient create Date ====>'.$admit_date=date("Y-m-d",strtotime($patient->create_date));
                            // echo "<br><br><br><br><br>";
                            $admit_v_date=strtotime($patient->create_date);
                            //  echo "<br><br><br><br><br>";
                            $vaman_date=strtotime("+6 days",$admit_v_date); 
                            // echo "<br><br><br><br><br>";
                            echo 'Vaman Date ====>'.$vaman_virachan_date = date("Y-m-d",$vaman_date);
                            // echo "<br><br><br><br><br>";                           
                            $shirobasti_date=strtotime("+1 days",$admit_v_date); 
                            // echo "<br><br><br><br><br>";
                            echo 'Shirobasti Date ====>'.$shirobasti_final_date = date("Y-m-d",$shirobasti_date);
                            //  echo "<br><br><br><br><br>";
                            echo 'Fibal Push Date ===>'.$push_final_date = date('Y-m-d',strtotime($last_create_date));
                            // echo "<br><br><br><br><br>";                        
                            
                            $date1=date_create($admit_date);
                            $date2=date_create($last_create_date);
                            $diff=date_diff($date1,$date2);
                            $diffDay = $diff->format("%a");
                            $shirobastiCheck = ($diffDay % 2);
                            print_r("Panchakarma ==>==>==> ");
                            if($tretment->SNEHAN)
                            { 
                                print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
                                $Snehan = $Snehan + 1;
                            }
                            if($tretment->SWEDAN)
                            { 
                                print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
                                $Swedan = $Swedan + 1;
                            }
                            if($tretment->VAMAN && $vaman_virachan_date == $push_final_date)
                            { 
                                print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
                                $Vaman = $Vaman + 1;
                            }
                            // die();
                            if($tretment->VIRECHAN)
                            { 
                                print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
                                $Virechan = $Virechan + 1;
                            }
                            if($tretment->NASYA && $admit_date == $push_final_date)
                            { 
                                print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
                                $Nasya = $Nasya + 1;
                            }
                            if($tretment->RAKTAMOKSHAN && $admit_date == $push_final_date)
                            { 
                                print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
                                $Raktmokshan = $Raktmokshan + 1;
                            }
                            if($tretment->SHIRODHARA_SHIROBASTI)
                            { 
                                print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
                                $Shirodhara = $Shirodhara + 1;
                            }
                            if($tretment->SHIROBASTI && $shirobasti_final_date == $push_final_date)
                            { 
                                print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
                                $Shirobasti = $Shirobasti + 1;
                            }
                            if($tretment->UTTARBASTI)
                            { 
                                print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
                                $Uttarbasti = $Uttarbasti + 1;
                            }
                            if($tretment->BASTI)
                            { 
                                print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
                                $Basti = $Basti + 1;
                            }
                            if($tretment->YONIDHAVAN)
                            { 
                                print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
                                $Yonidhavan = $Yonidhavan + 1;
                            }
                            if($tretment->YONIPICHU)
                            { 
                                print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
                                $Yonipichu = $Yonipichu + 1;
                            }
                            if($tretment->OTHER)
                            { 
                                print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
                                $Other = $Other + 1;
                            }
                            (object)$postPatientInvestPanchData = ([
                            'patient_auto_id' => $patient->id,
                            'patient_name' => $patient->firstname,
                            'ipd_opd' => $patient->ipd_opd,
                            'sex' => $patient->sex,
                            'create_date' => $last_create_date,
                            'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
                            'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
                            'vaman' => ($vaman_virachan_date == $push_final_date) ? $tretment->VAMAN : NULL,
                            'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
                            'nasya' => ($admit_date == $push_final_date) ? $tretment->NASYA : NULL,
                            'raktmokshan' => ($admit_date == $push_final_date) ? $tretment->RAKTAMOKSHAN : NULL,
                            'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
                            'shirobasti' => ($shirobasti_final_date == $push_final_date) ? $tretment->SHIROBASTI : NULL,
                            'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
                            'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
                            'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
                            'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
                            'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
                            ]);
                            $updateRes = $this->db->insert('panchkarma_patient_count_ipd', $postPatientInvestPanchData);
                        }
                        $data = array(
                        'panchkamra' => '1'
                        );
                        $this->db->where('create_date',$last_create_date);
                        $this->db->update('patient_ipd', $data);
                        #print_r($this->db->last_query()); 
                    }
                }  
                $investi_panch_count[$index] = [
                'Snehan' => $Snehan,
                'Swedan' => $Swedan,
                'Vaman' => $Vaman,
                'Virechan' => $Virechan,
                'Nasya' => $Nasya,
                'Raktmokshan' => $Raktmokshan,
                'Shirodhara' => $Shirodhara,
                'Shirobasti' => $Shirobasti,
                'Uttarbasti' => $Uttarbasti,
                'Basti' => $Basti,
                'Yonidhavan' => $Yonidhavan,
                'Yonipichu' => $Yonipichu,
                'Other' => $Other,
                ];
            
                $investi_panch_test_count[$index] = [
                'Snehan' => $Snehan,
                'Swedan' => $Swedan,
                'Vaman' => $Vaman,
                'Virechan' => $Virechan,
                'Nasya' => $Nasya,
                'Raktmokshan' => $Raktmokshan,
                'Shirodhara' => $Shirodhara,
                'Shirobasti' => $Shirobasti,
                'Uttarbasti' => $Uttarbasti,
                'Basti' => $Basti,
                'Yonidhavan' => $Yonidhavan,
                'Yonipichu' => $Yonipichu,
                'Other' => $Other,
                ];
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                #print_r($investi_panch_test_count);print_r("<br>");

                for($i=0; $i<count($investi_panch_count);$i++)
                {
                    $last_count = $this->db->select('*')->from('panchkarma_total_count_ipd')->where('create_date',$startDate2)->get()->row();
                    if($last_count)
                    {        
                        $snehan_count = $last_count->snehan_count;
                        $swedan_count = $last_count->swedan_count;
                        $vaman_count = $last_count->vaman_count;
                        $virechan_count = $last_count->virechan_count;
                        $nasya_count = $last_count->nasya_count;
                        $raktmokshan_count = $last_count->raktmokshan_count;
                        $shirodhara_count = $last_count->shirodhara_count;
                        $shirobasti_count = $last_count->shirobasti_count;
                        $uttarbasti_count = $last_count->uttarbasti_count;
                        $basti_count = $last_count->basti_count;
                        $yonidhavan_count = $last_count->yonidhavan_count;
                        $yonipichu_count = $last_count->yonipichu_count;
                        $others_count = $last_count->others_count;
                                
                        (object)$postPatientInvestPanchCountData = ([
                        'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
                        'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
                        'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
                        'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
                        'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
                        'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
                        'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
                        'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
                        'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
                        'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
                        'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
                        'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
                        'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $this->db->where('create_date', $startDate2);
                        $res =  $this->db->update('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);

                        $this->db->where('create_date', $startDate2);
                        $res1 =  $this->db->update('panchkarma_test_total_count_ipd', $postPatientInvestPanchCountData);

                        //     //  print_r($this->db->last_query());
                        //     //  die();
                        if($res && $res1)
                        {
                            print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                        }
                    }   
                    else
                    {
                        (object)$postPatientInvestPanchCountData = ([
                        'ipd_opd' => 'ipd',
                        'create_date' => $startDate2,
                        'snehan_count' => $investi_panch_count[$i]['Snehan'],
                        'swedan_count' => $investi_panch_count[$i]['Swedan'],
                        'vaman_count' => $investi_panch_count[$i]['Vaman'],
                        'virechan_count' => $investi_panch_count[$i]['Virechan'],
                        'nasya_count' => $investi_panch_count[$i]['Nasya'],
                        'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
                        'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
                        'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
                        'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
                        'basti_count' => $investi_panch_count[$i]['Basti'],
                        'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
                        'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
                        'others_count' => $investi_panch_count[$i]['Other'],
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);
                        
                        $res = $this->db->insert('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);
                        #echo "<pre>";
                        ///   print_r($this->db->last_query());
                        //   die();
                        (object)$postPatientInvestPanchTestCountData = ([
                        'ipd_opd' => 'ipd',
                        'create_date' => $startDate2,
                        'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
                        'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
                        'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
                        'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
                        'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
                        'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
                        'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
                        'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
                        'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
                        'basti_count' => $investi_panch_test_count[$i]['Basti'],
                        'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
                        'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
                        'others_count' => $investi_panch_test_count[$i]['Other'],
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $res1 = $this->db->insert('panchkarma_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                        if($res && $res1)
                        {
                            print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                        }
                            //25
                    }
                }
            }
            elseif($current_date > $last_create_date)
            {
                $index = 0;
                $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
                $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
                $Yonipichu = 0; $Other = 0;
                //   echo "hiiiiiii";
 
               $patients1 = $this->db->select("*")
                ->from('patient_ipd')
                ->join('department','department.dprt_id = patient_ipd.department_id')
                ->where('discharge_date >=', $last_create_date)
                ->where('create_date <=', $last_create_date)
                ->where('dignosis !=', '')
                //->where('manual_status', '0')
                //->where('panchkamra','0')
                ->where('ipd_opd', 'ipd')
                ->get()
                ->result();
                        
                //print_r('q1   ');
                //print_r($this->db->last_query());
                
        
                $patients2 = $this->db->select("*")
                ->from('patient_ipd')
                ->join('department','department.dprt_id = patient_ipd.department_id')
                ->where('create_date <=', $last_create_date)
                ->where('dignosis !=', '')
                //  ->where('manual_status', '0')
                // ->where('panchkamra','0')
                ->where('discharge_date LIKE', '%0000-00-00%')
                ->where('ipd_opd', 'ipd')
                ->get()
                ->result();
                
                //print_r('q2   ');                    
               
        
                $patientList = array_merge($patients1, $patients2);
                foreach($patientList as $patient)
                {
                    // print_r($patient->firstname);
                    //  die();
                    //echo "Push Date =================>".
                    $startDate2=$patient->create_date;
                    echo "<br>";
                    $section_tret='ipd';
                    $che=trim($patient->dignosis);
                    $section_tret='ipd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2')
                    {
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    else
                    {
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0)
                    {
                        if($patient->proxy_id)
                        {
                            $tretment=$this->db->select("*")
                            ->from('treatments1')
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('proxy_id',$patient->proxy_id)
                            ->where('department_id',$patient->department_id)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();
                        }
                        else
                        {
                            $tretment=$this->db->select("*")
                            ->from('treatments1')
                            ->where('dignosis LIKE',$p_dignosis)
                            ->where('department_id',$patient->department_id)
                            ->where('ipd_opd ',$section_tret)
                            ->get()
                            ->row();  
                            if(empty($tretment))
                            {
                                $tretment=$this->db->select("*")
                                ->from('treatments1')
                                ->where('department_id',$patient->department_id)
                                ->where('ipd_opd',$patient->department_id)
                                ->get()
                                ->row();   
                            }
                        }
                    }
                    else
                    {
                        $tretment=$this->db->select("*")
                        ->from('manual_treatments')
                        ->where('patient_id_auto',$patient->id)
                        ->where('dignosis LIKE',$p_dignosis)
                        ->where('ipd_opd ',$section_tret)
                        ->get()
                        ->row();
                    }
                    //  echo "<pre>";
                    if($tretment)
                    {
                        if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
                        {
                           // echo "<br><br><br><br><br>";
                            echo 'Patient create Date ====>'.$admit_date=date("Y-m-d",strtotime($patient->create_date));
                           // echo "<br><br><br><br><br>";
                            $admit_v_date=strtotime($patient->create_date);
                           //  echo "<br><br><br><br><br>";
                            $vaman_date=strtotime("+6 days",$admit_v_date); 
                           // echo "<br><br><br><br><br>";
                            echo 'Vaman Date ====>'.$vaman_virachan_date = date("Y-m-d",$vaman_date);
                           // echo "<br><br><br><br><br>";                           
                            $shirobasti_date=strtotime("+1 days",$admit_v_date); 
                           // echo "<br><br><br><br><br>";
                            echo 'Shirobasti Date ====>'.$shirobasti_final_date = date("Y-m-d",$shirobasti_date);
                           //  echo "<br><br><br><br><br>";
                            echo 'Fibal Push Date ===>'.$push_final_date = date('Y-m-d',strtotime($last_create_date));
                           // echo "<br><br><br><br><br>";                        
                            
                            //die();
                            // echo "<br><br><br><br><br><br><br><br><br><br><br><br><br>";
                            
                            $date1=date_create($admit_date);
                            $date2=date_create($last_create_date);
                            $diff=date_diff($date1,$date2);
                            $diffDay = $diff->format("%a");
                            $shirobastiCheck = ($diffDay % 2);

                            print_r("Panchakarma ==>==>==> ");
                            if($tretment->SNEHAN)
                            { 
                                print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
                                $Snehan = $Snehan + 1;
                            }
                            if($tretment->SWEDAN)
                            { 
                                print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
                                $Swedan = $Swedan + 1;
                            }
                            if($tretment->VAMAN && $vaman_virachan_date == $push_final_date){ 
                                print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
                                $Vaman = $Vaman + 1;
                            }
                            
                            //   die();
                            if($tretment->VIRECHAN)
                            { 
                                print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
                                $Virechan = $Virechan + 1;
                            }
                            if($tretment->NASYA && $admit_date == $push_final_date)
                            { 
                                print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
                                $Nasya = $Nasya + 1;
                            }
                            if($tretment->RAKTAMOKSHAN && $admit_date == $push_final_date)
                            { 
                                print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
                                $Raktmokshan = $Raktmokshan + 1;
                            }
                            if($tretment->SHIRODHARA_SHIROBASTI)
                            { 
                                print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
                                $Shirodhara = $Shirodhara + 1;
                            }
                            if($tretment->SHIROBASTI && $shirobasti_final_date == $push_final_date)
                            { 
                                print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
                                $Shirobasti = $Shirobasti + 1;
                            }
                            if($tretment->UTTARBASTI)
                            { 
                                print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
                                $Uttarbasti = $Uttarbasti + 1;
                            }
                            if($tretment->BASTI)
                            { 
                                print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
                                $Basti = $Basti + 1;
                            }
                            if($tretment->YONIDHAVAN)
                            { 
                                print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
                                $Yonidhavan = $Yonidhavan + 1;
                            }
                            if($tretment->YONIPICHU)
                            { 
                                print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
                                $Yonipichu = $Yonipichu + 1;
                            }
                            if($tretment->OTHER)
                            { 
                                print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
                                $Other = $Other + 1;
                            }
                            (object)$postPatientInvestPanchData = ([
                            'patient_auto_id' => $patient->id,
                            'patient_name' => $patient->firstname,
                            'ipd_opd' => $patient->ipd_opd,
                            'sex' => $patient->sex,
                            'create_date' => $last_create_date,
                            'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
                            'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
                            'vaman' => ($vaman_virachan_date == $push_final_date) ? $tretment->VAMAN : NULL,
                            'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
                            'nasya' => ($admit_date == $push_final_date) ? $tretment->NASYA : NULL,
                            'raktmokshan' => ($admit_date == $push_final_date) ? $tretment->RAKTAMOKSHAN : NULL,
                            'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
                            'shirobasti' => ($shirobasti_final_date == $push_final_date) ? $tretment->SHIROBASTI : NULL,
                            'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
                            'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
                            'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
                            'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
                            'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
                            ]);
                            
                            $updateRes = $this->db->insert('panchkarma_patient_count_ipd', $postPatientInvestPanchData);
                        }
                        $data = array(
                        'panchkamra' => '1'
                        );

                        $this->db->where('create_date',$last_create_date);
                        $this->db->update('patient_ipd', $data);
                        #print_r($this->db->last_query());
                    }
                }  
                // die();
                    
                $investi_panch_count[$index] = [
                'Snehan' => $Snehan,
                'Swedan' => $Swedan,
                'Vaman' => $Vaman,
                'Virechan' => $Virechan,
                'Nasya' => $Nasya,
                'Raktmokshan' => $Raktmokshan,
                'Shirodhara' => $Shirodhara,
                'Shirobasti' => $Shirobasti,
                'Uttarbasti' => $Uttarbasti,
                'Basti' => $Basti,
                'Yonidhavan' => $Yonidhavan,
                'Yonipichu' => $Yonipichu,
                'Other' => $Other,
                ];
             
                $investi_panch_test_count[$index] = [
                'Snehan' => $Snehan,
                'Swedan' => $Swedan,
                'Vaman' => $Vaman,
                'Virechan' => $Virechan,
                'Nasya' => $Nasya,
                'Raktmokshan' => $Raktmokshan,
                'Shirodhara' => $Shirodhara,
                'Shirobasti' => $Shirobasti,
                'Uttarbasti' => $Uttarbasti,
                'Basti' => $Basti,
                'Yonidhavan' => $Yonidhavan,
                'Yonipichu' => $Yonipichu,
                'Other' => $Other,
                ];
        

                $index = $index + 1;
                // print_r($investi_panch_count);print_r("<br>");
                // print_r($investi_panch_test_count);print_r("<br>");

                for($i=0; $i<count($investi_panch_count);$i++)
                {
                    $last_count = $this->db->select('*')->from('panchkarma_total_count_ipd')->where('create_date',$startDate2)->get()->row();
                    if($last_count)
                    {           
                        $snehan_count = $last_count->snehan_count;
                        $swedan_count = $last_count->swedan_count;
                        $vaman_count = $last_count->vaman_count;
                        $virechan_count = $last_count->virechan_count;
                        $nasya_count = $last_count->nasya_count;
                        $raktmokshan_count = $last_count->raktmokshan_count;
                        $shirodhara_count = $last_count->shirodhara_count;
                        $shirobasti_count = $last_count->shirobasti_count;
                        $uttarbasti_count = $last_count->uttarbasti_count;
                        $basti_count = $last_count->basti_count;
                        $yonidhavan_count = $last_count->yonidhavan_count;
                        $yonipichu_count = $last_count->yonipichu_count;
                        $others_count = $last_count->others_count;
                        
                        (object)$postPatientInvestPanchCountData = ([
                        'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
                        'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
                        'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
                        'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
                        'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
                        'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
                        'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
                        'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
                        'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
                        'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
                        'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
                        'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
                        'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $this->db->where('create_date', $startDate2);
                        $res =  $this->db->update('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);

                        $this->db->where('create_date', $startDate2);
                        $res1 =  $this->db->update('panchkarma_test_total_count_ipd', $postPatientInvestPanchCountData);

                        // //  print_r($this->db->last_query());
                        // //  die();
                        if($res && $res1)
                        {
                            print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                        }
                    }   
                    else
                    {
                        (object)$postPatientInvestPanchCountData = ([
                        'ipd_opd' => 'ipd',
                        'create_date' => $startDate2,
                        'snehan_count' => $investi_panch_count[$i]['Snehan'],
                        'swedan_count' => $investi_panch_count[$i]['Swedan'],
                        'vaman_count' => $investi_panch_count[$i]['Vaman'],
                        'virechan_count' => $investi_panch_count[$i]['Virechan'],
                        'nasya_count' => $investi_panch_count[$i]['Nasya'],
                        'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
                        'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
                        'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
                        'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
                        'basti_count' => $investi_panch_count[$i]['Basti'],
                        'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
                        'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
                        'others_count' => $investi_panch_count[$i]['Other'],
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $res = $this->db->insert('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);
                        echo "<pre>";
                                  
                        (object)$postPatientInvestPanchTestCountData = ([
                        'ipd_opd' => 'ipd',
                        'create_date' => $startDate2,
                        'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
                        'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
                        'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
                        'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
                        'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
                        'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
                        'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
                        'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
                        'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
                        'basti_count' => $investi_panch_test_count[$i]['Basti'],
                        'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
                        'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
                        'others_count' => $investi_panch_test_count[$i]['Other'],
                        ]);

                        // echo "<pre>";
                        // print_r($postPatientInvestPanchCountData);

                        $res1 = $this->db->insert('panchkarma_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                        if($res && $res1)
                        {
                        print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
                        }
                        //25
                    }
                }
            }
    }
//   public function panchUpdate()
//     {
//         error_reporting(0);
//         echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
//         date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
//         echo date('d-m-Y H:i:s');
//       	echo "<br>";
//         echo "<script>
//         $(document).ready(function () 
//         {
//             setTimeout('location.reload(true);', '10000');
//         });
//         </script>";

        
//         ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//         /////////////////////////////////////                                                         /////////////////////////////////////
//         /////////////////////////////////////      OPD Investigation & Panchakarma Counting CODE /////////////////////////////////////
//         /////////////////////////////////////                                                         /////////////////////////////////////
//         ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            

//         $start_time= date('H:i',strtotime('18:15'));
//         $time_date=date('H:i');
//         $current_date = date('Y-m-d');
//         $last_date_res = 
//         $this->db->select('*')
//         ->where('ipd_opd', 'opd')
//         ->where('panchkamra','0')
//         //->where('year(create_date)','2023')
//         ->limit(1)
//         ->order_by('id','ASC')
//         ->get('patient')
//         ->row();
   
//         $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));
//         echo "Last Date OPD=================>".$last_create_date;
//         echo "<br>";
//         echo "Current Date OPD=================>".$current_date;
//         echo "<br>";
//         echo "Push Date OPD=================>".$last_create_date;
//         echo "<br>";

//          $rand_limit_patient = rand(20,30);
         
//         //   die();


//             if($last_create_date == $current_date)
//             {
//                 $index = 0;
//                 $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
//                 $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
//                 $Yonipichu = 0; $Other = 0;

//                 $patientList =  
//                 $this->db->select('*')
//                 ->from('patient')
//                 //->where('yearly_reg_no !=','')
//                 ->where('panchkamra','0')
//                 ->where('ipd_patient_flag','0')
//                 ->where('dignosis !=','')
//                 ->where('create_date',$last_create_date)
//                 ->where('ipd_opd','opd')
//                 ->order_by('id','ASC')
//                 //->order_by('RAND()')
//                 //->limit($rand_limit_patient)
//                 ->get()
//                 ->result();
//                 // print_r($this->db->last_query());
                
//                 foreach($patientList as $patient)
//                 {
//                     //echo "Push Date =================>".
//                     $startDate3=$patient->create_date;

//                     //echo "<br>";
//                     $section_tret='opd';
//                     $che=trim($patient->dignosis);
//                     $section_tret='opd';
//                     $len=strlen($che);
//                     $dd= substr($che,$len - 1);
//                     $str = $patient->dignosis;
//                     $arry=explode("-",$str);
//                     $t_c=count($arry);
//                     if($t_c=='2')
//                     {
//                         $dd1=substr($che, 0, -1);
//                         $new_str = trim($arry[0]);
//                         $p_dignosis = '%'.$new_str.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                     else
//                     {
//                         $p_dignosis = '%'.$che.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }

//                     if($patient->manual_status==0)
//                     {
//                         if($patient->proxy_id)
//                         {
//                             $tretment=$this->db->select("*")
//                             ->from('treatments1')
//                             ->where('dignosis LIKE',$p_dignosis)
//                             ->where('proxy_id',$patient->proxy_id)
//                             ->where('department_id',$patient->department_id)
//                             ->where('ipd_opd ',$section_tret)
//                             ->get()
//                             ->row();
//                         }
//                         else
//                         {
//                             $tretment=$this->db->select("*")
//                             ->from('treatments1')
//                             ->where('dignosis LIKE',$p_dignosis)
//                             ->where('department_id',$patient->department_id)
//                             ->where('ipd_opd ',$section_tret)
//                             ->get()
//                             ->row();  
//                             if(empty($tretment))
//                             {
//                                 $tretment=$this->db->select("*")
//                                 ->from('treatments1')
//                                 ->where('department_id',$patient->department_id)
//                                 ->where('ipd_opd',$patient->department_id)
//                                 ->get()
//                                 ->row();   
//                             }
//                         }
//                     }
//                     else
//                     {
//                         $tretment=$this->db->select("*")
//                         ->from('manual_treatments')
//                         ->where('patient_id_auto',$patient->id)
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();
//                     }

//                     //  if($patient->yearly_reg_no)
//                     // {

//                     #Akki 27-08-2024
//                     $last_strirog_count = $this->db->select('count(department_id) as striCount')->from('panchkarma_patient_count_opd')->where('department_id','29')->where('create_date',$last_create_date)->get()->row();

//                     #print_r($this->db->last_query());die();

//                     $last_shalakyatantra_count = $this->db->select('count(department_id) as shalakyaCount')->from('panchkarma_patient_count_opd')->where('department_id','30')->where('create_date',$last_create_date)->get()->row();

//                     $last_shalyatantra_count = $this->db->select('count(department_id) as shalyaCount')->from('panchkarma_patient_count_opd')->where('department_id','31')->where('create_date',$last_create_date)->get()->row();

//                     $last_balrog_count = $this->db->select('count(department_id) as balrogCount')->from('panchkarma_patient_count_opd')->where('department_id','32')->where('create_date',$last_create_date)->get()->row();

//                     //  echo $last_shalakyatantra_count->shalakyaCount;
//                     //  die();

//                     #akki 27-08-2024

//                     if($patient->department_id == '33' || $patient->department_id == '34' || $patient->department_id == '29' || $patient->department_id == '30' || $patient->department_id == '31' || $patient->department_id == '32')
//                     {
//                         if($tretment)
//                         {
//                             if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN ||       $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
//                             {
//                                 print_r("Panchakarma ==>==>==> ");
//                                 if($tretment->SNEHAN)
//                                 { 
//                                     print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
//                                     $Snehan = $Snehan + 1;
//                                 }
//                                 if($tretment->SWEDAN)
//                                 { 
//                                     print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
//                                     $Swedan = $Swedan + 1;
//                                 }
//                                 if($tretment->VAMAN)
//                                 { 
//                                     print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
//                                     $Vaman = $Vaman + 1;
//                                 }
//                                 if($tretment->VIRECHAN)
//                                 { 
//                                     print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
//                                     $Virechan = $Virechan + 1;
//                                 }
//                                 if($tretment->NASYA)
//                                 { 
//                                     print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
//                                     $Nasya = $Nasya + 1;
//                                 }
//                                 if($tretment->RAKTAMOKSHAN)
//                                 { 
//                                     print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
//                                     $Raktmokshan = $Raktmokshan + 1;
//                                 }
//                                 if($tretment->SHIRODHARA_SHIROBASTI)
//                                 { 
//                                     print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
//                                     $Shirodhara = $Shirodhara + 1;
//                                 }
//                                 if($tretment->SHIROBASTI)
//                                 { 
//                                     print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
//                                     $Shirobasti = $Shirobasti + 1;
//                                 }
//                                 if($tretment->UTTARBASTI)
//                                 { 
//                                     print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
//                                     $Uttarbasti = $Uttarbasti + 1;
//                                 }
//                                 if($tretment->BASTI)
//                                 { 
//                                     print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
//                                     $Basti = $Basti + 1;
//                                 }
//                                 if($tretment->YONIDHAVAN)
//                                 { 
//                                     print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
//                                     $Yonidhavan = $Yonidhavan + 1;
//                                 }
//                                 if($tretment->YONIPICHU)
//                                 { 
//                                     print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
//                                     $Yonipichu = $Yonipichu + 1;
//                                 }
//                                 if($tretment->OTHER)
//                                 { 
//                                     print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
//                                     $Other = $Other + 1;
//                                 }

//                                 (object)$postPatientInvestPanchData = ([
//                                 'patient_auto_id' => $patient->id,
//                                 'patient_name' => $patient->firstname,
//                                 'ipd_opd' => $patient->ipd_opd,
//                                 'sex' => $patient->sex,
//                                 'department_id' => $patient->department_id,
//                                 'create_date' => $patient->create_date,
//                                 'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
//                                 'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
//                                 'vaman' => ($tretment->VAMAN) ? $tretment->VAMAN : NULL,
//                                 'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
//                                 'nasya' => ($tretment->NASYA) ? $tretment->NASYA : NULL,
//                                 'raktmokshan' => ($tretment->RAKTAMOKSHAN) ? $tretment->RAKTAMOKSHAN : NULL,
//                                 'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
//                                 'shirobasti' => ($tretment->SHIROBASTI) ? $tretment->SHIROBASTI : NULL,
//                                 'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
//                                 'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
//                                 'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
//                                 'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
//                                 'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
//                                 ]);

//                                 $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('panchkarma_patient_count_opd')->num_rows();

//                                 #echo "<pre>"; print_r($postPatientInvestPanchData);

//                                 if($searchRes == 0)
//                                 {
//                                     #$updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);

//                                     #######akkki 28-08-2024
                                        
//                                             if($patient->department_id == 29)
//                                             {
//                                                 if($last_strirog_count->striCount <= 4){

//                                                     $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                                 }
//                                             }elseif($patient->department_id == 30)
//                                             {
//                                                 if($last_shalakyatantra_count->shalakyaCount <= 3){

//                                                     $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                                 }
//                                             }elseif($patient->department_id == 31)
//                                             {
//                                                 if($last_shalyatantra_count->shalyaCount <= 3){

//                                                     $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                                 }
//                                             }elseif($patient->department_id == 32)
//                                             {
//                                                 if($last_balrog_count->balrogCount <= 1){

//                                                     $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                                 }
//                                             }elseif($patient->department_id != 29 && $patient->department_id != 30 && $patient->department_id != 31 && $patient->department_id != 32){

//                                                 $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                             }

//                                             #print_r($this->db->last_query());die();


//                                         #######
//                                 }
                                                    
//                             }        
//                         }  
//                     }
//                     // }

//                     $data = array(
//                     'panchkamra' => '1'
//                     );  
//                     $this->db->where('create_date',$last_create_date);
//                     $this->db->or_where('ipd_patient_flag','1');
//                     $this->db->update('patient', $data);

//                     //  print_r($this->db->last_query());
//                 }   

//                 $investi_panch_count[$index] = [
//                 'Snehan' => $Snehan,
//                 'Swedan' => $Swedan,
//                 'Vaman' => $Vaman,
//                 'Virechan' => $Virechan,
//                 'Nasya' => $Nasya,
//                 'Raktmokshan' => $Raktmokshan,
//                 'Shirodhara' => $Shirodhara,
//                 'Shirobasti' => $Shirobasti,
//                 'Uttarbasti' => $Uttarbasti,
//                 'Basti' => $Basti,
//                 'Yonidhavan' => $Yonidhavan,
//                 'Yonipichu' => $Yonipichu,
//                 'Other' => $Other,
//                 ];

//                 //  echo "<pre>";
//                 // print_r($investi_panch_count);
//                 // die();

//                 $investi_panch_test_count[$index] = [
//                 'Snehan' => $Snehan,
//                 'Swedan' => $Swedan,
//                 'Vaman' => $Vaman,
//                 'Virechan' => $Virechan,
//                 'Nasya' => $Nasya,
//                 'Raktmokshan' => $Raktmokshan,
//                 'Shirodhara' => $Shirodhara,
//                 'Shirobasti' => $Shirobasti,
//                 'Uttarbasti' => $Uttarbasti,
//                 'Basti' => $Basti,
//                 'Yonidhavan' => $Yonidhavan,
//                 'Yonipichu' => $Yonipichu,
//                 'Other' => $Other,
//                 ];
              
//                 $index = $index + 1;
//                 print_r($investi_panch_count);print_r("<br>");
//                 print_r($investi_panch_test_count);print_r("<br>");
//                 for($i=0; $i<count($investi_panch_count);$i++)
//                 {
//                     $last_count = $this->db->select('*')->from('panchkarma_total_count_opd')->where('create_date',$last_create_date)->get()->row();
//                     //	print_r($this->db->last_query());
//                     //  die();
//                     if($last_count) 
//                     {
                             
//                         $snehan_count = $last_count->snehan_count;
//                         $swedan_count = $last_count->swedan_count;
//                         $vaman_count = $last_count->vaman_count;
//                         $virechan_count = $last_count->virechan_count;
//                         $nasya_count = $last_count->nasya_count;
//                         $raktmokshan_count = $last_count->raktmokshan_count;
//                         $shirodhara_count = $last_count->shirodhara_count;
//                         $shirobasti_count = $last_count->shirobasti_count;
//                         $uttarbasti_count = $last_count->uttarbasti_count;
//                         $basti_count = $last_count->basti_count;
//                         $yonidhavan_count = $last_count->yonidhavan_count;
//                         $yonipichu_count = $last_count->yonipichu_count;
//                         $others_count = $last_count->others_count;
                                  

//                         (object)$postPatientInvestPanchCountData = ([
//                         'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
//                         'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
//                         'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
//                         'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
//                         'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
//                         'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
//                         'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
//                         'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
//                         'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
//                         'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
//                         'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
//                         'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
//                         'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $this->db->where('create_date', $last_create_date);
//                         $res =  $this->db->update('panchkarma_total_count_opd', $postPatientInvestPanchCountData);

//                         // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
//                         $this->db->where('create_date', $last_create_date);
//                         $res1 =  $this->db->update('panchkarma_test_total_count_opd', $postPatientInvestPanchCountData);

//                         //  print_r($this->db->last_query());
//                         //  die();
//                         if($res && $res1)
//                         {
//                             print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
//                         }
//                     }   
//                     else
//                     {
//                         (object)$postPatientInvestPanchCountData = ([
//                         'ipd_opd' => 'opd',
//                         'create_date' => $last_create_date,
//                         'snehan_count' => $investi_panch_count[$i]['Snehan'],
//                         'swedan_count' => $investi_panch_count[$i]['Swedan'],
//                         'vaman_count' => $investi_panch_count[$i]['Vaman'],
//                         'virechan_count' => $investi_panch_count[$i]['Virechan'],
//                         'nasya_count' => $investi_panch_count[$i]['Nasya'],
//                         'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
//                         'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
//                         'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
//                         'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
//                         'basti_count' => $investi_panch_count[$i]['Basti'],
//                         'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
//                         'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
//                         'others_count' => $investi_panch_count[$i]['Other'],
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);
//                         echo "<pre>";
//                         ///   print_r($this->db->last_query());
//                         //   die();
//                         (object)$postPatientInvestPanchTestCountData = ([
//                         'ipd_opd' => 'opd',
//                         'create_date' => $last_create_date,
//                         'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
//                         'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
//                         'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
//                         'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
//                         'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
//                         'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
//                         'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
//                         'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
//                         'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
//                         'basti_count' => $investi_panch_test_count[$i]['Basti'],
//                         'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
//                         'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
//                         'others_count' => $investi_panch_test_count[$i]['Other'],
//                         ]);
//                         $res1 = $this->db->insert('panchkarma_test_total_count_opd', $postPatientInvestPanchTestCountData);
//                         if($res && $res1)
//                         {
//                             print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
//                         }
//                             //25 
//                     }
//                 }
      
//             }
//             elseif($current_date > $last_create_date)
//             {
//                 // echo "hoooooooooooooooooo";
    
//                 $index = 0;
//                 $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
//                 $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
//                 $Yonipichu = 0; $Other = 0;

//                 $patientList =  
//                 $this->db->select('*')
//                 ->from('patient')
//                 //->where('yearly_reg_no !=','')
//                 ->where('panchkamra','0')
//                 ->where('ipd_patient_flag','0')
//                 ->where('dignosis !=','')
//                 ->where('create_date',$last_create_date)
//                 ->where('ipd_opd','opd')
//                 ->order_by('id','ASC')
//                 //->order_by('RAND()')
//                 //->limit($rand_limit_patient)
//                 ->get()
//                 ->result();
//                 // print_r($this->db->last_query());
        
//                 foreach($patientList as $patient)
//                 {
//                     //echo "Push Date =================>".
//                     $startDate3=$patient->create_date;
//                     //echo "<br>";
//                     $section_tret='opd';
//                     $che=trim($patient->dignosis);
//                     $section_tret='opd';
//                     $len=strlen($che);
//                     $dd= substr($che,$len - 1);
//                     $str = $patient->dignosis;
//                     $arry=explode("-",$str);
//                     $t_c=count($arry);
//                     if($t_c=='2')
//                     {
//                         $dd1=substr($che, 0, -1);
//                         $new_str = trim($arry[0]);
//                         $p_dignosis = '%'.$new_str.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                     else
//                     {
//                         $p_dignosis = '%'.$che.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                     if($patient->manual_status==0)
//                     {
//                         if($patient->proxy_id)
//                         {
//                             $tretment=$this->db->select("*")
//                             ->from('treatments1')
//                             ->where('dignosis LIKE',$p_dignosis)
//                             ->where('proxy_id',$patient->proxy_id)
//                             ->where('department_id',$patient->department_id)
//                             ->where('ipd_opd ',$section_tret)
//                             ->get()
//                             ->row();
//                         }
//                         else
//                         {
//                             $tretment=$this->db->select("*")
//                             ->from('treatments1')
//                             ->where('dignosis LIKE',$p_dignosis)
//                             ->where('department_id',$patient->department_id)
//                             ->where('ipd_opd ',$section_tret)
//                             ->get()
//                             ->row();  
//                             if(empty($tretment))
//                             {
//                                 $tretment=$this->db->select("*")
//                                 ->from('treatments1')
//                                 ->where('department_id',$patient->department_id)
//                                 ->where('ipd_opd',$patient->department_id)
//                                 ->get()
//                                 ->row();   
//                             }
//                         }
//                     }
//                     else
//                     {
//                         $tretment=$this->db->select("*")
//                         ->from('manual_treatments')
//                         ->where('patient_id_auto',$patient->id)
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();
//                     }
                    

//                     #Akki 2-08-2024
//                     $last_strirog_count = $this->db->select('count(department_id) as striCount')->from('panchkarma_patient_count_opd')->where('department_id',29)->where('create_date',$last_create_date)->get()->row();

//                     #print_r($this->db->last_query());die();

//                     $last_shalakyatantra_count = $this->db->select('count(department_id) as shalakyaCount')->from('panchkarma_patient_count_opd')->where('department_id',30)->where('create_date',$last_create_date)->get()->row();

//                     $last_shalyatantra_count = $this->db->select('count(department_id) as shalyaCount')->from('panchkarma_patient_count_opd')->where('department_id',31)->where('create_date',$last_create_date)->get()->row();

//                     $last_balrog_count = $this->db->select('count(department_id) as balrogCount')->from('panchkarma_patient_count_opd')->where('department_id',32)->where('create_date',$last_create_date)->get()->row();

//                     // echo $last_shalakyatantra_count->shalakyaCount;
//                     // die();

//                     #akki 27-08-2024

//                     if($patient->department_id == '33' || $patient->department_id == '34' || $patient->department_id == '29' || $patient->department_id == '30' || $patient->department_id == '31' || $patient->department_id == '32')
//                     {
                        
//                         if($tretment)
//                         {
//                             if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
//                             {
//                                 print_r("Panchakarma ==>==>==> ");
//                                 if($tretment->SNEHAN)
//                                 { 
//                                     print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
//                                     $Snehan = $Snehan + 1;
//                                 }
//                                 if($tretment->SWEDAN)
//                                 { 
//                                     print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
//                                     $Swedan = $Swedan + 1;
//                                 }
//                                 if($tretment->VAMAN)
//                                 { 
//                                     print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
//                                     $Vaman = $Vaman + 1;
//                                 }
//                                 if($tretment->VIRECHAN)
//                                 { 
//                                     print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
//                                     $Virechan = $Virechan + 1;
//                                 }
//                                 if($tretment->NASYA)
//                                 { 
//                                     print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
//                                     $Nasya = $Nasya + 1;
//                                 }
//                                 if($tretment->RAKTAMOKSHAN)
//                                 { 
//                                     print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
//                                     $Raktmokshan = $Raktmokshan + 1;
//                                 }
//                                 if($tretment->SHIRODHARA_SHIROBASTI)
//                                 { 
//                                     print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
//                                     $Shirodhara = $Shirodhara + 1;
//                                 }
//                                 if($tretment->SHIROBASTI)
//                                 { 
//                                     print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
//                                     $Shirobasti = $Shirobasti + 1;
//                                 }
//                                 if($tretment->UTTARBASTI)
//                                 { 
//                                     print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
//                                     $Uttarbasti = $Uttarbasti + 1;
//                                 }
//                                 if($tretment->BASTI)
//                                 { 
//                                     print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
//                                     $Basti = $Basti + 1;
//                                 }
//                                 if($tretment->YONIDHAVAN)
//                                 { 
//                                     print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
//                                     $Yonidhavan = $Yonidhavan + 1;
//                                 }
//                                 if($tretment->YONIPICHU)
//                                 { 
//                                     print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
//                                     $Yonipichu = $Yonipichu + 1;
//                                 }
//                                 if($tretment->OTHER)
//                                 { 
//                                     print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
//                                     $Other = $Other + 1;
//                                 }

//                                 (object)$postPatientInvestPanchData = ([
//                                 'patient_auto_id' => $patient->id,
//                                 'patient_name' => $patient->firstname,
//                                 'ipd_opd' => $patient->ipd_opd,
//                                 'sex' => $patient->sex,
//                                 'department_id' => $patient->department_id,
//                                 'create_date' => $patient->create_date,
//                                 'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
//                                 'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
//                                 'vaman' => ($tretment->VAMAN) ? $tretment->VAMAN : NULL,
//                                 'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
//                                 'nasya' => ($tretment->NASYA) ? $tretment->NASYA : NULL,
//                                 'raktmokshan' => ($tretment->RAKTAMOKSHAN) ? $tretment->RAKTAMOKSHAN : NULL,
//                                 'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
//                                 'shirobasti' => ($tretment->SHIROBASTI) ? $tretment->SHIROBASTI : NULL,
//                                 'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
//                                 'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
//                                 'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
//                                 'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
//                                 'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
//                                 ]);

//                                 //echo "<br>";
//                                 // print_r($postPatientInvestPanchData);
//                                 //  echo "<br>";
//                                 $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('panchkarma_patient_count_opd')->num_rows();
//                                 if($searchRes == 0)
//                                 {   

//                                     #######akkki 28-08-2024
                                
//                                     if($patient->department_id == 29)
//                                     {
//                                         if($last_strirog_count->striCount <= 4){

//                                             $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                         }
//                                     }elseif($patient->department_id == 30)
//                                     {
//                                         if($last_shalakyatantra_count->shalakyaCount <= 3){

//                                             $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                         }
//                                     }elseif($patient->department_id == 31)
//                                     {
//                                         if($last_shalyatantra_count->shalyaCount <= 3){

//                                             $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                         }
//                                     }elseif($patient->department_id == 32)
//                                     {
//                                         if($last_balrog_count->balrogCount <= 1){

//                                             $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                         }
//                                     }elseif($patient->department_id != 29 && $patient->department_id != 30 && $patient->department_id != 31 && $patient->department_id != 32){

//                                         $updateRes = $this->db->insert('panchkarma_patient_count_opd', $postPatientInvestPanchData);
//                                     }

//                                     #######

//                                 }  
//                             }                
//                         }  
//                     }

//                     $data = array(
//                         'panchkamra' => '1'
//                     );
//                     $this->db->where('create_date',$last_create_date);
//                     $this->db->or_where('ipd_patient_flag','1');
//                     $this->db->update('patient', $data);
//                     //  print_r($this->db->last_query());
//                 }           
                            
//                 $investi_panch_count[$index] = [
//                 'Snehan' => $Snehan,
//                 'Swedan' => $Swedan,
//                 'Vaman' => $Vaman,
//                 'Virechan' => $Virechan,
//                 'Nasya' => $Nasya,
//                 'Raktmokshan' => $Raktmokshan,
//                 'Shirodhara' => $Shirodhara,
//                 'Shirobasti' => $Shirobasti,
//                 'Uttarbasti' => $Uttarbasti,
//                 'Basti' => $Basti,
//                 'Yonidhavan' => $Yonidhavan,
//                 'Yonipichu' => $Yonipichu,
//                 'Other' => $Other,
//                 ];
        
//                 $investi_panch_test_count[$index] = [
//                 'Snehan' => $Snehan,
//                 'Swedan' => $Swedan,
//                 'Vaman' => $Vaman,
//                 'Virechan' => $Virechan,
//                 'Nasya' => $Nasya,
//                 'Raktmokshan' => $Raktmokshan,
//                 'Shirodhara' => $Shirodhara,
//                 'Shirobasti' => $Shirobasti,
//                 'Uttarbasti' => $Uttarbasti,
//                 'Basti' => $Basti,
//                 'Yonidhavan' => $Yonidhavan,
//                 'Yonipichu' => $Yonipichu,
//                 'Other' => $Other,
//                 ];
            
//                 $index = $index + 1;
//                 print_r($investi_panch_count);print_r("<br>");
//                 #print_r($investi_panch_test_count);print_r("<br>");

//                 for($i=0; $i<count($investi_panch_count);$i++)
//                 {
//                     $last_count = $this->db->select('*')->from('panchkarma_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                    
//                     if($last_count) 
//                     {
//                         $snehan_count = $last_count->snehan_count;
//                         $swedan_count = $last_count->swedan_count;
//                         $vaman_count = $last_count->vaman_count;
//                         $virechan_count = $last_count->virechan_count;
//                         $nasya_count = $last_count->nasya_count;
//                         $raktmokshan_count = $last_count->raktmokshan_count;
//                         $shirodhara_count = $last_count->shirodhara_count;
//                         $shirobasti_count = $last_count->shirobasti_count;
//                         $uttarbasti_count = $last_count->uttarbasti_count;
//                         $basti_count = $last_count->basti_count;
//                         $yonidhavan_count = $last_count->yonidhavan_count;
//                         $yonipichu_count = $last_count->yonipichu_count;
//                         $others_count = $last_count->others_count;
                        

//                         (object)$postPatientInvestPanchCountData = ([
//                         'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
//                         'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
//                         'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
//                         'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
//                         'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
//                         'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
//                         'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
//                         'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
//                         'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
//                         'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
//                         'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
//                         'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
//                         'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $this->db->where('create_date', $last_create_date);
//                         $res =  $this->db->update('panchkarma_total_count_opd', $postPatientInvestPanchCountData);

//                         // $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);+
//                         $this->db->where('create_date', $last_create_date);
//                         $res1 =  $this->db->update('panchkarma_test_total_count_opd', $postPatientInvestPanchCountData);

//                         if($res && $res1)
//                         {
//                             print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
//                         }
//                     }   
//                     else
//                     {
//                         (object)$postPatientInvestPanchCountData = ([
//                         'ipd_opd' => 'opd',
//                         'create_date' => $last_create_date,
//                         'snehan_count' => $investi_panch_count[$i]['Snehan'],
//                         'swedan_count' => $investi_panch_count[$i]['Swedan'],
//                         'vaman_count' => $investi_panch_count[$i]['Vaman'],
//                         'virechan_count' => $investi_panch_count[$i]['Virechan'],
//                         'nasya_count' => $investi_panch_count[$i]['Nasya'],
//                         'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
//                         'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
//                         'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
//                         'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
//                         'basti_count' => $investi_panch_count[$i]['Basti'],
//                         'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
//                         'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
//                         'others_count' => $investi_panch_count[$i]['Other'],
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $res = $this->db->insert('panchkarma_total_count_opd', $postPatientInvestPanchCountData);
//                         echo "<pre>";
                                
//                         (object)$postPatientInvestPanchTestCountData = ([
//                         'ipd_opd' => 'opd',
//                         'create_date' => $last_create_date,
//                         'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
//                         'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
//                         'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
//                         'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
//                         'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
//                         'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
//                         'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
//                         'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
//                         'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
//                         'basti_count' => $investi_panch_test_count[$i]['Basti'],
//                         'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
//                         'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
//                         'others_count' => $investi_panch_test_count[$i]['Other'],
//                         ]);
//                         $res1 = $this->db->insert('panchkarma_test_total_count_opd', $postPatientInvestPanchTestCountData);
//                         if($res && $res1)
//                         {
//                         print_r('OPD Investigation & Panchakarma Counting Inserted Successfully');
//                         }
//                         //25
//                     }
//                 }
//             }

//             #die();

//             ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//             /////////////////////////////////////                                                         /////////////////////////////////////
//             /////////////////////////////////////      IPD Investigation & Panchakarma Counting CODE      /////////////////////////////////////
//             /////////////////////////////////////                                                         /////////////////////////////////////
//             /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 

//             $start_time= date('H:i',strtotime('18:15'));
//             $time_date=date('H:i');
//             $current_date = date('Y-m-d');
//             $last_date_res = 
//             $this->db->select('*')
//             ->where('ipd_opd', 'ipd')
//             ->where('panchkamra','0')
//             //->where('year(create_date)','2023')
//             ->limit(1)
//             ->order_by('id','ASC')
//             ->get('patient_ipd')
//             ->row();
//             // print_r($this->db->last_query());
//             echo "<br>";
//             $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));
    
// 		    echo "<br><br><br><br>";
//             echo "Last Date IPD=================>".$last_create_date;
//             echo "<br>";
//             echo "Current Date IPD=================>".$current_date;
//             echo "<br>";
//             echo "Push Date IPD=================>".$last_create_date;
//             echo "<br>";

//             if($last_create_date == $current_date)
//             {
//                 $index = 0;
//                 $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
//                 $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
//                 $Yonipichu = 0; $Other = 0;
//                 //   echo "hiiiiiii";
 
//                $patients1 = $this->db->select("*")
//                ->from('patient_ipd')
//                ->join('department','department.dprt_id = patient_ipd.department_id')
//                ->where('discharge_date >=', $last_create_date)
//                ->where('create_date <=', $last_create_date)
//                ->where('dignosis !=', '')
//                ->where('ipd_opd', 'ipd')
//                ->get()
//                ->result();

//                 $patients2 = $this->db->select("*")
//                 ->from('patient_ipd')
//                 ->join('department','department.dprt_id = patient_ipd.department_id')
//                 ->where('create_date <=', $last_create_date)
//                 ->where('dignosis !=', '')
//                 ->where('discharge_date LIKE', '%0000-00-00%')
//                 ->where('ipd_opd', 'ipd')
//                 ->get()
//                 ->result();
                
//                 //print_r('q2   ');                    
               
        
//                 $patientList = array_merge($patients1, $patients2);
//                 foreach($patientList as $patient)
//                 {
//                     //echo "Push Date =================>".
//                     $startDate2=$patient->create_date;
//                     echo "<br>";
//                     $section_tret='ipd';
//                     $che=trim($patient->dignosis);
//                     $section_tret='ipd';
//                     $len=strlen($che);
//                     $dd= substr($che,$len - 1);
//                     $str = $patient->dignosis;
//                     $arry=explode("-",$str);
//                     $t_c=count($arry);
//                     if($t_c=='2')
//                     {
//                         $dd1=substr($che, 0, -1);
//                         $new_str = trim($arry[0]);
//                         $p_dignosis = '%'.$new_str.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                     else
//                     {
//                         $p_dignosis = '%'.$che.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                     if($patient->manual_status==0)
//                     {
//                         if($patient->proxy_id)
//                         {
//                             $tretment=$this->db->select("*")
//                             ->from('treatments1')
//                             ->where('dignosis LIKE',$p_dignosis)
//                             ->where('proxy_id',$patient->proxy_id)
//                             ->where('department_id',$patient->department_id)
//                             ->where('ipd_opd ',$section_tret)
//                             ->get()
//                             ->row();
//                         }
//                         else
//                         {
//                             $tretment=$this->db->select("*")
//                             ->from('treatments1')
//                             ->where('dignosis LIKE',$p_dignosis)
//                             ->where('department_id',$patient->department_id)
//                             ->where('ipd_opd ',$section_tret)
//                             ->get()
//                             ->row();  
//                             if(empty($tretment))
//                             {
//                                 $tretment=$this->db->select("*")
//                                 ->from('treatments1')
//                                 ->where('department_id',$patient->department_id)
//                                 ->where('ipd_opd',$patient->department_id)
//                                 ->get()
//                                 ->row();   
//                             }
//                         }
//                     }
//                     else
//                     {
//                         $tretment=$this->db->select("*")
//                         ->from('manual_treatments')
//                         ->where('patient_id_auto',$patient->id)
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();
//                     }
//                     //  echo "<pre>";
//                     if($tretment)
//                     {
//                         if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
//                         {
//                             echo 'Patient create Date ====>'.$admit_date=date("Y-m-d",strtotime($patient->create_date));
//                             // echo "<br><br><br><br><br>";
//                             $admit_v_date=strtotime($patient->create_date);
//                             //  echo "<br><br><br><br><br>";
//                             $vaman_date=strtotime("+6 days",$admit_v_date); 
//                             // echo "<br><br><br><br><br>";
//                             echo 'Vaman Date ====>'.$vaman_virachan_date = date("Y-m-d",$vaman_date);
//                             // echo "<br><br><br><br><br>";                           
//                             $shirobasti_date=strtotime("+1 days",$admit_v_date); 
//                             // echo "<br><br><br><br><br>";
//                             echo 'Shirobasti Date ====>'.$shirobasti_final_date = date("Y-m-d",$shirobasti_date);
//                             //  echo "<br><br><br><br><br>";
//                             echo 'Fibal Push Date ===>'.$push_final_date = date('Y-m-d',strtotime($last_create_date));
//                             // echo "<br><br><br><br><br>";                        
                            
//                             $date1=date_create($admit_date);
//                             $date2=date_create($last_create_date);
//                             $diff=date_diff($date1,$date2);
//                             $diffDay = $diff->format("%a");
//                             $shirobastiCheck = ($diffDay % 2);
//                             print_r("Panchakarma ==>==>==> ");
//                             if($tretment->SNEHAN)
//                             { 
//                                 print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
//                                 $Snehan = $Snehan + 1;
//                             }
//                             if($tretment->SWEDAN)
//                             { 
//                                 print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
//                                 $Swedan = $Swedan + 1;
//                             }
//                             if($tretment->VAMAN && $vaman_virachan_date == $push_final_date)
//                             { 
//                                 print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
//                                 $Vaman = $Vaman + 1;
//                             }
//                             // die();
//                             if($tretment->VIRECHAN)
//                             { 
//                                 print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
//                                 $Virechan = $Virechan + 1;
//                             }
//                             if($tretment->NASYA && $admit_date == $push_final_date)
//                             { 
//                                 print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
//                                 $Nasya = $Nasya + 1;
//                             }
//                             if($tretment->RAKTAMOKSHAN && $admit_date == $push_final_date)
//                             { 
//                                 print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
//                                 $Raktmokshan = $Raktmokshan + 1;
//                             }
//                             if($tretment->SHIRODHARA_SHIROBASTI)
//                             { 
//                                 print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
//                                 $Shirodhara = $Shirodhara + 1;
//                             }
//                             if($tretment->SHIROBASTI && $shirobasti_final_date == $push_final_date)
//                             { 
//                                 print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
//                                 $Shirobasti = $Shirobasti + 1;
//                             }
//                             if($tretment->UTTARBASTI)
//                             { 
//                                 print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
//                                 $Uttarbasti = $Uttarbasti + 1;
//                             }
//                             if($tretment->BASTI)
//                             { 
//                                 print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
//                                 $Basti = $Basti + 1;
//                             }
//                             if($tretment->YONIDHAVAN)
//                             { 
//                                 print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
//                                 $Yonidhavan = $Yonidhavan + 1;
//                             }
//                             if($tretment->YONIPICHU)
//                             { 
//                                 print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
//                                 $Yonipichu = $Yonipichu + 1;
//                             }
//                             if($tretment->OTHER)
//                             { 
//                                 print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
//                                 $Other = $Other + 1;
//                             }
//                             (object)$postPatientInvestPanchData = ([
//                             'patient_auto_id' => $patient->id,
//                             'patient_name' => $patient->firstname,
//                             'ipd_opd' => $patient->ipd_opd,
//                             'sex' => $patient->sex,
//                             'create_date' => $last_create_date,
//                             'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
//                             'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
//                             'vaman' => ($vaman_virachan_date == $push_final_date) ? $tretment->VAMAN : NULL,
//                             'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
//                             'nasya' => ($admit_date == $push_final_date) ? $tretment->NASYA : NULL,
//                             'raktmokshan' => ($admit_date == $push_final_date) ? $tretment->RAKTAMOKSHAN : NULL,
//                             'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
//                             'shirobasti' => ($shirobasti_final_date == $push_final_date) ? $tretment->SHIROBASTI : NULL,
//                             'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
//                             'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
//                             'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
//                             'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
//                             'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
//                             ]);
//                             $updateRes = $this->db->insert('panchkarma_patient_count_ipd', $postPatientInvestPanchData);
//                         }
//                         $data = array(
//                         'panchkamra' => '1'
//                         );
//                         $this->db->where('create_date',$last_create_date);
//                         $this->db->update('patient_ipd', $data);
//                         #print_r($this->db->last_query()); 
//                     }
//                 }  
//                 $investi_panch_count[$index] = [
//                 'Snehan' => $Snehan,
//                 'Swedan' => $Swedan,
//                 'Vaman' => $Vaman,
//                 'Virechan' => $Virechan,
//                 'Nasya' => $Nasya,
//                 'Raktmokshan' => $Raktmokshan,
//                 'Shirodhara' => $Shirodhara,
//                 'Shirobasti' => $Shirobasti,
//                 'Uttarbasti' => $Uttarbasti,
//                 'Basti' => $Basti,
//                 'Yonidhavan' => $Yonidhavan,
//                 'Yonipichu' => $Yonipichu,
//                 'Other' => $Other,
//                 ];
            
//                 $investi_panch_test_count[$index] = [
//                 'Snehan' => $Snehan,
//                 'Swedan' => $Swedan,
//                 'Vaman' => $Vaman,
//                 'Virechan' => $Virechan,
//                 'Nasya' => $Nasya,
//                 'Raktmokshan' => $Raktmokshan,
//                 'Shirodhara' => $Shirodhara,
//                 'Shirobasti' => $Shirobasti,
//                 'Uttarbasti' => $Uttarbasti,
//                 'Basti' => $Basti,
//                 'Yonidhavan' => $Yonidhavan,
//                 'Yonipichu' => $Yonipichu,
//                 'Other' => $Other,
//                 ];
//                 $index = $index + 1;
//                 print_r($investi_panch_count);print_r("<br>");
//                 #print_r($investi_panch_test_count);print_r("<br>");

//                 for($i=0; $i<count($investi_panch_count);$i++)
//                 {
//                     $last_count = $this->db->select('*')->from('panchkarma_total_count_ipd')->where('create_date',$startDate2)->get()->row();
//                     if($last_count)
//                     {        
//                         $snehan_count = $last_count->snehan_count;
//                         $swedan_count = $last_count->swedan_count;
//                         $vaman_count = $last_count->vaman_count;
//                         $virechan_count = $last_count->virechan_count;
//                         $nasya_count = $last_count->nasya_count;
//                         $raktmokshan_count = $last_count->raktmokshan_count;
//                         $shirodhara_count = $last_count->shirodhara_count;
//                         $shirobasti_count = $last_count->shirobasti_count;
//                         $uttarbasti_count = $last_count->uttarbasti_count;
//                         $basti_count = $last_count->basti_count;
//                         $yonidhavan_count = $last_count->yonidhavan_count;
//                         $yonipichu_count = $last_count->yonipichu_count;
//                         $others_count = $last_count->others_count;
                                
//                         (object)$postPatientInvestPanchCountData = ([
//                         'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
//                         'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
//                         'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
//                         'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
//                         'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
//                         'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
//                         'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
//                         'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
//                         'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
//                         'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
//                         'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
//                         'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
//                         'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $this->db->where('create_date', $startDate2);
//                         $res =  $this->db->update('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);

//                         $this->db->where('create_date', $startDate2);
//                         $res1 =  $this->db->update('panchkarma_test_total_count_ipd', $postPatientInvestPanchCountData);

//                         //     //  print_r($this->db->last_query());
//                         //     //  die();
//                         if($res && $res1)
//                         {
//                             print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
//                         }
//                     }   
//                     else
//                     {
//                         (object)$postPatientInvestPanchCountData = ([
//                         'ipd_opd' => 'ipd',
//                         'create_date' => $startDate2,
//                         'snehan_count' => $investi_panch_count[$i]['Snehan'],
//                         'swedan_count' => $investi_panch_count[$i]['Swedan'],
//                         'vaman_count' => $investi_panch_count[$i]['Vaman'],
//                         'virechan_count' => $investi_panch_count[$i]['Virechan'],
//                         'nasya_count' => $investi_panch_count[$i]['Nasya'],
//                         'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
//                         'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
//                         'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
//                         'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
//                         'basti_count' => $investi_panch_count[$i]['Basti'],
//                         'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
//                         'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
//                         'others_count' => $investi_panch_count[$i]['Other'],
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);
                        
//                         $res = $this->db->insert('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);
//                         #echo "<pre>";
//                         ///   print_r($this->db->last_query());
//                         //   die();
//                         (object)$postPatientInvestPanchTestCountData = ([
//                         'ipd_opd' => 'ipd',
//                         'create_date' => $startDate2,
//                         'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
//                         'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
//                         'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
//                         'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
//                         'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
//                         'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
//                         'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
//                         'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
//                         'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
//                         'basti_count' => $investi_panch_test_count[$i]['Basti'],
//                         'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
//                         'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
//                         'others_count' => $investi_panch_test_count[$i]['Other'],
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $res1 = $this->db->insert('panchkarma_test_total_count_ipd', $postPatientInvestPanchTestCountData);
//                         if($res && $res1)
//                         {
//                             print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
//                         }
//                             //25
//                     }
//                 }
//             }
//             elseif($current_date > $last_create_date)
//             {
//                 $index = 0;
//                 $Snehan = 0; $Swedan = 0; $Vaman = 0; $Virechan = 0; $Nasya = 0; $Raktmokshan = 0; 
//                 $Shirodhara = 0; $Shirobasti = 0; $Uttarbasti = 0; $Basti = 0; $Yonidhavan = 0; 
//                 $Yonipichu = 0; $Other = 0;
//                 //   echo "hiiiiiii";
 
//                $patients1 = $this->db->select("*")
//                 ->from('patient_ipd')
//                 ->join('department','department.dprt_id = patient_ipd.department_id')
//                 ->where('discharge_date >=', $last_create_date)
//                 ->where('create_date <=', $last_create_date)
//                 ->where('dignosis !=', '')
//                 //->where('manual_status', '0')
//                 //->where('panchkamra','0')
//                 ->where('ipd_opd', 'ipd')
//                 ->get()
//                 ->result();
                        
//                 //print_r('q1   ');
//                 //print_r($this->db->last_query());
                
        
//                 $patients2 = $this->db->select("*")
//                 ->from('patient_ipd')
//                 ->join('department','department.dprt_id = patient_ipd.department_id')
//                 ->where('create_date <=', $last_create_date)
//                 ->where('dignosis !=', '')
//                 //  ->where('manual_status', '0')
//                 // ->where('panchkamra','0')
//                 ->where('discharge_date LIKE', '%0000-00-00%')
//                 ->where('ipd_opd', 'ipd')
//                 ->get()
//                 ->result();
                
//                 //print_r('q2   ');                    
               
        
//                 $patientList = array_merge($patients1, $patients2);
//                 foreach($patientList as $patient)
//                 {
//                     // print_r($patient->firstname);
//                     //  die();
//                     //echo "Push Date =================>".
//                     $startDate2=$patient->create_date;
//                     echo "<br>";
//                     $section_tret='ipd';
//                     $che=trim($patient->dignosis);
//                     $section_tret='ipd';
//                     $len=strlen($che);
//                     $dd= substr($che,$len - 1);
//                     $str = $patient->dignosis;
//                     $arry=explode("-",$str);
//                     $t_c=count($arry);
//                     if($t_c=='2')
//                     {
//                         $dd1=substr($che, 0, -1);
//                         $new_str = trim($arry[0]);
//                         $p_dignosis = '%'.$new_str.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                     else
//                     {
//                         $p_dignosis = '%'.$che.'%';
//                         $p_dignosis_name=$patient->dignosis;
//                     }
//                     if($patient->manual_status==0)
//                     {
//                         if($patient->proxy_id)
//                         {
//                             $tretment=$this->db->select("*")
//                             ->from('treatments1')
//                             ->where('dignosis LIKE',$p_dignosis)
//                             ->where('proxy_id',$patient->proxy_id)
//                             ->where('department_id',$patient->department_id)
//                             ->where('ipd_opd ',$section_tret)
//                             ->get()
//                             ->row();
//                         }
//                         else
//                         {
//                             $tretment=$this->db->select("*")
//                             ->from('treatments1')
//                             ->where('dignosis LIKE',$p_dignosis)
//                             ->where('department_id',$patient->department_id)
//                             ->where('ipd_opd ',$section_tret)
//                             ->get()
//                             ->row();  
//                             if(empty($tretment))
//                             {
//                                 $tretment=$this->db->select("*")
//                                 ->from('treatments1')
//                                 ->where('department_id',$patient->department_id)
//                                 ->where('ipd_opd',$patient->department_id)
//                                 ->get()
//                                 ->row();   
//                             }
//                         }
//                     }
//                     else
//                     {
//                         $tretment=$this->db->select("*")
//                         ->from('manual_treatments')
//                         ->where('patient_id_auto',$patient->id)
//                         ->where('dignosis LIKE',$p_dignosis)
//                         ->where('ipd_opd ',$section_tret)
//                         ->get()
//                         ->row();
//                     }
//                     //  echo "<pre>";
//                     if($tretment)
//                     {
//                         if($tretment->SNEHAN || $tretment->SWEDAN || $tretment->VAMAN || $tretment->VIRECHAN || $tretment->NASYA || $tretment->RAKTAMOKSHAN || $tretment->SHIRODHARA_SHIROBASTI || $tretment->SHIROBASTI || $tretment->UTTARBASTI || $tretment->BASTI || $tretment->YONIDHAVAN || $tretment->YONIPICHU || $tretment->OTHER)
//                         {
//                            // echo "<br><br><br><br><br>";
//                             echo 'Patient create Date ====>'.$admit_date=date("Y-m-d",strtotime($patient->create_date));
//                            // echo "<br><br><br><br><br>";
//                             $admit_v_date=strtotime($patient->create_date);
//                            //  echo "<br><br><br><br><br>";
//                             $vaman_date=strtotime("+6 days",$admit_v_date); 
//                            // echo "<br><br><br><br><br>";
//                             echo 'Vaman Date ====>'.$vaman_virachan_date = date("Y-m-d",$vaman_date);
//                            // echo "<br><br><br><br><br>";                           
//                             $shirobasti_date=strtotime("+1 days",$admit_v_date); 
//                            // echo "<br><br><br><br><br>";
//                             echo 'Shirobasti Date ====>'.$shirobasti_final_date = date("Y-m-d",$shirobasti_date);
//                            //  echo "<br><br><br><br><br>";
//                             echo 'Fibal Push Date ===>'.$push_final_date = date('Y-m-d',strtotime($last_create_date));
//                            // echo "<br><br><br><br><br>";                        
                            
//                             //die();
//                             // echo "<br><br><br><br><br><br><br><br><br><br><br><br><br>";
                            
//                             $date1=date_create($admit_date);
//                             $date2=date_create($last_create_date);
//                             $diff=date_diff($date1,$date2);
//                             $diffDay = $diff->format("%a");
//                             $shirobastiCheck = ($diffDay % 2);

//                             print_r("Panchakarma ==>==>==> ");
//                             if($tretment->SNEHAN)
//                             { 
//                                 print_r("Snehan");print_r(' ==>==>==>==> ');print_r($tretment->SNEHAN); 
//                                 $Snehan = $Snehan + 1;
//                             }
//                             if($tretment->SWEDAN)
//                             { 
//                                 print_r("Swedan");print_r(' ==>==>==>==> ');print_r($tretment->SWEDAN); 
//                                 $Swedan = $Swedan + 1;
//                             }
//                             if($tretment->VAMAN && $vaman_virachan_date == $push_final_date){ 
//                                 print_r("Vaman");print_r(' ==>==>==>==> ');print_r($tretment->VAMAN); 
//                                 $Vaman = $Vaman + 1;
//                             }
                            
//                             //   die();
//                             if($tretment->VIRECHAN)
//                             { 
//                                 print_r("Virechan");print_r(' ==>==>==>==> ');print_r($tretment->VIRECHAN);
//                                 $Virechan = $Virechan + 1;
//                             }
//                             if($tretment->NASYA && $admit_date == $push_final_date)
//                             { 
//                                 print_r("Nasya");print_r(' ==>==>==>==> ');print_r($tretment->NASYA); 
//                                 $Nasya = $Nasya + 1;
//                             }
//                             if($tretment->RAKTAMOKSHAN && $admit_date == $push_final_date)
//                             { 
//                                 print_r("Raktmokshan");print_r(' ==>==>==>==> ');print_r($tretment->RAKTAMOKSHAN); 
//                                 $Raktmokshan = $Raktmokshan + 1;
//                             }
//                             if($tretment->SHIRODHARA_SHIROBASTI)
//                             { 
//                                 print_r("Shirodhara");print_r(' ==>==>==>==> ');print_r($tretment->SHIRODHARA_SHIROBASTI);
//                                 $Shirodhara = $Shirodhara + 1;
//                             }
//                             if($tretment->SHIROBASTI && $shirobasti_final_date == $push_final_date)
//                             { 
//                                 print_r("Shirobast");print_r(' ==>==>==>==> ');print_r($tretment->SHIROBASTI); 
//                                 $Shirobasti = $Shirobasti + 1;
//                             }
//                             if($tretment->UTTARBASTI)
//                             { 
//                                 print_r("Uttarbasti");print_r(' ==>==>==>==> ');print_r($tretment->UTTARBASTI);
//                                 $Uttarbasti = $Uttarbasti + 1;
//                             }
//                             if($tretment->BASTI)
//                             { 
//                                 print_r("Basti");print_r(' ==>==>==>==> ');print_r($tretment->BASTI);
//                                 $Basti = $Basti + 1;
//                             }
//                             if($tretment->YONIDHAVAN)
//                             { 
//                                 print_r("Yonidhavan");print_r(' ==>==>==>==> ');print_r($tretment->YONIDHAVAN);
//                                 $Yonidhavan = $Yonidhavan + 1;
//                             }
//                             if($tretment->YONIPICHU)
//                             { 
//                                 print_r("Yonipichu");print_r(' ==>==>==>==> ');print_r($tretment->YONIPICHU);
//                                 $Yonipichu = $Yonipichu + 1;
//                             }
//                             if($tretment->OTHER)
//                             { 
//                                 print_r("Other");print_r(' ==>==>==>==> ');print_r($tretment->OTHER);
//                                 $Other = $Other + 1;
//                             }
//                             (object)$postPatientInvestPanchData = ([
//                             'patient_auto_id' => $patient->id,
//                             'patient_name' => $patient->firstname,
//                             'ipd_opd' => $patient->ipd_opd,
//                             'sex' => $patient->sex,
//                             'create_date' => $last_create_date,
//                             'snehan' => ($tretment->SNEHAN) ? $tretment->SNEHAN : NULL,
//                             'swedan' => ($tretment->SWEDAN) ? $tretment->SWEDAN : NULL,
//                             'vaman' => ($vaman_virachan_date == $push_final_date) ? $tretment->VAMAN : NULL,
//                             'virechan' => ($tretment->VIRECHAN) ? $tretment->VIRECHAN : NULL,
//                             'nasya' => ($admit_date == $push_final_date) ? $tretment->NASYA : NULL,
//                             'raktmokshan' => ($admit_date == $push_final_date) ? $tretment->RAKTAMOKSHAN : NULL,
//                             'shirodhara' => ($tretment->SHIRODHARA_SHIROBASTI) ? $tretment->SHIRODHARA_SHIROBASTI : NULL,
//                             'shirobasti' => ($shirobasti_final_date == $push_final_date) ? $tretment->SHIROBASTI : NULL,
//                             'uttarbasti' => ($tretment->UTTARBASTI) ? $tretment->UTTARBASTI : NULL,
//                             'basti' => ($tretment->BASTI) ? $tretment->BASTI : NULL,
//                             'yonidhavan' => ($tretment->YONIDHAVAN) ? $tretment->YONIDHAVAN : NULL,
//                             'yonipichu' => ($tretment->YONIPICHU) ? $tretment->YONIPICHU : NULL,
//                             'others' => ($tretment->OTHER) ? $tretment->OTHER : NULL,
//                             ]);
                            
//                             $updateRes = $this->db->insert('panchkarma_patient_count_ipd', $postPatientInvestPanchData);
//                         }
//                         $data = array(
//                         'panchkamra' => '1'
//                         );

//                         $this->db->where('create_date',$last_create_date);
//                         $this->db->update('patient_ipd', $data);
//                         #print_r($this->db->last_query());
//                     }
//                 }  
//                 // die();
                    
//                 $investi_panch_count[$index] = [
//                 'Snehan' => $Snehan,
//                 'Swedan' => $Swedan,
//                 'Vaman' => $Vaman,
//                 'Virechan' => $Virechan,
//                 'Nasya' => $Nasya,
//                 'Raktmokshan' => $Raktmokshan,
//                 'Shirodhara' => $Shirodhara,
//                 'Shirobasti' => $Shirobasti,
//                 'Uttarbasti' => $Uttarbasti,
//                 'Basti' => $Basti,
//                 'Yonidhavan' => $Yonidhavan,
//                 'Yonipichu' => $Yonipichu,
//                 'Other' => $Other,
//                 ];
             
//                 $investi_panch_test_count[$index] = [
//                 'Snehan' => $Snehan,
//                 'Swedan' => $Swedan,
//                 'Vaman' => $Vaman,
//                 'Virechan' => $Virechan,
//                 'Nasya' => $Nasya,
//                 'Raktmokshan' => $Raktmokshan,
//                 'Shirodhara' => $Shirodhara,
//                 'Shirobasti' => $Shirobasti,
//                 'Uttarbasti' => $Uttarbasti,
//                 'Basti' => $Basti,
//                 'Yonidhavan' => $Yonidhavan,
//                 'Yonipichu' => $Yonipichu,
//                 'Other' => $Other,
//                 ];
        

//                 $index = $index + 1;
//                 // print_r($investi_panch_count);print_r("<br>");
//                 // print_r($investi_panch_test_count);print_r("<br>");

//                 for($i=0; $i<count($investi_panch_count);$i++)
//                 {
//                     $last_count = $this->db->select('*')->from('panchkarma_total_count_ipd')->where('create_date',$startDate2)->get()->row();
//                     if($last_count)
//                     {           
//                         $snehan_count = $last_count->snehan_count;
//                         $swedan_count = $last_count->swedan_count;
//                         $vaman_count = $last_count->vaman_count;
//                         $virechan_count = $last_count->virechan_count;
//                         $nasya_count = $last_count->nasya_count;
//                         $raktmokshan_count = $last_count->raktmokshan_count;
//                         $shirodhara_count = $last_count->shirodhara_count;
//                         $shirobasti_count = $last_count->shirobasti_count;
//                         $uttarbasti_count = $last_count->uttarbasti_count;
//                         $basti_count = $last_count->basti_count;
//                         $yonidhavan_count = $last_count->yonidhavan_count;
//                         $yonipichu_count = $last_count->yonipichu_count;
//                         $others_count = $last_count->others_count;
                        
//                         (object)$postPatientInvestPanchCountData = ([
//                         'snehan_count' => $investi_panch_count[$i]['Snehan'] + $snehan_count,
//                         'swedan_count' => $investi_panch_count[$i]['Swedan'] + $swedan_count,
//                         'vaman_count' => $investi_panch_count[$i]['Vaman'] + $vaman_count,
//                         'virechan_count' => $investi_panch_count[$i]['Virechan'] + $virechan_count,
//                         'nasya_count' => $investi_panch_count[$i]['Nasya'] + $nasya_count,
//                         'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'] + $raktmokshan_count,
//                         'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'] + $shirodhara_count,
//                         'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'] + $shirobasti_count,
//                         'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'] + $uttarbasti_count,
//                         'basti_count' => $investi_panch_count[$i]['Basti'] + $basti_count,
//                         'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'] + $yonidhavan_count,
//                         'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'] + $yonipichu_count,
//                         'others_count' => $investi_panch_count[$i]['Other'] + $others_count,
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $this->db->where('create_date', $startDate2);
//                         $res =  $this->db->update('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);

//                         $this->db->where('create_date', $startDate2);
//                         $res1 =  $this->db->update('panchkarma_test_total_count_ipd', $postPatientInvestPanchCountData);

//                         // //  print_r($this->db->last_query());
//                         // //  die();
//                         if($res && $res1)
//                         {
//                             print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
//                         }
//                     }   
//                     else
//                     {
//                         (object)$postPatientInvestPanchCountData = ([
//                         'ipd_opd' => 'ipd',
//                         'create_date' => $startDate2,
//                         'snehan_count' => $investi_panch_count[$i]['Snehan'],
//                         'swedan_count' => $investi_panch_count[$i]['Swedan'],
//                         'vaman_count' => $investi_panch_count[$i]['Vaman'],
//                         'virechan_count' => $investi_panch_count[$i]['Virechan'],
//                         'nasya_count' => $investi_panch_count[$i]['Nasya'],
//                         'raktmokshan_count' => $investi_panch_count[$i]['Raktmokshan'],
//                         'shirodhara_count' => $investi_panch_count[$i]['Shirodhara'],
//                         'shirobasti_count' => $investi_panch_count[$i]['Shirobasti'],
//                         'uttarbasti_count' => $investi_panch_count[$i]['Uttarbasti'],
//                         'basti_count' => $investi_panch_count[$i]['Basti'],
//                         'yonidhavan_count' => $investi_panch_count[$i]['Yonidhavan'],
//                         'yonipichu_count' => $investi_panch_count[$i]['Yonipichu'],
//                         'others_count' => $investi_panch_count[$i]['Other'],
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $res = $this->db->insert('panchkarma_total_count_ipd', $postPatientInvestPanchCountData);
//                         echo "<pre>";
                                  
//                         (object)$postPatientInvestPanchTestCountData = ([
//                         'ipd_opd' => 'ipd',
//                         'create_date' => $startDate2,
//                         'snehan_count' => $investi_panch_test_count[$i]['Snehan'],
//                         'swedan_count' => $investi_panch_test_count[$i]['Swedan'],
//                         'vaman_count' => $investi_panch_test_count[$i]['Vaman'],
//                         'virechan_count' => $investi_panch_test_count[$i]['Virechan'],
//                         'nasya_count' => $investi_panch_test_count[$i]['Nasya'],
//                         'raktmokshan_count' => $investi_panch_test_count[$i]['Raktmokshan'],
//                         'shirodhara_count' => $investi_panch_test_count[$i]['Shirodhara'],
//                         'shirobasti_count' => $investi_panch_test_count[$i]['Shirobasti'],
//                         'uttarbasti_count' => $investi_panch_test_count[$i]['Uttarbasti'],
//                         'basti_count' => $investi_panch_test_count[$i]['Basti'],
//                         'yonidhavan_count' => $investi_panch_test_count[$i]['Yonidhavan'],
//                         'yonipichu_count' => $investi_panch_test_count[$i]['Yonipichu'],
//                         'others_count' => $investi_panch_test_count[$i]['Other'],
//                         ]);

//                         // echo "<pre>";
//                         // print_r($postPatientInvestPanchCountData);

//                         $res1 = $this->db->insert('panchkarma_test_total_count_ipd', $postPatientInvestPanchTestCountData);
//                         if($res && $res1)
//                         {
//                         print_r('IPD Investigation & Panchakarma Counting Inserted Successfully');
//                         }
//                         //25
//                     }
//                 }
//             }
//     }


    public function xrayUpdate()
    {
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
        date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
        echo date('d-m-Y H:i:s');
      	echo "<br>";
        echo "<script>
            $(document).ready(function () {
                 setTimeout('location.reload(true);', '10000');
            });
        </script>";
        
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////                   OPD X-RAY Counting CODE               /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'opd')
        ->where('xray','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient')
        ->row();
      // print_r($this->db->last_query());
      //die();
      $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));

      echo "Last Date OPD=================>".$last_create_date;
      echo "<br>";
      echo "Current Date OPD=================>".$current_date;
      echo "<br>";
      echo "Push Date OPD=================>".$last_create_date;
      echo "<br>";
        



     // $rand_limit_patient = rand(50,60);
        if($last_create_date == $current_date)
        {
        
            $index = 0;
            $XRay = 0;
            $XRay_Test = 0;


            $patientList =  
              $this->db->select('*')
              ->from('patient')
              //->where('yearly_reg_no !=','')
              ->where('xray','0')
              ->where('ipd_patient_flag','0')
              ->where('dignosis !=','')
              ->where('create_date',$last_create_date)
              ->where('ipd_opd','opd')
              ->order_by('id','ASC')
             ->limit($rand_limit_patient)
              ->get()
              ->result();
                   // print_r($this->db->last_query());
           // die();
            foreach($patientList as $patient)
            {
              //echo "Push Date =================>".
				$startDate3=$patient->create_date;
              
             
              //echo "<br>";
                $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                  if($patient->manual_status==0){
                                      if($patient->proxy_id){
                                     $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else
                                      {
                                      $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                      if(empty($tretment)){
                                      $tretment=$this->db->select("*")
                                      ->from('treatments1')
                                      ->where('department_id',$patient->department_id)
			                          ->where('ipd_opd',$patient->department_id)
                                     ->get()
                                     ->row();   
                                      }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                  }
								
				//if($patient->yearly_reg_no)
              //  {
                                        if($tretment)
                                        {
                                            if($tretment->X_RAY)
                                            {
                                               
                                                if($tretment->X_RAY){
                                                    print_r("X-Ray");print_r(' ==>==>==>==> ');print_r($tretment->X_RAY);
                                                    $XRay = $XRay + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->X_RAY));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        
                                                        $XRay_Test = $XRay_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $startDate2
                                                                    ];
                                                                    $this->db->insert('xray_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }


                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'xray' => ($tretment->X_RAY) ? $tretment->X_RAY : NULL,
                                                ]);
                                                


                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('xray_patient_count_opd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('xray_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            
                                            }
                                          
                                        }  
                                        
                                    //}
                                            $data = array(
                                                'xray' => '1'
                                            );
                                            
                                            $this->db->where('create_date',$last_create_date);
              								$this->db->or_where('ipd_patient_flag','1');
                                            $this->db->update('patient', $data);
                                            //  print_r($this->db->last_query());
        
                                        
   
            }                       
                    $investi_panch_count[$index] = [
                        'XRay' => $XRay,
                    ];
            


                    $investi_panch_test_count[$index] = [
                        'XRay' => $XRay_Test,
                    ];
              
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count = $this->db->select('*')->from('xray_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                             


                              if($last_count) 
                                {
                             
                                    $xray_count = $last_count->xray_count;
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'xray_count' => $investi_panch_count[$i]['XRay'] + $xray_count,
                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('xray_total_count_opd', $postPatientInvestPanchCountData);

                                   
                                    if($res)
                                    {
                                    print_r('OPD XRAY Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'xray_count' => $investi_panch_count[$i]['XRay'],
                                    ]);

                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('xray_total_count_opd', $postPatientInvestPanchCountData);
                                    echo "<pre>";
                                    if($res)
                                    {
                                    print_r('OPD XRAY Counting Inserted Successfully');
                                    }

                                }
                                $last_count_new = $this->db->select('*')->from('xray_test_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                            
                            


                              if($last_count_new) 
                                {

                                    $xray_count = $last_count_new->xray_count;
                                       
                                    (object)$postPatientInvestPanchCountData = ([
                                        
                                        'xray_count' => $investi_panch_test_count[$i]['XRay'] + $xray_count,
                                        ]);

                                     $this->db->where('create_date', $last_create_date);
                                     $res1 =  $this->db->update('xray_test_total_count_opd', $postPatientInvestPanchCountData);
                                     if($res1)
                                     {
                                     print_r('OPD XRAY Counting Inserted Successfully');
                                     }
                                }
                                else{
                                    (object)$postPatientInvestPanchTestCountData = ([
                                        'ipd_opd' => 'opd',
                                        'create_date' => $last_create_date,
                                        'xray_count' => $investi_panch_test_count[$i]['XRay'],
                                        ]);
                                        $res1 = $this->db->insert('xray_test_total_count_opd', $postPatientInvestPanchTestCountData);
                                        if($res1)
                                        {
                                        print_r('OPD XRAY Counting Inserted Successfully');
                                        }

                                }
                            }
      
        }
        elseif($current_date > $last_create_date)
        {
        
            $index = 0;
            $XRay = 0;
            $XRay_Test = 0;


            $patientList =  
              $this->db->select('*')
              ->from('patient')
              //->where('yearly_reg_no !=','')
              ->where('xray','0')
              ->where('ipd_patient_flag','0')
              ->where('dignosis !=','')
              ->where('create_date',$last_create_date)
              ->where('ipd_opd','opd')
              ->order_by('id','ASC')
             ->limit($rand_limit_patient)
              ->get()
              ->result();

                   // print_r($this->db->last_query());
           // die();

            foreach($patientList as $patient)
            {
              //echo "Push Date =================>".

				$startDate3=$patient->create_date;
              
             
              //echo "<br>";
                $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                  if($patient->manual_status==0){
                                      if($patient->proxy_id){
                                     $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                     ->where('proxy_id',$patient->proxy_id)
                                     ->where('department_id',$patient->department_id)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                      }
                                      else
                                      {
                                      $tretment=$this->db->select("*")
			                         ->from('treatments1')
                                     ->where('dignosis LIKE',$p_dignosis)
                                      ->where('department_id',$patient->department_id)
                                     ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();  
                                      if(empty($tretment)){
                                      $tretment=$this->db->select("*")
                                      ->from('treatments1')
                                      ->where('department_id',$patient->department_id)
			                          ->where('ipd_opd',$patient->department_id)
                                     ->get()
                                     ->row();   
                                      }
                                      }
                                  }else{
                                      $tretment=$this->db->select("*")
                                      ->from('manual_treatments')
                                     ->where('patient_id_auto',$patient->id)
			                         ->where('dignosis LIKE',$p_dignosis)
			                         ->where('ipd_opd ',$section_tret)
                                     ->get()
                                     ->row();
                                  }
								
				//if($patient->yearly_reg_no)
               // {
                                        if($tretment)
                                        {
                                            if($tretment->X_RAY)
                                            {
                                               
                                                if($tretment->X_RAY){
                                                    print_r("X-Ray");print_r(' ==>==>==>==> ');print_r($tretment->X_RAY);
                                                    $XRay = $XRay + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->X_RAY));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $XRay_Test = $XRay_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $startDate2
                                                                    ];
                                                                    $this->db->insert('xray_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }


                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'xray' => ($tretment->X_RAY) ? $tretment->X_RAY : NULL,
                                                ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('xray_patient_count_opd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('xray_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            
                                            }
                                          
                                        }  
                                        
                               //     }
                                            $data = array(
                                                'xray' => '1'
                                            );
                                            
                                            $this->db->where('create_date',$last_create_date);
              								$this->db->or_where('ipd_patient_flag','1');
                                            $this->db->update('patient', $data);
                                            //  print_r($this->db->last_query());
        
                                        
   
            }                       
                    $investi_panch_count[$index] = [
                        'XRay' => $XRay,
                    ];


            //  echo "<pre>";
             // print_r($investi_panch_count);
              // die();



                    $investi_panch_test_count[$index] = [
                        'XRay' => $XRay_Test,
                    ];
              
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count = $this->db->select('*')->from('xray_total_count_opd')->where('create_date',$last_create_date)->get()->row();


                              //	print_r($this->db->last_query());
                                //  die();


                              if($last_count) 
                                {
                             
                                    $xray_count = $last_count->xray_count;
                                  

                                    (object)$postPatientInvestPanchCountData = ([
                                        'xray_count' => $investi_panch_count[$i]['XRay'] + $xray_count,
                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('xray_total_count_opd', $postPatientInvestPanchCountData);

                                   
                                    if($res)
                                    {
                                    print_r('OPD XRAY Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'xray_count' => $investi_panch_count[$i]['XRay'],
                                    ]);

                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('xray_total_count_opd', $postPatientInvestPanchCountData);
                                    echo "<pre>";
                                    if($res)
                                    {
                                    print_r('OPD XRAY Counting Inserted Successfully');
                                    }

                                }
                                $last_count_new = $this->db->select('*')->from('xray_test_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                            
                            
                              //	print_r($this->db->last_query());
                                //  die();
                            
                            
                              if($last_count_new) 
                                {

                                    $xray_count = $last_count_new->xray_count;
                                       
                                    (object)$postPatientInvestPanchCountData = ([
                                        
                                        'xray_count' => $investi_panch_test_count[$i]['XRay'] + $xray_count,
                                        ]);

                                     $this->db->where('create_date', $last_create_date);
                                     $res1 =  $this->db->update('xray_test_total_count_opd', $postPatientInvestPanchCountData);
                                     if($res1)
                                     {
                                     print_r('OPD XRAY Counting Inserted Successfully');
                                     }
                                }
                                else{
                                    (object)$postPatientInvestPanchTestCountData = ([
                                        'ipd_opd' => 'opd',
                                        'create_date' => $last_create_date,
                                        'xray_count' => $investi_panch_test_count[$i]['XRay'],
                                        ]);
                                        $res1 = $this->db->insert('xray_test_total_count_opd', $postPatientInvestPanchTestCountData);
                                        if($res1)
                                        {
                                        print_r('OPD XRAY Counting Inserted Successfully');
                                        }

                                }
                            }
      
        }
        //   die();

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////               IPD XRAY Counting CODE                    /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 

        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'ipd')
        ->where('xray','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient_ipd')
        ->row();
     
        //   echo "<br>";
       $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));
        // print_r($this->db->last_query());
        // die();
		echo "<br><br><br><br>";
      echo "Last Date IPD=================>".$last_create_date;
      echo "<br>";
      echo "Current Date IPD=================>".$current_date;
      echo "<br>";
      echo "Push Date OID=================>".$last_create_date;
      echo "<br>";

      if($last_create_date == $current_date)
      {
        $index = 0;
        $XRay = 0;
        $XRay_Test = 0;
        
        $patients1 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('discharge_date >=', $last_create_date)
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                   // ->where('manual_status', '0')
                    //->where('panchkamra','0')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                        

                //print_r('q1   ');
             // print_r($this->db->last_query());
             // die();  


        
                $patients2 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')

                   // ->where('manual_status', '0')
                   /// ->where('panchkamra','0')

                    ->where('discharge_date LIKE', '%0000-00-00%')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                
                //print_r('q2   ');                    
               
        
                $patientList = array_merge($patients1, $patients2);

                foreach($patientList as $patient)
                {
                  //echo "Push Date =================>".
                    $startDate3=$patient->create_date;
                  
                 	//die();
                  	//echo "<br>";

                    
                    	$section_tret='ipd';
                        $che=trim($patient->dignosis);
                        $section_tret='ipd';
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $patient->dignosis;
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $p_dignosis = '%'.$new_str.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }else{
                            $p_dignosis = '%'.$che.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }
                      if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else
                                          {
                                          $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          if(empty($tretment)){
                                          $tretment=$this->db->select("*")
                                          ->from('treatments1')
                                          ->where('department_id',$patient->department_id)
                                          ->where('ipd_opd',$patient->department_id)
                                         ->get()
                                         ->row();   
                                          }
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                      }
                                    
                                     
                                            if($tretment)
                                            {

                                                if($tretment->X_RAY){

                                                if($startDate3==date('Y-m-d',strtotime($last_create_date)))
                                                {
                                                    if($tretment->X_RAY){
                                                        print_r("X-Ray");print_r(' ==>==>==>==> ');print_r($tretment->X_RAY);
                                                        $XRay = $XRay + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->X_RAY));
                                                        if($ex[0]!='' || $ex[0]!=null){


                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';


                                                            $XRay_Test = $XRay_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                              
                                                                //print_r($result);
                                                                //////if($result){
                                                              
                                                              
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('xray_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                              
                                            }  

                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'xray' => ($tretment->X_RAY) ? $tretment->X_RAY : NULL,
                                                ]);
                                             
                                             
                                             
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                            
                                            
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('xray_patient_count_ipd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('xray_patient_count_ipd', $postPatientInvestPanchData);
                                                }
                                            }
                                        }
                                                $data = array(
                                                    'xray' => '1'
                                                );
                                                
                                                //$this->db->where('id', $patient->id);
                                                //$this->db->or_where('ipd_patient_flag','1');
                                             
                                                $this->db->where('create_date',$last_create_date);
                                                $this->db->update('patient_ipd', $data);
                                             
                                                //  print_r($this->db->last_query());
            
                                            
       
                } 
                
                $investi_panch_count[$index] = [
                    'XRay' => $XRay,
                ];
       
       
        //  echo "<pre>";
         // print_r($investi_panch_count);
          // die();



                $investi_panch_test_count[$index] = [
                    'XRay' => $XRay_Test,
                ];
          
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                print_r($investi_panch_test_count);print_r("<br>");

                        for($i=0; $i<count($investi_panch_count);$i++)
                        {
                            $last_count = $this->db->select('*')->from('xray_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count) 
                            {
                         
                                $xray_count = $last_count->xray_count;
                              

                                (object)$postPatientInvestPanchCountData = ([
                                    'xray_count' => $investi_panch_count[$i]['XRay'] + $xray_count,
                                ]);
                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $this->db->where('create_date', $last_create_date);
                                $res =  $this->db->update('xray_total_count_ipd', $postPatientInvestPanchCountData);

                               
                                if($res)
                                {
                                print_r('IPD XRAY Counting Inserted Successfully');
                                }
                            }   
                            else
                            {

                                (object)$postPatientInvestPanchCountData = ([
                                'ipd_opd' => 'ipd',
                                'create_date' => $last_create_date,
                                'xray_count' => $investi_panch_count[$i]['XRay'],
                                ]);

                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $res = $this->db->insert('xray_total_count_ipd', $postPatientInvestPanchCountData);
                                echo "<pre>";
                                if($res)
                                {
                                print_r('IPD XRAY Counting Inserted Successfully');
                                }

                            }
                            $last_count_new = $this->db->select('*')->from('xray_test_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                       
                       
                       
                          //	print_r($this->db->last_query());
                            //  die();
                        
                        
                          if($last_count_new) 
                            {

                                $xray_count = $last_count_new->xray_count;
                                   
                                (object)$postPatientInvestPanchCountData = ([
                                    
                                    'xray_count' => $investi_panch_test_count[$i]['XRay'] + xray_count,
                                    ]);

                                 $this->db->where('create_date', $last_create_date);
                                 $res1 =  $this->db->update('xray_test_total_count_ipd', $postPatientInvestPanchCountData);
                                 if($res1)
                                 {
                                 print_r('IPD XRAY Counting Inserted Successfully');
                                 }
                            }
                            else{
                                (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'xray_count' => $investi_panch_test_count[$i]['XRay'],
                                    ]);
                                    $res1 = $this->db->insert('xray_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('IPD XRAY Counting Inserted Successfully');
                                    }

                            }
                        }

      }
      elseif($current_date > $last_create_date)
      {
        $index = 0;
        $XRay = 0;
        $XRay_Test = 0;
        
        $patients1 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('discharge_date >=', $last_create_date)
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                   // ->where('manual_status', '0')
                    //->where('panchkamra','0')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();


                //print_r('q1   ');
             // print_r($this->db->last_query());
             // die();  

        
                $patients2 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                  

                   // ->where('manual_status', '0')
                   /// ->where('panchkamra','0')
                  
                  
                    ->where('discharge_date LIKE', '%0000-00-00%')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                
                //print_r('q2   ');                    
               
        
                $patientList = array_merge($patients1, $patients2);

                foreach($patientList as $patient)
                {
                  //echo "Push Date =================>".
                    $startDate3=$patient->create_date;
                  
                 	//die();
                  	//echo "<br>";


                    	$section_tret='ipd';
                        $che=trim($patient->dignosis);
                        $section_tret='ipd';
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $patient->dignosis;
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $p_dignosis = '%'.$new_str.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }else{
                            $p_dignosis = '%'.$che.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }
                      if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else
                                          {
                                          $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          if(empty($tretment)){
                                          $tretment=$this->db->select("*")
                                          ->from('treatments1')
                                          ->where('department_id',$patient->department_id)
                                          ->where('ipd_opd',$patient->department_id)
                                         ->get()
                                         ->row();   
                                          }
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                      }
                                    
                                     
                                            if($tretment)
                                            {

                                                if($tretment->X_RAY){

                                                if($startDate3==date('Y-m-d',strtotime($last_create_date)))
                                                {
                                                    if($tretment->X_RAY){
                                                        print_r("X-Ray");print_r(' ==>==>==>==> ');print_r($tretment->X_RAY);
                                                        $XRay = $XRay + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->X_RAY));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                       
                                                       
                                                       
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                    
                                                    
                                                    
                                                            $XRay_Test = $XRay_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                           
                                                                //print_r($result);
                                                                //////if($result){
                                                           
                                                           
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('xray_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                              
                                            }  

                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'xray' => ($tretment->X_RAY) ? $tretment->X_RAY : NULL,
                                                ]);
                                             
                                             
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                             
                                             
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('xray_patient_count_ipd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('xray_patient_count_ipd', $postPatientInvestPanchData);
                                                }
                                            }
                                        }
                                                $data = array(
                                                    'xray' => '1'
                                                );


                                                //$this->db->where('id', $patient->id);
                                                //$this->db->or_where('ipd_patient_flag','1');
                                              
                                              
                                                $this->db->where('create_date',$last_create_date);
                                                $this->db->update('patient_ipd', $data);
                                             
                                             
                                                //  print_r($this->db->last_query());
            

                                            
       
                } 
                
                $investi_panch_count[$index] = [
                    'XRay' => $XRay,
                ];
      
      
        //  echo "<pre>";
         // print_r($investi_panch_count);
          // die();
           
           
           
                $investi_panch_test_count[$index] = [
                    'XRay' => $XRay_Test,
                ];
          
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                print_r($investi_panch_test_count);print_r("<br>");

                        for($i=0; $i<count($investi_panch_count);$i++)
                        {
                            $last_count = $this->db->select('*')->from('xray_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                      
                      
                          //	print_r($this->db->last_query());
                            //  die();
                      
                      
                          if($last_count) 
                            {
                         
                                $xray_count = $last_count->xray_count;
                              

                                (object)$postPatientInvestPanchCountData = ([
                                    'xray_count' => $investi_panch_count[$i]['XRay'] + $xray_count,
                                ]);
                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $this->db->where('create_date', $last_create_date);
                                $res =  $this->db->update('xray_total_count_ipd', $postPatientInvestPanchCountData);

                               
                                if($res)
                                {
                                print_r('IPD XRAY Counting Inserted Successfully');
                                }
                            }   
                            else
                            {

                                (object)$postPatientInvestPanchCountData = ([
                                'ipd_opd' => 'ipd',
                                'create_date' => $last_create_date,
                                'xray_count' => $investi_panch_count[$i]['XRay'],
                                ]);

                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $res = $this->db->insert('xray_total_count_ipd', $postPatientInvestPanchCountData);
                                echo "<pre>";
                                if($res)
                                {
                                print_r('IPD XRAY Counting Inserted Successfully');
                                }

                            }
                            $last_count_new = $this->db->select('*')->from('xray_test_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                       
                       
                       
                          //	print_r($this->db->last_query());
                            //  die();
                      
                      
                          if($last_count_new) 
                            {

                                $xray_count = $last_count_new->xray_count;
                                   
                                (object)$postPatientInvestPanchCountData = ([
                                    
                                    'xray_count' => $investi_panch_test_count[$i]['XRay'] + xray_count,
                                    ]);

                                 $this->db->where('create_date', $last_create_date);
                                 $res1 =  $this->db->update('xray_test_total_count_ipd', $postPatientInvestPanchCountData);
                                 if($res1)
                                 {
                                 print_r('IPD XRAY Counting Inserted Successfully');
                                 }
                            }
                            else{
                                (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'xray_count' => $investi_panch_test_count[$i]['XRay'],
                                    ]);
                                    $res1 = $this->db->insert('xray_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('IPD XRAY Counting Inserted Successfully');
                                    }

                            }
                        }

      }
    }


    
     public function ecgUpdate()
    {   
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
        date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
        echo date('d-m-Y H:i:s');
      	echo "<br>";
        echo "<script>
            $(document).ready(function () {
                 setTimeout('location.reload(true);', '10000');
            });
        </script>";
        
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////                     OPD ECG Counting CODE               /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'opd')
        ->where('ecg','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient')
        ->row();
      // print_r($this->db->last_query());
      //die();
      $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));

      echo "Last Date OPD=================>".$last_create_date;
      echo "<br>";
      echo "Current Date OPD=================>".$current_date;
      echo "<br>";
      echo "Push Date OPD=================>".$last_create_date;
      echo "<br>";
        //  
        //     if($current_date > $last_create_date) {
        //       echo"gfhfghfgfhfjfghjfhjgfhdfghcbvfgghf";
        // }
            
            // die();
    // $rand_limit_patient = rand(50,60);
        if($last_create_date == $current_date)
        {
            $index = 0;
            $ECG = 0;
            $ECG_Test = 0;


            $patientList =  
                $this->db->select('*')
                ->from('patient')
                //->where('yearly_reg_no !=','')
                ->where('ecg','0')
                ->where('ipd_patient_flag','0')
                ->where('dignosis !=','')
                ->where('create_date',$last_create_date)
                ->where('ipd_opd','opd')
                ->order_by('id','ASC')
              //  ->limit($rand_limit_patient)
                ->get()
                ->result();
                    // print_r($this->db->last_query());
            // die();
            foreach($patientList as $patient)
            {
                //echo "Push Date =================>".
                $startDate3=$patient->create_date;
                
                
                //echo "<br>";
                $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0){
                                        if($patient->proxy_id){
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('proxy_id',$patient->proxy_id)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                        }
                                        else
                                        {
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();  
                                        if(empty($tretment)){
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd',$patient->department_id)
                                        ->get()
                                        ->row();   
                                        }
                                        }
                                    }else{
                                        $tretment=$this->db->select("*")
                                        ->from('manual_treatments')
                                        ->where('patient_id_auto',$patient->id)
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                    }
                                        //    if($patient->yearly_reg_no)
                                         //   {
                                                if($tretment)
                                                {
                                                    if($tretment->ECG)
                                                    {
                                                        
                                                        if($tretment->ECG){
                                                            print_r("ECG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
                                                            $ECG = $ECG + 1;
                                                            
                                                            $ex = explode(',',trim($tretment->ECG));
                                                            if($ex[0]!='' || $ex[0]!=null){
                                                                // print_r($ex);
                                                                // print_r(count($ex));
                                                                // echo '<br>';
                                                                $ECG_Test = $ECG_Test + count($ex);
                                                                
                                                                for($i=0;$i<count($ex);$i++){
                                                                    echo "======>"."Ex -> ".$ex[$i];
                                                                    $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                                    //print_r($result);
                                                                    if($result){
                                                                        foreach($result as $rs){
                                                                            print_r($rs->test_name);print_r(" =====> ");
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                            $rand_val = array_rand($ex_random_val);
                                                                            print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                            (object)$postData = [
                                                                                'patient_auto_id' => $patient->id,
                                                                                'name' => $patient->firstname,
                                                                                'dignosis' => $patient->dignosis,
                                                                                'test_name' => $rs->test_name,
                                                                                'test_type' => $rs->test_type,
                                                                                'report_type' => $rs->report_type,
                                                                                'report_section' => $rs->report_section,
                                                                                'unit' => $rs->unit,
                                                                                'reference_range' => $rs->reference_range,
                                                                                'result' => $ex_random_val[$rand_val],
                                                                                'ipd_opd' => $patient->ipd_opd,
                                                                                'create_date' => $startDate2
                                                                            ];
                                                                            $this->db->insert('ecg_opd_report_result', $postData);
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }


                                                        (object)$postPatientInvestPanchData = ([
                                                        'patient_auto_id' => $patient->id,
                                                        'patient_name' => $patient->firstname,
                                                        'ipd_opd' => $patient->ipd_opd,
                                                        'sex' => $patient->sex,
                                                        'create_date' => $patient->create_date,
                                                        'ecg' => ($tretment->ECG) ? $tretment->ECG : NULL,
                                                        ]);
                                                        //echo "<br>";
                                                        // print_r($postPatientInvestPanchData);
                                                        //  echo "<br>";
                                                        $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('ecg_patient_count_opd')->num_rows();
                                                        if($searchRes == 0)
                                                        {
                                                        $updateRes = $this->db->insert('ecg_patient_count_opd', $postPatientInvestPanchData);
                                                        }
                                                    
                                                    }
                                                    
                                                }  
                                       //     }
                                        
                                    
                                            $data = array(
                                                'ecg' => '1'
                                            );
                                            
                                            $this->db->where('create_date',$last_create_date);
                                                $this->db->or_where('ipd_patient_flag','1');
                                            $this->db->update('patient', $data);
                                            //  print_r($this->db->last_query());

                                        

            }                       
                    $investi_panch_count[$index] = [
                        'ECG' => $ECG,
                    ];
            //  echo "<pre>";
                // print_r($investi_panch_count);
                // die();
                    $investi_panch_test_count[$index] = [
                        'ECG' => $ECG_Test,
                    ];
                
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count = $this->db->select('*')->from('ecg_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                                //	print_r($this->db->last_query());
                                //  die();
                                if($last_count) 
                                {
                                
                                    $ecg_count = $last_count->ecg_count;
                                    

                                    (object)$postPatientInvestPanchCountData = ([
                                        'ecg_count' => $investi_panch_count[$i]['ECG'] + $ecg_count,
                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('ecg_total_count_opd', $postPatientInvestPanchCountData);

                                    
                                    if($res)
                                    {
                                    print_r('OPD ECG Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'ecg_count' => $investi_panch_count[$i]['ECG'],
                                    ]);

                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('ecg_total_count_opd', $postPatientInvestPanchCountData);
                                    echo "<pre>";
                                    if($res)
                                    {
                                    print_r('OPD ECG Counting Inserted Successfully');
                                    }

                                }
                                $last_count_new = $this->db->select('*')->from('ecg_test_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                                //	print_r($this->db->last_query());
                                //  die();
                                if($last_count_new) 
                                {

                                    $ecg_count = $last_count_new->ecg_count;
                                        
                                    (object)$postPatientInvestPanchCountData = ([
                                        
                                        'ecg_count' => $investi_panch_test_count[$i]['ECG'] + $ecg_count,
                                        ]);

                                        $this->db->where('create_date', $last_create_date);
                                        $res1 =  $this->db->update('ecg_test_total_count_opd', $postPatientInvestPanchCountData);
                                        if($res1)
                                        {
                                        print_r('OPD ECG Counting Inserted Successfully');
                                        }
                                }
                                else{
                                    (object)$postPatientInvestPanchTestCountData = ([
                                        'ipd_opd' => 'opd',
                                        'create_date' => $last_create_date,
                                        'ecg_count' => $investi_panch_test_count[$i]['ECG'],
                                        ]);
                                        $res1 = $this->db->insert('ecg_test_total_count_opd', $postPatientInvestPanchTestCountData);
                                        if($res1)
                                        {
                                        print_r('OPD ECG Counting Inserted Successfully');
                                        }

                                }
                            }
            
        }
        elseif($current_date > $last_create_date)
        {
            $index = 0;
            $ECG = 0;
            $ECG_Test = 0;


            $patientList =  
                $this->db->select('*')
                ->from('patient')
                //->where('yearly_reg_no !=','')
                ->where('ecg','0')
                ->where('ipd_patient_flag','0')
                ->where('dignosis !=','')
                ->where('create_date',$last_create_date)
                ->where('ipd_opd','opd')
                ->order_by('id','ASC')
              //  ->limit($rand_limit_patient)
                ->get()
                ->result();
                    // print_r($this->db->last_query());
            // die();
            foreach($patientList as $patient)
            {
                //echo "Push Date =================>".
                $startDate3=$patient->create_date;
                
                
                //echo "<br>";
                $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0){
                                        if($patient->proxy_id){
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('proxy_id',$patient->proxy_id)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                        }
                                        else
                                        {
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();  
                                        if(empty($tretment)){
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd',$patient->department_id)
                                        ->get()
                                        ->row();   
                                        }
                                        }
                                    }else{
                                        $tretment=$this->db->select("*")
                                        ->from('manual_treatments')
                                        ->where('patient_id_auto',$patient->id)
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                    }
                                         //   if($patient->yearly_reg_no)
                                         //   {
                                                if($tretment)
                                                {
                                                    if($tretment->ECG)
                                                    {
                                                        
                                                        if($tretment->ECG){
                                                            print_r("ECG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
                                                            $ECG = $ECG + 1;
                                                            
                                                            $ex = explode(',',trim($tretment->ECG));
                                                            if($ex[0]!='' || $ex[0]!=null){
                                                                // print_r($ex);
                                                                // print_r(count($ex));
                                                                // echo '<br>';
                                                                $ECG_Test = $ECG_Test + count($ex);
                                                                
                                                                for($i=0;$i<count($ex);$i++){
                                                                    echo "======>"."Ex -> ".$ex[$i];
                                                                    $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                                    //print_r($result);
                                                                    if($result){
                                                                        foreach($result as $rs){
                                                                            print_r($rs->test_name);print_r(" =====> ");
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                            $rand_val = array_rand($ex_random_val);
                                                                            print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                            (object)$postData = [
                                                                                'patient_auto_id' => $patient->id,
                                                                                'name' => $patient->firstname,
                                                                                'dignosis' => $patient->dignosis,
                                                                                'test_name' => $rs->test_name,
                                                                                'test_type' => $rs->test_type,
                                                                                'report_type' => $rs->report_type,
                                                                                'report_section' => $rs->report_section,
                                                                                'unit' => $rs->unit,
                                                                                'reference_range' => $rs->reference_range,
                                                                                'result' => $ex_random_val[$rand_val],
                                                                                'ipd_opd' => $patient->ipd_opd,
                                                                                'create_date' => $startDate2
                                                                            ];
                                                                            $this->db->insert('ecg_opd_report_result', $postData);
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }


                                                        (object)$postPatientInvestPanchData = ([
                                                        'patient_auto_id' => $patient->id,
                                                        'patient_name' => $patient->firstname,
                                                        'ipd_opd' => $patient->ipd_opd,
                                                        'sex' => $patient->sex,
                                                        'create_date' => $patient->create_date,
                                                        'ecg' => ($tretment->ECG) ? $tretment->ECG : NULL,
                                                        ]);
                                                        //echo "<br>";
                                                        // print_r($postPatientInvestPanchData);
                                                        //  echo "<br>";
                                                        $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('ecg_patient_count_opd')->num_rows();
                                                        if($searchRes == 0)
                                                        {
                                                        $updateRes = $this->db->insert('ecg_patient_count_opd', $postPatientInvestPanchData);
                                                        }
                                                    
                                                    }
                                                    
                                                }  
                                       //     }
                                        
                                    
                                            $data = array(
                                                'ecg' => '1'
                                            );
                                            
                                            $this->db->where('create_date',$last_create_date);
                                                $this->db->or_where('ipd_patient_flag','1');
                                            $this->db->update('patient', $data);
                                            //  print_r($this->db->last_query());

                                        

            }                       
                    $investi_panch_count[$index] = [
                        'ECG' => $ECG,
                    ];
            //  echo "<pre>";
                // print_r($investi_panch_count);
                // die();
                    $investi_panch_test_count[$index] = [
                        'ECG' => $ECG_Test,
                    ];
                
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count = $this->db->select('*')->from('ecg_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                                //	print_r($this->db->last_query());
                                //  die();
                                if($last_count) 
                                {
                                
                                    $ecg_count = $last_count->ecg_count;
                                    

                                    (object)$postPatientInvestPanchCountData = ([
                                        'ecg_count' => $investi_panch_count[$i]['ECG'] + $ecg_count,
                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('ecg_total_count_opd', $postPatientInvestPanchCountData);

                                    
                                    if($res)
                                    {
                                    print_r('OPD ECG Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'ecg_count' => $investi_panch_count[$i]['ECG'],
                                    ]);

                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('ecg_total_count_opd', $postPatientInvestPanchCountData);
                                    echo "<pre>";
                                    if($res)
                                    {
                                    print_r('OPD ECG Counting Inserted Successfully');
                                    }

                                }
                                $last_count_new = $this->db->select('*')->from('ecg_test_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                                //	print_r($this->db->last_query());
                                //  die();
                                if($last_count_new) 
                                {

                                    $ecg_count = $last_count_new->ecg_count;
                                        
                                    (object)$postPatientInvestPanchCountData = ([
                                        
                                        'ecg_count' => $investi_panch_test_count[$i]['ECG'] + $ecg_count,
                                        ]);

                                        $this->db->where('create_date', $last_create_date);
                                        $res1 =  $this->db->update('ecg_test_total_count_opd', $postPatientInvestPanchCountData);
                                        if($res1)
                                        {
                                        print_r('OPD ECG Counting Inserted Successfully');
                                        }
                                }
                                else{
                                    (object)$postPatientInvestPanchTestCountData = ([
                                        'ipd_opd' => 'opd',
                                        'create_date' => $last_create_date,
                                        'ecg_count' => $investi_panch_test_count[$i]['ECG'],
                                        ]);
                                        $res1 = $this->db->insert('ecg_test_total_count_opd', $postPatientInvestPanchTestCountData);
                                        if($res1)
                                        {
                                        print_r('OPD ECG Counting Inserted Successfully');
                                        }

                                }
                            }
            
        }
        //   die();

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////               IPD ECG  Counting CODE                    /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 

        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'ipd')
        ->where('ecg','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient_ipd')
        ->row();
     
        //   echo "<br>";
       $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));
        // print_r($this->db->last_query());
        // die();
		echo "<br><br><br><br>";
      echo "Last Date IPD=================>".$last_create_date;
      echo "<br>";
      echo "Current Date IPD=================>".$current_date;
      echo "<br>";
      echo "Push Date OID=================>".$last_create_date;
      echo "<br>";

      if($last_create_date == $current_date)
      {
        $index = 0;
        $ECG = 0;
        $ECG_Test = 0;
        
        $patients1 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('discharge_date >=', $last_create_date)
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                   // ->where('manual_status', '0')
                    //->where('panchkamra','0')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                        
                //print_r('q1   ');
             // print_r($this->db->last_query());
             // die();  
        
                $patients2 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                   // ->where('manual_status', '0')
                   // ->where('panchkamra','0')
                    ->where('discharge_date LIKE', '%0000-00-00%')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                
                //print_r('q2   ');                    
               
        
                $patientList = array_merge($patients1, $patients2);

                foreach($patientList as $patient)
                {
                  //echo "Push Date =================>".
                    $startDate3=$patient->create_date;
                  
                 	//die();
                  	//echo "<br>";
                    	$section_tret='ipd';
                        $che=trim($patient->dignosis);
                        $section_tret='ipd';
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $patient->dignosis;
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $p_dignosis = '%'.$new_str.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }else{
                            $p_dignosis = '%'.$che.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }
                      if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else
                                          {
                                          $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          if(empty($tretment)){
                                          $tretment=$this->db->select("*")
                                          ->from('treatments1')
                                          ->where('department_id',$patient->department_id)
                                          ->where('ipd_opd',$patient->department_id)
                                         ->get()
                                         ->row();   
                                          }
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                      }
                                    
                                     
                                            if($tretment)
                                            {

                                                if($tretment->ECG){

                                                if($startDate3==date('Y-m-d',strtotime($last_create_date)))
                                                {
                                                    if($tretment->ECG){
                                                        print_r("ECG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
                                                        $ECG = $ECG + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->ECG));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $ECG_Test = $ECG_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('ecg_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                              
                                            }  

                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'ECG' => ($tretment->ECG) ? $tretment->ECG : NULL,
                                                ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('ecg_patient_count_ipd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('ecg_patient_count_ipd', $postPatientInvestPanchData);
                                                }
                                            }
                                        }
                                                $data = array(
                                                    'ecg' => '1'
                                                );
                                                
                                               // $this->db->where('id', $patient->id);
                                                //$this->db->or_where('ipd_patient_flag','1');
                                                $this->db->where('create_date',$last_create_date);
                                                $this->db->update('patient_ipd', $data);
                                                //  print_r($this->db->last_query());
            
                                            
       
                } 
                
                $investi_panch_count[$index] = [
                    'ECG' => $ECG,
                ];
        //  echo "<pre>";
         // print_r($investi_panch_count);
          // die();
                $investi_panch_test_count[$index] = [
                    'ECG' => $ECG_Test,
                ];
          
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                print_r($investi_panch_test_count);print_r("<br>");

                        for($i=0; $i<count($investi_panch_count);$i++)
                        {
                            $last_count = $this->db->select('*')->from('ecg_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count) 
                            {
                         
                                $ecg_count = $last_count->ecg_count;
                              

                                (object)$postPatientInvestPanchCountData = ([
                                    'ecg_count' => $investi_panch_count[$i]['ECG'], + $ecg_count,
                                ]);
                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $this->db->where('create_date', $last_create_date);
                                $res =  $this->db->update('ecg_total_count_ipd', $postPatientInvestPanchCountData);

                               
                                if($res)
                                {
                                print_r('IPD ECG Counting Inserted Successfully');
                                }
                            }   
                            else
                            {

                                (object)$postPatientInvestPanchCountData = ([
                                'ipd_opd' => 'ipd',
                                'create_date' => $last_create_date,
                                'ecg_count' => $investi_panch_count[$i]['ECG'],
                                ]);

                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $res = $this->db->insert('ecg_total_count_ipd', $postPatientInvestPanchCountData);
                                echo "<pre>";
                                if($res)
                                {
                                print_r('IPD ECG Counting Inserted Successfully');
                                }

                            }
                            $last_count_new = $this->db->select('*')->from('ecg_test_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count_new) 
                            {

                                $ecg_count = $last_count_new->ecg_count;
                                   
                                (object)$postPatientInvestPanchCountData = ([
                                    
                                    'ecg_count' => $investi_panch_count[$i]['ECG'], + $ecg_count,
                                    ]);

                                 $this->db->where('create_date', $last_create_date);
                                 $res1 =  $this->db->update('ecg_test_total_count_ipd', $postPatientInvestPanchCountData);
                                 if($res1)
                                 {
                                 print_r('IPD ECG Counting Inserted Successfully');
                                 }
                            }
                            else{
                                (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'ecg_count' => $investi_panch_count[$i]['ECG'],
                                    ]);
                                    $res1 = $this->db->insert('ecg_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('IPD ECG Counting Inserted Successfully');
                                    }

                            }
                        }

      }
      elseif($current_date > $last_create_date)
      {
        $index = 0;
        $ECG = 0;
        $ECG_Test = 0;
        
        $patients1 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('discharge_date >=', $last_create_date)
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                   // ->where('manual_status', '0')
                    //->where('panchkamra','0')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                        
                //print_r('q1   ');
             // print_r($this->db->last_query());
             // die();  
        
                $patients2 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                   // ->where('manual_status', '0')
                   // ->where('panchkamra','0')
                    ->where('discharge_date LIKE', '%0000-00-00%')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                
                //print_r('q2   ');                    
               
        
                $patientList = array_merge($patients1, $patients2);

                foreach($patientList as $patient)
                {
                  //echo "Push Date =================>".
                    $startDate3=$patient->create_date;
                  
                 	//die();
                  	//echo "<br>";
                    	$section_tret='ipd';
                        $che=trim($patient->dignosis);
                        $section_tret='ipd';
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $patient->dignosis;
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $p_dignosis = '%'.$new_str.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }else{
                            $p_dignosis = '%'.$che.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }
                      if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else
                                          {
                                          $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          if(empty($tretment)){
                                          $tretment=$this->db->select("*")
                                          ->from('treatments1')
                                          ->where('department_id',$patient->department_id)
                                          ->where('ipd_opd',$patient->department_id)
                                         ->get()
                                         ->row();   
                                          }
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                      }
                                    
                                     
                                            if($tretment)
                                            {

                                                if($tretment->ECG){

                                                if($startDate3==date('Y-m-d',strtotime($last_create_date)))
                                                {
                                                    if($tretment->ECG){
                                                        print_r("ECG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
                                                        $ECG = $ECG + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->ECG));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $ECG_Test = $ECG_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('ecg_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                              
                                            }  

                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'ECG' => ($tretment->ECG) ? $tretment->ECG : NULL,
                                                ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('ecg_patient_count_ipd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('ecg_patient_count_ipd', $postPatientInvestPanchData);
                                                }
                                            }
                                        }
                                                $data = array(
                                                    'ecg' => '1'
                                                );
                                                
                                                //$this->db->where('id', $patient->id);
                                                //$this->db->or_where('ipd_patient_flag','1');
                                                $this->db->where('create_date',$last_create_date);
                                                $this->db->update('patient_ipd', $data);
                                                //  print_r($this->db->last_query());
            
                                            
       
                } 
                
                $investi_panch_count[$index] = [
                    'ECG' => $ECG,
                ];
        //  echo "<pre>";
         // print_r($investi_panch_count);
          // die();
                $investi_panch_test_count[$index] = [
                    'ECG' => $ECG_Test,
                ];
          
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                print_r($investi_panch_test_count);print_r("<br>");

                        for($i=0; $i<count($investi_panch_count);$i++)
                        {
                            $last_count = $this->db->select('*')->from('ecg_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count) 
                            {
                         
                                $ecg_count = $last_count->ecg_count;
                              

                                (object)$postPatientInvestPanchCountData = ([
                                    'ecg_count' => $investi_panch_count[$i]['ECG'], + $ecg_count,
                                ]);
                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $this->db->where('create_date', $last_create_date);
                                $res =  $this->db->update('ecg_total_count_ipd', $postPatientInvestPanchCountData);

                               
                                if($res)
                                {
                                print_r('IPD ECG Counting Inserted Successfully');
                                }
                            }   
                            else
                            {

                                (object)$postPatientInvestPanchCountData = ([
                                'ipd_opd' => 'ipd',
                                'create_date' => $last_create_date,
                                'ecg_count' => $investi_panch_count[$i]['ECG'],
                                ]);

                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $res = $this->db->insert('ecg_total_count_ipd', $postPatientInvestPanchCountData);
                                echo "<pre>";
                                if($res)
                                {
                                print_r('IPD ECG Counting Inserted Successfully');
                                }

                            }
                            $last_count_new = $this->db->select('*')->from('ecg_test_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count_new) 
                            {

                                $ecg_count = $last_count_new->ecg_count;
                                   
                                (object)$postPatientInvestPanchCountData = ([
                                    
                                    'ecg_count' => $investi_panch_count[$i]['ECG'], + $ecg_count,
                                    ]);

                                 $this->db->where('create_date', $last_create_date);
                                 $res1 =  $this->db->update('ecg_test_total_count_ipd', $postPatientInvestPanchCountData);
                                 if($res1)
                                 {
                                 print_r('IPD ECG Counting Inserted Successfully');
                                 }
                            }
                            else{
                                (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'ecg_count' => $investi_panch_count[$i]['ECG'],
                                    ]);
                                    $res1 = $this->db->insert('ecg_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('IPD ECG Counting Inserted Successfully');
                                    }

                            }
                        }

      }
    }





 
    public function usgUpdate()
    {
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
        date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
        echo date('d-m-Y H:i:s');
      	echo "<br>";
        echo "<script>
            $(document).ready(function () {
                 setTimeout('location.reload(true);', '10000');
            });
        </script>";
        
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////                     OPD USG Counting CODE               /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'opd')
        ->where('usg','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient')
        ->row();
      // print_r($this->db->last_query());
      //die();
      $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));

      echo "Last Date OPD=================>".$last_create_date;
      echo "<br>";
      echo "Current Date OPD=================>".$current_date;
      echo "<br>";
      echo "Push Date OPD=================>".$last_create_date;
      echo "<br>";
        //  
        //     if($current_date > $last_create_date) {
        //       echo"gfhfghfgfhfjfghjfhjgfhdfghcbvfgghf";
        // }
            
            // die();
     //$rand_limit_patient = rand(50,60);
        if($last_create_date == $current_date)
        {
            $index = 0;
            $USG = 0;
            $USG_Test = 0;


            $patientList =  
                $this->db->select('*')
                ->from('patient')
                //->where('yearly_reg_no !=','')
                ->where('usg','0')
                ->where('ipd_patient_flag','0')
                ->where('dignosis !=','')
                ->where('create_date',$last_create_date)
                ->where('ipd_opd','opd')
                ->order_by('id','ASC')
                ->limit($rand_limit_patient)
                ->get()
                ->result();
                    // print_r($this->db->last_query());
            // die();
            foreach($patientList as $patient)
            {
                //echo "Push Date =================>".
                $startDate3=$patient->create_date;
                
                
                //echo "<br>";
                $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0){
                                        if($patient->proxy_id){
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('proxy_id',$patient->proxy_id)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                        }
                                        else
                                        {
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();  
                                        if(empty($tretment)){
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd',$patient->department_id)
                                        ->get()
                                        ->row();   
                                        }
                                        }
                                    }else{
                                        $tretment=$this->db->select("*")
                                        ->from('manual_treatments')
                                        ->where('patient_id_auto',$patient->id)
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                    }
                                
                if($patient->yearly_reg_no)
                {
                                        if($tretment)
                                        {
                                            if($tretment->USG)
                                            {
                                                
                                                if($tretment->USG){
                                                    print_r("USG");print_r(' ==>==>==>==> ');print_r($tretment->USG);
                                                    $USG = $USG + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->USG));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $USG_Test = $USG_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $startDate2
                                                                    ];
                                                                    $this->db->insert('usg_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }


                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'usg' => ($tretment->USG) ? $tretment->USG : NULL,
                                                ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('usg_patient_count_opd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('usg_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            
                                            }
                                            
                                        }  
                                        
                                    }
                                            $data = array(
                                                'usg' => '1'
                                            );
                                            
                                            $this->db->where('create_date',$last_create_date);
                                            $this->db->or_where('ipd_patient_flag','1');
                                            $this->db->update('patient', $data);
                                            //  print_r($this->db->last_query());

                                        

            }                       
                    $investi_panch_count[$index] = [
                        'USG' => $USG,
                    ];
            //  echo "<pre>";
                // print_r($investi_panch_count);
                // die();
                    $investi_panch_test_count[$index] = [
                        'USG' => $USG_Test,
                    ];
                
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count = $this->db->select('*')->from('usg_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                                //	print_r($this->db->last_query());
                                //  die();
                                if($last_count) 
                                {
                                
                                    $usg_count = $last_count->usg_count;
                                    

                                    (object)$postPatientInvestPanchCountData = ([
                                        'usg_count' => $investi_panch_count[$i]['USG'] + $usg_count,
                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('usg_total_count_opd', $postPatientInvestPanchCountData);

                                    
                                    if($res)
                                    {
                                    print_r('OPD USG Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'usg_count' => $investi_panch_count[$i]['USG'],
                                    ]);

                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('usg_total_count_opd', $postPatientInvestPanchCountData);
                                    echo "<pre>";
                                    if($res)
                                    {
                                    print_r('OPD USG Counting Inserted Successfully');
                                    }

                                }
                                $last_count_new = $this->db->select('*')->from('usg_test_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                                //	print_r($this->db->last_query());
                                //  die();
                                if($last_count_new) 
                                {

                                    $usg_count = $last_count_new->usg_count;
                                        
                                    (object)$postPatientInvestPanchCountData = ([
                                        
                                        'usg_count' => $investi_panch_test_count[$i]['USG'] + $usg_count,
                                        ]);

                                        $this->db->where('create_date', $last_create_date);
                                        $res1 =  $this->db->update('usg_test_total_count_opd', $postPatientInvestPanchCountData);
                                        if($res1)
                                        {
                                        print_r('OPD USG Counting Inserted Successfully');
                                        }
                                }
                                else{
                                    (object)$postPatientInvestPanchTestCountData = ([
                                        'ipd_opd' => 'opd',
                                        'create_date' => $last_create_date,
                                        'usg_count' => $investi_panch_test_count[$i]['USG'],
                                        ]);
                                        $res1 = $this->db->insert('usg_test_total_count_opd', $postPatientInvestPanchTestCountData);
                                        if($res1)
                                        {
                                        print_r('OPD USG Counting Inserted Successfully');
                                        }

                                }
                            }
            
        }
        elseif($current_date > $last_create_date)
        {
            $index = 0;
            $USG = 0;
            $USG_Test = 0;


            $patientList =  
                $this->db->select('*')
                ->from('patient')
                //->where('yearly_reg_no !=','')
                ->where('usg','0')
                ->where('ipd_patient_flag','0')
                ->where('dignosis !=','')
                ->where('create_date',$last_create_date)
                ->where('ipd_opd','opd')
                ->order_by('id','ASC')
                ->limit($rand_limit_patient)
                ->get()
                ->result();
                    // print_r($this->db->last_query());
            // die();
            foreach($patientList as $patient)
            {
                //echo "Push Date =================>".
                $startDate3=$patient->create_date;
                
                
                //echo "<br>";
                $section_tret='opd';
                    $che=trim($patient->dignosis);
                    $section_tret='opd';
                    $len=strlen($che);
                    $dd= substr($che,$len - 1);
                    $str = $patient->dignosis;
                    $arry=explode("-",$str);
                    $t_c=count($arry);
                    if($t_c=='2'){
                        $dd1=substr($che, 0, -1);
                        $new_str = trim($arry[0]);
                        $p_dignosis = '%'.$new_str.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }else{
                        $p_dignosis = '%'.$che.'%';
                        $p_dignosis_name=$patient->dignosis;
                    }
                    if($patient->manual_status==0){
                                        if($patient->proxy_id){
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('proxy_id',$patient->proxy_id)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                        }
                                        else
                                        {
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();  
                                        if(empty($tretment)){
                                        $tretment=$this->db->select("*")
                                        ->from('treatments1')
                                        ->where('department_id',$patient->department_id)
                                        ->where('ipd_opd',$patient->department_id)
                                        ->get()
                                        ->row();   
                                        }
                                        }
                                    }else{
                                        $tretment=$this->db->select("*")
                                        ->from('manual_treatments')
                                        ->where('patient_id_auto',$patient->id)
                                        ->where('dignosis LIKE',$p_dignosis)
                                        ->where('ipd_opd ',$section_tret)
                                        ->get()
                                        ->row();
                                    }
                                
                if($patient->yearly_reg_no)
                {
                                        if($tretment)
                                        {
                                            if($tretment->USG)
                                            {
                                                
                                                if($tretment->USG){
                                                    print_r("USG");print_r(' ==>==>==>==> ');print_r($tretment->USG);
                                                    $USG = $USG + 1;
                                                    
                                                    $ex = explode(',',trim($tretment->USG));
                                                    if($ex[0]!='' || $ex[0]!=null){
                                                        // print_r($ex);
                                                        // print_r(count($ex));
                                                        // echo '<br>';
                                                        $USG_Test = $USG_Test + count($ex);
                                                        
                                                        for($i=0;$i<count($ex);$i++){
                                                            echo "======>"."Ex -> ".$ex[$i];
                                                            $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'opd'])->get('investigation_test_master')->result();
                                                            //print_r($result);
                                                            if($result){
                                                                foreach($result as $rs){
                                                                    print_r($rs->test_name);print_r(" =====> ");
                                                                    if($patient->department_id == 32){
                                                                        $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                    }
                                                                    else{
                                                                        $ex_random_val = explode(',',trim($rs->random_value));
                                                                    }
                                                                    $rand_val = array_rand($ex_random_val);
                                                                    print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                    (object)$postData = [
                                                                        'patient_auto_id' => $patient->id,
                                                                        'name' => $patient->firstname,
                                                                        'dignosis' => $patient->dignosis,
                                                                        'test_name' => $rs->test_name,
                                                                        'test_type' => $rs->test_type,
                                                                        'report_type' => $rs->report_type,
                                                                        'report_section' => $rs->report_section,
                                                                        'unit' => $rs->unit,
                                                                        'reference_range' => $rs->reference_range,
                                                                        'result' => $ex_random_val[$rand_val],
                                                                        'ipd_opd' => $patient->ipd_opd,
                                                                        'create_date' => $startDate2
                                                                    ];
                                                                    $this->db->insert('usg_opd_report_result', $postData);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }


                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'usg' => ($tretment->USG) ? $tretment->USG : NULL,
                                                ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('usg_patient_count_opd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('usg_patient_count_opd', $postPatientInvestPanchData);
                                                }
                                            
                                            }
                                            
                                        }  
                                        
                                    }
                                            $data = array(
                                                'usg' => '1'
                                            );
                                            
                                            $this->db->where('create_date',$last_create_date);
                                            $this->db->or_where('ipd_patient_flag','1');
                                            $this->db->update('patient', $data);
                                            //  print_r($this->db->last_query());

                                        

            }                       
                    $investi_panch_count[$index] = [
                        'USG' => $USG,
                    ];
            //  echo "<pre>";
                // print_r($investi_panch_count);
                // die();
                    $investi_panch_test_count[$index] = [
                        'USG' => $USG_Test,
                    ];
                
                    $index = $index + 1;
                    print_r($investi_panch_count);print_r("<br>");
                    print_r($investi_panch_test_count);print_r("<br>");

                            for($i=0; $i<count($investi_panch_count);$i++)
                            {
                                $last_count = $this->db->select('*')->from('usg_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                                //	print_r($this->db->last_query());
                                //  die();
                                if($last_count) 
                                {
                                
                                    $usg_count = $last_count->usg_count;
                                    

                                    (object)$postPatientInvestPanchCountData = ([
                                        'usg_count' => $investi_panch_count[$i]['USG'] + $usg_count,
                                    ]);
                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $this->db->where('create_date', $last_create_date);
                                    $res =  $this->db->update('usg_total_count_opd', $postPatientInvestPanchCountData);

                                    
                                    if($res)
                                    {
                                    print_r('OPD USG Counting Inserted Successfully');
                                    }
                                }   
                                else
                                {

                                    (object)$postPatientInvestPanchCountData = ([
                                    'ipd_opd' => 'opd',
                                    'create_date' => $last_create_date,
                                    'usg_count' => $investi_panch_count[$i]['USG'],
                                    ]);

                                    echo "<pre>";
                                    print_r($postPatientInvestPanchCountData);

                                    $res = $this->db->insert('usg_total_count_opd', $postPatientInvestPanchCountData);
                                    echo "<pre>";
                                    if($res)
                                    {
                                    print_r('OPD USG Counting Inserted Successfully');
                                    }

                                }
                                $last_count_new = $this->db->select('*')->from('usg_test_total_count_opd')->where('create_date',$last_create_date)->get()->row();
                                //	print_r($this->db->last_query());
                                //  die();
                                if($last_count_new) 
                                {

                                    $usg_count = $last_count_new->usg_count;
                                        
                                    (object)$postPatientInvestPanchCountData = ([
                                        
                                        'usg_count' => $investi_panch_test_count[$i]['USG'] + $usg_count,
                                        ]);

                                        $this->db->where('create_date', $last_create_date);
                                        $res1 =  $this->db->update('usg_test_total_count_opd', $postPatientInvestPanchCountData);
                                        if($res1)
                                        {
                                        print_r('OPD USG Counting Inserted Successfully');
                                        }
                                }
                                else{
                                    (object)$postPatientInvestPanchTestCountData = ([
                                        'ipd_opd' => 'opd',
                                        'create_date' => $last_create_date,
                                        'usg_count' => $investi_panch_test_count[$i]['USG'],
                                        ]);
                                        $res1 = $this->db->insert('usg_test_total_count_opd', $postPatientInvestPanchTestCountData);
                                        if($res1)
                                        {
                                        print_r('OPD USG Counting Inserted Successfully');
                                        }

                                }
                            }
            
        }
        //   die();

        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////               IPD USG  Counting CODE                    /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 

        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        $current_date = date('Y-m-d');
        $last_date_res = 
        $this->db->select('*')
        ->where('ipd_opd', 'ipd')
        ->where('usg','0')
        //->where('year(create_date)','2023')
        ->limit(1)
        ->order_by('id','ASC')
        ->get('patient_ipd')
        ->row();
     
        //   echo "<br>";
       $last_create_date = date("Y-m-d",strtotime($last_date_res->create_date));
        // print_r($this->db->last_query());
        // die();
		echo "<br><br><br><br>";
      echo "Last Date IPD=================>".$last_create_date;
      echo "<br>";
      echo "Current Date IPD=================>".$current_date;
      echo "<br>";
      echo "Push Date OID=================>".$last_create_date;
      echo "<br>";

      if($last_create_date == $current_date)
      {
        $index = 0;
        $USG = 0;
        $USG_Test = 0;
        
        $patients1 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('discharge_date >=', $last_create_date)
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                    //->where('manual_status', '0')
                    //->where('panchkamra','0')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                        
                //print_r('q1   ');
             // print_r($this->db->last_query());
             // die();  
        
                $patients2 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                   // ->where('manual_status', '0')
                   // ->where('panchkamra','0')
                    ->where('discharge_date LIKE', '%0000-00-00%')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                
                //print_r('q2   ');                    
               
        
                $patientList = array_merge($patients1, $patients2);

                foreach($patientList as $patient)
                {
                  //echo "Push Date =================>".
                    $startDate3=$patient->create_date;
                  
                 	//die();
                  	//echo "<br>";
                    	$section_tret='ipd';
                        $che=trim($patient->dignosis);
                        $section_tret='ipd';
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $patient->dignosis;
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $p_dignosis = '%'.$new_str.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }else{
                            $p_dignosis = '%'.$che.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }
                      if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else
                                          {
                                          $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          if(empty($tretment)){
                                          $tretment=$this->db->select("*")
                                          ->from('treatments1')
                                          ->where('department_id',$patient->department_id)
                                          ->where('ipd_opd',$patient->department_id)
                                         ->get()
                                         ->row();   
                                          }
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                      }
                                    
                                     
                                            if($tretment)
                                            {

                                                if($tretment->USG){

                                                if($startDate3==date('Y-m-d',strtotime($last_create_date)))
                                                {
                                                    if($tretment->USG){
                                                        print_r("USG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
                                                        $USG = $USG + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->USG));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $USG_Test = $USG_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('usg_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                              
                                            }  

                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'USG' => ($tretment->USG) ? $tretment->USG : NULL,
                                                ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('usg_patient_count_ipd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('usg_patient_count_ipd', $postPatientInvestPanchData);
                                                }
                                            }
                                        }
                                                $data = array(
                                                    'usg' => '1'
                                                );
                                                
                                                $this->db->where('id', $patient->id);
                                                //$this->db->or_where('ipd_patient_flag','1');
                                                $this->db->update('patient_ipd', $data);
                                                //  print_r($this->db->last_query());
            
                                            
       
                } 
                
                $investi_panch_count[$index] = [
                    'USG' => $USG,
                ];
        //  echo "<pre>";
         // print_r($investi_panch_count);
          // die();
                $investi_panch_test_count[$index] = [
                    'USG' => $USG_Test,
                ];
          
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                print_r($investi_panch_test_count);print_r("<br>");

                        for($i=0; $i<count($investi_panch_count);$i++)
                        {
                            $last_count = $this->db->select('*')->from('usg_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count) 
                            {
                         
                                $usg_count = $last_count->usg_count;
                              

                                (object)$postPatientInvestPanchCountData = ([
                                    'usg_count' => $investi_panch_count[$i]['USG'], + $usg_count,
                                ]);
                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $this->db->where('create_date', $last_create_date);
                                $res =  $this->db->update('usg_total_count_ipd', $postPatientInvestPanchCountData);

                               
                                if($res)
                                {
                                print_r('IPD USG Counting Inserted Successfully');
                                }
                            }   
                            else
                            {

                                (object)$postPatientInvestPanchCountData = ([
                                'ipd_opd' => 'ipd',
                                'create_date' => $last_create_date,
                                'usg_count' => $investi_panch_count[$i]['USG'],
                                ]);

                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $res = $this->db->insert('usg_total_count_ipd', $postPatientInvestPanchCountData);
                                echo "<pre>";
                                if($res)
                                {
                                print_r('IPD USG Counting Inserted Successfully');
                                }

                            }
                            $last_count_new = $this->db->select('*')->from('usg_test_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count_new) 
                            {

                                $usg_count = $last_count_new->usg_count;
                                   
                                (object)$postPatientInvestPanchCountData = ([
                                    
                                    'usg_count' => $investi_panch_count[$i]['USG'], + $usg_count,
                                    ]);

                                 $this->db->where('create_date', $last_create_date);
                                 $res1 =  $this->db->update('usg_test_total_count_ipd', $postPatientInvestPanchCountData);
                                 if($res1)
                                 {
                                 print_r('IPD USG Counting Inserted Successfully');
                                 }
                            }
                            else{
                                (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'usg_count' => $investi_panch_count[$i]['USG'],
                                    ]);
                                    $res1 = $this->db->insert('usg_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('IPD USG Counting Inserted Successfully');
                                    }

                            }
                        }

      }
      elseif($current_date > $last_create_date)
      {
        $index = 0;
        $USG = 0;
        $USG_Test = 0;
        
        $patients1 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('discharge_date >=', $last_create_date)
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                   // ->where('manual_status', '0')
                  //  //->where('panchkamra','0')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                        
                //print_r('q1   ');
             // print_r($this->db->last_query());
             // die();  
        
                $patients2 = $this->db->select("*")
                    ->from('patient_ipd')
                    ->join('department','department.dprt_id = patient_ipd.department_id')
                    ->where('create_date <=', $last_create_date)
                    ->where('dignosis !=', '')
                 //   ->where('manual_status', '0')
                   // ->where('panchkamra','0')
                    ->where('discharge_date LIKE', '%0000-00-00%')
                    ->where('ipd_opd', 'ipd')
                    ->get()
                    ->result();
                
                //print_r('q2   ');                    
               
        
                $patientList = array_merge($patients1, $patients2);

                foreach($patientList as $patient)
                {
                  //echo "Push Date =================>".
                    $startDate3=$patient->create_date;
                  
                 	//die();
                  	//echo "<br>";
                    	$section_tret='ipd';
                        $che=trim($patient->dignosis);
                        $section_tret='ipd';
                        $len=strlen($che);
                        $dd= substr($che,$len - 1);
                        $str = $patient->dignosis;
                        $arry=explode("-",$str);
                        $t_c=count($arry);
                        if($t_c=='2'){
                            $dd1=substr($che, 0, -1);
                            $new_str = trim($arry[0]);
                            $p_dignosis = '%'.$new_str.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }else{
                            $p_dignosis = '%'.$che.'%';
                            $p_dignosis_name=$patient->dignosis;
                        }
                      if($patient->manual_status==0){
                                          if($patient->proxy_id){
                                         $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('proxy_id',$patient->proxy_id)
                                         ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                          }
                                          else
                                          {
                                          $tretment=$this->db->select("*")
                                         ->from('treatments1')
                                         ->where('dignosis LIKE',$p_dignosis)
                                          ->where('department_id',$patient->department_id)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();  
                                          if(empty($tretment)){
                                          $tretment=$this->db->select("*")
                                          ->from('treatments1')
                                          ->where('department_id',$patient->department_id)
                                          ->where('ipd_opd',$patient->department_id)
                                         ->get()
                                         ->row();   
                                          }
                                          }
                                      }else{
                                          $tretment=$this->db->select("*")
                                          ->from('manual_treatments')
                                         ->where('patient_id_auto',$patient->id)
                                         ->where('dignosis LIKE',$p_dignosis)
                                         ->where('ipd_opd ',$section_tret)
                                         ->get()
                                         ->row();
                                      }
                                    
                                     
                                            if($tretment)
                                            {

                                                if($tretment->USG){

                                                if($startDate3==date('Y-m-d',strtotime($last_create_date)))
                                                {
                                                    if($tretment->USG){
                                                        print_r("USG");print_r(' ==>==>==>==> ');print_r($tretment->ECG);
                                                        $USG = $USG + 1;
                                                        
                                                        $ex = explode(',',trim($tretment->USG));
                                                        if($ex[0]!='' || $ex[0]!=null){
                                                            // print_r($ex);
                                                            // print_r(count($ex));
                                                            // echo '<br>';
                                                            $USG_Test = $USG_Test + count($ex);
                                                            
                                                            for($i=0;$i<count($ex);$i++){
                                                                echo "======>"."Ex -> ".$ex[$i];
                                                                $result = $this->db->where(['report_type'=>trim($ex[$i]), 'ipd_opd'=>'ipd', 'dignosis like'=>$p_dignosis])->get('investigation_test_master')->result();
                                                                //print_r($result);
                                                                //////if($result){
                                                                    foreach($result as $rs){
                                                                        print_r($rs->test_name);print_r(" =====> ");
                                                                        if($patient->sex == 'M'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_m));
                                                                            }
                                                                        }elseif($patient->sex == 'F'){
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_f)); 
                                                                            }
                                                                        }else{
                                                                            if($patient->department_id == 32){
                                                                                $ex_random_val = explode(',',trim($rs->random_value_abnormal_b));
                                                                            }
                                                                            else{
                                                                                $ex_random_val = explode(',',trim($rs->random_value));
                                                                            }
                                                                        }
                                                                        $rand_val = array_rand($ex_random_val);
                                                                        print_r($ex_random_val[$rand_val]);print_r("<br>");
                                                                        (object)$postData = [
                                                                            'patient_auto_id' => $patient->id,
                                                                            'name' => $patient->firstname,
                                                                            'dignosis' => $patient->dignosis,
                                                                            'test_name' => $rs->test_name,
                                                                            'test_type' => $rs->test_type,
                                                                            'report_type' => $rs->report_type,
                                                                            'report_section' => $rs->report_section,
                                                                            'unit' => $rs->unit,
                                                                            'reference_range' => $rs->reference_range,
                                                                            'result' => $ex_random_val[$rand_val],
                                                                            'ipd_opd' => $patient->ipd_opd,
                                                                            'create_date' => $startDate2
                                                                        ];
                                                                        $this->db->insert('usg_ipd_report_result', $postData);
                                                                    }
                                                                //////}
                                                            }
                                                        }
                                                    }
                                              
                                            }  

                                                (object)$postPatientInvestPanchData = ([
                                                'patient_auto_id' => $patient->id,
                                                'patient_name' => $patient->firstname,
                                                'ipd_opd' => $patient->ipd_opd,
                                                'sex' => $patient->sex,
                                                'create_date' => $patient->create_date,
                                                'USG' => ($tretment->USG) ? $tretment->USG : NULL,
                                                ]);
                                                //echo "<br>";
                                                // print_r($postPatientInvestPanchData);
                                                //  echo "<br>";
                                                $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('usg_patient_count_ipd')->num_rows();
                                                if($searchRes == 0)
                                                {
                                                $updateRes = $this->db->insert('usg_patient_count_ipd', $postPatientInvestPanchData);
                                                }
                                            }
                                        }
                                                $data = array(
                                                    'usg' => '1'
                                                );
                                                
                                                $this->db->where('id', $patient->id);
                                                //$this->db->or_where('ipd_patient_flag','1');
                                                $this->db->update('patient_ipd', $data);
                                                //  print_r($this->db->last_query());
            
                                            
       
                } 
                
                $investi_panch_count[$index] = [
                    'USG' => $USG,
                ];
        //  echo "<pre>";
         // print_r($investi_panch_count);
          // die();
                $investi_panch_test_count[$index] = [
                    'USG' => $USG_Test,
                ];
          
                $index = $index + 1;
                print_r($investi_panch_count);print_r("<br>");
                print_r($investi_panch_test_count);print_r("<br>");

                        for($i=0; $i<count($investi_panch_count);$i++)
                        {
                            $last_count = $this->db->select('*')->from('usg_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count) 
                            {
                         
                                $usg_count = $last_count->usg_count;
                              

                                (object)$postPatientInvestPanchCountData = ([
                                    'usg_count' => $investi_panch_count[$i]['USG'] + $usg_count,
                                ]);
                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $this->db->where('create_date', $last_create_date);
                                $res =  $this->db->update('usg_total_count_ipd', $postPatientInvestPanchCountData);

                               
                                if($res)
                                {
                                print_r('IPD USG Counting Inserted Successfully');
                                }
                            }   
                            else
                            {

                                (object)$postPatientInvestPanchCountData = ([
                                'ipd_opd' => 'ipd',
                                'create_date' => $last_create_date,
                                'usg_count' => $investi_panch_count[$i]['USG'],
                                ]);

                                echo "<pre>";
                                print_r($postPatientInvestPanchCountData);

                                $res = $this->db->insert('usg_total_count_ipd', $postPatientInvestPanchCountData);
                                echo "<pre>";
                                if($res)
                                {
                                print_r('IPD USG Counting Inserted Successfully');
                                }

                            }
                            $last_count_new = $this->db->select('*')->from('usg_test_total_count_ipd')->where('create_date',$last_create_date)->get()->row();
                          //	print_r($this->db->last_query());
                            //  die();
                          if($last_count_new) 
                            {

                                $ecg_count = $last_count_new->ecg_count;
                                   
                                (object)$postPatientInvestPanchCountData = ([
                                    
                                    'usg_count' => $investi_panch_count[$i]['USG'] + $ecg_count,
                                    ]);

                                 $this->db->where('create_date', $last_create_date);
                                 $res1 =  $this->db->update('usg_test_total_count_ipd', $postPatientInvestPanchCountData);
                                 if($res1)
                                 {
                                 print_r('IPD USG Counting Inserted Successfully');
                                 }
                            }
                            else{
                                (object)$postPatientInvestPanchTestCountData = ([
                                    'ipd_opd' => 'ipd',
                                    'create_date' => $last_create_date,
                                    'usg_count' => $investi_panch_count[$i]['USG'],
                                    ]);
                                    $res1 = $this->db->insert('usg_test_total_count_ipd', $postPatientInvestPanchTestCountData);
                                    if($res1)
                                    {
                                    print_r('IPD USG Counting Inserted Successfully');
                                    }

                            }
                        }

      }
    }


 public function ambulance_count()
      {
        error_reporting(0);
        echo "<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>";
        date_default_timezone_set("Asia/Kolkata");   //India time (GMT+5:30)
        echo date('d-m-Y H:i:s');
        echo "<script>
            $(document).ready(function () {
                 setTimeout('location.reload(true);', '10000');
            });
        </script>";
        
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        /////////////////////////////////////         OPD Ambulance Counting CODE                 /////////////////////////////////////
        /////////////////////////////////////                                                         /////////////////////////////////////
        ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////            
                
        $start_time= date('H:i',strtotime('18:15'));
        $time_date=date('H:i');
        
        $last_date_res = $this->db->select('create_date')->where('ipd_opd', 'opd')->order_by('id','DESC')->limit(1)->get('ambulance_opd_total_count')->row();
        print_r('<br>');
        $last_date = date('Y-m-d', strtotime($last_date_res->create_date));
        print_r('Last Date');print_r('==>==>');print_r($last_date);print_r('<br>');
        $current_date = date('Y-m-d');
        print_r('Current Date');print_r('==>==>');print_r($current_date);print_r('<br>');
        $push_date = date('Y-m-d',strtotime("+1 days", strtotime($last_date)));
        print_r('Push Date');print_r('==>==>');print_r($push_date);print_r('<br>');print_r('<br>');
        
        $section_opd = 'opd';
        
        $rand_limit_patient = rand(60, 80);
        
        $res = $this->db->where(['create_date'=> $push_date, 'yearly_reg_no != '=>''])->get('patient')->result();

        if($current_date == $push_date)
        {
            //print_r($res);
             $index = 0;
            //$PHYSIOTHERAPY = 0;
            $ambulance = 0;
            
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('OPD Amulance Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
            if($res != '' || $res != null){

                $patientList = $this->db->select('*')
                ->from('patient')
                ->where('departmnet_id','35')
                ->where('create_date',$startDate2)
                ->get()
                ->result();
                $college_address = 'Sagulwadi';
                $ambulance_number = 'MH12VK1418';
                
                foreach($patientList as $patient){
                    $ambulance = $ambulance + 1;
                            (object)$ambulancepatient = ([
                                    'patient_auto_id' => $patient->id,
                                    'name' => $patient->firstname,
                                    'ipd_opd' => $patient->ipd_opd,
                                    'dignosis' => $patient->dignosis,
                                    'department_id' => $patient->department_id,
                                    'create_date' => $startDate2,
                                    'address1' => $patient->address,
                                    'address2' => $college_address,
                                    'ambulance_no' => $ambulance_number,
                            ]);
                            $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('ambulance_opd_report_result')->num_rows();
                            if($searchRes == 0){
                                $updateRes = $this->db->insert('ambulance_opd_report_result', $ambulancepatient);
                                print_r($ambulancepatient);
                            }
                    
                }
                $ambulance_count[$index] = [
                    'ambulance' => $ambulance,
                ];
                $index = $index + 1;
                print_r($ambulance_count);print_r("<br>");
            }
            else{
                $ambulance_count[$index] = [
                    'ambulance' => $ambulance,
                ];
                
                $index = $index + 1;
                print_r($ambulance_count);print_r("<br>");
            }
            
            for($i=0; $i<count($ambulance_count);$i++){
                //print_r($physiohterapy_count[$i]['Hematology']);
                (object)$postPatientambulaceCountData = ([
                        'ipd_opd' => 'opd',
                        'create_date' => $startDate2,
                        'ambulance_count' => $ambulance_count[$i]['ambulance'],
                    ]);
                $res = $this->db->insert('ambulance_opd_total_count', $postPatientambulaceCountData);
                                print_r($postPatientambulaceCountData);

               
                if($res)
                {
                    print_r('Ambulance Counting Inserted Successfully');
                }
            }
        }
        elseif($current_date > $push_date)
        {
            //print_r($res);
             $index = 0;
            //$PHYSIOTHERAPY = 0;
            $ambulance = 0;
            
            $startDate2 = date('Y-m-d', strtotime($push_date));
            print_r('OPD Amulance Counting Push Date');print_r(' ==>==>==>==> ');print_r($startDate2);print_r('<br>');
            
            if($res != '' || $res != null){

                $patientList = $this->db->select('*')
                ->from('patient')
                ->where('department_id','35')
                ->where('create_date',$startDate2)
                ->get()
                ->result();
                $college_address = 'Sagulwadi';
                $ambulance_number = 'MH12VK1418';
                
                foreach($patientList as $patient){
                    $ambulance = $ambulance + 1;
                            (object)$ambulancepatient = ([
                                    'patient_auto_id' => $patient->id,
                                    'name' => $patient->firstname,
                                    'ipd_opd' => $patient->ipd_opd,
                                    'dignosis' => $patient->dignosis,
                                    'department_id' => $patient->department_id,
                                    'create_date' => $startDate2,
                                    'address1' => $patient->address,
                                    'address2' => $college_address,
                                    'ambulance_no' => $ambulance_number,
                            ]);
                            $searchRes = $this->db->where('patient_auto_id',$patient->id)->get('ambulance_opd_report_result')->num_rows();
                            if($searchRes == 0){
                                $updateRes = $this->db->insert('ambulance_opd_report_result', $ambulancepatient);
                                print_r($ambulancepatient);
                            }
                    
                }
                $ambulance_count[$index] = [
                    'ambulance' => $ambulance,
                ];
                $index = $index + 1;
                print_r($ambulance_count);print_r("<br>");
            }
            else{
                $ambulance_count[$index] = [
                    'ambulance' => $ambulance,
                ];
                
                $index = $index + 1;
                print_r($ambulance_count);print_r("<br>");
            }
            
            for($i=0; $i<count($ambulance_count);$i++){
                //print_r($physiohterapy_count[$i]['Hematology']);
                (object)$postPatientambulaceCountData = ([
                        'ipd_opd' => 'opd',
                        'create_date' => $startDate2,
                        'ambulance_count' => $ambulance_count[$i]['ambulance'],
                    ]);
                $res = $this->db->insert('ambulance_opd_total_count', $postPatientambulaceCountData);
                                print_r($postPatientambulaceCountData);

               
                if($res)
                {
                    print_r('Ambulance Counting Inserted Successfully');
                }
            }
        }
        

    }
}
